!function(){define("discovery.vars",[],function(){"use strict";return{apiRoot:"/v1/",bootstrapUrls:["accounts/bootstrap"],routerConf:{pushState:!1,root:"/"},debugExportBBB:!0,debug:!1,useCache:!1,googleTrackingCode:"UA-37369750-6",googleTrackingOptions:"auto",orcidClientId:"APP-BA5POB6F5D7CTHX2",orcidLoginEndpoint:"https://orcid.org/oauth/authorize",orcidApiEndpoint:"/v1/orcid",recaptchaKey:"6Lf__gITAAAAAMjwyJnzWfuJi9NTbecK5p_2K4Hk"}}),define("analytics",["underscore","jquery"],function(e,t){var n={resolver:{hooks:["toc-link-followed","abstract-link-followed","citations-link-followed","associated-link-followed"],types:["abstract","citations","references","metrics","coreads","graphics","associated"],url:e.template("link_gateway/<%= bibcode %>/<%= target %>")}},i=function(i,a){(e.isString(i)||e.isPlainObject(a))&&e.forEach(n,function(n){var r;e.contains(n.hooks,i)&&e.contains(n.types,a.target)&&(r=a.url?a.url:n.url(a),t.ajax({url:r,type:"GET"}))})},a=window[window.GoogleAnalyticsObject];window[window.GoogleAnalyticsObject]=function(){try{a.q=a.q||[],a.q.push([arguments]),a.apply(a,arguments)}catch(e){console.info("google analytics event not tracked")}};return function(){i.apply(null,e.rest(arguments,3)),window[window.GoogleAnalyticsObject].apply(this,arguments)}}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hbs/handlebars",t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=i(n(1)),r=i(n(2)),s=n(3),o=n(4),l=i(n(5)),c=i(n(6)),u=i(n(7)),d=a.default.create;function h(){var e=d();return e.compile=function(t,n){return o.compile(t,n,e)},e.precompile=function(t,n){return o.precompile(t,n,e)},e.AST=r.default,e.Compiler=o.Compiler,e.JavaScriptCompiler=l.default,e.Parser=s.parser,e.parse=s.parse,e}var p=h();p.create=h,u.default(p),p.Visitor=c.default,p.default=p,t.default=p,e.exports=t.default},function(e,t,n){"use strict";var i=n(9).default,a=n(8).default;t.__esModule=!0;var r=i(n(10)),s=a(n(11)),o=a(n(12)),l=i(n(13)),c=i(n(14)),u=a(n(7));function d(){var e=new r.HandlebarsEnvironment;return l.extend(e,r),e.SafeString=s.default,e.Exception=o.default,e.Utils=l,e.escapeExpression=l.escapeExpression,e.VM=c,e.template=function(t){return c.template(t,e)},e}var h=d();h.create=d,u.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i={Program:function(e,t,n,i){this.loc=i,this.type="Program",this.body=e,this.blockParams=t,this.strip=n},MustacheStatement:function(e,t,n,i,a,r){this.loc=r,this.type="MustacheStatement",this.path=e,this.params=t||[],this.hash=n,this.escaped=i,this.strip=a},BlockStatement:function(e,t,n,i,a,r,s,o,l){this.loc=l,this.type="BlockStatement",this.path=e,this.params=t||[],this.hash=n,this.program=i,this.inverse=a,this.openStrip=r,this.inverseStrip=s,this.closeStrip=o},PartialStatement:function(e,t,n,i,a){this.loc=a,this.type="PartialStatement",this.name=e,this.params=t||[],this.hash=n,this.indent="",this.strip=i},ContentStatement:function(e,t){this.loc=t,this.type="ContentStatement",this.original=this.value=e},CommentStatement:function(e,t,n){this.loc=n,this.type="CommentStatement",this.value=e,this.strip=t},SubExpression:function(e,t,n,i){this.loc=i,this.type="SubExpression",this.path=e,this.params=t||[],this.hash=n},PathExpression:function(e,t,n,i,a){this.loc=a,this.type="PathExpression",this.data=e,this.original=i,this.parts=n,this.depth=t},StringLiteral:function(e,t){this.loc=t,this.type="StringLiteral",this.original=this.value=e},NumberLiteral:function(e,t){this.loc=t,this.type="NumberLiteral",this.original=this.value=Number(e)},BooleanLiteral:function(e,t){this.loc=t,this.type="BooleanLiteral",this.original=this.value="true"===e},UndefinedLiteral:function(e){this.loc=e,this.type="UndefinedLiteral",this.original=this.value=void 0},NullLiteral:function(e){this.loc=e,this.type="NullLiteral",this.original=this.value=null},Hash:function(e,t){this.loc=t,this.type="Hash",this.pairs=e},HashPair:function(e,t,n){this.loc=n,this.type="HashPair",this.key=e,this.value=t},helpers:{helperExpression:function(e){return!("SubExpression"!==e.type&&!e.params.length&&!e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!i.helpers.scopedId(e)&&!e.depth}}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default,a=n(9).default;t.__esModule=!0,t.parse=function(e,t){if("Program"===e.type)return e;return r.default.yy=u,u.locInfo=function(e){return new u.SourceLocation(t&&t.srcName,e)},(new o.default).accept(r.default.parse(e))};var r=i(n(15)),s=i(n(2)),o=i(n(16)),l=a(n(17)),c=n(13);t.parser=r.default;var u={};c.extend(u,l,s.default)},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.Compiler=l,t.precompile=function(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new a.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0);t.compat&&(t.useDepths=!0);var i=n.parse(e,t),r=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(r,t)},t.compile=function(e,t,n){var i=void 0===arguments[1]?{}:arguments[1];if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new a.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in i||(i.data=!0);i.compat&&(i.useDepths=!0);var r=void 0;function s(){var t=n.parse(e,i),a=(new n.Compiler).compile(t,i),r=(new n.JavaScriptCompiler).compile(a,i,void 0,!0);return n.template(r)}function o(e,t){return r||(r=s()),r.call(this,e,t)}return o._setup=function(e){return r||(r=s()),r._setup(e)},o._child=function(e,t,n,i){return r||(r=s()),r._child(e,t,n,i)},o};var a=i(n(12)),r=n(13),s=i(n(2)),o=[].slice;function l(){}function c(e,t){if(e===t)return!0;if(r.isArray(e)&&r.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!c(e[n],t[n]))return!1;return!0}}function u(e){if(!e.path.parts){var t=e.path;e.path=new s.default.PathExpression(!1,0,[t.original+""],t.original+"",t.loc)}}l.prototype={compiler:l,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],a=e.opcodes[n];if(i.opcode!==a.opcode||!c(i.args,a.args))return!1}t=this.children.length;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(t.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[n]=t,this.useDepths=this.useDepths||t.useDepths,n},accept:function(e){this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;i<n;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){u(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},PartialStatement:function(e){this.usePartial=!0;var t=e.params;if(t.length>1)throw new a.default("Unsupported number of partial arguments: "+t.length,e);t.length||t.push({type:"PathExpression",parts:[],depth:0});var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,void 0,void 0,!0);var r=e.indent||"";this.options.preventIndent&&r&&(this.opcode("appendContent",r),r=""),this.opcode("invokePartial",i,n,r),this.opcode("append")},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){u(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,a=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.accept(i),this.opcode("invokeAmbiguous",a,r)},simpleSexpr:function(e){this.accept(e.path),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),r=e.path,o=r.parts[0];if(this.options.knownHelpers[o])this.opcode("invokeKnownHelper",i.length,o);else{if(this.options.knownHelpersOnly)throw new a.default("You specified knownHelpersOnly, but used the unknown helper "+o,e);r.falsy=!0,this.accept(r),this.opcode("invokeHelper",i.length,r.original,s.default.helpers.simpleId(r))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=s.default.helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts)):this.opcode("lookupOnContext",e.parts,e.falsy,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");n<i;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:o.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=s.default.helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&s.default.helpers.helperExpression(e),a=!n&&(i||t);if(a&&!i){var r=e.path.parts[0],o=this.options;o.knownHelpers[r]?i=!0:o.knownHelpersOnly&&(a=!1)}return i?"helper":a?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||s.default.helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else(t=e.original||t).replace&&(t=t.replace(/^\.\//g,"").replace(/^\.$/g,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var a=e.params;return this.pushParams(a),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),a},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],a=i&&r.indexOf(i,e);if(i&&a>=0)return[t,a]}}}},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=n(10),r=i(n(12)),s=n(13),o=i(n(18));function l(e){this.value=e}function c(){}c.prototype={nameLookup:function(e,t){return c.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"['",t,"']"]},depthedLookup:function(e){return[this.aliasable("this.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=a.COMPILER_REVISION;return[e,a.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,n){return s.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var a=e.opcodes,s=void 0,o=void 0,l=void 0,c=void 0;for(l=0,c=a.length;l<c;l++)s=a[l],this.source.currentLocation=s.loc,o=o||s.loc,this[s.opcode].apply(this,s.args);if(this.source.currentLocation=o,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new r.default("Compile completed with content left on stack");var u=this.createFunctionContext(i);if(this.isChild)return u;var d={compiler:this.compilerInfo(),main:u},h=this.context.programs;for(l=0,c=h.length;l<c;l++)h[l]&&(d[l]=h[l]);return this.environment.usePartial&&(d.usePartial=!0),this.options.data&&(d.useData=!0),this.useDepths&&(d.useDepths=!0),this.useBlockParams&&(d.useBlockParams=!0),this.options.compat&&(d.compat=!0),i?d.compilerOptions=this.options:(d.compiler=JSON.stringify(d.compiler),this.source.currentLocation={start:{line:1,column:0}},d=this.objectLiteral(d),t.srcName?(d=d.toStringWithSourceMap({file:t.destName})).map=d.map&&d.map.toString():d=d.toString()),d},preamble:function(){this.lastContext=0,this.source=new o.default(this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var a in this.aliases){var r=this.aliases[a];this.aliases.hasOwnProperty(a)&&r.children&&r.referenceCount>1&&(t+=", alias"+ ++i+"="+a,r.children[0]="alias"+i)}var s=["depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&s.push("blockParams"),this.useDepths&&s.push("depths");var o=this.mergeSource(t);return e?(s.push(o),Function.apply(this,s)):this.source.wrap(["function(",s.join(","),") {\n  ",o,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,a=void 0,r=void 0,s=void 0;return this.source.each(function(e){e.appendToBuffer?(r?e.prepend("  + "):r=e,s=e):(r&&(a?r.prepend("buffer += "):i=!0,s.add(";"),r=s=void 0),a=!0,t||(n=!1))}),n?r?(r.prepend("return "),s.add(";")):a||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),r?(r.prepend("return buffer + "),s.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("this.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0)},resolvePath:function(e,t,n,i){var a=this;if(this.options.strict||this.options.assumeObjects)this.push(function(e,t,n,i){var a=t.popStack(),r=0,s=n.length;e&&s--;for(;r<s;r++)a=t.nameLookup(a,n[r],i);return e?[t.aliasable("this.strict"),"(",a,", ",t.quotedString(n[r]),")"]:a}(this.options.strict,this,t,e));else for(var r=t.length;n<r;n++)this.replaceStack(function(r){var s=a.nameLookup(r,t[n],e);return i?[" && ",s]:[" != null ? ",s," : ",r]})},resolvePossibleLambda:function(){this.push([this.aliasable("this.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){var i=this.popStack(),a=this.setupHelper(e,t),r=n?[a.name," || "]:"",s=["("].concat(r,i);this.options.strict||s.push(" || ",this.aliasable("helpers.helperMissing")),s.push(")"),this.push(this.source.functionCall(s,"call",a.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),a=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",n,")"];this.options.strict||(a[0]="(helper = ",a.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",a,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],a=this.setupParams(t,1,i,!1);e&&(t=this.popStack(),delete a.name),n&&(a.indent=JSON.stringify(n)),a.helpers="helpers",a.partials="partials",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(a.depths="depths"),a=this.objectLiteral(a),i.push(a),this.push(this.source.functionCall("this.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,a=void 0;this.trackIds&&(a=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var r=this.hash;n&&(r.contexts[e]=n),i&&(r.types[e]=i),a&&(r.ids[e]=a),r.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:c,compileChildren:function(e,t){for(var n=e.children,i=void 0,a=void 0,r=0,s=n.length;r<s;r++){i=n[r],a=new this.compiler;var o=this.matchExistingProgram(i);null==o?(this.context.programs.push(""),o=this.context.programs.length,i.index=o,i.name="program"+o,this.context.programs[o]=a.compile(i,t,this.context,!this.precompile),this.context.environments[o]=i,this.useDepths=this.useDepths||a.useDepths,this.useBlockParams=this.useBlockParams||a.useBlockParams):(i.index=o,i.name="program"+o,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"this.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof l||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new l(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,i=void 0,a=void 0;if(!this.isInline())throw new r.default("replaceStack on non-inline");var s=this.popStack(!0);if(s instanceof l)t=["(",n=[s.value]],a=!0;else{i=!0;var o=this.incrStack();t=["((",this.push(o)," = ",s,")"],n=this.topStack()}var c=e.call(this,n);a||this.popStack(),i&&this.stackSlot--,this.push(t.concat(c,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i instanceof l)this.compileStack.push(i);else{var a=this.incrStack();this.pushSource([a," = ",i,";"]),this.compileStack.push(a)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof l)return n.value;if(!t){if(!this.stackSlot)throw new r.default("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof l?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):((t=this.aliases[e]=this.source.wrap(e)).aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[];return{params:i,paramsInit:this.setupHelperArgs(t,e,i,n),name:this.nameLookup("helpers",t,"helper"),callParams:[this.contextName(0)].concat(i)}},setupParams:function(e,t,n){var i={},a=[],r=[],s=[],o=void 0;i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var l=this.popStack(),c=this.popStack();(c||l)&&(i.fn=c||"this.noop",i.inverse=l||"this.noop");for(var u=t;u--;)o=this.popStack(),n[u]=o,this.trackIds&&(s[u]=this.popStack()),this.stringParams&&(r[u]=this.popStack(),a[u]=this.popStack());return this.trackIds&&(i.ids=this.source.generateArray(s)),this.stringParams&&(i.types=this.source.generateArray(r),i.contexts=this.source.generateArray(a)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var a=this.setupParams(e,t,n,!0);return a=this.objectLiteral(a),i?(this.useRegister("options"),n.push("options"),["options=",a]):(n.push(a),"")}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=c.RESERVED_WORDS={},n=0,i=e.length;n<i;n++)t[e[n]]=!0}(),c.isValidJavaScriptVariableName=function(e){return!c.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=c,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=i(n(12)),r=i(n(2));function s(){this.parents=[]}s.prototype={constructor:s,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&(!n.type||!r.default[n.type]))throw new a.default('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new a.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:!1!==t?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},BlockStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash"),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")},PartialStatement:function(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=s,e.exports=t.default},function(e,t,n){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,i=t.Handlebars;e.noConflict=function(){t.Handlebars===e&&(t.Handlebars=i)}},e.exports=t.default}).call(t,function(){return this}())},function(e,t,n){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if("object"==typeof e&&null!==e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t,n){"use strict";var i=n(9).default,a=n(8).default;t.__esModule=!0,t.HandlebarsEnvironment=u,t.createFrame=p;var r=i(n(13)),s=a(n(12));t.VERSION="3.0.1";t.COMPILER_REVISION=6;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};var o=r.isArray,l=r.isFunction,c=r.toString;function u(e,t){var n;this.helpers=e||{},this.partials=t||{},(n=this).registerHelper("helperMissing",function(){if(1!==arguments.length)throw new s.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}),n.registerHelper("blockHelperMissing",function(e,t){var i=t.inverse,a=t.fn;if(!0===e)return a(this);if(!1===e||null==e)return i(this);if(o(e))return e.length>0?(t.ids&&(t.ids=[t.name]),n.helpers.each(e,t)):i(this);if(t.data&&t.ids){var s=p(t.data);s.contextPath=r.appendContextPath(t.data.contextPath,t.name),t={data:s}}return a(e,t)}),n.registerHelper("each",function(e,t){if(!t)throw new s.default("Must pass iterator to #each");var n=t.fn,i=t.inverse,a=0,c="",u=void 0,d=void 0;function h(t,i,a){u&&(u.key=t,u.index=i,u.first=0===i,u.last=!!a,d&&(u.contextPath=d+t)),c+=n(e[t],{data:u,blockParams:r.blockParams([e[t],t],[d+t,null])})}if(t.data&&t.ids&&(d=r.appendContextPath(t.data.contextPath,t.ids[0])+"."),l(e)&&(e=e.call(this)),t.data&&(u=p(t.data)),e&&"object"==typeof e)if(o(e))for(var f=e.length;a<f;a++)h(a,a,a===e.length-1);else{var g=void 0;for(var m in e)e.hasOwnProperty(m)&&(g&&h(g,a-1),g=m,a++);g&&h(g,a-1,!0)}return 0===a&&(c=i(this)),c}),n.registerHelper("if",function(e,t){return l(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),n.registerHelper("unless",function(e,t){return n.helpers.if.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),n.registerHelper("with",function(e,t){l(e)&&(e=e.call(this));var n=t.fn;if(r.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=p(t.data);i.contextPath=r.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),n.registerHelper("log",function(e,t){var i=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;n.log(i,e)}),n.registerHelper("lookup",function(e,t){return e&&e[t]})}u.prototype={constructor:u,logger:d,log:h,registerHelper:function(e,t){if("[object Object]"===c.call(e)){if(t)throw new s.default("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===c.call(e))r.extend(this.partials,e);else{if(void 0===t)throw new s.default("Attempting to register a partial as undefined");this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]}};var d={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(e,t){if("undefined"!=typeof console&&d.level<=e){var n=d.methodMap[e];(console[n]||console.log).call(console,t)}}};t.logger=d;var h=d.log;function p(e){var t=r.extend({},e);return t._parent=e,t}t.log=h},function(e,t,n){"use strict";function i(e){this.string=e}t.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},t.default=i,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i=["description","fileName","lineNumber","message","name","number","stack"];function a(e,t){var n=t&&t.loc,r=void 0,s=void 0;n&&(e+=" - "+(r=n.start.line)+":"+(s=n.start.column));for(var o=Error.prototype.constructor.call(this,e),l=0;l<i.length;l++)this[i[l]]=o[i[l]];Error.captureStackTrace&&Error.captureStackTrace(this,a),n&&(this.lineNumber=r,this.column=s)}a.prototype=new Error,t.default=a,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0,t.extend=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e},t.indexOf=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!r.test(e))return e;return e.replace(a,s)},t.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},a=/[&<>"'`]/g,r=/[&<>"'`]/;function s(e){return i[e]}var o,l=Object.prototype.toString;t.toString=l,(o=function(e){return"function"==typeof e})(/x/)&&(t.isFunction=o=function(e){return"function"==typeof e&&"[object Function]"===l.call(e)}),t.isFunction=o;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===l.call(e)};t.isArray=c},function(e,t,n){"use strict";var i=n(9).default,a=n(8).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=o.COMPILER_REVISION;if(t!==n){if(t<n){var i=o.REVISION_CHANGES[n],a=o.REVISION_CHANGES[t];throw new s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new s.default("No environment passed to template");if(!e||!e.main)throw new s.default("Unknown template object: "+typeof e);t.VM.checkRevision(e.compiler);var n={strict:function(e,t){if(!(t in e))throw new s.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:r.escapeExpression,invokePartial:function(n,i,a){a.hash&&(i=r.extend({},i,a.hash));n=t.VM.resolvePartial.call(this,n,i,a);var o=t.VM.invokePartial.call(this,n,i,a);null==o&&t.compile&&(a.partials[a.name]=t.compile(n,e.compilerOptions,t),o=a.partials[a.name](i,a));if(null!=o){if(a.indent){for(var l=o.split("\n"),c=0,u=l.length;c<u&&(l[c]||c+1!==u);c++)l[c]=a.indent+l[c];o=l.join("\n")}return o}throw new s.default("The partial "+a.name+" could not be compiled when running in runtime-only mode")},fn:function(t){return e[t]},programs:[],program:function(e,t,n,i,a){var r=this.programs[e],s=this.fn(e);return t||a||i||n?r=l(this,e,s,t,n,i,a):r||(r=this.programs[e]=l(this,e,s)),r},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=r.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};function i(t){var a=void 0===arguments[1]?{}:arguments[1],r=a.data;i._setup(a),!a.partial&&e.useData&&(r=function(e,t){t&&"root"in t||((t=t?o.createFrame(t):{}).root=e);return t}(t,r));var s=void 0,l=e.useBlockParams?[]:void 0;return e.useDepths&&(s=a.depths?[t].concat(a.depths):[t]),e.main.call(n,t,n.helpers,n.partials,r,l,s)}return i.isTop=!0,i._setup=function(i){i.partial?(n.helpers=i.helpers,n.partials=i.partials):(n.helpers=n.merge(i.helpers,t.helpers),e.usePartial&&(n.partials=n.merge(i.partials,t.partials)))},i._child=function(t,i,a,r){if(e.useBlockParams&&!a)throw new s.default("must pass block params");if(e.useDepths&&!r)throw new s.default("must pass parent depths");return l(n,t,e[t],i,0,a,r)},i},t.wrapProgram=l,t.resolvePartial=function(e,t,n){e?e.call||n.name||(n.name=e,e=n.partials[e]):e=n.partials[n.name];return e},t.invokePartial=function(e,t,n){if(n.partial=!0,void 0===e)throw new s.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=function(){return""};var r=i(n(13)),s=a(n(12)),o=n(10);function l(e,t,n,i,a,r,s){function o(t){var a=void 0===arguments[1]?{}:arguments[1];return n.call(e,t,e.helpers,e.partials,a.data||i,r&&[a.blockParams].concat(r),s&&[t].concat(s))}return o.program=t,o.depth=s?s.length:0,o.blockParams=a||0,o}},function(e,t,n){"use strict";t.__esModule=!0;var i=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,content:12,COMMENT:13,CONTENT:14,openRawBlock:15,END_RAW_BLOCK:16,OPEN_RAW_BLOCK:17,helperName:18,openRawBlock_repetition0:19,openRawBlock_option0:20,CLOSE_RAW_BLOCK:21,openBlock:22,block_option0:23,closeBlock:24,openInverse:25,block_option1:26,OPEN_BLOCK:27,openBlock_repetition0:28,openBlock_option0:29,openBlock_option1:30,CLOSE:31,OPEN_INVERSE:32,openInverse_repetition0:33,openInverse_option0:34,openInverse_option1:35,openInverseChain:36,OPEN_INVERSE_CHAIN:37,openInverseChain_repetition0:38,openInverseChain_option0:39,openInverseChain_option1:40,inverseAndProgram:41,INVERSE:42,inverseChain:43,inverseChain_option0:44,OPEN_ENDBLOCK:45,OPEN:46,mustache_repetition0:47,mustache_option0:48,OPEN_UNESCAPED:49,mustache_repetition1:50,mustache_option1:51,CLOSE_UNESCAPED:52,OPEN_PARTIAL:53,partialName:54,partial_repetition0:55,partial_option0:56,param:57,sexpr:58,OPEN_SEXPR:59,sexpr_repetition0:60,sexpr_option0:61,CLOSE_SEXPR:62,hash:63,hash_repetition_plus0:64,hashSegment:65,ID:66,EQUALS:67,blockParams:68,OPEN_BLOCK_PARAMS:69,blockParams_repetition_plus0:70,CLOSE_BLOCK_PARAMS:71,path:72,dataName:73,STRING:74,NUMBER:75,BOOLEAN:76,UNDEFINED:77,NULL:78,DATA:79,pathSegments:80,SEP:81,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",13:"COMMENT",14:"CONTENT",16:"END_RAW_BLOCK",17:"OPEN_RAW_BLOCK",21:"CLOSE_RAW_BLOCK",27:"OPEN_BLOCK",31:"CLOSE",32:"OPEN_INVERSE",37:"OPEN_INVERSE_CHAIN",42:"INVERSE",45:"OPEN_ENDBLOCK",46:"OPEN",49:"OPEN_UNESCAPED",52:"CLOSE_UNESCAPED",53:"OPEN_PARTIAL",59:"OPEN_SEXPR",62:"CLOSE_SEXPR",66:"ID",67:"EQUALS",69:"OPEN_BLOCK_PARAMS",71:"CLOSE_BLOCK_PARAMS",74:"STRING",75:"NUMBER",76:"BOOLEAN",77:"UNDEFINED",78:"NULL",79:"DATA",81:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[12,1],[10,3],[15,5],[9,4],[9,4],[22,6],[25,6],[36,6],[41,2],[43,3],[43,1],[24,3],[8,5],[8,5],[11,5],[57,1],[57,1],[58,5],[63,1],[65,3],[68,3],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[54,1],[54,1],[73,2],[72,1],[80,3],[80,1],[6,0],[6,2],[19,0],[19,2],[20,0],[20,1],[23,0],[23,1],[26,0],[26,1],[28,0],[28,2],[29,0],[29,1],[30,0],[30,1],[33,0],[33,2],[34,0],[34,1],[35,0],[35,1],[38,0],[38,2],[39,0],[39,1],[40,0],[40,1],[44,0],[44,1],[47,0],[47,2],[48,0],[48,1],[50,0],[50,2],[51,0],[51,1],[55,0],[55,2],[56,0],[56,1],[60,0],[60,2],[61,0],[61,1],[64,1],[64,2],[70,1],[70,2]],performAction:function(e,t,n,i,a,r,s){var o=r.length-1;switch(a){case 1:return r[o-1];case 2:this.$=new i.Program(r[o],null,{},i.locInfo(this._$));break;case 3:case 4:case 5:case 6:case 7:this.$=r[o];break;case 8:this.$=new i.CommentStatement(i.stripComment(r[o]),i.stripFlags(r[o],r[o]),i.locInfo(this._$));break;case 9:this.$=new i.ContentStatement(r[o],i.locInfo(this._$));break;case 10:this.$=i.prepareRawBlock(r[o-2],r[o-1],r[o],this._$);break;case 11:this.$={path:r[o-3],params:r[o-2],hash:r[o-1]};break;case 12:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!1,this._$);break;case 13:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!0,this._$);break;case 14:case 15:case 16:this.$={path:r[o-4],params:r[o-3],hash:r[o-2],blockParams:r[o-1],strip:i.stripFlags(r[o-5],r[o])};break;case 17:this.$={strip:i.stripFlags(r[o-1],r[o-1]),program:r[o]};break;case 18:var l=i.prepareBlock(r[o-2],r[o-1],r[o],r[o],!1,this._$),c=new i.Program([l],null,{},i.locInfo(this._$));c.chained=!0,this.$={strip:r[o-2].strip,program:c,chain:!0};break;case 19:this.$=r[o];break;case 20:this.$={path:r[o-1],strip:i.stripFlags(r[o-2],r[o])};break;case 21:case 22:this.$=i.prepareMustache(r[o-3],r[o-2],r[o-1],r[o-4],i.stripFlags(r[o-4],r[o]),this._$);break;case 23:this.$=new i.PartialStatement(r[o-3],r[o-2],r[o-1],i.stripFlags(r[o-4],r[o]),i.locInfo(this._$));break;case 24:case 25:this.$=r[o];break;case 26:this.$=new i.SubExpression(r[o-3],r[o-2],r[o-1],i.locInfo(this._$));break;case 27:this.$=new i.Hash(r[o],i.locInfo(this._$));break;case 28:this.$=new i.HashPair(i.id(r[o-2]),r[o],i.locInfo(this._$));break;case 29:this.$=i.id(r[o-1]);break;case 30:case 31:this.$=r[o];break;case 32:this.$=new i.StringLiteral(r[o],i.locInfo(this._$));break;case 33:this.$=new i.NumberLiteral(r[o],i.locInfo(this._$));break;case 34:this.$=new i.BooleanLiteral(r[o],i.locInfo(this._$));break;case 35:this.$=new i.UndefinedLiteral(i.locInfo(this._$));break;case 36:this.$=new i.NullLiteral(i.locInfo(this._$));break;case 37:case 38:this.$=r[o];break;case 39:this.$=i.preparePath(!0,r[o],this._$);break;case 40:this.$=i.preparePath(!1,r[o],this._$);break;case 41:r[o-2].push({part:i.id(r[o]),original:r[o],separator:r[o-1]}),this.$=r[o-2];break;case 42:this.$=[{part:i.id(r[o]),original:r[o]}];break;case 43:this.$=[];break;case 44:r[o-1].push(r[o]);break;case 45:this.$=[];break;case 46:r[o-1].push(r[o]);break;case 53:this.$=[];break;case 54:r[o-1].push(r[o]);break;case 59:this.$=[];break;case 60:r[o-1].push(r[o]);break;case 65:this.$=[];break;case 66:r[o-1].push(r[o]);break;case 73:this.$=[];break;case 74:r[o-1].push(r[o]);break;case 77:this.$=[];break;case 78:r[o-1].push(r[o]);break;case 81:this.$=[];break;case 82:r[o-1].push(r[o]);break;case 85:this.$=[];break;case 86:r[o-1].push(r[o]);break;case 89:this.$=[r[o]];break;case 90:r[o-1].push(r[o]);break;case 91:this.$=[r[o]];break;case 92:r[o-1].push(r[o])}},table:[{3:1,4:2,5:[2,43],6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],46:[2,43],49:[2,43],53:[2,43]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:[1,11],14:[1,18],15:16,17:[1,21],22:14,25:15,27:[1,19],32:[1,20],37:[2,2],42:[2,2],45:[2,2],46:[1,12],49:[1,13],53:[1,17]},{1:[2,1]},{5:[2,44],13:[2,44],14:[2,44],17:[2,44],27:[2,44],32:[2,44],37:[2,44],42:[2,44],45:[2,44],46:[2,44],49:[2,44],53:[2,44]},{5:[2,3],13:[2,3],14:[2,3],17:[2,3],27:[2,3],32:[2,3],37:[2,3],42:[2,3],45:[2,3],46:[2,3],49:[2,3],53:[2,3]},{5:[2,4],13:[2,4],14:[2,4],17:[2,4],27:[2,4],32:[2,4],37:[2,4],42:[2,4],45:[2,4],46:[2,4],49:[2,4],53:[2,4]},{5:[2,5],13:[2,5],14:[2,5],17:[2,5],27:[2,5],32:[2,5],37:[2,5],42:[2,5],45:[2,5],46:[2,5],49:[2,5],53:[2,5]},{5:[2,6],13:[2,6],14:[2,6],17:[2,6],27:[2,6],32:[2,6],37:[2,6],42:[2,6],45:[2,6],46:[2,6],49:[2,6],53:[2,6]},{5:[2,7],13:[2,7],14:[2,7],17:[2,7],27:[2,7],32:[2,7],37:[2,7],42:[2,7],45:[2,7],46:[2,7],49:[2,7],53:[2,7]},{5:[2,8],13:[2,8],14:[2,8],17:[2,8],27:[2,8],32:[2,8],37:[2,8],42:[2,8],45:[2,8],46:[2,8],49:[2,8],53:[2,8]},{18:22,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:33,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:34,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{4:35,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{12:36,14:[1,18]},{18:38,54:37,58:39,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,9],13:[2,9],14:[2,9],16:[2,9],17:[2,9],27:[2,9],32:[2,9],37:[2,9],42:[2,9],45:[2,9],46:[2,9],49:[2,9],53:[2,9]},{18:41,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:42,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:43,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[2,73],47:44,59:[2,73],66:[2,73],74:[2,73],75:[2,73],76:[2,73],77:[2,73],78:[2,73],79:[2,73]},{21:[2,30],31:[2,30],52:[2,30],59:[2,30],62:[2,30],66:[2,30],69:[2,30],74:[2,30],75:[2,30],76:[2,30],77:[2,30],78:[2,30],79:[2,30]},{21:[2,31],31:[2,31],52:[2,31],59:[2,31],62:[2,31],66:[2,31],69:[2,31],74:[2,31],75:[2,31],76:[2,31],77:[2,31],78:[2,31],79:[2,31]},{21:[2,32],31:[2,32],52:[2,32],59:[2,32],62:[2,32],66:[2,32],69:[2,32],74:[2,32],75:[2,32],76:[2,32],77:[2,32],78:[2,32],79:[2,32]},{21:[2,33],31:[2,33],52:[2,33],59:[2,33],62:[2,33],66:[2,33],69:[2,33],74:[2,33],75:[2,33],76:[2,33],77:[2,33],78:[2,33],79:[2,33]},{21:[2,34],31:[2,34],52:[2,34],59:[2,34],62:[2,34],66:[2,34],69:[2,34],74:[2,34],75:[2,34],76:[2,34],77:[2,34],78:[2,34],79:[2,34]},{21:[2,35],31:[2,35],52:[2,35],59:[2,35],62:[2,35],66:[2,35],69:[2,35],74:[2,35],75:[2,35],76:[2,35],77:[2,35],78:[2,35],79:[2,35]},{21:[2,36],31:[2,36],52:[2,36],59:[2,36],62:[2,36],66:[2,36],69:[2,36],74:[2,36],75:[2,36],76:[2,36],77:[2,36],78:[2,36],79:[2,36]},{21:[2,40],31:[2,40],52:[2,40],59:[2,40],62:[2,40],66:[2,40],69:[2,40],74:[2,40],75:[2,40],76:[2,40],77:[2,40],78:[2,40],79:[2,40],81:[1,45]},{66:[1,32],80:46},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{50:47,52:[2,77],59:[2,77],66:[2,77],74:[2,77],75:[2,77],76:[2,77],77:[2,77],78:[2,77],79:[2,77]},{23:48,36:50,37:[1,52],41:51,42:[1,53],43:49,45:[2,49]},{26:54,41:55,42:[1,53],45:[2,51]},{16:[1,56]},{31:[2,81],55:57,59:[2,81],66:[2,81],74:[2,81],75:[2,81],76:[2,81],77:[2,81],78:[2,81],79:[2,81]},{31:[2,37],59:[2,37],66:[2,37],74:[2,37],75:[2,37],76:[2,37],77:[2,37],78:[2,37],79:[2,37]},{31:[2,38],59:[2,38],66:[2,38],74:[2,38],75:[2,38],76:[2,38],77:[2,38],78:[2,38],79:[2,38]},{18:58,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{28:59,31:[2,53],59:[2,53],66:[2,53],69:[2,53],74:[2,53],75:[2,53],76:[2,53],77:[2,53],78:[2,53],79:[2,53]},{31:[2,59],33:60,59:[2,59],66:[2,59],69:[2,59],74:[2,59],75:[2,59],76:[2,59],77:[2,59],78:[2,59],79:[2,59]},{19:61,21:[2,45],59:[2,45],66:[2,45],74:[2,45],75:[2,45],76:[2,45],77:[2,45],78:[2,45],79:[2,45]},{18:65,31:[2,75],48:62,57:63,58:66,59:[1,40],63:64,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{66:[1,70]},{21:[2,39],31:[2,39],52:[2,39],59:[2,39],62:[2,39],66:[2,39],69:[2,39],74:[2,39],75:[2,39],76:[2,39],77:[2,39],78:[2,39],79:[2,39],81:[1,45]},{18:65,51:71,52:[2,79],57:72,58:66,59:[1,40],63:73,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{24:74,45:[1,75]},{45:[2,50]},{4:76,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{45:[2,19]},{18:77,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:78,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{24:79,45:[1,75]},{45:[2,52]},{5:[2,10],13:[2,10],14:[2,10],17:[2,10],27:[2,10],32:[2,10],37:[2,10],42:[2,10],45:[2,10],46:[2,10],49:[2,10],53:[2,10]},{18:65,31:[2,83],56:80,57:81,58:66,59:[1,40],63:82,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{59:[2,85],60:83,62:[2,85],66:[2,85],74:[2,85],75:[2,85],76:[2,85],77:[2,85],78:[2,85],79:[2,85]},{18:65,29:84,31:[2,55],57:85,58:66,59:[1,40],63:86,64:67,65:68,66:[1,69],69:[2,55],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,31:[2,61],34:87,57:88,58:66,59:[1,40],63:89,64:67,65:68,66:[1,69],69:[2,61],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,20:90,21:[2,47],57:91,58:66,59:[1,40],63:92,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[1,93]},{31:[2,74],59:[2,74],66:[2,74],74:[2,74],75:[2,74],76:[2,74],77:[2,74],78:[2,74],79:[2,74]},{31:[2,76]},{21:[2,24],31:[2,24],52:[2,24],59:[2,24],62:[2,24],66:[2,24],69:[2,24],74:[2,24],75:[2,24],76:[2,24],77:[2,24],78:[2,24],79:[2,24]},{21:[2,25],31:[2,25],52:[2,25],59:[2,25],62:[2,25],66:[2,25],69:[2,25],74:[2,25],75:[2,25],76:[2,25],77:[2,25],78:[2,25],79:[2,25]},{21:[2,27],31:[2,27],52:[2,27],62:[2,27],65:94,66:[1,95],69:[2,27]},{21:[2,89],31:[2,89],52:[2,89],62:[2,89],66:[2,89],69:[2,89]},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],67:[1,96],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{21:[2,41],31:[2,41],52:[2,41],59:[2,41],62:[2,41],66:[2,41],69:[2,41],74:[2,41],75:[2,41],76:[2,41],77:[2,41],78:[2,41],79:[2,41],81:[2,41]},{52:[1,97]},{52:[2,78],59:[2,78],66:[2,78],74:[2,78],75:[2,78],76:[2,78],77:[2,78],78:[2,78],79:[2,78]},{52:[2,80]},{5:[2,12],13:[2,12],14:[2,12],17:[2,12],27:[2,12],32:[2,12],37:[2,12],42:[2,12],45:[2,12],46:[2,12],49:[2,12],53:[2,12]},{18:98,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{36:50,37:[1,52],41:51,42:[1,53],43:100,44:99,45:[2,71]},{31:[2,65],38:101,59:[2,65],66:[2,65],69:[2,65],74:[2,65],75:[2,65],76:[2,65],77:[2,65],78:[2,65],79:[2,65]},{45:[2,17]},{5:[2,13],13:[2,13],14:[2,13],17:[2,13],27:[2,13],32:[2,13],37:[2,13],42:[2,13],45:[2,13],46:[2,13],49:[2,13],53:[2,13]},{31:[1,102]},{31:[2,82],59:[2,82],66:[2,82],74:[2,82],75:[2,82],76:[2,82],77:[2,82],78:[2,82],79:[2,82]},{31:[2,84]},{18:65,57:104,58:66,59:[1,40],61:103,62:[2,87],63:105,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{30:106,31:[2,57],68:107,69:[1,108]},{31:[2,54],59:[2,54],66:[2,54],69:[2,54],74:[2,54],75:[2,54],76:[2,54],77:[2,54],78:[2,54],79:[2,54]},{31:[2,56],69:[2,56]},{31:[2,63],35:109,68:110,69:[1,108]},{31:[2,60],59:[2,60],66:[2,60],69:[2,60],74:[2,60],75:[2,60],76:[2,60],77:[2,60],78:[2,60],79:[2,60]},{31:[2,62],69:[2,62]},{21:[1,111]},{21:[2,46],59:[2,46],66:[2,46],74:[2,46],75:[2,46],76:[2,46],77:[2,46],78:[2,46],79:[2,46]},{21:[2,48]},{5:[2,21],13:[2,21],14:[2,21],17:[2,21],27:[2,21],32:[2,21],37:[2,21],42:[2,21],45:[2,21],46:[2,21],49:[2,21],53:[2,21]},{21:[2,90],31:[2,90],52:[2,90],62:[2,90],66:[2,90],69:[2,90]},{67:[1,96]},{18:65,57:112,58:66,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,22],13:[2,22],14:[2,22],17:[2,22],27:[2,22],32:[2,22],37:[2,22],42:[2,22],45:[2,22],46:[2,22],49:[2,22],53:[2,22]},{31:[1,113]},{45:[2,18]},{45:[2,72]},{18:65,31:[2,67],39:114,57:115,58:66,59:[1,40],63:116,64:67,65:68,66:[1,69],69:[2,67],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,23],13:[2,23],14:[2,23],17:[2,23],27:[2,23],32:[2,23],37:[2,23],42:[2,23],45:[2,23],46:[2,23],49:[2,23],53:[2,23]},{62:[1,117]},{59:[2,86],62:[2,86],66:[2,86],74:[2,86],75:[2,86],76:[2,86],77:[2,86],78:[2,86],79:[2,86]},{62:[2,88]},{31:[1,118]},{31:[2,58]},{66:[1,120],70:119},{31:[1,121]},{31:[2,64]},{14:[2,11]},{21:[2,28],31:[2,28],52:[2,28],62:[2,28],66:[2,28],69:[2,28]},{5:[2,20],13:[2,20],14:[2,20],17:[2,20],27:[2,20],32:[2,20],37:[2,20],42:[2,20],45:[2,20],46:[2,20],49:[2,20],53:[2,20]},{31:[2,69],40:122,68:123,69:[1,108]},{31:[2,66],59:[2,66],66:[2,66],69:[2,66],74:[2,66],75:[2,66],76:[2,66],77:[2,66],78:[2,66],79:[2,66]},{31:[2,68],69:[2,68]},{21:[2,26],31:[2,26],52:[2,26],59:[2,26],62:[2,26],66:[2,26],69:[2,26],74:[2,26],75:[2,26],76:[2,26],77:[2,26],78:[2,26],79:[2,26]},{13:[2,14],14:[2,14],17:[2,14],27:[2,14],32:[2,14],37:[2,14],42:[2,14],45:[2,14],46:[2,14],49:[2,14],53:[2,14]},{66:[1,125],71:[1,124]},{66:[2,91],71:[2,91]},{13:[2,15],14:[2,15],17:[2,15],27:[2,15],32:[2,15],42:[2,15],45:[2,15],46:[2,15],49:[2,15],53:[2,15]},{31:[1,126]},{31:[2,70]},{31:[2,29]},{66:[2,92],71:[2,92]},{13:[2,16],14:[2,16],17:[2,16],27:[2,16],32:[2,16],37:[2,16],42:[2,16],45:[2,16],46:[2,16],49:[2,16],53:[2,16]}],defaultActions:{4:[2,1],49:[2,50],51:[2,19],55:[2,52],64:[2,76],73:[2,80],78:[2,17],82:[2,84],92:[2,48],99:[2,18],100:[2,72],105:[2,88],107:[2,58],110:[2,64],111:[2,11],123:[2,70],124:[2,29]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],a=[],r=this.table,s="",o=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;a.push(u);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,f,g,m,b,v,y,_,w,S={};;){if(f=n[n.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null!==h&&void 0!==h||(w=void 0,"number"!=typeof(w=t.lexer.lex()||1)&&(w=t.symbols_[w]||w),h=w),g=r[f]&&r[f][h]),void 0===g||!g.length||!g[0]){var E="";if(!c){for(b in _=[],r[f])this.terminals_[b]&&b>2&&_.push("'"+this.terminals_[b]+"'");E=this.lexer.showPosition?"Parse error on line "+(o+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(E,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:_})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:n.push(h),i.push(this.lexer.yytext),a.push(this.lexer.yylloc),n.push(g[1]),h=null,p?(h=p,p=null):(l=this.lexer.yyleng,s=this.lexer.yytext,o=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[g[1]][1],S.$=i[i.length-v],S._$={first_line:a[a.length-(v||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(v||1)].first_column,last_column:a[a.length-1].last_column},d&&(S._$.range=[a[a.length-(v||1)].range[0],a[a.length-1].range[1]]),void 0!==(m=this.performAction.call(S,s,l,o,this.yy,g[1],i,a)))return m;v&&(n=n.slice(0,-1*v*2),i=i.slice(0,-1*v),a=a.slice(0,-1*v)),n.push(this.productions_[g[1]][0]),i.push(S.$),a.push(S._$),y=r[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,n,i,a;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length&&(!(n=this._input.match(this.rules[r[s]]))||t&&!(n[0].length>t[0].length)||(t=n,i=s,this.options.flex));s++);return t?((a=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,n,i){function a(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(a(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(a(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),16;case 4:return 14;case 5:return this.popState(),13;case 6:return 59;case 7:return 62;case 8:return 17;case 9:return this.popState(),this.begin("raw"),21;case 10:return 53;case 11:return 27;case 12:return 45;case 13:case 14:return this.popState(),42;case 15:return 32;case 16:return 37;case 17:return 49;case 18:return 46;case 19:this.unput(t.yytext),this.popState(),this.begin("com");break;case 20:return this.popState(),13;case 21:return 46;case 22:return 67;case 23:case 24:return 66;case 25:return 81;case 26:break;case 27:return this.popState(),52;case 28:return this.popState(),31;case 29:return t.yytext=a(1,2).replace(/\\"/g,'"'),74;case 30:return t.yytext=a(1,2).replace(/\\'/g,"'"),74;case 31:return 79;case 32:case 33:return 76;case 34:return 77;case 35:return 78;case 36:return 75;case 37:return 69;case 38:return 71;case 39:case 40:return 66;case 41:return"INVALID";case 42:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,42],inclusive:!0}}};return e}();function n(){this.yy={}}return e.lexer=t,n.prototype=e,e.Parser=n,new n}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0;var a=i(n(6));function r(){}function s(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],a=e[t-2];return i?"ContentStatement"===i.type?(a||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function o(e,t,n){void 0===t&&(t=-1);var i=e[t+1],a=e[t+2];return i?"ContentStatement"===i.type?(a||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function l(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var a=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==a}}function c(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var a=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==a,i.leftStripped}}r.prototype=new a.default,r.prototype.Program=function(e){var t=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,a=n.length;i<a;i++){var r=n[i],u=this.accept(r);if(u){var d=s(n,i,t),h=o(n,i,t),p=u.openStandalone&&d,f=u.closeStandalone&&h,g=u.inlineStandalone&&d&&h;u.close&&l(n,i,!0),u.open&&c(n,i,!0),g&&(l(n,i),c(n,i)&&"PartialStatement"===r.type&&(r.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),p&&(l((r.program||r.inverse).body),c(n,i)),f&&(l(n,i),c((r.inverse||r.program).body))}}return e},r.prototype.BlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,a=n;if(n&&n.chained)for(i=n.body[0].program;a.chained;)a=a.body[a.body.length-1].program;var r={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:o(t.body),closeStandalone:s((i||t).body)};if(e.openStrip.close&&l(t.body,null,!0),n){var u=e.inverseStrip;u.open&&c(t.body,null,!0),u.close&&l(i.body,null,!0),e.closeStrip.open&&c(a.body,null,!0),s(t.body)&&o(i.body)&&(c(t.body),l(i.body))}else e.closeStrip.open&&c(t.body,null,!0);return r},r.prototype.MustacheStatement=function(e){return e.strip},r.prototype.PartialStatement=r.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=r,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},t.id=function(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e},t.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},t.stripComment=function(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")},t.preparePath=function(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",r=[],s=0,o=0,l=t.length;o<l;o++){var c=t[o].part,u=t[o].original!==c;if(i+=(t[o].separator||"")+c,u||".."!==c&&"."!==c&&"this"!==c)r.push(c);else{if(r.length>0)throw new a.default("Invalid path: "+i,{loc:n});".."===c&&(s++,"../")}}return new this.PathExpression(e,s,r,i,n)},t.prepareMustache=function(e,t,n,i,a,r){var s=i.charAt(3)||i.charAt(2),o="{"!==s&&"&"!==s;return new this.MustacheStatement(e,t,n,o,a,this.locInfo(r))},t.prepareRawBlock=function(e,t,n,i){if(e.path.original!==n){var r={loc:e.path.loc};throw new a.default(e.path.original+" doesn't match "+n,r)}i=this.locInfo(i);var s=new this.Program([t],null,{},i);return new this.BlockStatement(e.path,e.params,e.hash,s,void 0,{},{},{},i)},t.prepareBlock=function(e,t,n,i,r,s){if(i&&i.path&&e.path.original!==i.path.original){var o={loc:e.path.loc};throw new a.default(e.path.original+" doesn't match "+i.path.original,o)}t.blockParams=e.blockParams;var l=void 0,c=void 0;n&&(n.chain&&(n.program.body[0].closeStrip=i.strip),c=n.strip,l=n.program);r&&(r=l,l=t,t=r);return new this.BlockStatement(e.path,e.params,e.hash,t,l,e.strip,c,i&&i.strip,this.locInfo(s))};var a=i(n(12))},function(e,t,n){"use strict";t.__esModule=!0;var i=n(13),a=void 0;try{}catch(e){}function r(e,t,n){if(i.isArray(e)){for(var a=[],r=0,s=e.length;r<s;r++)a.push(t.wrap(e[r],n));return a}return"boolean"==typeof e||"number"==typeof e?e+"":e}function s(e){this.srcFile=e,this.source=[]}a||((a=function(e,t,n,i){this.src="",i&&this.add(i)}).prototype={add:function(e){i.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){i.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),s.prototype={prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=void 0===arguments[0]?this.currentLocation||{start:{}}:arguments[0];return new a(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof a?e:(e=r(e,this,t),new a(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=r(e[n],this);"undefined"!==i&&t.push([this.quotedString(n),":",i])}var a=this.generateList(t);return a.prepend("{"),a.add("}"),a},generateList:function(e,t){for(var n=this.empty(t),i=0,a=e.length;i<a;i++)i&&n.add(","),n.add(r(e[i],this,t));return n},generateArray:function(e,t){var n=this.generateList(e,t);return n.prepend("["),n.add("]"),n}},t.default=s,e.exports=t.default}])}),require.config({deps:"undefined"!=typeof window&&window.skipMain?[]:["js/apps/discovery/main"],waitSeconds:30,config:{es6:{modules:void 0},"js/components/persistent_storage":{namespace:"bumblebee"},"js/apps/discovery/main":{core:{controllers:{FeedbackMediator:"js/wraps/discovery_mediator",QueryMediator:"js/components/query_mediator",Diagnostics:"js/bugutils/diagnostics",AlertsController:"js/wraps/alerts_mediator",Orcid:"js/modules/orcid/module"},services:{Api:"js/services/api",PubSub:"js/services/pubsub",Navigator:"js/apps/discovery/navigator",PersistentStorage:"js/services/storage",HistoryManager:"js/components/history_manager"},objects:{User:"js/components/user",Session:"js/components/session",DynamicConfig:"discovery.vars",MasterPageManager:"js/page_managers/master",AppStorage:"js/components/app_storage",RecaptchaManager:"js/components/recaptcha_manager",CSRFManager:"js/components/csrf_manager",LibraryController:"js/components/library_controller",DocStashController:"js/components/doc_stash_controller"},modules:{FacetFactory:"js/widgets/facet/factory"}},widgets:{LandingPage:"js/wraps/landing_page_manager/landing_page_manager",SearchPage:"js/wraps/results_page_manager",DetailsPage:"js/wraps/abstract_page_manager/abstract_page_manager",AuthenticationPage:"js/wraps/authentication_page_manager",SettingsPage:"js/wraps/user_settings_page_manager/user_page_manager",OrcidPage:"js/wraps/orcid_page_manager/orcid_page_manager",OrcidInstructionsPage:"js/wraps/orcid-instructions-page-manager/manager",LibrariesPage:"js/wraps/libraries_page_manager/libraries_page_manager",HomePage:"js/wraps/home_page_manager/home_page_manager",PublicLibrariesPage:"js/wraps/public_libraries_page_manager/public_libraries_manager",ErrorPage:"js/wraps/error_page_manager/error_page_manager",Authentication:"js/widgets/authentication/widget",UserSettings:"js/widgets/user_settings/widget",UserPreferences:"js/widgets/preferences/widget",LibraryImport:"js/widgets/library_import/widget",BreadcrumbsWidget:"js/widgets/filter_visualizer/widget",NavbarWidget:"js/widgets/navbar/widget",UserNavbarWidget:"js/widgets/user_navbar/widget",AlertsWidget:"js/widgets/alerts/widget",ClassicSearchForm:"js/widgets/classic_form/widget",SearchWidget:"js/widgets/search_bar/search_bar_widget",PaperSearchForm:"js/widgets/paper_search_form/widget",Results:"js/widgets/results/widget",QueryInfo:"js/widgets/query_info/query_info_widget",QueryDebugInfo:"js/widgets/api_query/widget",ExportWidget:"es6!js/widgets/export/widget.jsx",Sort:"es6!js/widgets/sort/widget.jsx",ExportDropdown:"js/wraps/export_dropdown",VisualizationDropdown:"js/wraps/visualization_dropdown",AuthorNetwork:"js/wraps/author_network",PaperNetwork:"js/wraps/paper_network",ConceptCloud:"js/widgets/wordcloud/widget",BubbleChart:"js/widgets/bubble_chart/widget",AuthorAffiliationTool:"es6!js/widgets/author_affiliation_tool/widget.jsx",Metrics:"js/widgets/metrics/widget",CitationHelper:"js/widgets/citation_helper/widget",OrcidBigWidget:"js/modules/orcid/widget/widget",OrcidSelector:"es6!js/widgets/orcid-selector/widget.jsx",AuthorFacet:"js/wraps/author_facet",BibgroupFacet:"js/wraps/bibgroup_facet",BibstemFacet:"js/wraps/bibstem_facet",DataFacet:"js/wraps/data_facet",DatabaseFacet:"js/wraps/database_facet",GrantsFacet:"js/wraps/grants_facet",KeywordFacet:"js/wraps/keyword_facet",ObjectFacet:"js/wraps/simbad_object_facet",NedObjectFacet:"js/wraps/ned_object_facet",RefereedFacet:"js/wraps/refereed_facet",VizierFacet:"js/wraps/vizier_facet",GraphTabs:"js/wraps/graph_tabs",FooterWidget:"js/widgets/footer/widget",PubtypeFacet:"js/wraps/pubtype_facet",ShowAbstract:"js/widgets/abstract/widget",ShowGraphics:"js/widgets/graphics/widget",ShowGraphicsSidebar:"js/wraps/sidebar-graphics-widget",ShowReferences:"js/wraps/references",ShowCitations:"js/wraps/citations",ShowCoreads:"js/wraps/coreads",MetaTagsWidget:"js/widgets/meta_tags/widget",ShowTableofcontents:"js/wraps/table_of_contents",ShowResources:"es6!js/widgets/resources/widget.jsx",ShowAssociated:"es6!js/widgets/associated/widget.jsx",ShowRecommender:"js/widgets/recommender/widget",ShowMetrics:"js/wraps/paper_metrics",ShowPaperExport:"js/wraps/paper_export",ShowLibraryAdd:"js/wraps/abstract_page_library_add/widget",IndividualLibraryWidget:"js/widgets/library_individual/widget",AllLibrariesWidget:"js/widgets/libraries_all/widget",LibraryListWidget:"js/widgets/library_list/widget"},plugins:{}}},map:{"*":{pubsub_service_impl:"js/services/default_pubsub"}},paths:{config:"./discovery.config",main:"js/apps/discovery/main",router:"js/apps/discovery/router",analytics:"js/components/analytics",underscore:["//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.2/lodash.min","libs/lodash/lodash.compat"],async:"libs/requirejs-plugins/async",babel:"libs/requirejs-babel-plugin/babel-5.8.34.min",backbone:["//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min","libs/backbone/backbone"],"backbone-validation":["//cdnjs.cloudflare.com/ajax/libs/backbone.validation/0.11.3/backbone-validation-amd-min","libs/backbone-validation/backbone-validation"],"backbone.stickit":["//cdnjs.cloudflare.com/ajax/libs/backbone.stickit/0.8.0/backbone.stickit.min","libs/backbone.stickit/backbone.stickit"],"backbone.wreqr":["//cdnjs.cloudflare.com/ajax/libs/backbone.wreqr/1.0.0/backbone.wreqr.min","libs/backbone.wreqr/lib/backbone.wreqr"],bootstrap:["//ajax.aspnetcdn.com/ajax/bootstrap/3.3.5/bootstrap.min","libs/bootstrap/bootstrap"],cache:"libs/dsjslib/lib/Cache",chai:"../bower_components/chai/chai",classnames:["//cdnjs.cloudflare.com/ajax/libs/classnames/2.2.5/index.min","../bower_components/classnames/index"],clipboard:["//cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min","libs/clipboard/clipboard"],"create-react-class":["//cdn.jsdelivr.net/npm/create-react-class@15.6.2/create-react-class.min","libs/create-react-class/index"],d3:["//cdnjs.cloudflare.com/ajax/libs/d3/3.4.6/d3.min","libs/d3/d3.min"],"d3-cloud":["//cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min","libs/d3-cloud/d3.layout.cloud"],enzyme:"libs/enzyme/enzyme","es5-shim":["//cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.10/es5-shim.min","libs/es5-shim/es5-shim"],es6:"libs/requirejs-babel-plugin/es6",filesaver:["//cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min","libs/file-saver/index"],"google-analytics":["//google-analytics.com/analytics","data:application/javascript,"],"google-recaptcha":["//google.com/recaptcha/api.js?&render=explicit&onload=onRecaptchaLoad","data:application/javascript,"],hbs:"libs/require-handlebars-plugin/hbs",immutable:"libs/immutable/index",jquery:["//ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min","libs/jquery/jquery"],"jquery-querybuilder":"libs/jQuery-QueryBuilder/query-builder","jquery-ui":["//ajax.aspnetcdn.com/ajax/jquery.ui/1.10.4/jquery-ui.min","libs/jqueryui/jquery-ui"],jsonpath:["//cdn.jsdelivr.net/npm/jsonpath@0.2.12/jsonpath.min","libs/jsonpath/jsonpath"],marionette:["//cdnjs.cloudflare.com/ajax/libs/backbone.marionette/2.4.5/backbone.marionette.min","libs/marionette/backbone.marionette"],mathjax:["//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured","libs/mathjax/index"],mocha:"libs/mocha/mocha",moment:["//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min","libs/momentjs/moment"],"persist-js":["//cdn.jsdelivr.net/npm/persist-js@0.3.1/src/persist.min","libs/persist-js/src/persist"],react:["//cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-with-addons.min","libs/react/index"],"react-bootstrap":["//cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.32.1/react-bootstrap.min","libs/react-bootstrap/index"],"react-dom":["//cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min","libs/react-dom/index"],"react-prop-types":["//cdnjs.cloudflare.com/ajax/libs/prop-types/15.6.0/prop-types.min","libs/react-prop-types/index"],"react-redux":["//cdnjs.cloudflare.com/ajax/libs/react-redux/4.4.5/react-redux.min","libs/react-redux/index"],redux:["//cdnjs.cloudflare.com/ajax/libs/redux/3.5.2/redux.min","libs/redux/index"],"redux-immutable":"libs/redux-immutable/index","redux-thunk":["//cdnjs.cloudflare.com/ajax/libs/redux-thunk/2.1.0/redux-thunk.min","libs/redux-thunk/index"],select2:["//cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min","libs/select2/select2"],sinon:["//cdnjs.cloudflare.com/ajax/libs/sinon.js/1.9.0/sinon.min","../bower_components/sinon/index"],sprintf:["//cdnjs.cloudflare.com/ajax/libs/sprintf/1.0.2/sprintf.min","libs/sprintf/sprintf"],utils:"js/utils",reselect:["//cdnjs.cloudflare.com/ajax/libs/reselect/3.0.1/reselect.min","libs/reselect"]},hbs:{templateExtension:"html",helpers:!1},shim:{Backbone:{deps:["backbone"],exports:"Backbone"},mocha:{exports:"mocha"},"backbone.stickit":{deps:["backbone"]},"backbone-validation":{deps:["backbone"]},bootstrap:{deps:["jquery","jquery-ui"]},backbone:{deps:["jquery","underscore"]},marionette:{deps:["jquery","underscore","backbone"],exports:"Marionette"},analytics:{deps:["google-analytics"]},cache:{exports:"Cache"},"jquery-querybuilder":{deps:["jquery"]},filesaver:{exports:"saveAs"},d3:{exports:"d3"},"d3-cloud":{deps:["d3"]},"google-analytics":{exports:"__ga__"},"jquery-ui":{deps:["jquery"]},sprintf:{exports:"sprintf"},"persist-js":{exports:"Persist"},mathjax:{exports:"MathJax",init:function(){return MathJax.Hub.Config({messageStyle:"none",HTML:["input/TeX","output/HTML-CSS"],TeX:{extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:!0}}}),MathJax.Hub.Startup.onload(),MathJax}},"redux-immutable":{deps:["immutable"]}},callback:function(){window.GoogleAnalyticsObject="__ga__",require(["discovery.vars","google-analytics","analytics"],function(e){var t=window[window.GoogleAnalyticsObject];t.l=Date.now(),t("create",e.googleTrackingCode||"",e.googleTrackingOptions)}),require(["hbs/handlebars"],function(e){e.registerHelper("compare",function(e,t,n){var i,a;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(!(i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return typeof e==t}})[a=void 0!==n&&n.hash&&n.hash.operator?n.hash.operator:"==="])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+a);return i[a](e,t)?n.fn(this):n.inverse(this)})}),require(["backbone-validation"],function(){_.extend(Backbone.Validation.callbacks,{valid:function(e,t,n){e.$("input[name="+t+"]").closest(".form-group").removeClass("has-error").find(".help-block").html("").addClass("no-show")},invalid:function(e,t,n,i){var a=e.$("[name="+t+"]");$group=a.closest(".form-group"),!0===e.submit&&($group.addClass("has-error"),$group.find(".help-block").html(n).removeClass("no-show"))}})}),require(["d3","d3-cloud"],function(e,t){var n=window;n.d3||(n.d3=e),n.d3&&n.d3.layout&&!n.d3.layout.cloud&&(n.d3.layout.cloud=t),e.legend=function(t){return t.each(function(){var t=e.select(this),n={},i=e.select(t.property("nearestViewportElement")),a=t.attr("data-style-padding")||5,r=t.selectAll(".legend-box").data([!0]),s=t.selectAll(".legend-items").data([!0]);r.enter().append("rect").classed("legend-box",!0),s.enter().append("g").classed("legend-items",!0);try{i.selectAll("[data-legend]").each(function(){var t=e.select(this);n[t.attr("data-legend")]={pos:t.attr("data-legend-pos")||this.getBBox().y,color:void 0!=t.attr("data-legend-color")?t.attr("data-legend-color"):"none"!=t.style("fill")?t.style("fill"):t.style("stroke")}})}catch(e){}n=e.entries(n).sort(function(e,t){return e.value.pos-t.value.pos});var o=0;s.selectAll("text").data(n,function(e){return e.key}).call(function(e){e.enter().append("text")}).call(function(e){e.exit().remove()}).attr("y",function(e,t){return 0===t?"0em":t+(o+=.2)+"em"}).attr("x","1em").text(function(e){return e.key}),s.selectAll("circle").data(n,function(e){return e.key}).call(function(e){e.enter().append("circle")}).call(function(e){e.exit().remove()}).attr("cy",function(e,t){return t-.25+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(e){return e.value.color});var l=s[0][0].getBBox();r.attr("x",l.x-a).attr("y",l.y-a).attr("height",l.height+2*a).attr("width",l.width+2*a)}),t}})}}),define("config",function(){});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};define("js/components/multi_params",["backbone","underscore","jquery"],function(e,t,n){return e.Model.extend({locked:!1,_checkLock:function(){if(!0===this.locked)throw Error("Object locked for modifications")},isLocked:function(){return this.locked},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},clone:function(){if(this.isLocked()){var e=new this.constructor(this.attributes);return e.lock(),e}return new this.constructor(this.attributes)},_validate:function(e,n){for(var i in e){if(!t.isString(i))throw new Error("Keys must be strings, not: "+i);var a=e[i];if(a=t.without(t.flatten(a),"",!1,null,void 0,NaN),!t.isArray(a))throw new Error("Values were not converted to an Array");if(t.isEmpty(a)&&!0!==n.unset)throw new Error("Empty values not allowed");if(!t.every(a,function(e){return t.isString(e)||t.isNumber(e)&&!t.isNaN(e)}))throw new Error("Invalid value (not a string or number): "+a);e[i]=a}return!0},set:function(n,i,a){var r;if(this._checkLock(),null==n)return this;for(var s in"object"===(void 0===n?"undefined":_typeof(n))?(r=n,a=i):(r={})[n]=i,r){var o=r[s];t.isArray(o)||(r[s]=t.flatten([o]))}e.Model.prototype.set.call(this,r,a)},unset:function(){this._checkLock(),e.Model.prototype.unset.apply(this,arguments)},add:function(n,i,a){var r;if(this._checkLock(),null==n)return this;for(var s in"object"===(void 0===n?"undefined":_typeof(n))?(r=n,a=i):(r={})[n]=i,r){var o=r[s];t.isArray(o)||(o=t.flatten([o])),this.has(s)&&(o=t.clone(this.get(s)).concat(o)),r[s]=o}e.Model.prototype.set.call(this,r,a)},sync:function(){throw Error("MultiParams cannot be saved to server")},url:function(e){e||(e=this.attributes);var i=t.pairs(e).sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}),a=n.param(t.object(i),!0);return a=(a=a.replace(/\+/g,"%20")).replace(/%E2%80%9[ECD]/g,"%22")},parse:function(e,n){if(t.isString(e)){var i={};return(e=decodeURI(e)).indexOf("?")>-1&&(i["#path"]=[e.slice(0,e.indexOf("?"))],e=e.slice(e.indexOf("?")+1)),e.indexOf("#")>-1&&(i["#hash"]=this._parse(e.slice(e.indexOf("#")+1)),e=e.slice(0,e.indexOf("#"))),i["#query"]=this._parse(e),this._checkParsed(i)}return this._checkParsed(e)},_parse:function(e){var t,n={};if(!e.trim())return n;for(var i,a,r=e.slice(e.indexOf("?")+1).split("&"),s=0;s<r.length;s++){t=r[s].split("="),i=decodeURIComponent(t[0].split("+").join(" "));var o=t[1];t.length>2&&(t.shift(),o=t.join("=")),a=decodeURIComponent(o.split("+").join(" ")),void 0!==n[i]?n[i].push(a):n[i]=[a]}return n},_checkParsed:function(e){return t.isObject(e)&&"#query"in e?e["#query"]:e},load:function(e){this._checkLock();var t=this.parse(e);return this.clear(),this.set(t),this}})}),define("js/components/solr_params",["js/components/multi_params","backbone","underscore","jquery"],function(e,t,n,i){return e.extend({fieldsToConcatenate:[],defaultOperator:" ",fieldProcessors:{"*":function(e,t){return[e.join(t.defaultOperator)]}},initialize:function(e,t){t&&n.extend(this,n.pick(t,["fieldsToConcatenate","defaultOperator","fieldProcessors"]))},url:function(t,i){for(var a=n.clone(this.attributes),r=this.fieldsToConcatenate.length,s="",o=0;o<r;o++)s=this.fieldsToConcatenate[o],this.has(s)&&(this.fieldProcessors[s]?a[s]=this.fieldProcessors[s](this.get(s),this):a[s]=this.fieldProcessors["*"](this.get(s),this));return e.prototype.url.call(this,a)}})}),define("js/components/facade",["underscore","js/components/facade"],function(e,t){return(t=function(e,t){var n;return n={},this.mixIn(e,t,n),n.mixIn=this.mixIn,n}).prototype.mixIn=function(t,n,i){var a,r;for(a in i=i||this,t)if(r=t[a],a in n){var s=n[a];if("function"==typeof r)i[a]=e.bind(r,n);else if("function"==typeof s)i[a]=e.bind(s,n);else if(e.isUndefined(s));else if(e.isString(s)||e.isNumber(s)||e.isBoolean(s)||e.isDate(s)||e.isNull(s)||e.isRegExp(s))i["get"+a.substring(0,1).toUpperCase()+a.substring(1)]=e.bind(function(){return this.ctx[this.name]},{ctx:n,name:a}),i[a]=s;else if(s.hasOwnProperty("__facade__")&&s.__facade__)i[a]=s;else{if(!(e.isObject(s)&&"getHardenedInstance"in s))throw new Error("Sorry, you can't wrap '"+a+"': "+s);i[a]=s.getHardenedInstance()}}else{if("function"!=typeof r)throw new Error("Unknown key: "+a+"("+r+")");i[a]=e.bind(r,n)}return i.__facade__=!n||Boolean(!n.constructor||(!n.constructor.name||n.constructor.name)),i},t}),define("js/components/api_query",["backbone","underscore","js/components/solr_params","js/components/facade"],function(e,t,n,i){var a={add:"add values",set:"set (replace existing)",get:"get values",has:"has a key",url:"url string of the params",load:"loads query as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},r=function(e,t){this.innerQuery=new i(a,e instanceof n?e:new n(e,t))},s={};return t.each(t.keys(a),function(e,t,n){s[e]=function(){return this.innerQuery[e].apply(this.innerQuery,arguments)}}),t.extend(r.prototype,s,{clone:function(){var e=this.innerQuery.clone.apply(this.innerQuery,arguments);return new r(e)},load:function(){var e=this.innerQuery.load.apply(this.innerQuery,arguments);return new r(e)}}),r}),define("js/components/pubsub_events",[],function(){return{START_SEARCH:"[PubSub]-New-Query",INVITING_REQUEST:"[PubSub]-Inviting-Request",DELIVERING_REQUEST:"[PubSub]-New-Request",EXECUTE_REQUEST:"[PubSub]-Execute-Request",EXECUTE_STORED_QUERY:"[PubSub]-Execute-Stored-Query",DELIVERING_RESPONSE:"[PubSub]-New-Response",CLOSING_GATES:"[PubSub]-Closing",CLOSED_FOR_BUSINESS:"[PubSub]-Closed",OPENING_GATES:"[PubSub]-Opening",OPEN_FOR_BUSINESS:"[PubSub]-Ready",SMALL_FIRE:"[PubSub]-Problem",BIG_FIRE:"[PubSub]-Big-Problem",CITY_BURNING:"[PubSub]-Disaster",FEEDBACK:"[FC]-FeedBack",DISPLAY_DOCUMENTS:"[Router]-Display-Documents",DISPLAY_DOCUMENTS_DETAILS:"[Router]-Display-Documents-Details",GET_QTREE:"[FC]-GetQTree",NAVIGATE:"[Router]-Navigate-With-Trigger",PAGE_CHANGE:"[Navigator]Page-Changed",CUSTOM_EVENT:"[PubSub]-Custom-Event",ARIA_ANNOUNCEMENT:"[PubSub]-Aria-Announcement",USER_ANNOUNCEMENT:"[PubSub]-User-Announcement",ALERT:"[Alert]-Message",ORCID_ANNOUNCEMENT:"[PubSub]-Orcid-Announcement",APP_LOADED:"[App]-Application-Loaded",APP_BOOTSTRAPPED:"[App]-Application-Bootstrapped",APP_STARTING:"[App]-Application-Starting",APP_STARTED:"[App]-Application-Started",APP_EXIT:"[App]-Exit",PAPER_SELECTION:"[User]-Paper-Selection",BULK_PAPER_SELECTION:"[User]-Bulk-Paper-Selection",STORAGE_PAPER_UPDATE:"[User]-Paper-Update",LIBRARY_CHANGE:"[PubSub]-Library-Change"}}),define("js/components/pubsub_key",["underscore"],function(e){var t=function(t){e.extend(this,t)};return e.extend(t,{newInstance:function(n){var i={id:e.has(n,"id")?n.id:e.uniqueId(":psk"),creator:e.has(n,"creator")?n.creator:null};return new t({getId:function(){return i.id},getCreator:function(){return i.creator}})}}),t}),define("js/mixins/dependon",["underscore","js/components/pubsub_events","js/components/pubsub_key"],function(e,t,n){return{BeeHive:{setBeeHive:function(t){if(e.isEmpty(t))throw new Error("Huh? Empty Beehive? Trying to be funny?");this.__beehive=t},getBeeHive:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactivate (or dead :<})");return this.__beehive},hasBeeHive:function(){return!(!this.__beehive||!(this.__beehive.active||this.__beehive.__facade__&&this.__beehive.getActive()))},getPubSub:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactive (or dead >:})");if(this.__ctx||(this.__ctx={}),this.__ctx.pubsub)return this.__ctx.pubsub;var i=this.__beehive.getService("PubSub");return i&&i.__facade__?i:(this.__ctx.pubsub={_key:i.getPubSubKey(),_exec:function(t,a){if((a=e.toArray(a))[0]instanceof n)throw Error("You have given us a PubSub key, this.publish() method does not need it.");a.unshift(this._key),i[t].apply(i,a)},publish:function(){this._exec("publish",arguments)},subscribe:function(){this._exec("subscribe",arguments)},subscribeOnce:function(){this._exec("subscribeOnce",arguments)},unpublish:function(){this._exec("unpublish",arguments)},getCurrentPubSubKey:function(){return this._key}},e.extend(this.__ctx.pubsub,t),this.__ctx.pubsub)},hasPubSub:function(){return!!this.hasBeeHive()&&e.isObject(this.__beehive.getService("PubSub"))}},App:{setApp:function(t){if(e.isUndefined(t))throw new Error("App object cannot be empty");this.__app=t},getApp:function(){return this.__app},hasApp:function(){return!e.isEmpty(this.__app)}}}}),define("js/mixins/hardened",["underscore","js/components/facade"],function(e,t){return{_getHardenedInstance:function(e,n){if(!("hardenedInterface"in this||e))throw Error("Error: this.hardenedInterface is not defined");return new t(e||("hardenedInterface"in this?this.hardenedInterface:{}),n)},getHardenedInstance:function(e){return this._getHardenedInstance(e,this)}}}),define("js/components/api_feedback",["underscore","backbone","js/mixins/hardened"],function(e,t,n){var i=function(t){e.extend(this,e.defaults(t||{},{code:200,msg:void 0})),this.setCode(this.code)};i.CODES={INVALID_PASSWORD:498,ACCOUNT_NOT_FOUND:495,ALREADY_LOGGED_IN:493,REQUIRES_LOGIN:491,TOO_MANY_CHARACTERS:486,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,INTERNAL_SERVER_ERROR:500,BAD_GATEWAY:502,SERVER_ERROR:503,TOO_MANY_FAILURES:580,ALL_FINE:200,KEEP_WAITING:190,TESTING:0,MAKE_SPACE:-1,UNMAKE_SPACE:-1.1,SEARCH_CYCLE_STARTED:-2,SEARCH_CYCLE_FAILED_TO_START:-3,SEARCH_CYCLE_PROGRESS:-4,SEARCH_CYCLE_STOP_MONITORING:-5,SEARCH_CYCLE_FINISHED:-6,QUERY_ASSISTANT:-7,ALERT:-8,CANNOT_ROUTE:-9,API_REQUEST_ERROR:-10,BIBCODE_DATA_REQUESTED:-11};var a={};return e.each(e.pairs(i.CODES),function(e){a[e[1]]=e[0]}),e.extend(i.prototype,{hardenedInterface:{code:"integer value of the code",msg:"string message",toJSON:"for cloning",getApiRequest:"to get the original request",getSenderKey:"retrieve the senders key"},initialize:function(){},toJSON:function(){return{code:this.code,msg:this.msg}},setCode:function(e){if(!a[e])throw new Error("This code is not in the list ApiCodes - please extend js/components/api_feedback first:",this.code);this.code=e},setApiRequest:function(e){this.req=e},getApiRequest:function(){return this.req},setMsg:function(e){this.msg=e},getSenderKey:function(){return this.senderKey},setSenderKey:function(e){this.senderKey=e}},n),i.extend=t.Model.extend,i});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};define("js/components/default_request",["underscore","backbone","js/components/api_query","js/components/multi_params"],function(e,t,n,i){var a=function(t){if(e.isString(t))return!0;if(e.isArray(t))for(var n=t.length,i=0;i<n;i++){var a=t[i];if(!e.isString(a)&&!e.isNumber(a))return!1}return!0},r={query:function(t){return!!e.isUndefined(t)||t instanceof n},target:a,sender:a,options:a};return i.extend({_validate:function(t,n){return e.forOwn(t,function(e,n){var i=t[n];if(!(n in r))throw new Error("Invalid attr: "+n);if(!r[n].call(r,i))throw new Error("Invalid value:key "+n+i)}),!0},set:function(e,n,i){var a;if(this._checkLock(),null==e)return this;"object"===(void 0===e?"undefined":_typeof(e))?(a=e,i=n):(a={})[e]=n,t.Model.prototype.set.call(this,a,i)},_checkParsed:function(t){if(e.isObject(t)){var i={};return"#query"in t&&!e.isEmpty(t["#query"])&&(i.query=new n(t["#query"])),"#path"in t&&(i.target=t["#path"][0]),"#hash"in t&&e.extend(i,e.each(t["#hash"],function(e,t,n){1==e.length&&(n[t]=e[0])})),i}return t},url:function(t){t||(t=this.attributes);var n=t.target,a=n?e.isArray(n)?n.join("/"):n:"";return"query"in t&&(a+="?"+t.query.url()),"sender"in t&&(a+="#"+i.prototype.url.call(this,{sender:t.sender})),a},load:function(e){return i.prototype.load.call(this,e.indexOf("?")>-1?e:e+"?")}})}),define("js/components/api_request",["underscore","backbone","js/components/facade","js/components/default_request"],function(e,t,n,i){var a={get:"get a key",set:"set (replace existing)",url:"url string defining this request",has:"has a key",load:"loads request as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},r=function(e,t){this.innerRequest=new n(a,e instanceof i?e:new i(e,t))},s={};return e.each(e.keys(a),function(e,t,n){s[e]=function(){return this.innerRequest[e].apply(this.innerRequest,arguments)}}),e.extend(r.prototype,s,{clone:function(){var e=this.innerRequest.clone.apply(this.innerRequest,arguments);return new r(e)},load:function(){var e=this.innerRequest.load.apply(this.innerRequest,arguments);return new r(e)}}),r}),define("js/components/api_targets",["underscore","backbone"],function(e,t){var n={BOOTSTRAP:"/accounts/bootstrap",SEARCH:"search/query",QTREE:"search/qtree",BIGQUERY:"search/bigquery",EXPORT:"export/",SERVICE_AUTHOR_NETWORK:"vis/author-network",SERVICE_PAPER_NETWORK:"vis/paper-network",SERVICE_WORDCLOUD:"vis/word-cloud",SERVICE_METRICS:"metrics",SERVICE_OBJECTS:"objects",SERVICE_OBJECTS_QUERY:"objects/query",SERVICE_CITATION_HELPER:"citation_helper",SERVICE_AUTHOR_AFFILIATION_EXPORT:"authoraff",MYADS_STORAGE:"vault",AUTHOR_AFFILIATION_SEARCH:"author-affiliation/search",AUTHOR_AFFILIATION_EXPORT:"author-affiliation/export",RESOLVER:"resolver",CSRF:"accounts/csrf",USER:"accounts/user",USER_DATA:"vault/user-data",SITE_CONFIGURATION:"vault/configuration",TOKEN:"accounts/token",LOGOUT:"accounts/logout",REGISTER:"accounts/register",VERIFY:"accounts/verify",DELETE:"accounts/user/delete",RESET_PASSWORD:"accounts/reset-password",CHANGE_PASSWORD:"accounts/change-password",CHANGE_EMAIL:"accounts/change-email",RECOMMENDER:"recommender",GRAPHICS:"graphics",FEEDBACK:"feedback/slack",LIBRARY_IMPORT_CLASSIC_AUTH:"harbour/auth/classic",LIBRARY_IMPORT_CLASSIC_MIRRORS:"harbour/mirrors",LIBRARY_IMPORT_CLASSIC_TO_BBB:"biblib/classic",LIBRARY_IMPORT_ADS2_AUTH:"harbour/auth/twopointoh",LIBRARY_IMPORT_ADS2_TO_BBB:"biblib/twopointoh",LIBRARY_IMPORT_ZOTERO:"harbour/export/twopointoh/zotero",LIBRARY_IMPORT_MENDELEY:"harbour/export/twopointoh/mendeley",LIBRARY_IMPORT_CREDENTIALS:"harbour/user",ORCID_PREFERENCES:"orcid/preferences",LIBRARIES:"biblib/libraries",DOCUMENTS:"biblib/documents",PERMISSIONS:"biblib/permissions",_limits:{ExportWidget:{default:500,limit:3e3},Metrics:{default:6e3,limit:6e3},AuthorNetwork:{default:400,limit:1e3},PaperNetwork:{default:400,limit:1e3},ConceptCloud:{default:150,limit:150},BubbleChart:{default:1500}}};return n._doesntNeedCredentials=[n.SEARCH,n.QTREE,n.BIGQUERY,n.EXPORT,n.SERVICE_AUTHOR_NETWORK,n.SERVICE_PAPER_NETWORK,n.SERVICE_WORDCLOUD,n.SERVICE_METRICS,n.RECOMMENDER,n.GRAPHICS,n.FEEDBACK],n}),define("js/mixins/api_access",["underscore","backbone","js/components/api_query","js/components/api_request"],function(e,t,n,i){return{onBootstrap:function(t){var n=this.getBeeHive();if(t.access_token){n.getService("Api").setVals({access_token:t.token_type+":"+t.access_token,refresh_token:t.refresh_token,expire_in:t.expire_in}),console.warn("Redefining access_token: "+t.access_token);var i=n.getObject("User"),a=t.anonymous?void 0:t.username;i.setUser(a);var r=n.getService("PersistentStorage");e.isPlainObject(r)&&e.isFunction(r.set)&&r.set("appConfig",t)}else console.warn("bootstrap didn't provide access_token!")},getApiAccess:function(e){e=e||{};var t=this.getBeeHive().getService("Api"),a=this,r=$.Deferred();return t[e.tokenRefresh?"_request":"request"](new i({query:new n,target:this.bootstrapUrls?this.bootstrapUrls[0]:"/accounts/bootstrap"}),{done:function(t){e.reconnect&&a.onBootstrap(t),r.resolve(t)},fail:function(){r.reject.apply(r,arguments)},type:"GET"}),r}}}),define("js/components/api_query_updater",["underscore","js/components/api_query"],function(e,t){var n=function(t,n){if(!t||!e.isString(t))throw new Error("You must initialize the ApiQueryUpdater with a context (which is a string)");this.context=t,this.defaultOperator=" ",this.operators=[" ","AND","OR","NOT","NEAR"],this.defaultMode="limit",this.operationModes=["limit","exclude","expand","replace"],this.impossibleString="￼￼￼",e.extend(this,n)};return e.extend(n.prototype,{updateQuery:function(t,n,i,a,r){if(r=e.defaults({},r,{prefix:"__"}),!n||!e.isString(n))throw new Error("You must tell us what parameter to update in the ApiQuery");var s;if(a=this._sanitizeConditionAsArray(a),"limit"==(i=this._sanitizeMode(i)))s="AND";else if("exclude"==i)s="NOT";else{if("expand"!=i){if("replace"==i)return this._closeExistingVals(t,this._n(n,r.prefix)),t.set(this._n(n,r.prefix),["AND",a[0]]),t.set(n,a[0]);throw new Error("Unsupported mode/operator:",i)}s="OR"}if(!t.has(n)){var o=[s].concat(a);return t.set(n,this._buildQueryFromConditions(o)),void t.set(this._n(n,r.prefix),o)}var l,c,u,d,h=this._n(n,r.prefix),p=e.clone(t.get(n));if(d=this._getExistingVals(t,h)){if(d[0]!==s)return this._closeExistingVals(t,h),this.updateQuery(t,n,i,a);l=this._buildQueryFromConditions(d)}else if(d=[s],1==p.length)if(-1==p[0].indexOf(" "))l=p[0],d.push(p[0]);else{l=p[0];var f=p[0].toLowerCase();f.indexOf(" and ")>-1||f.indexOf(" or ")>-1||f.indexOf(" not ")>-1||f.indexOf(" near")>-1||f.indexOf("(")>2?d.push("("+p[0]+")"):d.push(p[0])}else l=this.impossibleString;if("limit"==i||"expand"==i){u=e.union(d,a),c=this._buildQueryFromConditions(u);var g=e.clone(p);if(this._modifyArrayReplaceString(g,l,c))return t.set(n,g),void t.set(h,u)}if("exclude"==i){var m=e.clone(d);m[0]="OR",l=" NOT "+this._buildQueryFromConditions(m),u=e.union(d,a);var b=e.clone(u);b[0]="OR",c=" NOT "+this._buildQueryFromConditions(b);g=e.clone(p);if(this._modifyArrayReplaceString(g,l,c))return t.set(n,g),void t.set(h,u)}"limit"==i?u=this._modifyArrayAddString(p,a,"AND"):"exclude"==i?u=this._modifyArrayAddString(p,a,"NOT"):"expand"==i&&(u=this._modifyArrayAddString(p,a,"OR")),t.set(h,u),t.set(n,p)},needsEscape:function(e){for(var t,n=0;n<e.length;n++)if("\\"==(t=e[n])||"+"==t||"-"==t||"!"==t||"("==t||")"==t||":"==t||"^"==t||"["==t||"]"==t||'"'==t||"{"==t||"}"==t||"~"==t||"*"==t||"?"==t||"|"==t||"&"==t||"/"==t)return!0;return!1},escape:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t||n.push("\\"),n.push(t);return n.join("")},escapeInclWhitespace:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t&&" "!=t&&"\t"!=t||n.push("\\"),n.push(t);return n.join("")},quoteIfNecessary:function(e,t,n){return this.quote(e,t,n,!0)},quote:function(t,n,i,a){n||(n='"'),i||(i=n),e.isUndefined(a)&&(a=!1);for(var r,s=[],o=!1,l=0;l<t.length;l++)"\\"!=(r=t[l])&&"+"!=r&&"-"!=r&&"!"!=r&&"("!=r&&")"!=r&&":"!=r&&"^"!=r&&"["!=r&&"]"!=r&&'"'!=r&&"{"!=r&&"}"!=r&&"~"!=r&&"|"!=r&&"&"!=r&&"/"!=r&&" "!=r&&"\t"!=r||(o=!0),r!=n&&r!=i||!(0==l||l>0&&"\\"!==t[l-1])||s.push("\\"),s.push(r);return 1==a&&"\\"==s[0]&&'"'==s[1]&&"\\"==s[s.length-2]&&'"'==s[s.length-1]?(s[0]="",s[s.length-2]="",s.join("")):o||0==a?n+s.join("")+i:s.join("")},saveTmpEntry:function(e,t,n){var i,a=this._getTmpStorage(e,!0);return t in a&&(i=a[t]),a[t]=n,i},removeTmpEntry:function(e,t){var n=this._getTmpStorage(e,!0),i=n[t];return delete n[t],i},getTmpEntry:function(e,t,n){var i;return t in(i=n?this._getTmpStorage(e,!0):this._getTmpStorage(e,!1))?i[t]:(i[t]=n,n)},hasTmpEntry:function(e,t){return t in this._getTmpStorage(e)},_getTmpStorage:function(e,t){var n=this._n("__tmpStorage");if(!e.hasOwnProperty(n)){if(!t)return{};e[n]={}}return e[n]},_n:function(t,n){return(e.isString(n)?n:"__")+this.context+"_"+t},_buildQueryFromConditions:function(e){if(e.length<=1)throw new Error("Violation of contract: first condition is always an operator");var t=e[0];return" "!=t&&(t=" "+t+" "),"("+e.slice(1).join(t)+")"},_modifyArrayReplaceString:function(t,n,i,a){var r=0;if(a||(a=-1),!n)throw new Error("Your search is empty, you fool");return e.each(t,function(e,s){a>0&&r>a||e.indexOf(n)>-1&&(t[s]=e.replace(n,i),r+=1)}),r},_modifyArrayAddString:function(e,t,n){if(!(0!=e.length&&""!=e[e.length-1].trim()||"NOT"!=n&&"NEAR"!=n))throw new Error("Invalid operation; cannot apply NOT/NEAR on single clause");var i=[n,e[e.length-1]].concat(t);return e[e.length-1]=this._buildQueryFromConditions(i),i},_getExistingVals:function(e,t,n){return e.has(t)?e.get(t):n},_closeExistingVals:function(e,t){e.unset(t)},_sanitizeMode:function(t){if(!t)return this.defaultMode;var n=e.indexOf(this.operationModes,t);if(-1==n)throw new Error("Unkwnown mode: "+t);return this.operationModes[n]},_sanitizeOperator:function(t){if(!t)return this.defaultOperator;if(!e.isString(t))throw new Error("Operator must be a string");if(""==t.trim())return this.defaultOperator;t=t.toUpperCase();var n=e.indexOf(this.operators,t);if(-1==n)throw new Error("Unknown operator: ",t);return this.operators[n]},_sanitizeConditionAsArray:function(t){if(!t)throw new Error("The condition must be set (string/array of strings)");if(e.isString(t))return[t];if(0==(t=e.without(e.flatten(t),"",!1,null,void 0,NaN)).length)throw new Error("After removing empty values, no condition was left");return t},clean:function(n){var i={};return n&&n.keys&&e.each(n.keys(),function(e){"__"!=e.substring(0,2)&&(i[e]=n.get(e))}),new t(i)}}),n}),define("router",["underscore","jquery","backbone","js/components/api_query","js/mixins/dependon","js/components/api_feedback","js/components/api_request","js/components/api_targets","js/mixins/api_access","js/components/api_query_updater"],function(e,t,n,i,a,r,s,o,l,c){var u=n.Router.extend({initialize:function(e){e=e||{},this.queryUpdater=new c("Router")},execute:function(t,i){if(n.History.started){var a=n.history.getFragment();if("search/"===(a=""===a?"index":a)&&e.isEmpty(e.reject(i,e.isUndefined)))return n.history.history.go(-2)}e.isFunction(t)&&t.apply(this,i)},activate:function(e){if(this.setBeeHive(e),!this.hasPubSub())throw new Error("Ooops! Who configured this #@$%! There is no PubSub service!")},routerNavigate:function(t,n){n=n||{};e.extend(n,{replace:!0}),this.getPubSub().publish(this.getPubSub().NAVIGATE,t,n)},routes:{"":"index","classic-form":"classicForm","paper-form":"paperForm","index/(:query)":"index","search/(:query)(/)(:widgetName)":"search","execute-query/(:query)":"executeQuery","abs/:bibcode(/)(:subView)":"view","user/orcid*(:subView)":"orcidPage","user/account(/)(:subView)":"authenticationPage","user/account/verify/(:subView)/(:token)":"routeToVerifyPage","user/settings(/)(:subView)(/)":"settingsPage","user/libraries(/)(:id)(/)(:subView)(/)(:subData)(/)":"librariesPage","user/home":"homePage","orcid-instructions":"orcidInstructions","public-libraries/(:id)(/)":"publicLibraryPage","*invalidRoute":"noPageFound"},index:function(e){this.routerNavigate("index-page")},classicForm:function(){this.routerNavigate("ClassicSearchForm")},paperForm:function(){this.routerNavigate("PaperSearchForm")},search:function(t,n){var a=["metrics","author-network","paper-network","concept-cloud","bubble-chart"];if(t)try{var s=(new i).load(t);this.getPubSub().publish(this.getPubSub().START_SEARCH,s)}catch(e){return console.error("Error parsing query from a string: ",t,e),this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page"),this.getPubSub().publish(this.getPubSub().BIG_FIRE,new r({code:r.CODES.CANNOT_ROUTE,reason:"Cannot parse query",query:t})),this.getPubSub().publish(this.getPubSub().ALERT,new r({code:r.CODES.ALERT,msg:"unable parse query",type:"danger",modal:!0}))}else this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page");n&&a.indexOf(n)>-1?this.getPubSub().subscribeOnce(this.getPubSub().NAVIGATE,e.bind(function(e){"results-page"==e&&this.getPubSub().publish(this.getPubSub().NAVIGATE,"show-"+n)},this)):n&&-1==a.indexOf(n)&&console.error("Results page subpage not recognized:",n)},executeQuery:function(e){this.getPubSub().publish(this.getPubSub().NAVIGATE,"execute-query",e)},view:function(e,t){var n,a,r;r=this,n=new i({q:"identifier:"+this.queryUpdater.quoteIfNecessary(e),fl:"bibcode"}),a=new s({query:n,target:o.SEARCH,options:{done:function(a){var s,o;t?(s="Show"+t[0].toUpperCase()+t.slice(1),o="#abs/"+e+"/"+t):s="ShowAbstract",r.routerNavigate(s,{href:o}),a.response&&a.response.docs&&a.response.docs[0]?(e=a.response.docs[0].bibcode,r.getPubSub().publish(r.getPubSub().DISPLAY_DOCUMENTS,new i({q:"bibcode:"+e}))):a.response&&a.response.docs&&!a.response.docs.length&&console.error("the query  "+n.get("q")[0]+"  did not return any bibcodes")},fail:function(){console.log("Cannot identify page to load, bibcode: "+e),r.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page")}}}),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,a)},routeToVerifyPage:function(e,t){var n,i,a,l,c,u,d=this;function h(e,t,a){this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page");var s=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown";this.getPubSub().publish(this.getPubSub().ALERT,new r({code:0,title:i,msg:" <b>"+s+"</b> <br/>"+n,modal:!0,type:"danger"}))}"register"==e?(i="Registration failed.",n="<p>Please try again, or contact <b> adshelp@cfa.harvard.edu for support </b></p>",a=o.VERIFY+"/"+t,l=function(e){this.getApiAccess({reconnect:!0}).done(function(){d.getPubSub().publish(d.getPubSub().NAVIGATE,"index-page");var t="<p>You have been successfully registered with the username</p> <p><b>"+e.email+"</b></p>";d.getPubSub().publish(d.getPubSub().ALERT,new r({code:0,title:"Welcome to ADS",msg:t,modal:!0,type:"success"}))}).fail(function(){h()})}):"change-email"==e?(i="Attempt to change email failed",n="Please try again, or contact adshelp@cfa.harvard.edu for support",a=o.VERIFY+"/"+t,l=function(e){this.getApiAccess({reconnect:!0}).done(function(){d.getPubSub().publish(d.getPubSub().NAVIGATE,"index-page");var t="Your new ADS email is <b>"+e.email+"</b>";d.getPubSub().publish(d.getPubSub().ALERT,new r({code:0,title:"Email has been changed.",msg:t,modal:!0,type:"success"}))}).fail(function(){this.apply(h,arguments)})}):"reset-password"==e&&(l=function(){this.getBeeHive().getObject("Session").setChangeToken(t),this.getPubSub().publish(this.getPubSub().NAVIGATE,"authentication-page",{subView:"reset-password-2"})},n="Reset password token was invalid.",a=o.RESET_PASSWORD+"/"+t,u="GET"),c=new s({target:a,options:{type:u||"GET",context:this,done:l,fail:h}}),this.getBeeHive().getService("Api").request(c)},orcidPage:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"orcid-page")},orcidInstructions:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"orcid-instructions")},authenticationPage:function(t){if(t&&!e.contains(["login","register","reset-password-1","reset-password-2"],t))throw new Error("that isn't a subview that the authentication page knows about");this.routerNavigate("authentication-page",{subView:t})},settingsPage:function(t){e.contains(["token","password","email","delete"],t)?this.routerNavigate("UserSettings",{subView:t}):e.contains(["librarylink","orcid"],t)?this.routerNavigate("UserPreferences",{subView:t}):this.routerNavigate("UserPreferences",{subView:void 0})},librariesPage:function(t,n,i){if(t){n=n||"library";if(e.contains(["library","admin"],n))this.routerNavigate("IndividualLibraryWidget",{subView:n,id:t});else{if(!e.contains(["export","metrics","visualization"],n))throw new Error("did not recognize subview for library view");"library-export"==(n="library-"+n)?this.routerNavigate(n,{subView:i||"bibtex",id:t}):"library-metrics"==n&&this.routerNavigate(n,{id:t})}}else this.routerNavigate("AllLibrariesWidget","libraries")},publicLibraryPage:function(e){this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{id:e,publicView:!0,subView:"library"})},homePage:function(e){this.routerNavigate("home-page",{subView:e})},noPageFound:function(){this.routerNavigate("404")},_extractParameters:function(t,n){return e.map(t.exec(n).slice(1),function(e){return/q\=/.test(e)?e:e?decodeURIComponent(e):e})}});return e.extend(u.prototype,a.BeeHive,l),u}),define("js/components/generic_module",["backbone","underscore"],function(e,t){var n=["className","activate"],i=function(e){e=e||{},this.mid=t.uniqueId("module"),t.extend(this,t.pick(e,n)),this.initialize.call(this,e)};return t.extend(i.prototype,e.Events,{className:"GenericModule",initialize:function(){},destroy:function(){},activate:function(e){t.extend(this,t.pick(e,n))}}),i.extend=e.Model.extend,i}),define("js/components/services_container",["js/components/facade","js/components/generic_module","js/mixins/hardened","underscore"],function(e,t,n,i){var a=t.extend({initialize:function(e){this._services=i.has(e,"services")?i.clone(e.services):{}},activate:function(){var e=arguments;i.each(i.values(this._services),function(t){i.isObject(t)&&"activate"in t&&t.activate.apply(t,e)})},destroy:function(){for(var e in this._services)this.remove(e)},add:function(e,t){if(this._services.hasOwnProperty(e))throw new Error("The service: "+e+" is already registered, remove it first!");if(!e||!t||!i.isString(e))throw new Error("The key must be a string and the service is an object");this._services[e]=t},remove:function(e,t){if(this._services.hasOwnProperty(e)){var n=this._services[e];return"destroy"in n&&n.destroy(),delete this._services[e],n}return null},has:function(e){return this._services.hasOwnProperty(e)},get:function(e){return this._services[e]},getAll:function(){return i.pairs(this._services)}});return i.extend(a.prototype,n,{getHardenedInstance:function(){var e,t={};for(var n in this._services)e=this._services[n],i.isObject(e)&&"getHardenedInstance"in e&&(t[n]=!0);var a=new this.constructor({services:this._getHardenedInstance(t,this._services)});return this._getHardenedInstance({get:!0,has:!0},a)}}),a}),define("js/components/beehive",["backbone","underscore","js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/services_container"],function(e,t,n,i,a,r){var s=[],o=n.extend({initialize:function(e){t.extend(this,t.pick(e,s)),this.Services=new r,this.Objects=new r,this.debug=!1,this.active=!0},activate:function(){this.Services.activate.apply(this.Services,arguments),this.Objects.activate(this),this.active=!0},destroy:function(){this.Services.destroy(arguments),this.Objects.destroy(arguments),this.active=!1},getService:function(e){return this.Services.get(e)},hasService:function(e){return this.Services.has(e)},addService:function(e,t){return this.Services.add(e,t)},removeService:function(e){return this.Services.remove(e)},getObject:function(e){return this.Objects.get(e)},hasObject:function(e){return this.Objects.has(e)},addObject:function(e,t){return this.Objects.add(e,t)},removeObject:function(e){return this.Objects.remove(e)},getDebug:function(){return this.debug},getAllServices:function(){return this.Services.getAll()},getAllObjects:function(){return this.Objects.getAll()},hardenedInterface:{Services:"services container",Objects:"objects container",debug:"state of the app",active:"active or not",getHardenedInstance:"allow to create clone of the already hardened instance"}});return t.extend(o.prototype,a,{getHardenedInstance:function(e){(e=t.clone(e||this.hardenedInterface)).getService=function(e){return n.Services.get(e)},e.hasService=function(e){return n.Services.has(e)},e.getObject=function(e){return n.Objects.get(e)},e.hasObject=function(e){return n.Objects.has(e)};var n=this._getHardenedInstance(e,this);return n}}),o}),define("js/components/application",["underscore","jquery","backbone","module","js/components/beehive","js/mixins/api_access"],function(e,t,n,i,a,r){var s=function(t){t||(t={}),this.aid=e.uniqueId("application"),this.debug=!0,e.extend(this,e.pick(t,["timeout","debug"])),this.initialize.apply(this,arguments)},o=function(){this.container={}};return e.extend(o.prototype,{has:function(e){return this.container.hasOwnProperty(e)},get:function(e){return this.container[e]},remove:function(e){delete this.container[e]},add:function(e,t){this.container[e]=t}}),e.extend(s.prototype,{initialize:function(e,t){this.__beehive=new a,this.__modules=new o,this.__controllers=new o,this.__widgets=new o,this.__plugins=new o,this.__barbarianRegistry={},this.__barbarianInstances={}},shim:function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))},loadModules:function(n,i){var a,r=[],s=this,o=n.core;o&&e.each(["controllers","modules","services","objects"],function(e){o[e]&&(a=s._loadModules(e,o[e]))&&r.push(a)});var l=n.plugins;l&&(a=s._loadModules("plugins",l))&&r.push(a);var c=n.widgets;return c&&(a=s._loadModules("widgets",c))&&r.push(a),1==r.length&&r.push(a),t.when.apply(t,r).then(function(){e.each(arguments,function(t,n){e.isArray(t)&&(s.debug&&console.log("application: registering "+t[0]),s._registerLoadedModules.apply(s,t))})}).fail(function(){console.error("Generic error - we were not successul in loading all modules for config",n),arguments.length&&console.error(arguments)})},getBeeHive:function(){return this.__beehive},_registerLoadedModules:function(t,n){var i,a,r,s,o,l,c=this.getBeeHive(),u=this;if(l=function(e,t){if(t)return u.debug&&console.log("Creating instance of: "+e),t.prototype?new t:t&&t.hasOwnProperty(e)?t[e]:t;console.warn("Object "+e+" is empty, cannot instantiate it!")},"controllers"==t)r=e.bind(this.hasController,this),o=e.bind(function(e){this.__controllers.remove(e)},this),s=e.bind(function(e,t){this.__controllers.add(e,t)},this);else if("services"==t)r=e.bind(c.hasService,c),o=e.bind(c.removeService,c),s=e.bind(c.addService,c);else if("objects"==t)r=e.bind(c.hasObject,c),o=e.bind(c.removeObject,c),s=e.bind(c.addObject,c);else if("modules"==t)l=function(e,t){return t},r=e.bind(this.hasModule,this),o=e.bind(function(e){this.__modules.remove(e)},this),s=e.bind(function(e,t){this.__modules.add(e,t)},this);else if("widgets"==t)r=e.bind(this.hasWidget,this),o=e.bind(function(e){this.__widgets.remove(e)},this),s=e.bind(function(e,t){this.__widgets.add(e,t)},this),l=function(e,t){return t};else{if("plugins"!=t)throw new Error("Unknown section: "+t);r=e.bind(this.hasPlugin,this),o=e.bind(function(e){this.__plugins.remove(e)},this),s=e.bind(function(e,t){this.__plugins.add(e,t)},this),l=function(e,t){return t}}e.each(e.pairs(n),function(e){i=e[0],a=e[1],r(i)&&(console.warn("Removing (existing) object into ["+t+"]: "+i),o(i));var n=l(i,a);n?s(i,n):console.warn("Removing "+i+"(because it is null!)")})},_checkPrescription:function(t){e.each(e.pairs(t),function(t,n,i){var a=t[0],r=t[1];if(!e.isString(a)||!e.isString(r))throw new Error("You are kidding me, the key/implementation must be string values")})},_loadModules:function(n,i,a){var r=this;this._checkPrescription(i),this.debug&&console.log("application: loading "+n,i);var s={},o=e.keys(i),l=e.values(i),c=t.Deferred();return r.debug&&console.time("startLoading"+n),require(l,function(){r.debug&&console.timeEnd("startLoading"+n);var t=arguments;e.each(o,function(e,n,i){s[e]=t[n]}),c.resolve(n,s),r.debug&&console.log("Loaded: type="+n+" state="+c.state(),s)},function(e){var t=e.requireModules&&e.requireModules[0];r.debug&&console.warn("Error loading impl="+t,e.requireMap),a?r.debug&&console.warn("Ignoring error"):c.reject(e)}),this._setTimeout(c).promise()},_setTimeout:function(e){return setTimeout(function(){"resolved"!=e.state()&&e.reject("Timeout, application is loading too long")},this.timeout||3e4),e},destroy:function(){this.getBeeHive().destroy()},activate:function(t){var n=this.getBeeHive(),i=this;i.debug&&console.log("application: beehive.activate()"),n.activate(n),e.each(this.getAllControllers(),function(e){i.debug&&console.log("application: controllers: "+e[0]+".activate(beehive, app)");var t=e[1];"activate"in t&&t.activate(n,i)}),e.each(this.getAllModules(),function(e){try{i.debug&&console.log("application: modules: "+e[0]+".activate(beehive)");var t=e[1];"activate"in t&&t.activate(n)}catch(t){console.error("Error activating:"+e[0]),console.error(t)}}),this.__activated=!0},isActivated:function(){return this.__activated||!1},hasService:function(e){return this.getBeeHive().hasService(e)},getService:function(e){return this.getBeeHive().getService(e)},hasObject:function(e){return this.getBeeHive().hasObject(e)},getObject:function(e){return this.getBeeHive().getObject(e)},hasController:function(e){return this.__controllers.has(e)},getController:function(e){return this.__controllers.get(e)},hasModule:function(e){return this.__modules.has(e)},getModule:function(e){return this.__modules.get(e)},hasWidget:function(e){return this.__widgets.has(e)},getWidgetRefCount:function(e,t){var n=this.__barbarianInstances[(t||"widget:")+e];return n?n.counter:-1},getWidget:function(n){var i=t.Deferred(),a=this,r={};return arguments.length>1?(r={},e.each(arguments,function(t){if(t)try{r[t]=a._getWidget(t)}catch(n){throw console.error("Error loading: "+t),e.each(r,function(e,t){a.returnWidget(t),delete r[t]}),n}})):n&&(r=this._getWidget(n)),setTimeout(function(){i.done(function(t){e.isArray(n)?e.each(n,function(e){a.returnWidget(e)}):a.returnWidget(n)})},1),i.resolve(r),i.promise()},_getWidget:function(e){var t=this._getOrCreateBarbarian("widget",e);return this.__barbarianInstances["widget:"+e].counter++,t},returnWidget:function(e){var t=this.__barbarianInstances["widget:"+e];if(!t||!t.parent.dontKillMe)return t?(t.counter--,this._killBarbarian("widget:"+e),t.counter):-1},hasPlugin:function(e){return this.__plugins.has(e)},getPlugin:function(n){var i=t.Deferred(),a=this,r={};return arguments.length>1?(r={},e.each(arguments,function(t){if(t)try{r[t]=a._getPlugin(t)}catch(n){throw console.error("Error loading: "+t),e.each(r,function(e,t){a.returnPlugin(t),delete r[t]}),n}})):n&&(r=this._getPlugin(n)),setTimeout(function(){i.done(function(t){e.isArray(n)?e.each(n,function(e){a.returnPlugin(e)}):a.returnPlugin(n)})},1),i.resolve(r),i.promise()},getPluginRefCount:function(e){return this.getWidgetRefCount(e,"plugin:")},_getPlugin:function(e){var t=this._getOrCreateBarbarian("plugin",e);return this.__barbarianInstances["plugin:"+e].counter++,t},returnPlugin:function(e){var t=this.__barbarianInstances["plugin:"+e];return t?(t.counter--,this._killBarbarian("plugin:"+e),t.counter):-1},getPluginOrWidgetName:function(t){if(!e.isString(t))throw Error("The psk argument must be a string");if(this.__barbarianRegistry[t])return this.__barbarianRegistry[t]},getPluginOrWidgetByPubSubKey:function(e){var t=this.getPluginOrWidgetName(e);if(void 0!==t){if(this._isBarbarianAlive(t))return this._getBarbarian(t);throw new Error("Eeeek, thisis unexpectEED bEhAvjor! Cant find barbarian with ID: "+e)}},getPskOfPluginOrWidget:function(e){e.split(":");if(this._isBarbarianAlive(e)){var t=this._getBarbarian(e);if(t.getPubSub&&t.getPubSub().getCurrentPubSubKey)return t.getPubSub().getCurrentPubSubKey().getId()}},_getOrCreateBarbarian:function(t,n){var i=t+":"+n;if("plugin"==t&&!this.hasPlugin(n)||"widget"==t&&!this.hasWidget(n))throw new Error("We cannot give you "+i+" (cause there is no constructor for it)");if(this._isBarbarianAlive(i))return this._getBarbarian(i);var a,r=new("plugin"==t?this.__plugins.get(n):this.__widgets.get(n)),s=this.getBeeHive().getHardenedInstance(),o=this.getService("PubSub");e.keys(o._issuedKeys);"activate"in r&&(this.debug&&console.log("application: "+i+".activate(beehive)"),a=r.activate(s));var l=e.without(e.keys(o._issuedKeys),e.keys(o._issuedKeys));return this._registerBarbarian(i,r,a,s,l),r},_isBarbarianAlive:function(e){return!!this.__barbarianInstances[e]},_getBarbarian:function(e){return this.__barbarianInstances[e].parent},_registerBarbarian:function(t,n,i,a,r){this._killBarbarian(t),"getBeeHive"in n?this.__barbarianRegistry[n.getBeeHive().getService("PubSub").getCurrentPubSubKey().getId()]=t:this.__barbarianRegistry[a.getService("PubSub").getCurrentPubSubKey().getId()]=t;var s=[];i&&(s=this._registerBarbarianChildren(t,i)),r&&e.each(r,function(e){this.__barbarianRegistry[e]&&delete r[e]},this),this.__barbarianInstances[t]={parent:n,children:s,beehive:a,counter:0,psk:a.getService("PubSub").getCurrentPubSubKey(),bastards:r}},_registerBarbarianChildren:function(t,n){var i=[];return e.each(n,function(e,n){var a=t+"-"+(e.name||n);if(this.debug&&console.log("adding child object to registry: "+a),this._isBarbarianAlive(a))throw new Error("Contract breach, there already exists instance with a name: "+a);if("getBeeHive"in e){var r=e.getBeeHive().getService("PubSub").getCurrentPubSubKey().getId();if(this.__barbarianRegistry[r])throw new Error("Contract breach, the child of "+t+"is using the same pub-sub-key");this.__barbarianRegistry[r]=a}i.unshift(a)},this),i},_killBarbarian:function(t,n){var i=this.__barbarianInstances[t];if(i&&!(i.counter>0&&!0!==n)){i.children&&e.each(i.children,function(e){this._killBarbarian(e,!0)},this),e.each(this.__barbarianRegistry,function(e,n){e==t&&delete this.__barbarianRegistry[n]},this);var a=this.getService("PubSub");i.psk&&a.unsubscribe(i.psk),i.bastards,i.parent.destroy(),delete this.__barbarianInstances[t],"setBeeHive"in i.parent&&i.parent.setBeeHive({fake:"one"}),i=null,this.debug&&console.log("Destroyed: "+t)}},getAllControllers:function(){return e.pairs(this.__controllers.container)},getAllModules:function(){return e.pairs(this.__modules.container)},getAllPlugins:function(n){n=n||"plugin:";var i=t.Deferred(),a=[];return e.each(this.__barbarianInstances,function(e,t){t.indexOf(n)>-1&&a.unshift(t.replace(n,""))}),(n.indexOf("plugin:")>-1?this.getPlugin:this.getWidget).apply(this,a).done(function(t){var n=[];a.length>1?n=e.pairs(t):1==a.length&&(n=[[a[0],t]]),i.resolve(n)}),i.promise()},getAllWidgets:function(){return this.getAllPlugins("widget:")},getAllServices:function(){return this.getBeeHive().getAllServices()},getAllObjects:function(){return this.getBeeHive().getAllObjects()},triggerMethodOnAll:function(e,t){this.triggerMethod(this.getAllControllers(),"controllers",e,t),this.triggerMethod(this.getAllModules(),"modules",e,t);var n=this;this.getAllPlugins().done(function(i){i.length&&n.triggerMethod(i,"plugins",e,t)}),this.getAllWidgets().done(function(i){i.length&&n.triggerMethod(i,"widgets",e,t)}),this.triggerMethod(this.getBeeHive().getAllServices(),"BeeHive:services",e,t),this.triggerMethod(this.getBeeHive().getAllObjects(),"BeeHive:objects",e,t)},triggerMethod:function(t,n,i,a){var r=this;return e.map(t,function(t){var s=t[1];i in s?(r.debug&&console.log("application.triggerMethod: "+n+": "+t[0]+"."+i+"()"),s[i].call(s,a)):e.isFunction(i)&&(r.debug&&console.log("application.triggerMethod: "+n+": "+t[0]+" customCallback()"),i.call(s,n+":"+t[0],a))})}}),s.extend=n.Model.extend,s.extend(r)}),define("hbs/underscore",[],function(){var e={},t=Array.prototype,n=Object.prototype,i=Function.prototype,a=t.slice,r=t.unshift,s=n.toString,o=n.hasOwnProperty,l=t.forEach,c=t.map,u=t.reduce,d=t.reduceRight,h=t.filter,p=t.every,f=t.some,g=t.indexOf,m=t.lastIndexOf,b=Array.isArray,v=Object.keys,y=i.bind,_=function(e){return new T(e)};_.VERSION="1.3.3";var w=_.each=_.forEach=function(t,n,i){if(null!=t)if(l&&t.forEach===l)t.forEach(n,i);else if(t.length===+t.length){for(var a=0,r=t.length;a<r;a++)if(a in t&&n.call(i,t[a],a,t)===e)return}else for(var s in t)if(_.has(t,s)&&n.call(i,t[s],s,t)===e)return};_.map=_.collect=function(e,t,n){var i=[];return null==e?i:c&&e.map===c?e.map(t,n):(w(e,function(e,a,r){i[i.length]=t.call(n,e,a,r)}),e.length===+e.length&&(i.length=e.length),i)},_.reduce=_.foldl=_.inject=function(e,t,n,i){var a=arguments.length>2;if(null==e&&(e=[]),u&&e.reduce===u)return i&&(t=_.bind(t,i)),a?e.reduce(t,n):e.reduce(t);if(w(e,function(e,r,s){a?n=t.call(i,n,e,r,s):(n=e,a=!0)}),!a)throw new TypeError("Reduce of empty array with no initial value");return n},_.reduceRight=_.foldr=function(e,t,n,i){var a=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return i&&(t=_.bind(t,i)),a?e.reduceRight(t,n):e.reduceRight(t);var r=_.toArray(e).reverse();return i&&!a&&(t=_.bind(t,i)),a?_.reduce(r,t,n,i):_.reduce(r,t)},_.find=_.detect=function(e,t,n){var i;return S(e,function(e,a,r){if(t.call(n,e,a,r))return i=e,!0}),i},_.filter=_.select=function(e,t,n){var i=[];return null==e?i:h&&e.filter===h?e.filter(t,n):(w(e,function(e,a,r){t.call(n,e,a,r)&&(i[i.length]=e)}),i)},_.reject=function(e,t,n){var i=[];return null==e?i:(w(e,function(e,a,r){t.call(n,e,a,r)||(i[i.length]=e)}),i)},_.every=_.all=function(t,n,i){var a=!0;return null==t?a:p&&t.every===p?t.every(n,i):(w(t,function(t,r,s){if(!(a=a&&n.call(i,t,r,s)))return e}),!!a)};var S=_.some=_.any=function(t,n,i){n||(n=_.identity);var a=!1;return null==t?a:f&&t.some===f?t.some(n,i):(w(t,function(t,r,s){if(a||(a=n.call(i,t,r,s)))return e}),!!a)};_.include=_.contains=function(e,t){var n=!1;return null==e?n:g&&e.indexOf===g?-1!=e.indexOf(t):n=S(e,function(e){return e===t})},_.invoke=function(e,t){var n=a.call(arguments,2);return _.map(e,function(e){return(_.isFunction(t)?t||e:e[t]).apply(e,n)})},_.pluck=function(e,t){return _.map(e,function(e){return e[t]})},_.max=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&_.isEmpty(e))return-1/0;var i={computed:-1/0};return w(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;s>=i.computed&&(i={value:e,computed:s})}),i.value},_.min=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&_.isEmpty(e))return 1/0;var i={computed:1/0};return w(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;s<i.computed&&(i={value:e,computed:s})}),i.value},_.shuffle=function(e){var t,n=[];return w(e,function(e,i,a){t=Math.floor(Math.random()*(i+1)),n[i]=n[t],n[t]=e}),n},_.sortBy=function(e,t,n){var i=_.isFunction(t)?t:function(e){return e[t]};return _.pluck(_.map(e,function(e,t,a){return{value:e,criteria:i.call(n,e,t,a)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return void 0===n?1:void 0===i?-1:n<i?-1:n>i?1:0}),"value")},_.groupBy=function(e,t){var n={},i=_.isFunction(t)?t:function(e){return e[t]};return w(e,function(e,t){var a=i(e,t);(n[a]||(n[a]=[])).push(e)}),n},_.sortedIndex=function(e,t,n){n||(n=_.identity);for(var i=0,a=e.length;i<a;){var r=i+a>>1;n(e[r])<n(t)?i=r+1:a=r}return i},_.toArray=function(e){return e?_.isArray(e)?a.call(e):_.isArguments(e)?a.call(e):e.toArray&&_.isFunction(e.toArray)?e.toArray():_.values(e):[]},_.size=function(e){return _.isArray(e)?e.length:_.keys(e).length},_.first=_.head=_.take=function(e,t,n){return null==t||n?e[0]:a.call(e,0,t)},_.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},_.last=function(e,t,n){return null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},_.rest=_.tail=function(e,t,n){return a.call(e,null==t||n?1:t)},_.compact=function(e){return _.filter(e,function(e){return!!e})},_.flatten=function(e,t){return _.reduce(e,function(e,n){return _.isArray(n)?e.concat(t?n:_.flatten(n)):(e[e.length]=n,e)},[])},_.without=function(e){return _.difference(e,a.call(arguments,1))},_.uniq=_.unique=function(e,t,n){var i=n?_.map(e,n):e,a=[];return e.length<3&&(t=!0),_.reduce(i,function(n,i,r){return(t?_.last(n)===i&&n.length:_.include(n,i))||(n.push(i),a.push(e[r])),n},[]),a},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(e){var t=a.call(arguments,1);return _.filter(_.uniq(e),function(e){return _.every(t,function(t){return _.indexOf(t,e)>=0})})},_.difference=function(e){var t=_.flatten(a.call(arguments,1),!0);return _.filter(e,function(e){return!_.include(t,e)})},_.zip=function(){for(var e=a.call(arguments),t=_.max(_.pluck(e,"length")),n=new Array(t),i=0;i<t;i++)n[i]=_.pluck(e,""+i);return n},_.indexOf=function(e,t,n){if(null==e)return-1;var i,a;if(n)return e[i=_.sortedIndex(e,t)]===t?i:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(i=0,a=e.length;i<a;i++)if(i in e&&e[i]===t)return i;return-1},_.lastIndexOf=function(e,t){if(null==e)return-1;if(m&&e.lastIndexOf===m)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},_.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),a=0,r=new Array(i);a<i;)r[a++]=e,e+=n;return r};var E=function(){};_.bind=function(e,t){var n,i;if(e.bind===y&&y)return y.apply(e,a.call(arguments,1));if(!_.isFunction(e))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(a.call(arguments)));E.prototype=e.prototype;var r=new E,s=e.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}},_.bindAll=function(e){var t=a.call(arguments,1);return 0==t.length&&(t=_.functions(e)),w(t,function(t){e[t]=_.bind(e[t],e)}),e},_.memoize=function(e,t){var n={};return t||(t=_.identity),function(){var i=t.apply(this,arguments);return _.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},_.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},_.defer=function(e){return _.delay.apply(_,[e,1].concat(a.call(arguments,1)))},_.throttle=function(e,t){var n,i,a,r,s,o,l=_.debounce(function(){s=r=!1},t);return function(){n=this,i=arguments;return a||(a=setTimeout(function(){a=null,s&&e.apply(n,i),l()},t)),r?s=!0:o=e.apply(n,i),l(),r=!0,o}},_.debounce=function(e,t,n){var i;return function(){var a=this,r=arguments;n&&!i&&e.apply(a,r),clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(a,r)},t)}},_.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}},_.wrap=function(e,t){return function(){var n=[e].concat(a.call(arguments,0));return t.apply(this,n)}},_.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},_.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},_.keys=v||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)_.has(e,n)&&(t[t.length]=n);return t},_.values=function(e){return _.map(e,_.identity)},_.functions=_.methods=function(e){var t=[];for(var n in e)_.isFunction(e[n])&&t.push(n);return t.sort()},_.extend=function(e){return w(a.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},_.pick=function(e){var t={};return w(_.flatten(a.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},_.defaults=function(e){return w(a.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isEqual=function(e,t){return function e(t,n,i){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;if(t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped),t.isEqual&&_.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&_.isFunction(n.isEqual))return n.isEqual(t);var a=s.call(t);if(a!=s.call(n))return!1;switch(a){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var r=i.length;r--;)if(i[r]==t)return!0;i.push(t);var o=0,l=!0;if("[object Array]"==a){if(l=(o=t.length)==n.length)for(;o--&&(l=o in t==o in n&&e(t[o],n[o],i)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var c in t)if(_.has(t,c)&&(o++,!(l=_.has(n,c)&&e(t[c],n[c],i))))break;if(l){for(c in n)if(_.has(n,c)&&!o--)break;l=!o}}return i.pop(),l}(e,t,[])},_.isEmpty=function(e){if(null==e)return!0;if(_.isArray(e)||_.isString(e))return 0===e.length;for(var t in e)if(_.has(e,t))return!1;return!0},_.isElement=function(e){return!(!e||1!=e.nodeType)},_.isArray=b||function(e){return"[object Array]"==s.call(e)},_.isObject=function(e){return e===Object(e)},_.isArguments=function(e){return"[object Arguments]"==s.call(e)},_.isArguments(arguments)||(_.isArguments=function(e){return!(!e||!_.has(e,"callee"))}),_.isFunction=function(e){return"[object Function]"==s.call(e)},_.isString=function(e){return"[object String]"==s.call(e)},_.isNumber=function(e){return"[object Number]"==s.call(e)},_.isFinite=function(e){return _.isNumber(e)&&isFinite(e)},_.isNaN=function(e){return e!=e},_.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==s.call(e)},_.isDate=function(e){return"[object Date]"==s.call(e)},_.isRegExp=function(e){return"[object RegExp]"==s.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return o.call(e,t)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(e){return e},_.times=function(e,t,n){for(var i=0;i<e;i++)t.call(n,i)},_.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(e,t){if(null==e)return null;var n=e[t];return _.isFunction(n)?n.call(e):n},_.mixin=function(e){w(_.functions(e),function(t){D(t,_[t]=e[t])})};var x=0;_.uniqueId=function(e){var t=x++;return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/.^/,P={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var C in P)P[P[C]]=C;var k=/\\|'|\r|\n|\t|\u2028|\u2029/g,R=/\\(\\|'|r|n|t|u2028|u2029)/g,O=function(e){return e.replace(R,function(e,t){return P[t]})};_.template=function(e,t,n){n=_.defaults(n||{},_.templateSettings);var i="__p+='"+e.replace(k,function(e){return"\\"+P[e]}).replace(n.escape||A,function(e,t){return"'+\n_.escape("+O(t)+")+\n'"}).replace(n.interpolate||A,function(e,t){return"'+\n("+O(t)+")+\n'"}).replace(n.evaluate||A,function(e,t){return"';\n"+O(t)+"\n;__p+='"})+"';\n";n.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+i+"return __p;\n";var a=new Function(n.variable||"obj","_",i);if(t)return a(t,_);var r=function(e){return a.call(this,e,_)};return r.source="function("+(n.variable||"obj")+"){\n"+i+"}",r},_.chain=function(e){return _(e).chain()};var T=function(e){this._wrapped=e};_.prototype=T.prototype;var I=function(e,t){return t?_(e).chain():e},D=function(e,t){T.prototype[e]=function(){var e=a.call(arguments);return r.call(e,this._wrapped),I(t.apply(_,e),this._chain)}};return _.mixin(_),w(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=t[e];T.prototype[e]=function(){var t=this._wrapped;n.apply(t,arguments);var i=t.length;return"shift"!=e&&"splice"!=e||0!==i||delete t[0],I(t,this._chain)}}),w(["concat","join","slice"],function(e){var n=t[e];T.prototype[e]=function(){return I(n.apply(this._wrapped,arguments),this._chain)}}),T.prototype.chain=function(){return this._chain=!0,this},T.prototype.value=function(){return this._wrapped},_}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,a,r,s,o=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(r=l.length,n=0;n<r;n+=1)s[n]=str(n,l)||"null";return a=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,a}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;n<r;n+=1)"string"==typeof rep[n]&&(a=str(i=rep[n],l))&&s.push(quote(i)+(gap?": ":":")+a);else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(a=str(i,l))&&s.push(quote(i)+(gap?": ":":")+a);return a=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,a}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var n,i,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(void 0!==(i=walk(a,n))?a[n]=i:delete a[n]);return reviver.call(e,t,a)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",["hbs/handlebars","hbs/underscore","hbs/json2"],function(e,t,n){var i,a,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=function(){throw new Error("Environment unsupported.")},o=[],l="w+",c="hbs",u="/styles/",d="/demo-build/styles/",h="templates/helpers/",p="screen.build.css",f="onHbsRead";e.registerHelper("$",function(){}),"undefined"!=typeof window&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(a=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return!0===arguments[0]?new XDomainRequest:new XMLHttpRequest;for(t=0;t<3;t++){n=r[t];try{e=new ActiveXObject(n)}catch(e){}if(e){r=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},getIEVersion=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e},s=function(e,t){var n=!1;if(0!=e.indexOf("http"))n=!1;else{var i="https"===e.substr(0,5)?8:7,r="https"===window.location.href.substr(0,5)?8:7,s=e.substr(i).split("/").shift(),o=getIEVersion();n=s!=window.location.href.substr(r).split("/").shift()&&o>=7}if(n){var l=a(!0);l.open("GET",e),l.onload=function(){t(l.responseText,e)},l.onprogress=function(){},l.ontimeout=function(){},l.onerror=function(){},setTimeout(function(){l.send()},0)}else{var c=a();c.open("GET",e,!0),c.onreadystatechange=function(n){4===c.readyState&&t(c.responseText,e)},c.send(null)}}):"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),s=function(e,t){var n=i.readFileSync(e,"utf8")||"";t(n=n.replace(/^\uFEFF/,""),e)}):"undefined"!=typeof java&&void 0!==java.io&&(s=function(e,t){for(var n,i=new java.io.FileInputStream(e),a=new java.io.InputStreamReader(i,"UTF-8"),r=new java.io.BufferedReader(a),s="";null!==(n=r.readLine());)s+=new String(n)+"\n";r.close(),t(s,e)});var g,m=[],b={},v=[];return{get:function(){return e},write:function(e,t,n){if(t+"@hbs"in o){var i=o[t+"@hbs"];n.asModule(e+"!"+t,i)}},version:"3.0.3",load:function(i,a,r,y){var _=i+"@hbs";(g=g||y).hbs=g.hbs||{};var w=0==g.hbs.helpers,S="";g.hbs.partialsUrl&&((S=g.hbs.partialsUrl).match(/\/$/)||(S+="/")),g.hbs.fetchText&&(s=g.hbs.fetchText);var E;function x(e,n){var i=[];return e&&e.body&&(i=function e(n,i){return t(n).forEach(function(t){t&&t.type&&"PartialStatement"===t.type&&"SubExpression"!==t.name.type&&i.push(t.name.original),t&&t.program&&t.program.body&&e(t.program.body,i),t&&t.inverse&&t.inverse.body&&e(t.inverse.body,i)}),i}(e.body,[])),n&&n.partials&&n.partials.length&&t(n.partials).forEach(function(e){i.push(e)}),t.unique(i)}function A(e){return!!("SubExpression"===e.type||e.params&&e.params.length||e.hash)}function P(n,i){A(n)&&void 0!==n.path&&function(t,n){void 0===e.helpers[t]&&n.push(t)}(n.path.original,i),n&&n.params&&n.params.forEach(function(e){P(e,i)}),n&&n.hash&&n.hash.pairs&&t(n.hash.pairs).forEach(function(e){P(e.value,i)})}function C(e){var n=[],i=[];e&&e.body&&(n=function e(n,i,a,r){a=a?a+".":"";return t(n).forEach(function(t){var n;(A(t)||"MustacheStatement"===t.type)&&P(t,r),t&&t.mustache&&e([t.mustache],i,a+"",r),t&&t.program&&t.program.body&&(n=e([t.path],[],"",r)[0]||"",t.inverse&&t.inverse.body&&e(t.inverse.body,i,a+""+(n?a+""?"."+n:n:""),r),e(t.program.body,i,a+""+(n?a+""?"."+n:n:""),r))}),i}(e.body,[],void 0,i));var a=["helperMissing","blockHelperMissing","each","if","unless","with","log","lookup"];return{vars:t(n).chain().unique().map(function(e){return""===e?".":e.length&&"."===e[e.length-1]?e.substr(0,e.length-1)+"[]":e}).value(),helpers:t(i).chain().unique().map(function(e){if(!t(a).contains(e))return e}).compact().value()}}function k(e){for(var t=e.split("/"),n=0;n<t.length;n++)".."===t[n]?(delete t[n-1],delete t[n]):"."===t[n]&&delete t[n];return t.join("/").replace(/\/\/+/g,"/")}var R=g.hbs&&!1===g.hbs.templateExtension;E=R?a.toUrl(i):a.toUrl(i+"."+(g.hbs&&g.hbs.templateExtension?g.hbs.templateExtension:c)),s(E,function(s,y){var E,A,P,O,T,I=g.isBuild&&g[f]?g[f]:function(e,t,n){return n},D=e.parse(I(i,y,s)),M=function(e){var t,i;if(e&&e.body&&(t=e.body[0])&&"CommentStatement"===t.type)try{return i=t.value.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),n.parse(i),i}catch(e){return n.stringify({description:i})}return"{}"}(D),j=C(D),N=j.vars,q=j.helpers||[],L="",B=[],F=i.substr(0,i.lastIndexOf("/")+1);if("{}"!==M)try{P=n.parse(M)}catch(e){console.log("couldn't parse meta for %s",y)}var J,U,V=x(D,P);for(var H in g.hbs=g.hbs||{},g.hbs._partials=g.hbs._partials||{},V)if(V.hasOwnProperty(H)&&"string"==typeof V[H]){var G,z=V[H];if(G=z.match(/^(\.|\/)+/)?k(F+z):k(S+z),R){if(y===a.toUrl(G))continue}else if(y===a.toUrl(G+"."+(g.hbs&&g.hbs.templateExtension?g.hbs.templateExtension:c)))continue;g.hbs._partials[G]=g.hbs._partials[G]||[],g.hbs._partials[G].references=g.hbs._partials[G].references||[],g.hbs._partials[G].references.push(z),g.hbs._loadedDeps=g.hbs._loadedDeps||{},B[H]="hbs!"+G}if(E=B.join("', '"),q=q.concat(P&&P.helpers?P.helpers:[]),(A=w?"":function(){var e,t=[],n=g.hbs&&g.hbs.helperPathCallback?g.hbs.helperPathCallback:function(e){return(g.hbs&&g.hbs.helperDirectory?g.hbs.helperDirectory:h)+e};for(e=0;e<q.length;e++)t[e]="'"+n(q[e],y)+"'";return t}().join(","))&&(A=","+A),P)try{P.styles&&(m=t.union(m,P.styles),require.isBrowser&&!g.isBuild?(O=document.head||document.getElementsByTagName("head")[0],t(P.styles).forEach(function(e){b[e]||((T=document.createElement("link")).href=g.baseUrl+u+e+".css",T.media="all",T.rel="stylesheet",T.type="text/css",O.appendChild(T),b[e]=T)})):g.isBuild&&(J=require.nodeRequire("fs"),U=t(P.styles).map(function(e){return b[e]?"":(b[e]=!0,"@import url("+e+".css);\n")}).join("\n"),J.open(__dirname+d+p,l,"0666",function(e,t){J.writeSync(t,U,null,encoding="utf8"),J.close(t)}),l="a"))}catch(e){console.log("error injecting styles")}g.isBuild||g.serverRender||(L="t.meta = "+M+";\nt.helpers = "+n.stringify(q)+";\nt.deps = "+n.stringify(B)+";\nt.vars = "+n.stringify(N)+";\n");var Q=g.hbs||{},W=t.extend(Q.compileOptions||{},{originalKeyFallback:Q.originalKeyFallback}),$=function(t,n,i){var a,r;return"data"in(i=i||{})||(i.data=!0),i.compat&&(i.useDepths=!0),a=e.parse(t),r=(new e.Compiler).compile(a,i),(new e.JavaScriptCompiler).compile(r,i)}(s,0,W),K="'hbs!"+i+"',";E&&(E=", '"+E+"'");var Y=[];g.hbs._partials[i]&&(Y=g.hbs._partials[i].references);var X=g.hbs&&g.hbs.handlebarsPath?g.hbs.handlebarsPath:"hbs/handlebars";for(s="/* START_TEMPLATE */\ndefine("+K+"['hbs','"+X+"'"+E+A+"], function( hbs, Handlebars ){ \nvar t = Handlebars.template("+$+");\nHandlebars.registerPartial('"+i+"', t);\n",H=0;H<Y.length;H++)s+="Handlebars.registerPartial('"+Y[H]+"', t);\n";s+=L+"return t;\n});\n/* END_TEMPLATE */\n",g.isBuild&&(o[_]=s),g.isBuild||(s+="\r\n//# sourceURL="+y),g.isBuild?(r.fromText(i,s),a([i],function(e){r(e)})):a(B,function(){r.fromText(s),a([i],function(e){r(e)})}),g.removeCombined&&y&&v.push(y)})},onLayerEnd:function(){g.removeCombined&&i&&v.forEach(function(e){i.existsSync(e)&&i.unlinkSync(e)})}}}),define("js/mixins/discovery_bootstrap",["underscore","backbone","js/components/api_query","js/components/api_request","js/components/pubsub_events","hbs","js/components/api_targets"],function(e,t,n,i,a,r,s){return{configure:function(){var e=this.getObject("DynamicConfig");if(e){var t=this.getBeeHive(),n=t.getService("Api");e.root&&(n.url=e.root+"/"+n.url,this.root=e.root),void 0!==e.debug&&(t.debug=e.debug,this.getController("QueryMediator").debug=e.debug),e.apiRoot&&(n.url=e.apiRoot),e.version&&(n.clientVersion=e.version),n.modifyRequestOptions=function(e,t){-1==s._doesntNeedCredentials.indexOf(t.get("target"))&&(e.xhrFields={withCredentials:!0})};var i=t.getService("OrcidApi");e.orcidProxy&&(i.orcidProxyUri=location.origin+e.orcidProxy),this.bootstrapUrls=e.bootstrapUrls,e.useCache&&this.triggerMethodOnAll("activateCache")}},bootstrap:function(){var t=this.getBeeHive(),a=(this.getObject("DynamicConfig"),$.Deferred()),r=t.getService("PersistentStorage").get("appConfig");if(r&&r.expire_in&&new Date(r.expire_in)>new Date)return a.resolve(r).promise();var s=this.getBeeHive().getService("Api");if(this.bootstrapUrls){var o=this.bootstrapUrls.length,l={},c={done:function(t){o--,e.extend(l,t),o<=0&&a.resolve(l)},fail:function(){--o<=0&&a.resolve(l)},type:"GET",timeout:9999},u=location.origin+location.pathname;e.each(this.bootstrapUrls,function(e){e.indexOf("http")>-1?(c.u=e,s.request(new i({query:new n({redirect_uri:u}),target:""}),c)):(delete c.u,s.request(new i({query:new n({redirect_uri:u}),target:e}),c))}),setTimeout(function(){"resolved"!==a.state()&&a.reject(new Error("Timed out while loading modules"))},1e4)}else setTimeout(function(){a.resolve({})},1);return a},reload:function(e){if(!(location.search.indexOf("debug")>-1))return location.search&&location.search.indexOf("bbbRedirect=1")>-1?this.redirect(e):void(location.search=location.search?location.search+"&bbbRedirect=1":"bbbRedirect=1");console.warn("Debug stop, normally would reload to: "+e)},redirect:function(e){this.router&&(location.pathname=this.router.root+e),location.href=location.protocol+"//"+location.hostname+":"+location.port+location.pathname.substring(0,location.pathname.lastIndexOf("/"))+"/"+e},start:function(e){var n=this.getBeeHive(),i=(n.getService("Api"),this.getObject("DynamicConfig"));this.getBeeHive().getObject("AppStorage").setConfig(i);var a=function(e){throw new Error("Ooops. Check you config! There is no "+e+" component @#!")},r=this.getBeeHive().Services.get("Navigator");r||a("services.Navigator");var s=this.getObject("MasterPageManager");s||a("objects.MasterPageManager"),s.assemble(this);var o=$("div#body-template-container").empty();$(s.view.el).hide().appendTo(o).show(),this.router=new e,this.router.activate(n.getHardenedInstance()),r.start(this),r.router=this.router,t.history.start(i?i.routerConf:{}),$(document).on("scroll",function(){$("#landing-page-layout").length>0||($(window).scrollTop()>50?($(".s-quick-add").addClass("hidden"),$(".s-search-bar-full-width-container").addClass("s-search-bar-motion")):($(".s-search-bar-full-width-container").removeClass("s-search-bar-motion"),$(".s-quick-add").removeClass("hidden")))})}}}),define("js/apps/discovery/main",["config","module"],function(e,t){require(["router","js/components/application","js/mixins/discovery_bootstrap","js/mixins/api_access","analytics","es5-shim"],function(e,n,i,a,r){var s="function"==typeof window.__setAppLoadingProgress?window.__setAppLoadingProgress:function(){},o=Date.now();n.prototype.shim();var l=window.location.href.indexOf("debug=true")>-1,c=new(n.extend(i))({debug:l,timeout:3e4}),u=c.loadModules(t.config());s(20,"Starting Application"),u.done(function(){s(50,"Modules Loaded");var t=Date.now();r("send","event","timer","modules-loaded",t-o),c.activate();var n=c.getService("PubSub");n.publish(n.getCurrentPubSubKey(),n.APP_LOADED),c.configure(),s(95,"Finishing Up..."),c.bootstrap().done(function(i){s(100),c.onBootstrap(i),n.publish(n.getCurrentPubSubKey(),n.APP_BOOTSTRAPPED),n.publish(n.getCurrentPubSubKey(),n.APP_STARTING),c.start(e),n.publish(n.getCurrentPubSubKey(),n.APP_STARTED);var a=_.debounce(function(){var e=function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");if(t)return t.getUserData("USER_DATA")}catch(e){}return{}}.call(c);if("OPEN IN CURRENT TAB"===(e.externalLinkAction&&e.externalLinkAction.toUpperCase()||"AUTO")){var t;!function e(n){clearTimeout(t),n<10&&($('a[target="_blank"]').attr("target",""),t=setTimeout(e,1e3,n+1))}(0)}},3e3,{leading:!0,trailing:!1},!1);n.subscribe(n.getCurrentPubSubKey(),n.NAVIGATE,a),a(),r("send","event","timer","app-booted",Date.now()-t),$("body").on("click","button.toggle-menu",function(e){var t=$(e.target),n=t.parents().eq(1).find(".nav-container");n.toggleClass("show");var i=n.hasClass("show")?'  <i class="fa fa-close"></i> Close Menu':' <i class="fa fa-bars"></i> Show Menu';t.html(i)}),$("body").on("click","#skip-to-main-content",function(e){e.preventDefault()});var o=c.getObject("DynamicConfig");if(o&&o.debugExportBBB&&(console.log("Exposing Bumblebee as global object: window.bbb"),window.bbb=c),__PAGE_LOAD_TIMESTAMP){var u=new Date-__PAGE_LOAD_TIMESTAMP;r("send",{hitType:"timing",timingCategory:"Application",timingVar:"Loaded",timingValue:u}),l&&console.log("Application Started: "+u+"ms")}}).fail(function(){r("send","event","introspection","failed-load",arguments),l||c.redirect("500.html")})}).fail(function(){r("send","event","introspection","failed-reloading",arguments),l||c.reload("404.html")})})}),define("cache",["require","exports","module"],function(e,t,n){!function(){"use strict";function e(e){var n=this;!function(e){var t=e.maximumWeight,i=e.weigherFunction,a=e.maximumSize,r="number"==typeof t&&t>-1,s="function"==typeof i;if(!r&&s||r&&!s)throw new Error("Maximum weight or weight function has illegal values");if(r&&s&&"number"==typeof a&&a>-1)throw new Error("Both max weight and size can't be configured");n._spec={loaderFn:"function"==typeof e.loaderFunction&&e.loaderFunction,expiresAfterWrite:"number"==typeof e.expiresAfterWrite?1e3*e.expiresAfterWrite:null,recordStats:e.recordStats,maxSize:a,maxWeight:t,weighFn:i,onRemove:"function"==typeof e.onRemove&&e.onRemove}}(e),t.apply(this)}e.prototype._REMOVAL_CAUSE_I="explicit",e.prototype._REMOVAL_CAUSE_C="capacity",e.prototype._REMOVAL_CAUSE_E="expired";var t=function(){this._accessQueue=new i("A"),this._writeQueue=this._spec.expiresAfterWrite?new i("W"):null;var e=n(this._REMOVAL_CAUSE_C,this._canReap,this._accessQueue,this),t=n(this._REMOVAL_CAUSE_E,this.isExpired,this._writeQueue,this);function n(e,t,n,i){return n?function(a){if(a)for(var r=n.tail.prev(n),s=null;r&&t.apply(i,[r]);)r&&(s=r.prev(n),i._rmEntry(r,e),r=s)}.bind(n):function(){}}this._cleanup=function(n){e(n),t(this._writeQueue)},this.size=0,this.weight=0,this._cache=Object.create(null),Object.defineProperty(this,"stats",{value:{hitCount:0,missCount:0,requestCount:0},configurable:!0})};function i(e){this.tail=this.head=Object.create(a.prototype),this.type=e}function a(e,t,n,i){this.key=e,this.loading=n,n||this.setValue(t),this.onLoad=i?[i]:[],this.writeTime=Date.now()}a.prototype.setValue=function(e){if(void 0===e||null===e)throw new Error("Illegal value for key "+e);this.value=e,this.writeTime=Date.now()},a.prototype.moveToHead=function(e){var t=this;e.forEach(function(e){if(e){var n=e.head;t.next(e,n),n.prev(e,t),e.head=t}})},a.prototype.next=function(e,t){var n="next"+e.type;return void 0!==t&&(this[n]=t),this[n]},a.prototype.prev=function(e,t){var n="prev"+e.type;return void 0!==t&&(this[n]=t),this[n]},a.prototype.remove=function(e){if(e){var t=this.prev(e),n=this.next(e);t?(t.next(e,n),n.prev(e,t)):(n.prev(e,null),e.head=n),n.next(e)||(e.tail=n),this.next(e,null),this.prev(e,null)}},a.prototype.promote=function(){var e=this;Array.prototype.slice.call(arguments).forEach(function(t){t&&e.prev(t)&&(e.remove(t),e.moveToHead([t]))})},a.prototype.forEach=function(e,t){for(var n=this;n;)e.call(this,n),n=n.next(t)},e.prototype.put=function(e,t){var n=this._cache[e];n?(n.setValue(t),n.writeTime=Date.now(),n.promote(this._accessQueue,this._writeQueue),this._cleanup(!1)):this._createEntry(e,t)},e.prototype._createEntry=function(e,t,n,i){var r=new a(e,t,n,i);return this._cleanup(!0),this._cache[e]=r,this._updateCacheSize(r,!0),r.moveToHead([this._accessQueue,this._writeQueue]),r},e.prototype.isExpired=function(e){var t=this._spec.expiresAfterWrite,n=Date.now();return!e.loading&&t&&t>0&&n-e.writeTime>t},e.prototype._updateCacheSize=function(e,t){var n;this._spec.maxWeight&&(n=this._spec.weighFn.apply(this,[e.key,e.value]),this.weight+=t?n:-n),this.size+=t?1:-1},e.prototype.get=function(e,t){t=t||function(){},this.stats.requestCount++;var n=this;process.nextTick(function(){(function(e,t){var n=this._cache[e];if(n){if(n.loading)return this.stats.missCount++,void n.onLoad.push(t);this.isExpired(n)?(this.stats.missCount++,this._notify(n,this._REMOVAL_CAUSE_E),n.loading=!0,n.onLoad.push(t),r(this,s.bind(n),e)):(n.promote(this._accessQueue),this.stats.hitCount++,t.apply(null,[null,n.value]))}else this.stats.missCount++,n=this._createEntry(e,null,!0,t),r(this,s.bind(n),e)}).call(n,e,t)})};var r=function(e,t,n){var i=e._spec.loaderFn;i&&i.apply(null,[n,function(n,i){t(e,n,i)}])},s=function(e,t,n){if(!t)try{this.setValue(n),this.promote(e._accessQueue,e._writeQueue),this.onLoad.forEach(function(e){e.apply(null,[t,n])}),this.onLoad=[],this.loading=!1}catch(e){t=e}t&&(this.onLoad.forEach(function(e){e.apply(null,[t,n])}),e._rmEntry(this))};function o(e,t,n){var i,a=null,r=e._spec.loaderFn;return r&&(r.apply(null,[n,function(e,t){i=e,a=t}]),t(i,a)),a}e.prototype.getSync=function(e){var t=arguments.length>2&&arguments[2];this.stats.requestCount++;var n,i=this._cache[e],a=this;return i?this.isExpired(i)?(this.stats.missCount++,t?this._rmEntry(i,this._REMOVAL_CAUSE_E):n=o(a,function(e,t){if(e)throw e;a._notify(i,a._REMOVAL_CAUSE_E),i.setValue(t),i.promote(a._accessQueue,a._writeQueue)},e)):(i.promote(this._accessQueue),n=i.value,this.stats.hitCount++):(this.stats.missCount++,t||(n=o(a,function(t,n){if(t)throw t;a._createEntry(e,n)},e))),n},e.prototype.getIfPresent=function(e){return this.getSync(e,null,!0)},e.prototype.invalidate=function(e){var t=this._cache[e];this._rmEntry(t,this._REMOVAL_CAUSE_I)},e.prototype._notify=function(e,t){this._spec.onRemove&&this._spec.onRemove.apply(null,[e.key,e.value,t])},e.prototype._rmEntry=function(e,t){e.remove(this._accessQueue),e.remove(this._writeQueue),this._updateCacheSize(e,!1),delete this._cache[e.key],t&&this._notify(e,t)},e.prototype.invalidateAll=function(){var e=this;Object.keys(this._cache).forEach(function(t){e.invalidate(t)})},e.prototype._canReap=function(){return this._spec.maxSize&&this.size>=this._spec.maxSize||this._spec.maxWeight&&this.weight>this._spec.maxWeight},n.exports=e}()}),define("js/components/json_response",["underscore","backbone","js/components/api_query"],function(e,t,n){var i=function(t,n){var i,a=t||{};n||(n={}),this.rid=e.uniqueId("r"),this.readOnly=!n.hasOwnProperty("readOnly")||n.readOnly,this._url=n.hasOwnProperty("url")?n.url:null,n.parse&&(a=this.parse(a,n)||{}),(i=e.result(this,"defaults"))&&(a=e.defaults({},a,i)),this.attributes=a,this.initialize.apply(this,arguments)};return e.extend(i.prototype,{initialize:function(){},getApiQuery:function(){return this.apiQuery},setApiQuery:function(e){if(e){if(!(e instanceof n))throw new Error("Only ApiQuery instances accepted");this.apiQuery=e}},toJSON:function(e){return this._clone(this.attributes)},url:function(){return this._url?this._url:this.rid},set:function(e,t,n){if(this.readOnly)throw Error("You can't change read-only response object");var i=this._split(e);if(1==i.length)this.attributes[i[0]]=t;else{this.get(e);t}},_split:function(e){for(var t=[],n=0,i=e.length,a=0,r=[];n<i;)e[n]==r[r.length-1]?r.pop():'"'==e[n]||"'"==e[n]?r.push(e[n]):"."==e[n]&&0==r.length?(t.push(e.substring(a,n)),a=n+1):"["==e[n]&&0==r.length&&(t.push(e.substring(a,n)),t.push(e.substring(n,e.indexOf("]",n+1)+1)),a=n=e.indexOf("]",n+1)+1),n+=1;return a<i&&t.push(e.substring(a)),t},has:function(e){return this.get(e,!0)},get:function(t,n){if(!t)return this._clone(this.attributes);for(var i=this._split(t),a=[],r=this.attributes;i.length>0;){var s=i.shift();if(r.hasOwnProperty(s))r=r[s],a.push(s);else{if(!(s.indexOf("[")>-1)){if(n)return!1;throw new Error("Can't find: "+t+(a.length>0?" (worked up to: "+a.join(".")+")":""))}var o=s.trim().substring(1,s.length-1);if((o.indexOf('"')>-1||o.indexOf("'")>-1)&&r.hasOwnProperty(o.substring(1,o.length-1)))r=r[o.substring(1,o.length-1)],a.push(o);else{if(!e.isArray(r)){if(n)return!1;throw new Error("Can't find: "+t+(a.length>0?" (worked up to: "+a.join(".")+")":""))}var l=null;try{if(l=parseInt(o),e.isNaN(l)||r.length<=l||l<0){if(n)return!1;throw new Error}r=r[l],a.push(o)}catch(e){if(n)return!1;throw new Error("Can't find: "+t+(a.length>0?" (worked up to: "+a.join(".")+")":""))}}}}return!!n||this._clone(r)},clone:function(){return new this.constructor(this.attributes)},_clone:function(t){return this.readOnly&&e.isObject(t)?e.cloneDeep?e.cloneDeep(t):JSON.parse(JSON.stringify(t)):t},isLocked:function(){return this.readOnly},lock:function(){return this.readOnly=!0},unlock:function(){return this.readOnly=!1}}),i.extend=t.Model.extend,i}),define("js/components/solr_response",["js/components/json_response","js/components/solr_params","backbone","underscore","jquery"],function(e,t,n,i,a){return e.extend({initialize:function(){if(!this.has("responseHeader.params"))throw new Error("SOLR data error - missing: responseHeader.params");if(i.isString(this._url)){var e=new t;this._url=new t(e.parse(this._url)).url()}else{var n=this.get("responseHeader.params");this._url=new t(n).url()}},url:function(e,t){return this._url}})}),define("js/components/api_response",["underscore","backbone","js/components/solr_response","js/components/facade"],function(e,t,n,i){var a={set:"set (replace existing)",get:"get values",has:"has a key",toJSON:"values back as JSON object",clone:"make a copy",url:"url string of the params",isLocked:!0,lock:!0,unlock:!0,setApiQuery:"sets the ApiQuery",getApiQuery:"gets the query"},r=function(e,t){this.innerResponse=new i(a,e instanceof n?e:new n(e,t))},s={};return e.each(e.keys(a),function(e,t,n){s[e]=function(){return this.innerResponse[e].apply(this.innerResponse,arguments)}}),e.extend(r.prototype,s,{clone:function(){var e=this.innerResponse.clone.apply(this.innerResponse,arguments);return new r(e)}}),r}),define("js/components/feedback_mediator",["underscore","jquery","cache","js/components/generic_module","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/pubsub_key","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l,c){var u=i.extend({initialize:function(e){this._cache=this._getNewCache(e.cache),this.debug=e.debug||!1,this._handlers={},this.app=null},_getNewCache:function(t){return new n(e.extend({maximumSize:150,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){if(!n)throw new Error("This controller absolutely needs access to the app");this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.FEEDBACK,e.bind(this.receiveFeedback,this))},receiveFeedback:function(e,t){this.debug&&console.log("[EM]: received feedback:",e.toJSON(),t?t.getId():null);var n=this._getCacheKey(e,t),i=this._retrieveCacheEntry(n);i||(i=this.createNewCacheEntry(n),this._cache.put(n,i));var a=this.getFeedbackHandler(e,i);if(a){if(a.execute&&a.execute(e,i))return;if(a.call(this,e,i))return}this.handleFeedback(e,i)},removeFeedbackHandler:function(e){e.toString()in this._handlers&&delete this._handlers[e.toString()]},addFeedbackHandler:function(t,n){if(!t&&!e.isNumber(t))throw new Error("first argument must be code or code:string or string");if(!e.isFunction(n))throw new Error("second argument must be executable");this._handlers[t.toString()]=n},getFeedbackHandler:function(e,t){for(var n=[e.code+":"+t.id,t.id,e.code?e.code.toString():Date.now()],i=0;i<n.length;i++)if(n[i]in this._handlers)return this._handlers[n[i]]},_retrieveCacheEntry:function(e){return this._cache.getSync(e)},_getCacheKey:function(t,n){if(!t)throw new Error("ApiFeedback cannot be empty");if(t.getSenderKey())return t.getSenderKey();if(n){if(n instanceof l)return n.getId();if(e.isString(n))return n}var i=t.getApiRequest();if(i)return i.url();throw new Error("We cannot identify the origin (recipient) of this feedback")},createNewCacheEntry:function(e){return{waiting:0,max:0,errors:0,counter:0,created:Date.now(),id:e}},handleFeedback:function(e,t){var n=o.CODES;switch(t.counter+=1,e.code){case n.ALL_FINE:t.errors=0;break;case n.KEEP_WAITING:t.waiting+=t.started;break;case n.SERVER_ERROR:break;case n.ALERT:this.getApp().getController("AlertsController").onAlert(e,t)}}});return e.extend(u.prototype,c.BeeHive,c.App),u}),define("js/widgets/widget_states",[],function(){return{READY:0,LOADING:1,IDLE:2,FAILED:3}}),define("js/components/alerts",["backbone","js/mixins/hardened"],function(e,t){return{TYPE:{ERROR:"error",INFO:"info",WARNING:"warning",SUCCESS:"success",DANGER:"danger"},ACTION:{CALL_PUBSUB:2,TRIGGER_FEEDBACK:1}}}),define("js/wraps/discovery_mediator",["underscore","jquery","js/components/feedback_mediator","js/components/api_feedback","js/widgets/widget_states","js/components/alerts","js/components/api_response","analytics"],function(e,t,n,i,a,r,s,o){var l={};return l[i.CODES.MAKE_SPACE]=function(t){var n=this.getApp().getObject("MasterPageManager");if(n){var i=n.getCurrentActiveChild();i.view&&i.view.showCols&&(i.view.showCols({right:!1,left:!1}),this.getBeeHive().getService("PubSub").once(this.getPubSub().START_SEARCH,e.once(function(){i.view.showCols({right:!0})})))}this.getBeeHive().getService("PubSub").once(this.getPubSub().DELIVERING_REQUEST,e.bind(function(e,t){this._tmp.callOnce[t.getId()]||(this._tmp.callOnce[t.getId()]=!0)},this))},l[i.CODES.UNMAKE_SPACE]=function(e){var t=this.getApp().getObject("MasterPageManager");if(t){var n=t.getCurrentActiveChild();n.view&&n.view.showCols&&n.view.showCols({right:!0,left:!0})}},l[i.CODES.SEARCH_CYCLE_STARTED]=function(t){this._tmp.cycle_started=!0;var n=this.getApp();if(t.query?(n.getObject("AppStorage").setCurrentQuery(t.query),n.getObject("AppStorage").setCurrentNumFound(t.numFound)):n.getObject("AppStorage").setCurrentQuery(null),this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page"),t.request&&t.request.get("target").indexOf("search")>-1&&t.query&&!t.numFound)t.query;else{t.numFound>1e3&&n.getWidget("SearchWidget").done(function(e){e.view&&e.view.highlightFields&&e.view.highlightFields()});e.keys(t.cycle.waiting);this.getAlerter().alert(new i({type:r.TYPE.INFO,msg:null}))}},l[i.CODES.SEARCH_CYCLE_FAILED_TO_START]=function(t){var n=t.request,a=t.error.jqXHR||{},r=this.getApp(),l=this.getAlerter(),c=this,u={target:"",msg:a.statusText};function d(){var e=r.getService("Api");return e&&e.access_token?e.access_token.slice(30):"no access token"}if(o("send","event","error","search",a.statusText),a&&n){var h=n.get("target");switch(u.target=h,u.query=n.get("query").toJSON(),a.status){case 403:return o("send","event","error","access-denied","request="+n.url()+" token=..."+d()),void l.alert(new i({code:i.CODES.ALERT,msg:"We are sorry, you do not have permission to access: "+h+". This is likely our fault (misconfiguration) and the ADS team has been notified.",modal:!0}));case 429:return void l.alert(new i({code:i.CODES.ALERT,msg:"We are sorry, it looks like you have exhausted allowed quota for: "+h+". The limits will be reset in (usually) in 24 hours. If you believe this is an error or if you need to do something special, please contact us using the feedback button and describe what you are trying to accomplish. We may be able to help or provide efficient way of searching through ADS database. We also have an API that can be useful!",modal:!0}));case 405:return o("send","event","error","access-denied","request="+n.url()+" token=..."+d),void l.alert(new i({code:i.CODES.ALERT,msg:"I am afraid you have just discovered a glitch in our system. (Congratulations!). What you are trying to do should be possible. It is likely a mis-configuration. Please try to reload the webpage; if problem persists - then send us an angry email and wait for a day.",modal:!0}));case 401:return void r.getApiAccess({reconnect:!0}).done(function(){r.getService("Api").request(n,{done:function(){r.getController("QueryMediator").resetFailures(),c.getPubSub().publish(c.getPubSub().START_SEARCH,n.get("query"))},fail:function(){o("send","event","error","unauthorized","request="+n.url()+" token=..."+d()),l.alert(new i({msg:"Seems like you are not authorized to access: "+h,modal:!0,type:"danger"}))}})}).fail(function(){l.alert(new i({code:i.CODES.DANGER,msg:"The security token used to access our API has expired and we are unable to refresh it (though we tried). You will have to reload the webpage. Sorry about that!",modal:!0}))})}if(h.indexOf("search")>-1){if(400==a.status){var p=n.get("query"),f="";return a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.msg&&(f=a.responseJSON.error.msg).indexOf("SyntaxError")>-1&&(f=(f=(f=(f=(f=(f=f.replace("org.apache.solr.search.SyntaxError:","")).replace("org.apache.solr.common.SolrException:","")).replace("INVALID_SYNTAX_CANNOT_PARSE:","")).replace(": The parser reported a syntax error, antlrqueryparser hates errors!","")).trim()).replace("Syntax Error, cannot parse","Syntax Error, cannot parse<b>")+"</b>"),void l.alert(new i({msg:(f||"There is something wrong with the query:")+'<b><a href="#">&nbsp;&nbsp;Try looking at the search examples on the home page</a></b>  or <b><a href="https://adsabs.github.io/help/search/search-syntax" target="_blank" rel="noopener">reading our help page</a>.</b>',events:{"click a#query-assistant":"query-assistant"}})).done(function(e){"query-assistant"==e&&c.getApp().getWidget("SearchWidget").done(function(e){var t=p.get("q").join(" ");t?e.openQueryAssistant(t):e.openQueryAssistant("ooops, the query is complex (we are not yet ready for that)")})})}if(500==a.status&&a.responseJSON){var g=a.responseJSON;if(g.error&&g.error.msg&&g.error.msg.indexOf("maxClauseCount")>-1){var m=new s(g),b=t.cycle,v=e.keys(b.inprogress)[0],y=b.inprogress[v];return m.setApiQuery(y.request.get("query")),b.done[v]=b.inprogress[v],delete b.inprogress[v],c.getPubSub().publish(c.getPubSub().DELIVERING_RESPONSE+v,m),b.running=!1,void r.getController("QueryMediator").startExecutingQueries()}}}}o("send","event","error","unrecoverable-"+a.status,"request="+n.url()+" token=..."+d);var _,w=["We are having trouble accessing: "+h+". The ADS backend service is probably down, or else we’ve been struck by an asteroid.","We are having trouble accessing: "+h+". A solar flare must have taken down our servers! Or else the ADS backend service is down momentarily.","Was that a supernova or are our servers just down? We are having trouble accessing: "+h+" but we should be back in a flash.","The alien mothership has arrived! Or else the ADS backend service is down momentarily. We are having trouble accessing: "+h+" but should be back up soon.","The server response seems to be highly redshifted, may require another observation to record. (The ADS backend service is down momentarily and we are having trouble accessing: "+h+" but we should be back up soon.)","A singularity has formed inside our server, and we are having trouble accessing: "+h+".","Universal Translator Malfunction: Unable to Communicate with ADS Droids. (The ADS backend service is down momentarily and we are having trouble accessing: "+h+" but we should be back up soon.","UV catastrophe detected! (The ADS backend service is down momentarily and we are having trouble accessing: "+h+" but we should be back up soon.)","The ADS Droids got distracted by the Missing Mass Problem instead of working on: "+h+". Be back in a minute."];switch(a.status){case 504:case 408:f="This particular query is taking too long. Please wait a moment and retry. If the problem persits, our backend is likely overwhelmed and will be sluggish for a little longer.";break;case 500:case 502:case 503:_=Math.floor(Math.random()*w.length),f=w[_];break;default:f="Today, you are doubly unlucky. Not only are you experiencing an 'unrecoverable' error, but you have to read this default error message. Sorry about that! We have been notified about the problem."}l.alert(new i({code:i.CODES.ALERT,msg:f,modal:!1}))},l[i.CODES.API_REQUEST_ERROR]=function(e){var t=e.request,n=t.get("query"),a=t.get("target"),r=e.psk,s={error:e.errorThrown,errorCode:e.error.status,destination:a,query:n?n.toJSON():void 0},l=this.getApp(),c=this.getAlerter();if(o("send","event","error","api-request",JSON.stringify(s)),r){var u=l.getPluginOrWidgetName(r.getId());if(u){if(console.error("Query failed for widget: "+u,s),/orcid/.exec(a)&&401==e.error.status){c.alert(new i({code:i.CODES.ALERT,msg:"Your connection with Orcid is no longer valid, it may be that you revoked your token. To continue using this feature, please log back in to Orcid.",modal:!0}));var d=l.getService("OrcidApi"),h=l.getObject("User");return d.signOut(),void h.setOrcidMode(0)}this._tmp.api_failures=this._tmp.api_failures||{},this._tmp.api_failures[u]=this._tmp.api_failures[u]||0,this._tmp.api_failures[u]+=1;this._tmp.api_failures[u]}else if(!e.beVerbose)return;this._tmp.cycle_started}else console.error("We are not going to handle the error (PSK is empty, can't identify the component")},l[i.CODES.QUERY_ASSISTANT]=function(e){this.getApp().getWidget("SearchWidget").done(function(t){var n=null;e.query&&(n=e.query.get("q").join(" ")),t.openQueryAssistant(n)})},function(){var t=new(n.extend({_tmp:{},activate:function(){n.prototype.activate.apply(this,arguments);var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,e.bind(this.onNewCycle,this)),t.subscribe(t.ARIA_ANNOUNCEMENT,e.bind(this.onPageChange,this)),t.subscribe(t.APP_EXIT,e.bind(this.onAppExit,this)),t.subscribeOnce(t.APP_STARTING,e.bind(this.onAppStarting,this))},onAppStarting:function(){var t=this.getBeeHive().getService("PubSub"),n=this.getApp().getController("QueryMediator");t.unsubscribe(n.getPubSub().getCurrentPubSubKey(),t.START_SEARCH),this.getPubSub().subscribe(t.START_SEARCH,e.bind(function(e,t){var n,i,a=this.getPubSub(),r=this.getApp();if(a&&(n=r.getController("QueryMediator"))){if((i=r.getObject("AppStorage"))&&i.getCurrentQuery())try{console.log("URL: ",i.getCurrentQuery().url())}catch(e){}i&&i.hasCurrentQuery()&&e.url()==i.getCurrentQuery().url()&&"widget:SearchWidget"!=r.getPluginOrWidgetName(t.getId())&&r.getWidgetRefCount("Results")>=1&&r.hasService("Navigator")?r.getService("Navigator").navigate("results-page",{replace:!0}):("SearchPage"!==this.getCurrentPage()&&r.getWidgetRefCount("Results")<=0&&r.getService("Navigator").navigate("results-page",{replace:!1}),n.getQueryAndStartSearchCycle.apply(n,arguments))}},this))},onNewCycle:function(){this.reset()},onPageChange:function(e){e=e.replace("Switching to: ",""),this._currentPage=e,o("send","pageview",{page:e})},getCurrentPage:function(){return this._currentPage||"LandingPage"},onAppExit:function(e){console.log("App exit requested to: "+e);var t=this.getAlerter();e&&e.url&&("orcid"==e.type?t.alert(new i({code:i.CODES.WARNING,msg:'<p>You will be redirected to ORCID.</p> <p>Please sign in with your ORCID credentials and click on the "authorize" button.</p><p><b>This service is experimental. Should you have any suggestions, please let us know at <a href="mailto:adshelp@cfa.harvard.edu">adshelp@cfa.harvard.edu</a></b></p><button class="btn btn-success" id="okOrcid">Take me to ORCID</button>',modal:!0,events:{"click button#okOrcid":"OK"}})).done(function(t){"OK"==t&&(window.location=e.url)}):window.location=e.url)},getAlerter:function(){return this.getApp().getController(this.alertsController||"AlertsController")},createFeedback:function(e){return new i(e)},reset:function(){this._tmp={callOnce:{}}}}));return e.each(e.pairs(l),function(e){t.addFeedbackHandler(e[0],e[1])}),t}}),define("js/mixins/add_secondary_sort",[],function(){return{addSecondarySort:function(e){e.has("sort")||e.set("sort","date desc");var t=e.get("sort")[0].split(",")[0],n=t.indexOf(" asc")>-1?"bibcode asc":"bibcode desc";e.set("sort",t+", "+n)}}}),define("utils",["underscore"],function(e){return{qs:function(e,t,n){var i=e.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&"),a="(^|[\\?&])"+i+"=[^&]*",r=(t||location.hash).match(new RegExp(a,"g"));if(r){for(var s=[],o=0;o<r.length;o++)s.push(r[o].replace(new RegExp("(^|[\\?&])"+i+"="),""));return msg=s.join(n),decodeURIComponent(msg.replace(/\+/g," "))}return null},updateHash:function(t,n,i){var a=t.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&"),r=e.isString(i)?i:location.hash,s=r.match(new RegExp("&?"+a+"=([^&]+)(&|$)"));if(s){var o=s[0].replace(s[1],n);return r.replace(s[0],o)}return i}}}),define("js/components/query_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/mixins/add_secondary_sort","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/json_response","js/components/api_targets","js/components/api_query","js/components/alerts","utils","analytics"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g){var m=i.extend({initialize:function(t){t=t||{},this._cache=null,this.debug=t.debug||!1,this.queryUpdater=new l("QueryMediator"),this.failedRequestsCache=this._getNewCache({expiresAfterWrite:5}),this.maxRetries=t.maxRetries||3,this.recoveryDelayInMs=e.isNumber(t.recoveryDelayInMs)?t.recoveryDelayInMs:700,this.__searchCycle={waiting:{},inprogress:{},done:{},failed:{}},this.shortDelayInMs=e.isNumber(t.shortDelayInMs)?t.shortDelayInMs:10,this.longDelayInMs=e.isNumber(t.longDelayInMs)?t.longDelayInMs:100,this.monitoringDelayInMs=e.isNumber(t.monitoringDelayInMs)?t.monitoringDelayInMs:200,this.mostRecentQuery=new h},activateCache:function(e){this._cache=this._getNewCache((e||{}).cache)},_getNewCache:function(t){return new n(e.extend({maximumSize:100,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.START_SEARCH,e.bind(this.getQueryAndStartSearchCycle,this)),i.subscribe(i.DELIVERING_REQUEST,e.bind(this.receiveRequests,this)),i.subscribe(i.EXECUTE_REQUEST,e.bind(this.executeRequest,this)),i.subscribe(i.GET_QTREE,e.bind(this.getQTree,this))},getQTree:function(e,t){var n=new s({query:e,target:d.QTREE});this._executeRequest(n,t)},doQueryTranslation:function(e){var n=t.Deferred(),i=this.getPubSub(),a=new s({target:d.SERVICE_OBJECTS_QUERY,query:new h({query:e}),options:{type:"POST",contentType:"application/json"}});return i.subscribeOnce(i.DELIVERING_RESPONSE,function(e){n.resolve(e.toJSON())}),i.publish(i.EXECUTE_REQUEST,a),n.promise()},getQueryAndStartSearchCycle:function(e,t){var n=this,i=this.getPubSub();if(r.addSecondarySort(e),this.original_url&&e.get("q")&&-1!==e.get("q")[0].indexOf("simbid")){var a=e.clone(),o=e.get("q")[0];e.has("__original_query")&&(o=e.get("__original_query")[0]),a.set("q",o),this.original_url=this.queryUpdater.clean(a).url()}else this.original_url=this.queryUpdater.clean(e).url();if(this.original_query=e.get("q"),e.get("__bigquery")){e.set("bigquery","bibcode\n"+e.get("__bigquery").join("\n")),e.unset("__bigquery"),e.get("q")||e.set("q","*:*"),e.add("fq","{!bitset}");var l=new s({target:d.MYADS_STORAGE+"/query",query:e,options:{type:"POST",contentType:"application/json",done:function(i){var a=new h({q:e.get("q"),__qid:i.qid}),r=e.get("__bigquerySource");r&&a.set("__bigquerySource",r[0]),e.get("sort")&&a.set("sort",e.get("sort")),n.startSearchCycle(a,t)},fail:function(e,t,n){console.warn("bigquery failed:",[].slice.apply(arguments).join(",")),i.publish(i.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FAILED_TO_START,error:{jqXHR:e,textStatus:t,errorThrown:n}}))}}});this.getBeeHive().getService("Api").request(l)}else if(e.get("q")[0].indexOf("object:")>-1){var u=function(n){e.set({q:n.query}),this.startSearchCycle(e,t)}.bind(this);this.doQueryTranslation(e.get("q")[0]).done(u)}else this.startSearchCycle.apply(this,arguments)},startSearchCycle:function(t,n){if(this.getBeeHive().getObject("AppStorage")&&this.getBeeHive().getObject("AppStorage").clearSelectedPapers(),!this.mostRecentQuery.get("__qid")||t.get("__qid")||t.get("__clearBigQuery")||(this.mostRecentQuery.set("q",t.get("q")),t=this.mostRecentQuery),this.mostRecentQuery=t,this.debug&&console.log("[QM]: received query:",this.hasApp()&&this.getApp().getPluginOrWidgetName(n.getId())||n.getId(),t.url()),t.keys().length<=0)console.error("[QM] : received empty query (huh?!)");else{t.get("q")[0].indexOf("simbid")>-1&&(t.add("__original_url",this.original_url),t.add("__original_query",this.original_query));var i=this.getPubSub();this.__searchCycle.running&&this.__searchCycle.waiting&&e.keys(this.__searchCycle.waiting)&&console.error("The previous search cycle did not finish, and there already comes the next!"),this.reset(),this.__searchCycle.initiator=n.getId(),this.__searchCycle.collectingRequests=!0,this.__searchCycle.query=t.clone();var a=t.clone();a.unset("fl"),a.lock(),i.publish(i.INVITING_REQUEST,a);var r=this;this.shortDelayInMs?setTimeout(function(){r.__searchCycle.collectingRequests=!1,r.startExecutingQueries()&&r.monitorExecution()},this.shortDelayInMs):(this.__searchCycle.collectingRequests=!1,r.startExecutingQueries()&&setTimeout(function(){r.monitorExecution()},this.shortDelayInMs))}},startExecutingQueries:function(t){var n=this,i=this.__searchCycle;if(!i.running&&!e.isEmpty(i.waiting)&&this.hasBeeHive()){var a;i.running=!0;var r=this.getBeeHive().getService("Api"),s=this.getPubSub();if(s&&r){var o,l;if((o=this.getApp().getPskOfPluginOrWidget("widget:Results"))&&i.waiting[o]&&(a=i.waiting[o],delete i.waiting[o]),!a&&i.waiting[i.initiator]&&(a=i.waiting[i.initiator],delete i.waiting[i.initiator]),!a)this.debug&&console.warn("DynamicConfig does not tell us which request to execute first (grabbing random one)."),a=i.waiting[l=e.keys(i.waiting)[0]],delete i.waiting[l];var u=a.key.getId();return i.inprogress[u]=a,this._executeRequest(a.request,a.key).done(function(t,r,o){var l;i.done[u]=a,delete i.inprogress[u],t.response&&t.response.numFound&&(l=t.response.numFound),s.publish(s.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_STARTED,query:i.query,request:a.request,numFound:l,cycle:i,response:t})),n.displayTugboatMessages();var d=function(){e.each(e.keys(i.waiting),function(t){a=i.waiting[t],delete i.waiting[t],i.inprogress[t]=a;var r=t;n._executeRequest.call(n,a.request,a.key).done(function(){i.done[r]=i.inprogress[r],delete i.inprogress[r]}).fail(function(){i.failed[r]=i.inprogress[r],delete i.inprogress[r]}).always(function(){i.finished||e.isEmpty(i.inprogress)&&(s.publish(s.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FINISHED,cycle:i})),i.finished=!0)})})};n.longDelayInMs&&n.longDelayInMs>0?setTimeout(function(){d()},n.longDelayInMs):d()}).fail(function(e,t,a){n.__searchCycle.error=!0,s.publish(s.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FAILED_TO_START,cycle:i,request:this.request,error:{jqXHR:e,textStatus:t,errorThrown:a}}))}),!0}}},monitorExecution:function(){if(this.hasBeeHive()){var t=this,n=this.getPubSub();if(n){if(this.__searchCycle.monitor+=1,this.__searchCycle.monitor>100)return console.warn("Stopping monitoring of queries, it is running too long"),void n.publish(n.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_STOP_MONITORING,cycle:this.__searchCycle}));if(this.__searchCycle.inprogress&&e.isEmpty(this.__searchCycle.inprogress)){if(this.__searchCycle.finished)return;n.publish(n.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FINISHED,cycle:this.__searchCycle}))}else{var i=e.keys(this.__searchCycle.waiting).length,a=i+e.keys(this.__searchCycle.done).length+e.keys(this.__searchCycle.inprogress).length+e.keys(this.__searchCycle.failed).length;n.publish(n.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_PROGRESS,msg:i/a,total:a,todo:i,cycle:this.__searchCycle})),setTimeout(function(){t.monitorExecution()},t.monitoringDelayInMs)}}}},receiveRequests:function(e,t){this.debug&&console.log("[QM]: received request:",this.hasApp()&&this.getApp().getPluginOrWidgetName(t.getId())||t.getId(),e.url()),this.__searchCycle.collectingRequests?this.__searchCycle.waiting[t.getId()]={request:e,key:t}:this.executeRequest(e,t)},executeRequest:function(e,t){if(!(e instanceof s))throw new Error("Sir, I belive you forgot to send me a valid ApiRequest!");if(!t)throw new Error("Request executed, but no widget id provided!");return this._executeRequest(e,t)},_executeRequest:function(e,n){if(e.get("query")&&e.get("query").get("__qid")){var i=e.get("query").get("__qid")[0];e.set("target",d.MYADS_STORAGE+"/execute_query/"+i)}var a=this.getPubSub(),r=this.getBeeHive().getService("Api"),s=this._getCacheKey(e);if((this.failedRequestsCache.getSync(s)||0)>=this.maxRetries)return this.onApiRequestFailure.apply({request:e,key:n,requestKey:s,qm:this},[{status:c.CODES.TOO_MANY_FAILURES},"Error","This request has reached maximum number of failures (wait before retrying)"]),t.Deferred().reject();if(this._cache){var o=this._cache.getSync(s),l=this;if(o&&o.promise)return o.done(function(){l._cache.put(s,arguments),l.onApiResponse.apply({request:e,key:n,requestKey:s,qm:l},arguments)}),o.fail(function(){l._cache.invalidate(s),l.onApiRequestFailure.apply({request:e,pubsub:a,key:n,requestKey:s,qm:l},arguments)}),o;if(o){var u=t.Deferred();return u.done(function(){l.onApiResponse.apply({request:e,key:n,requestKey:s,qm:l},o)}),u.resolve(),u.promise()}var h=r.request(e,{done:function(){l._cache.put(s,arguments),l.onApiResponse.apply(this,arguments)},fail:function(){l._cache.invalidate(s),l.onApiRequestFailure.apply(this,arguments)},context:{request:e,key:n,requestKey:s,qm:l}});return this._cache.put(s,h),h}return r.request(e,{done:this.onApiResponse,fail:this.onApiRequestFailure,context:{request:e,key:n,requestKey:s,qm:this}})},onApiResponse:function(e,t,n){var i=this.qm,a=e.responseHeader&&e.responseHeader.params?new o(e):new u(e);a.setApiQuery(this.request.get("query")),i.debug&&console.log("[QM]: sending response:",i.hasApp()&&i.getApp().getPluginOrWidgetName(this.key.getId())||this.key.getId(),e);var r=i.getBeeHive().getService("PubSub");r&&r.publish(this.key,r.DELIVERING_RESPONSE+this.key.getId(),a),i.failedRequestsCache.getIfPresent(this.requestKey)&&i.failedRequestsCache.invalidate(this.requestKey)},onApiRequestFailure:function(e,t,n){var i=this.qm;this.request.get("query");i.debug&&console.warn("[QM]: request failed",e,t,n);var a=i.failedRequestsCache.getSync(this.requestKey)||0;if(i.failedRequestsCache.put(this.requestKey,a+1),i.tryToRecover.apply(this,arguments))return console.warn("[QM]: attempting recovery"),!0;var r=new c({code:c.CODES.API_REQUEST_ERROR,msg:t,request:this.request,error:e,psk:this.key,errorThrown:n,text:t}),s=i.getBeeHive().getService("PubSub");return s&&s.publish(this.key,s.FEEDBACK,r),!1},tryToRecover:function(e,t,n){var i=this.qm,a=this.key,r=this.request,s=this.requestKey,o=e.status;if(o)switch(o){case 408:case 409:case 500:case 502:case 503:case 504:return g("send","event","introspection","retrying",o),setTimeout(function(){if(i._cache){var e=i._cache.getSync(s);if(e&&e.promise)i._cache.invalidate(s);else if(e)return}i._executeRequest.call(i,r,a)},i.recoveryDelayInMs),!0;default:g("send","event","introspection","not-retrying",o)}},_getCacheKey:function(e){var t=e.get("query"),n=this.queryUpdater.clean(t);e.set("query",n);var i=e.url();return e.set("query",t),i},reset:function(){this.__searchCycle={waiting:{},inprogress:{},done:{},failed:{}},this._cache&&this._cache.invalidateAll()},getAlerter:function(){return this.getApp().getController(this.alertsController||"AlertsController")},displayTugboatMessages:function(){this.original_url&&(messages=[],err=f.qs("error_message",this.original_url,"  "),err&&messages.push(err),warn=f.qs("warning_message",this.original_url,"  "),warn&&messages.push(warn),unprocessed=f.qs("unprocessed_parameter",this.original_url,"  "),unprocessed&&messages.push(unprocessed),messages.length>0&&(messages.push('See our <a style="text-decoration: underline; font-weight: bold" href="http://adsabs.github.io/help/faq/#classic-search-translator">docs</a> for more information'),message=messages.join("<br>"),this.getAlerter().alert(new c({type:p.TYPE.INFO,msg:message}))))},resetFailures:function(){this.failedRequestsCache.invalidateAll()}});return e.extend(m.prototype,a.BeeHive,a.App),m}),define("js/bugutils/diagnostics",["jquery","underscore","js/components/api_query","js/components/api_request","js/components/api_response","js/mixins/dependon","js/components/generic_module","sprintf","js/components/api_targets"],function(e,t,n,i,a,r,s,o,l){var c=s.extend({activate:function(e,t){this.setApp(t),this.setBeeHive(e)},getFirstDoc:function(n,i){var a={query:{q:n,fl:"title,abstract,bibcode,id,author"},target:l.SEARCH};i&&t.extend(a,i);var r=e.Deferred();return this.apiRequest(a).done(function(e){r.resolve(e.response.docs[0])}),r.promise()},apiRequest:function(e,t){var a=this.getApp().getService("Api");if(!(e=e||{}).query)throw Error('You must pass in "query"');e.query instanceof n||(e.query=new n(e.query));var r=new i({target:e.target||l.SEARCH,query:e.query});return a.request(r,t)},ajax:function(t){var n=this.getApp().getService("Api");return t.headers=t.header||{},t.headers.Authorization=n.access_token,e.ajax(t)},jsonp:function(e,n){return e.dataType="jsonp",e.beforeSend=function(e,i){var a=i.url.split("&");t.each(a,function(e){e.startsWith("callback=")&&(i.url+="&"+(n||"json.wrf")+"="+e.replace("callback=",""))})},this.ajax(e)},printComparison:function(e){var t=[],n="%40s %40s %40s %10s";for(var i in t.push(o.sprintf(n,"field",e.first,e.second,"diff")),t.push("------------------------------------------------------------------------------------------------------------------------------------"),e.fields){var a=e.fields[i];t.push(o.sprintf(n,i,a.first,a.second,a.diff))}return console.log(t.join("\n")),t},compareTwoSearchInstances:function(n,i,a,r){var s=this,o=e.Deferred();if(a&&r){var l=this.countDocsInFields(n,a),c=this.countDocsInFields(i,r);e.when(l,c).done(function(e,a){var r=t.keys(e.fields),s=t.keys(a.fields),l=t.unique(r.concat(s)).sort(),c={};for(var u in l){u=l[u];var d=e.fields[u],h=a.fields[u];c[u]={first:d?d.numFound:"--",second:h?h.numFound:"--",diff:d&&h?h.numFound-d.numFound:"--"}}o.resolve({first:n,second:i,fields:c})})}else{var u=this.getListOfFields(n),d=this.getListOfFields(i);e.when(u,d).done(function(e,t){s.compareTwoSearchInstances(n,i,e,t).done(function(e){o.resolve(e)})})}return o},getListOfFields:function(t){var n=e.Deferred();return this.jsonp({url:t+"/solr/collection1/admin/luke?numTerms=0&wt=json&indent=true",timeout:6e4}).done(function(e){var t=[];for(var i in e.fields)i.startsWith("_")||t.push(i);n.resolve(t)}),n},countDocsInFields:function(t,n){var i=e.Deferred(),a=[],r={},s={fields:{}};for(var o in n){var l=n[o],c=(e.Deferred(),"{!lucene}"+l+":*");console.log("Getting num docs for: "+c);var u=this.jsonp({url:t+"/solr/collection1/select?q="+c+"&fl=id&wt=json&indent=true",context:{field:l,finalResult:s,cycleR:r},timeout:3e5}).done(function(e){this.finalResult.fields[this.field]={numFound:e.response.numFound};var n=0,a=[];for(var r in this.cycleR)"pending"==this.cycleR[r].state()&&(n+=1,a.push(r));console.log(t+" Got response for: "+this.field+" numFound: "+e.response.numFound+" requests to go: "+n+" "+(a.length<5?a.join(", "):"")),0==n&&i.resolve(this.finalResult)});r[l]=u,a.push(u)}return i},request:function(t){return e.ajax(t)},testOrcidLogin:function(){var e=this.getApp().getService("OrcidApi");e.signOut(),window.location=e.config.loginUrl},testOrcidSendingData:function(){var e=this.getApp();this.getFirstDoc("bibcode:1978yCat.1072....0C").done(function(t){e.getService("OrcidApi").addWorks([t]).done(function(e){console.log("result:",e,"expected: {}")})})},printPubSubSubscribers:function(e){var n=this.getApp().getService("PubSub"),i={};this.getApp().triggerMethodOnAll(function(e,t){if(this===n)i[n.pubSubKey.getId()]=e;else if(this.hasPubSub&&this.hasPubSub()){var a=this.getPubSub();a.getCurrentPubSubKey&&(i[a.getCurrentPubSubKey().getId()]&&console.warn("Redefining key that already exists: "+a.getCurrentPubSubKey().getId()+" "+i[a.getCurrentPubSubKey().getId()]),i[a.getCurrentPubSubKey().getId()]=e)}else console.warn("Instance without active PubSub: "+e,this)}),e&&(console.log("Printing list of all issued keys to PubSub"),t.each(t.keys(n._issuedKeys),function(e){var t;n._issuedKeys[e].getId&&i[n._issuedKeys[e].getId()]&&(t=i[n._issuedKeys[e].getId()]),t?console.log(e+"(parent:"+t+") -> "+i[e]):console.log(e+" -> "+i[e])}));var a={};console.log("Printing active subscribers to PubSub"),t.each(n._events,function(e,n,r){console.log(n+" ("+e.length+")"),t.each(e,function(e){var t=e.ctx.getId?i[e.ctx.getId()]:"unknown object";console.log("\t"+t),a[t]=a[t]?a[t]+1:1,void 0==t&&(a["undefined keys"]||(a["undefined keys"]=[]),a["undefined keys"].push(n+(e.ctx.getId?e.ctx.getId():"X")))})}),console.log(JSON.stringify(a,null," "))}});return t.extend(c.prototype,r.App,r.BeeHive),c}),define("js/components/alerts_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/api_feedback","js/mixins/hardened","js/components/alerts"],function(e,t,n,i,a,r,s,o){var l=i.extend({initialize:function(t){e.extend(this,e.pick(t,["debug","widgetName"]))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();if(i.subscribe(i.ALERT,e.bind(this.onAlert,this)),i.subscribe(i.NAVIGATE,e.bind(this.onNavigate,this)),!this.getWidget())throw new Error("If you want to use AlertController, you also need to have a Widget capable of displaying the messages (default: AlertsWidget)")},onNavigate:function(e){var t=this,n=this.getPubSub();"authentication-page"===e&&n.subscribeOnce(n.NAVIGATE,function(){var e=t.getWidget();e&&e.closeView&&e.closeView()})},onAlert:function(t,n){var i=this;return this.alert(t).done(function(t){if(e.isFunction(t))t();else if(e.isObject(t)&&t.action){switch(t.action){case o.ACTION.TRIGGER_FEEDBACK:i.getPubSub().publish(i.getPubSub().FEEDBACK,new r(t.arguments));break;case o.ACTION.CALL_PUBSUB:i.getPubSub().publish(t.signal,t.arguments);break;default:throw new Error("Unknown action type:"+t)}var n=i.getWidget();n&&n.closeView&&n.closeView()}})},getWidget:function(){return this._widget?this._widget:(this._widget=this.getApp()._getWidget(this.widgetName||"AlertsWidget"),this._widget)},alert:function(e){var n=this.getWidget();if(!n){console.warn('"AlertsWidget" has disappeared, we cant display messages to the user');var i=t.Deferred();return i.reject("AlertsWidget has disappeared"),i.promise()}return n.alert(e)},hardenedInterface:{debug:"state of the alerts",getHardenedInstance:"allow to create clone of the already hardened instance"}});return e.extend(l.prototype,a.BeeHive,a.App),e.extend(l.prototype,s),l}),define("js/wraps/alerts_mediator",["underscore","jquery","js/components/alerts_mediator","js/components/api_feedback","js/widgets/widget_states","js/components/alerts","js/components/api_response"],function(e,t,n,i,a,r,s){return n.extend({activate:function(t,i){n.prototype.activate.apply(this,arguments);var a=this.getPubSub();a.subscribe(a.APP_STARTED,e.bind(this.displaySiteMessageWithDelay,this))},onAlert:function(e,t){this._dirty=!0,n.prototype.onAlert.apply(this,arguments)},displaySiteMessageWithDelay:function(){var e=this;setTimeout(function(){e.checkAndDisplaySiteMessage()},500)},onDestroy:function(){clearInterval(this.timerId)},onStartSearch:function(){this._dirty=!1},checkAndDisplaySiteMessage:function(){var t=this,n=t.getBeeHive().getObject("User");n&&n.getSiteConfig("site_wide_message").done(function(a){if(a&&e.isString(a)&&!t._dirty){if(n.isLoggedIn())if(n.getUserData().last_seen_message==a)return;var r=t.getBeeHive().getService("PersistentStorage");if(r){var s=r.get("last_seen_message");if(s&&s==a)return}t.alert(new i({msg:a,events:{"click button.close":"dismissed"}})).done(function(e){"dismissed"==e&&(n&&n.isLoggedIn()&&n.setMyADSData({last_seen_message:a}),r&&r.set("last_seen_message",a))})}})}})}),define("js/mixins/openurl_generator",[],function(){return function(e,t){this.baseURL=t,this.metadata=void 0!==e?this.metadata=e:{},this.url_ver="Z39.88-2004",this.rft_val_fmt="info:ofi/fmt:kev:mtx:",this.rfr_id="info:sid/ADS",this.sid="ADS",this.parseAuthor=function(e){return void 0===e?{firstnames:!1,lastname:!1}:{firstnames:e.split(", ")[1],lastname:e.split(", ")[0]}},this.parseFirstPage=function(e){return void 0!==e&&e[0].split("-")[0]},this.parseRFTInfo=function(e){return[void 0!==e.doi&&"info:doi/"+e.doi[0],void 0!==e.bibcode&&"info:bibcode/"+e.bibcode]},this.parseID=function(e){return void 0!==e&&"doi:"+e[0]},this.parseGenre=function(e){return void 0!==e?e:"article"},this.parseDegree=function(e){return-1!=(e=void 0!==e?e:"").indexOf("PhDT")?"PhD":-1!=e.indexOf("MsT")&&"Masters"},this.parseContent=function(){this.rft_spage=this.parseFirstPage(this.metadata.page),this.id=this.parseID(this.metadata.doi),this.genre=this.parseGenre(this.metadata.doctype),this.rft_degree=this.parseDegree(this.metadata.bibcode),this.rft_id=this.parseRFTInfo(this.metadata);var e=this.parseAuthor(this.metadata.first_author);this.rft_aulast=e.lastname,this.rft_aufirst=e.firstnames,this.rft_issue=void 0!==this.metadata.issue&&this.metadata.issue,this.rft_vol=void 0!==this.metadata.volume&&this.metadata.volume,this.rft_jtitle=void 0!==this.metadata.pub&&this.metadata.pub,this.rft_date=void 0!==this.metadata.year&&this.metadata.year,this.rft_atitle=void 0!==this.metadata.title&&this.metadata.title[0],this.rft_issn=void 0!==this.metadata.issn&&this.metadata.issn[0],this.rft_isbn=void 0!==this.metadata.isbn&&this.metadata.isbn[0],this.rft_val_fmt+=this.genre},this.createContextObject=function(){this.parseContent(),this.contextObject={url_ver:this.url_ver,rfr_id:this.rfr_id,rft_val_fmt:this.rft_val_fmt,rft_id:this.rft_id,issn:this.rft_issn,id:this.id,isbn:this.rft_isbn,"rft.spage":this.rft_spage,"rft.issue":this.rft_issue,"rft.volume":this.rft_vol,"rft.jtitle":this.rft_jtitle,"rft.atitle":this.rft_atitle,"rft.aulast":this.rft_aulast,"rft.aufirst":this.rft_aufirst,"rft.date":this.rft_date,"rft.issn":this.rft_issn,"rft.isbn":this.rft_isbn,"rft.genre":this.genre,"rft.degree":this.rft_degree,sid:this.sid,spage:this.rft_spage,volume:this.rft_vol,title:this.rft_jtitle,atitle:this.rft_atitle,aulast:this.rft_aulast,aufirst:this.rft_aufirst,date:this.rft_date,genre:this.genre}},this.createOpenURL=function(){for(var e in this.createContextObject(),this.openURL=this.baseURL+"?",this.contextObject)if(this.contextObject.hasOwnProperty(e)){if(!1===this.contextObject[e])continue;if(this.contextObject[e]instanceof Array)for(var t=0;t<this.contextObject[e].length;t++)!1!==this.contextObject[e][t]&&(this.openURL+="&"+e+"="+this.contextObject[e][t]);else this.openURL+="&"+e+"="+this.contextObject[e]}this.openURL=encodeURI(this.openURL)}}}),define("js/mixins/link_generator_mixin",["underscore","js/mixins/openurl_generator"],function(e,t){var n=["ADS PDF","ADS Scanned Article","My Institution","Publisher Article","Publisher PDF","arXiv PDF"],i={PUB_PDF:{name:"Publisher PDF",shortName:"Publisher",description:"Publisher PDF",type:"PDF"},EPRINT_PDF:{name:"arXiv PDF",shortName:"arXiv",description:"ArXiv eprint",type:"PDF"},AUTHOR_PDF:{name:"Author PDF",shortName:"Author",description:"Link to PDF page provided by author",type:"PDF"},ADS_PDF:{name:"ADS PDF",shortName:"ADS",description:"ADS PDF",type:"PDF"},PUB_HTML:{name:"Publisher Article",shortName:"Publisher",description:"Electronic on-line publisher article (HTML)",type:"HTML"},EPRINT_HTML:{name:"arXiv Article",shortName:"arXiv",description:"Arxiv article",type:"HTML"},AUTHOR_HTML:{name:"Author Article",shortName:"Author",description:"Link to HTML page provided by author",type:"HTML"},ADS_SCAN:{name:"ADS Scanned Article",description:"ADS scanned article",shortName:"ADS",type:"SCAN"},AcA:{shortName:"AcA",description:"Acta Astronomica Data Files"},ALMA:{shortName:"ALMA",description:"Atacama Large Millimeter/submillimeter Array"},ARI:{shortName:"ARI",description:"Astronomisches Rechen-Institut"},Astroverse:{shortName:"Astroverse",description:"CfA Dataverse"},ATNF:{shortName:"ATNF",description:"Australia Telescope Online Archive"},Author:{shortName:"Author",description:"Author Hosted Dataset"},BICEP2:{shortName:"BICEP2",description:"BICEP/Keck Data"},CADC:{shortName:"CADC",description:"Canadian Astronomy Data Center"},CDS:{shortName:"CDS",description:"Strasbourg Astronomical Data Center"},CXO:{shortName:"CXO",description:"Chandra X-Ray Observatory"},ESA:{shortName:"ESA",description:"ESAC Science Data Center"},ESO:{shortName:"ESO",description:"European Southern Observatory"},GCPD:{shortName:"GCPD",description:"The General Catalogue of Photometric Data"},GTC:{shortName:"GTC",description:"Gran Telescopio CANARIAS Public Archive"},HEASARC:{shortName:"HEASARC",description:"NASA's High Energy Astrophysics Science Archive Research Center"},Herschel:{shortName:"Herschel",description:"Herschel Science Center"},IBVS:{shortName:"IBVS",description:"Information Bulletin on Variable Stars"},INES:{shortName:"INES",description:"IUE Newly Extracted Spectra"},ISO:{shortName:"ISO",description:"Infrared Space Observatory"},KOA:{shortName:"KOA",description:"Keck Observatory Archive"},MAST:{shortName:"MAST",description:"Mikulski Archive for Space Telescopes"},NED:{shortName:"NED",description:"NASA/IPAC Extragalactic Database"},NExScI:{shortName:"NExScI",description:"NASA Exoplanet Archive"},NOAO:{shortName:"NOAO",description:"National Optical Astronomy Observatory"},PASA:{shortName:"PASA",description:"Publication of the Astronomical Society of Australia Datasets"},PDG:{shortName:"PDG",description:"Particle Data Group"},PDS:{shortName:"PDS",description:"The NASA Planetary Data System"},SIMBAD:{shortName:"SIMBAD",description:"SIMBAD Database at the CDS"},Spitzer:{shortName:"Spitzer",description:"Spitzer Space Telescope"},TNS:{shortName:"TNS",description:"Transient Name Server"},Vizier:{shortName:"VizieR",description:"VizieR Catalog Service"},XMM:{shortName:"XMM",description:"XMM Newton Science Archive"},Zenodo:{shortName:"Zenodo",description:"Zenodo Archive"}};return{LINK_TYPES:i,parseLinksData:function(t){var n=e.bind(this._parseLinksDataForModel,this),i=e.bind(this.parseResourcesData,this);return e.isArray(t)?e.map(t,function(e){var t=i(e);return n(e,t)}):[]},parseResourcesData:function(t){var n=e.bind(this._processLinkData,this);if(e.isPlainObject(t)){if(e.isArray(t.property)&&e.isString(t.bibcode)){if(e.contains(t.property,"ESOURCE")&&!e.has(t,"esources"))throw new Error("if `property` property contains `ESOURCE`, then data must have `esources` field");if(e.contains(t.property,"DATA")&&!e.has(t,"data"))throw new Error("if `property` property contains `DATA`, then data must have `data` field");return n(e.extend({},t))}throw new Error("data must have `property` and `bibcode`")}throw new Error("data must be a plain object")},createUrlByType:function(t,n,i){var a=i;return e.isArray(a)&&(a=a[0]),e.isString(t)&&e.isString(n)&&e.isString(a)?"/link_gateway/"+t+"/"+n+":"+a:""},_createGatewayUrl:function(t,n){return e.isString(t)&&e.isString(n)?"/link_gateway/"+t+"/"+n:""},_processLinkData:function(a){var r=this._createGatewayUrl,s=[],o=[],l=0,c=a.property,u=e.contains(c,"OPENACCESS");return e.forEach(a.esources,function(n,o,d){var h=n.split("_"),p=i[n],f=e.contains(d,"ADS_SCAN"),g=a.link_server;if((a.doi||a.issn||a.isbn)&&g&&!u&&!f&&l<1){var m=new t(a,g);m.createOpenURL(),s.push({url:m.openURL,openUrl:!0,type:"INSTITUTION",shortName:"My Institution",name:"My Institution",description:"Find Article At My Institution"}),l+=1}h.length>1?s.push({url:r(a.bibcode,n),open:e.contains(c,h[0]+"_OPENACCESS"),shortName:p&&p.shortName||n,name:p&&p.name||n,type:p&&p.type||"HTML",description:p&&p.description}):s.push({url:r(a.bibcode,n),open:!1,shortName:p&&p.shortName||n,name:p&&p.name||n,type:p&&p.type||"HTML",description:p&&p.description})}),!e.find(s,{name:i.EPRINT_PDF.name})&&e.isArray(a.links_data)&&e.forEach(a.links_data,function(e){var t=JSON.parse(e);if(/preprint/i.test(t.type)){var n=i.EPRINT_PDF;s.push({url:t.url,open:!0,shortName:n&&n.shortName||t.type,name:n&&n.name||t.type,type:n&&n.type||"HTML",description:n&&n.description})}}),s=e.sortBy(s,function(e){var t=n.indexOf(e.name);return t>-1?t:9999}),e.forEach(a.data,function(e){var t=e.split(":"),n=i[t[0]];t.length>1?o.push({url:r(a.bibcode,t[0]),count:t[1],name:n&&n.shortName,description:n&&n.description}):o.push({url:r(a.bibcode,e),count:"0",name:e,description:n&&n.description})}),o=e.sortBy(o,"count").reverse(),{fullTextSources:s,dataProducts:o}},_parseLinksDataForModel:function(t,n){var i={list:[],data:[],text:[]},a=e.extend({},t,{links:i});if(e.isPlainObject(n)&&(i=e.assign(i,{data:i.data.concat(n.dataProducts||[]),text:i.text.concat(n.fullTextSources||[])})),!e.isPlainObject(a))throw new Error("data must be a plain object");if(e.isPlainObject(a["[citations]"])&&e.isString(a.bibcode)){var r=a["[citations]"];e.isNumber(r.num_citations)&&r.num_citations>0&&i.list.push({letter:"C",name:"Citations ("+r.num_citations+")",url:"#abs/"+a.bibcode+"/citations"}),e.isNumber(r.num_references)&&r.num_references>0&&i.list.push({letter:"R",name:"References ("+r.num_references+")",url:"#abs/"+a.bibcode+"/references"})}return e.isArray(a.property)&&e.isString(a.bibcode)&&e.contains(a.property,"TOC")&&i.list.push({letter:"T",name:"Table of Contents",url:"#abs/"+a.bibcode+"/tableofcontents"}),a}}}),define("js/modules/orcid/work",["underscore","jsonpath"],function(e,t){var n={createdDate:'$["created-date"].value',lastModifiedDate:'$["last-modified-date"].value',sourceOrcidIdUri:'$.source["source-orcid"].uri',sourceOrcidIdPath:'$.source["source-orcid"].path',sourceOrcidIdHost:'$.source["source-orcid"].host',sourceClientIdUri:'$.source["source-client-id"].uri',sourceClientIdPath:'$.source["source-client-id"].path',sourceClientIdHost:'$.source["source-client-id"].host',sourceName:'$.source["source-name"].value',putCode:'$["put-code"]',path:"$.path",title:'$["title"].title.value',subtitle:'$["title"].subtitle.value',translatedTitle:'$["title"]["translated-title"].value',translatedTitleLang:'$["title"]["translated-title"]["language-code"]',journalTitle:'$["journal-title"].value',shortDescription:'$["short-description"]',citationType:'$.citation["citation-type"]',citationValue:'$.citation["citation-value"]',type:"$.type",publicationDateYear:'$["publication-date"].year.value',publicationDateMonth:'$["publication-date"].month.value',publicationDateDay:'$["publication-date"].day.value',publicationDateMedia:'$["publication-date"]["media-type"]',url:"$.url.value",contributorOrcidUri:'$["contributors"].contributor..["contributor-orcid"].uri',contributorOrcidPath:'$["contributors"].contributor..["contributor-orcid"].path',contributorOrcidHost:'$["contributors"].contributor..["contributor-orcid"].host',contributorName:'$["contributors"].contributor..["credit-name"].value',contributorEmail:'$["contributors"].contributor..["contributor-email"].value',contributorAttributes:'$["contributors"].contributor..["contributor-attributes"]',contributorSequence:'$["contributors"].contributor..["contributor-attributes"]["contributor-sequence"]',contributorRole:'$["contributors"].contributor..["contributor-attributes"]["contributor-role"]',externalIdValue:'$["external-ids"]["external-id"]..["external-id-value"]',externalIdType:'$["external-ids"]["external-id"]..["external-id-type"]',externalIdUrl:'$["external-ids"]["external-id"]..["external-id-url"]',externalIdRelationship:'$["external-ids"]["external-id"]..["external-id-relationship"]',country:"$.country.value",visibility:"$.visibility.value"},i=function(i,a){i=i||{},this._root=i["work-summary"]?i["work-summary"][0]:i,this.sources=[],this.getSources=function(){return e.isEmpty(this.sources)?[this.getSourceName()]:this.sources},this.setSources=function(t){return e.isArray(t)&&(this.sources=t),this.sources},this.get=function(n){var i=t.query(this._root,n);return e.isEmpty(i)?null:e.isArray(i)&&i.length<=1?i[0]:i},this.getAsOrcid=function(){return e.reduce(n,e.bind(function(n,i){var a=this.get(i);return a&&(e.isArray(a)?e.forEach(a,function(e,a){t.value(n,i.replace("..","["+a+"]"),e)}):t.value(n,i,a)),n},this),{})},this.toADSFormat=function(){var t=this.getExternalIds();return t.doi&&(t.doi=[t.doi]),e.extend({},t,{author:this.getContributorName(),title:[this.getTitle()],formattedDate:this.getFormattedPubDate(),abstract:this.getShortDescription(),source_name:this.getSources().join("; "),pub:this.getJournalTitle(),_work:this})},this.getFormattedPubDate=function(){return(this.getPublicationDateYear()||"????")+"/"+(this.getPublicationDateMonth()||"??")},this.getExternalIds=function(){var t=this.getExternalIdType(),n=this.getExternalIdValue();return t=e.isArray(t)?t:[t],n=e.isArray(n)?n:[n],t.length!==n.length?{}:e.reduce(t,function(e,t,i){return e[t]=n[i],e},{})},this.pickIdentifier=function(t){var n=this.getExternalIds(),i={};return e.eachRight(t,function(t){if(e.isString(n[t]))return i=n[t],!1}),i},e.reduce(n,function(t,n,i){e.isString(i)&&i.slice&&(t["get"+(i[0].toUpperCase()+i.slice(1))]=e.partial(t.get,n));return t},this)};return i.adsToOrcid=function(i,a){var r="$.pubdate",s="$.abstract",o="$.bibcode",l="$.pub",c="$.doi[0]",u="$.author[*]",d="$.title[0]",h="$.doctype",p=function(n,i,a){return a&&(e.isArray(a)?e.forEach(a,function(e,a){t.value(n,i.replace("..","["+a+"]"),e)}):t.value(n,i,a)),n},f=function(n){var a=t.query(i,n);return e.isEmpty(a)?null:e.isArray(a)&&a.length<=1?a[0]:a},g={};try{var m={types:[],values:[],relationships:[]},b=f(o),v=f(c);b&&(m.types.push("bibcode"),m.values.push(b),m.relationships.push("SELF")),v&&(m.types.push("doi"),m.values.push(v),m.relationships.push("SELF")),p(g,n.publicationDateYear,f(r).split("-")[0]),"00"===f(r).split("-")[1]?p(g,n.publicationDateMonth,null):p(g,n.publicationDateMonth,f(r).split("-")[1]),p(g,n.shortDescription,f(s).slice(0,4997)+"..."),p(g,n.externalIdType,m.types),p(g,n.externalIdValue,m.values),p(g,n.externalIdRelationship,m.relationships),p(g,n.journalTitle,f(l)),p(g,n.type,{article:"JOURNAL_ARTICLE",inproceedings:"CONFERENCE_PAPER",abstract:"CONFERENCE_ABSTRACT",eprint:"WORKING_PAPER",phdthesis:"DISSERTATION",techreport:"RESEARCH_TECHNIQUE",inbook:"BOOK_CHAPTER",circular:"RESEARCH_TOOL",misc:"OTHER",book:"BOOK",proceedings:"BOOK",bookreview:"BOOK_REVIEW",erratum:"JOURNAL_ARTICLE",proposal:"OTHER",newsletter:"NEWSLETTER_ARTICLE",catalog:"DATA_SET",intechreport:"RESEARCH_TECHNIQUE",mastersthesis:"DISSERTATION",obituary:"OTHER",pressrelease:"OTHER",software:"RESEARCH_TECHNIQUE",talk:"LECTURE_SPEECH"}[f(h)]||"JOURNAL_ARTICLE");var y=f(u);y=e.isArray(y)?y:[y],p(g,n.contributorName,y);var _=e.map(y,function(){return"AUTHOR"});p(g,n.contributorRole,_),p(g,n.title,f(d)),a&&p(g,n.putCode,a)}catch(e){return null}return g},i}),define("js/modules/orcid/profile",["underscore","jsonpath","js/modules/orcid/work"],function(e,t,n){var i={firstName:'$.person.name["given-names"].value',lastName:'$.person.name["family-name"].value',orcid:'$["orcid-identifier"].path',workSummaries:'$["activities-summary"].works.group'};return function(a){this._root=a||{},this.works=[],this.get=function(n){var i=t.query(this._root,n);return e.isEmpty(i)?null:e.isArray(i)&&i.length<=1?i[0]:i},this.getWorks=function(){return this.works},this.setWorks=function(e){return this.works=e,this},this.getWorksDeep=function(){return e.map(this.getWorkSummaries(),function(t){return e.map(t["work-summary"],function(e){return new n(e)})})},this.toADSFormat=function(){var t=e.sortBy(this.getWorks(),function(e){return e.getTitle()});return t=e.map(t,function(e){return e.toADSFormat()}),{responseHeader:{params:{orcid:this.getOrcid(),firstName:this.getFirstName(),lastName:this.getLastName()}},response:{numFound:t.length,start:0,docs:t}}},e.reduce(i,function(t,n,i){return e.isString(i)&&i.slice&&(t["get"+(i[0].toUpperCase()+i.slice(1))]=e.partial(t.get,n)),t},this),this.works=e.map(this.getWorkSummaries(),function(e){return new n(e)})}}),define("js/modules/orcid/orcid_api",["underscore","bootstrap","jquery","backbone","js/components/generic_module","js/mixins/dependon","js/components/pubsub_events","js/mixins/link_generator_mixin","js/components/api_query","js/components/api_request","js/mixins/hardened","js/components/api_targets","js/components/api_query_updater","js/components/api_feedback","js/modules/orcid/work","js/modules/orcid/profile"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g){var m=a.extend({initialize:function(){this.userData={},this.addCache=[],this.deleteCache=[],this.getUserProfileCache=[],this.authData=null,this.addWait=3e3,this.deleteWait=100,this.profileWait=100,this.maxAddChunkSize=100,this.maxDeleteChunkSize=10,this.db={},this.clearDBWait=3e4,this.dbUpdatePromise=null,this.maxQuerySize=100,this.queryUpdater=new h("orcid_api"),this.orcidApiTimeout=3e4,this.adsQueryTimeout=10,this.dirty=!0},activate:function(t){var n=t.getService("PersistentStorage"),i=t.getObject("DynamicConfig");if(this.setBeeHive(t),this.config={},e.extend(this.config,i.Orcid),n){var a=n.get("Orcid");a&&a.authData&&this.saveAccessData(a.authData)}this._addWork=e.debounce(this._addWork,this.addWait),this._getUserProfile=e.debounce(this._getUserProfile,this.profileWait),this._deleteWork=e.debounce(this._deleteWork,this.deleteWait)},checkAccessOrcidApiAccess:function(){return this.hasAccess()?this.getUserProfile():n.Deferred().reject().promise()},hasAccess:function(){return!(!this.authData||!this.authData.expires)&&this.authData.expires>(new Date).getTime()},signIn:function(e){this.getPubSub().publish(this.getPubSub().APP_EXIT,{type:"orcid",url:this.config.loginUrl+"&redirect_uri="+encodeURIComponent(this.config.redirectUrlBase+(e||"/#/user/orcid"))}),this.getPubSub().publish(this.getPubSub().ORCID_ANNOUNCEMENT,"login")},setADSUserData:function(e){var t=this.getBeeHive().getService("Api").url+d.ORCID_PREFERENCES+"/"+this.authData.orcid,n=this.createRequest(t,{method:"POST"},e);return n.fail(function(){console.error.apply(console,["ADS ORCiD preferences could not be set"].concat(arguments))}),n},getADSUserData:function(){var e=this.getBeeHive().getService("Api").url+d.ORCID_PREFERENCES+"/"+this.authData.orcid,t=this.createRequest(e);return t.fail(function(){console.error.apply(console,["ADS ORCiD preferences could not be retrieved"].concat(arguments))}),t},signOut:function(){this.saveAccessData(null),this.getPubSub().publish(this.getPubSub().ORCID_ANNOUNCEMENT,"logout")},hasExchangeCode:function(e){return!!this.getExchangeCode(e)},getExchangeCode:function(e){return this.getUrlParameter("code",e||window.location.search)},getUrlParameter:function(e,t){for(var n=t.substring(1).split("&"),i=0;i<n.length;i++){var a=n[i].split("=");if(a[0]===e)return decodeURIComponent(a[1])}},getAccessData:function(t){var i=this.getBeeHive().getService("Api"),a=n.Deferred(),r={url:this.config.exchangeTokenUrl,done:e.bind(a.resolve,a),fail:e.bind(a.reject,a),always:e.bind(a.always,a),headers:{Accept:"application/json",Authorization:i.access_token}};return i.request(new c({target:this.config.exchangeTokenUrl,query:new l({code:t})}),r),a.promise()},saveAccessData:function(e){var t=this.getBeeHive();e&&!e.expires&&e.expires_in&&(e.expires=(new Date).getTime()+(1e3*e.expires_in-1e3)),this.authData=e;var n=t.getService("PersistentStorage");if(n){var i=n.get("Orcid")||{};i.authData=e,n.set("Orcid",i)}},getUrl:function(t,n){var i=this.config.apiEndpoint+"/"+this.authData.orcid+{profile:"/orcid-profile",works:"/orcid-works",work:"/orcid-work"}[t],a=e.isArray(n)?n.join(","):n;return a&&(i+="/"+a),i},createRequest:function(t,i,a){if(e.isUndefined(t))throw new Error("Url must be defined");var r=n.Deferred(),s=this.sendData(t,a,i||{});return s.done(e.bind(r.resolve,r)),s.fail(e.bind(r.reject,r)),s.always(e.bind(r.always,r)),r.promise()},_getUserProfile:function(){var t=this,n=this.createRequest(this.getUrl("profile")),i=t.getUserProfileCache.splice(0);n.done(function(n){e.forEach(i,function(e){e.resolve(t._reconcileProfileWorks(n))})}),n.fail(function(){var t=arguments;e.forEach(i,function(e){e.reject.apply(e,t)})})},_reconcileProfileWorks:function(t){var n=this,i=new g(t),a=e.map(i.getWorksDeep(),function(t,i){var a,r,s;t.length>1&&(e.forEach(t,function(e){var t=n.isSourcedByADS(e),i=e.getExternalIdType(),o=i.indexOf("bibcode")>-1,l=i.indexOf("doi")>-1;return t?(a=e,!1):(o&&!r&&(r=e),l&&!s&&(s=e),!0)}),!a&&r?a=r:!a&&s?a=s:a||(a=t[0]),a.setSources(e.map(t,function(e){return e.getSourceName()})));return a||t[0]});return i.setWorks(a),i},getUserProfile:function(){var e=n.Deferred();return this.getUserProfileCache.push(e),this._getUserProfile.call(this),e.promise()},getWork:function(t){var i=n.Deferred();return this.createRequest(this.getUrl("works",t)).done(function(e){i.resolve(new f(e))}).fail(e.bind(i.reject,i)),i.promise()},getWorks:function(t){if(!e.isArray(t))throw new TypeError("putcodes must be an Array");for(var i=n.Deferred(),a=[],r=0,s=t.length;r<s;r+=50){var o=t.slice(r,r+50),l=this.getUrl("works")+"/"+o.join(",");a.push(e.partial(this.createRequest,l))}var c=n.when.apply(n,a);return c.done(e.bind(i.resolve,i)),c.fail(function(){i.reject(arguments)}),i.promise()},updateWork:function(t){if(!e.isPlainObject(t))throw new TypeError("Work should be a simple object");var i=t["put-code"];if(!i)return n.Deferred().reject().promise();var a=this.getUrl("works",i);return this.createRequest(a,{method:"PUT"},t)},deleteWork:function(t){if(!e.isNumber(t))throw new TypeError("putcode should be a number");var i=n.Deferred();return this.deleteCache.push({id:e.uniqueId(),putCode:t,promise:i}),this._deleteWork.call(this),i.promise()},_deleteWork:function(){for(var t,i=this,a=this.deleteCache.slice(0),r=[],s=[],o=0;o<a.length;o+=this.maxDeleteChunkSize)t=a.slice(o,o+this.maxDeleteChunkSize),s.push(t);e.forEach(s,function(t,n){e.forEach(t,function(t){r.push(t.promise.promise()),e.delay(function(){i.createRequest(i.getUrl("works",t.putCode),{beforeSend:function(e){e._id=t.id},method:"DELETE"}).done(e.bind(t.promise.resolve,t.promise)).fail(e.bind(t.promise.reject,t.promise)).always(e.bind(t.promise.always,t.promise));var n=i.deleteCache.indexOf(t);i.deleteCache.splice(n,n+1)},i.deleteWait*n)})});n.when.apply(n,r).always(function(){i.deleteCache=e.reduce(i.deleteCache,function(e,t){return"pending"===t.promise.state()?t.promise.reject():e.push(t),e},[])})},addWork:function(t){if(!e.isPlainObject(t))throw new TypeError("Should be plain object");var i=n.Deferred();return this.addCache.push({id:e.uniqueId(),work:t,promise:i}),this._addWork.call(this),i.promise()},_addWork:function(){var t=this,n=e.map(t.addCache,"work"),i=e.map(t.addCache,"id"),a=t._addWorks(n,i);a.done(function(n){e.forEach(n,function(n,i){var a=e.find(t.addCache,function(e){return e.id===i});if(!a)return console.error("No Cache entry found"),!0;var r=a.promise,s=a.work;n?n.error?409===n.error["response-code"]?r.resolve(s):r.reject():r.resolve(new f(n.work)):r.reject();var o=t.addCache.indexOf(a);t.addCache.splice(o,o+1)})}),a.fail(function(n){var i=arguments;e.forEach(n,function(n){var a=e.findIndex(t.addCache,{id:n});if(a>=0){var r=t.addCache[a].promise;t.addCache.splice(a,a+1),"pending"===r.state()&&r.reject.apply(r,i)}})})},_addWorks:function(t,i){var a=this;if(!e.isArray(t)||!e.isArray(i))throw new TypeError("works and ids must be arrays");for(var r,s,o=n.Deferred(),l=[],c=0;c<t.length;c+=this.maxAddChunkSize){r=t.slice(c,c+this.maxAddChunkSize),s=i.slice(c,c+this.maxAddChunkSize);var u={bulk:[]};e.each(r,function(e){u.bulk.push({work:e})});var d=this.getUrl("works");l.push(this.createRequest(d,{beforeSend:function(e){e.cacheIds=s},method:"POST"},u))}return n.when.apply(n,l).then(function(){var t=e.isArray(arguments[0])?arguments:[arguments],n=e.reduce(t,function(t,n){var i=n&&n[0]&&n[0].bulk,a=n&&n[2]&&n[2].cacheIds;return e.forEach(a,function(e,n){t[e]=i[n]}),t},{});o.resolve(n)},function(e){a.setDirty(),o.reject.apply(o,[e.cacheIds].concat(arguments))}),o.promise()},sendData:function(t,i,a){var r=n.Deferred();a=a||{};var s={type:"GET",url:t,contentType:"application/json",cache:!!this.dbUpdatePromise,timeout:this.orcidApiTimeout,done:e.bind(r.resolve,r),fail:e.bind(r.reject,r),always:e.bind(r.always,r)};i?(s.dataType="json",s.data=JSON.stringify(i),s.converters={"* text":window.String,"text html":!0,"text json":function(e){return e=e||"{}",n.parseJSON(e)},"text xml":n.parseXML}):s.data=null,e.extend(s,a);var o=this.getBeeHive().getService("Api");return s.headers||(s.headers={}),s.headers.Authorization=o.access_token,!s.headers["Orcid-Authorization"]&&this.authData&&(s.headers["Orcid-Authorization"]="Bearer "+this.authData.access_token),s.headers["Content-Type"]||(s.headers["Content-Type"]="application/json"),s.headers.Accept||(s.headers.Accept="application/json"),o.request(new c({target:t,query:new l,options:s})),r.promise()},_checkIdsInADS:function(t){var i=this.getBeeHive().getService("Api"),a=n.Deferred();t.set("fl","bibcode, doi, alternate_bibcode"),t.set("rows","5000");var r=function(){a.resolve({})};return i.request(new c({target:d.SEARCH,query:t,options:{done:function(t){if(!t||!t.response||!t.response.docs)return a.resolve({});var n=e.reduce(t.response.docs,function(t,n){var i=n.bibcode.toLowerCase();return t["identifier:"+i]=i,e.each(n.doi,function(e){var n="identifier:"+e.toLowerCase().replace("doi:","");t[n]=i}),e.each(n.alternate_bibcode,function(e){var n="identifier:"+e.toLowerCase();t[n]=i}),t},{});a.resolve(n)},fail:r}})).fail(r),function t(n){if("pending"===a.state()&&n<=0)return a.reject("Request Timeout");"resolved"!==a.state()&&e.delay(t,1e3,--n)}(this.adsQueryTimeout),a.promise()},isSourcedByADS:function(e){return this.config.clientId===e.getSourceClientIdPath()},_buildQuery:function(t){if(e.isEmpty(t)||!t.identifier)return null;var n=e.filter(t.identifier,function(t){return!e.isEmpty(t.trim())||"NONE"===t}).join(" OR ");return e.isEmpty(n)?null:new l({q:"identifier:("+n+")"})},updateDatabase:function(t){var i=this;if(this.dbUpdatePromise&&"pending"===this.dbUpdatePromise.state())return this.dbUpdatePromise.promise();this.dbUpdatePromise=n.Deferred();var a=function(e){var t=i.dbUpdatePromise;i.setClean(),i.db=e,t&&t.resolve(),setTimeout(function(){t&&"pending"!==t.state()&&(t=null,i.setDirty())},i.clearDBWait)},r=function(t){var r=t.getWorks(),s=[],o={};if(e.forEach(r,function(t,n){var a="identifier:",r=t.getExternalIds();e.has(r,"bibcode")?a+=r.bibcode:e.has(r,"doi")?a+=r.doi:e.has(r,"null")?a+="NONE":e.isEmpty(r)||(a+=e.values(r)[0]),a&&(s.push(a),o[a.toLowerCase()]={sourcedByADS:i.isSourcedByADS(t),putcode:t.getPutCode(),idx:n})}),s.length&&i.maxQuerySize>0){var l=[];s=s.sort();for(var c=e.range(0,s.length,i.maxQuerySize),u=0;u<c.length;u++){for(var d={},h=c[u];h<c[u]+i.maxQuerySize&&!(h>=s.length);h++){var p=s[h].split(":");d[p[0]]||(d[p[0]]=[]),d[p[0]].push(i.queryUpdater.quoteIfNecessary(p[1]))}var f=i._buildQuery(d);f&&l.push(i._checkIdsInADS(f))}}else a(o);n.when.apply(n,l).then(function(t){e.each(o,function(e,n){var i=t[n];i?o[n].bibcode=i:o[n].idx=-1}),i._combineDatabaseWorks(o),a(o)},function(){console.error.apply(console,["Error processing response from ADS"].concat(arguments)),a(o)})};return t?r(t):this.getUserProfile().done(r).fail(function(){i.dbUpdatePromise.reject.apply(i.dbUpdatePromise,arguments)}),i.dbUpdatePromise.promise()},_combineDatabaseWorks:function(t){return e.forEach(t,function(n,i){if(e.isUndefined(n)||e.isUndefined(n.bibcode))return!0;var a=i.split(":")[1];e.forEach(t,function(e,t){e.bibcode===a&&t!==i&&(n.children=n.children||[],n.children.push(e.putcode))})}),t},getRecordInfo:function(t){var i=this,a=n.Deferred(),r=function(t){var n={isCreatedByADS:!1,isCreatedByOthers:!1,isKnownToADS:!1,provenance:null},a=function(t,a){var r=("identifier:"+t).toLowerCase(),s=i.db[r];s&&(s.sourcedByADS?n.isCreatedByADS=!0:n.isCreatedByOthers=!0,s.idx>-1&&(n.isKnownToADS=!0),n=e.extend({},n,s))},r=e.pick(t,"identifier","bibcode","doi","alternate_bibcode");return e.each(r,function(t,n){e.isArray(t)?e.each(t,a):a(t,0)}),n};return this.needsUpdate()?this.updateDatabase().done(function(){a.resolve(r(t))}).fail(e.bind(a.reject,a)):a.resolve(r(t)),a.promise()},needsUpdate:function(){return this.dirty},setDirty:function(){this.dirty=!0},setClean:function(){this.dirty=!1},hardenedInterface:{hasAccess:"boolean indicating access to ORCID Api",getUserProfile:"get user profile",signIn:"login",signOut:"logout",getADSUserData:"",setADSUserData:"",getRecordInfo:"provides info about a document",addWork:"add a new orcid work",deleteWork:"remove an entry from orcid",updateWork:"update an orcid work",getWork:"get an orcid work",getWorks:"get an array of orcid works"}});return e.extend(m.prototype,r.BeeHive),e.extend(m.prototype,u),m}),define("js/modules/orcid/module",["backbone","underscore","js/components/generic_module","./orcid_api"],function(e,t,n,i){var a=n.extend({activate:function(e){var n=e.getObject("DynamicConfig");if(!n)throw new Error("DynamicConfig is not available to Orcid module");var i=n.orcidRedirectUrlBase||location.protocol+"//"+location.host,a=n.orcidClientId,r=n.orcidApiEndpoint,s=n.orcidLoginEndpoint;if(!a||!r)throw new Error("Missing configuration for ORCID module: orcidApiEndpoint, orcidClientId");var o={redirectUrlBase:i,apiEndpoint:r,clientId:a,worksUrl:r+"/{0}/orcid-works",loginUrl:s+"?scope=/orcid-profile/read-limited%20/orcid-works/create%20/orcid-works/update&response_type=code&access_type=offline&show_login=true&client_id="+a,exchangeTokenUrl:r+"/exchangeOAuthCode"};t.extend(n,{Orcid:o}),this.activateDependencies(e)},activateDependencies:function(e){var t=e.getService("OrcidApi");t||((t=new i).activate(e),e.addService("OrcidApi",t))}});return function(){return{activate:function(e){(new a).activate(e)}}}}),define("js/services/api",["underscore","jquery","js/components/generic_module","js/components/api_request","js/mixins/dependon","js/components/api_response","js/components/api_query","js/components/api_feedback","js/mixins/hardened","js/mixins/api_access","moment"],function(e,t,n,i,a,r,s,o,l,c,u){var d=n.extend({url:"/api/1/",clientVersion:null,outstandingRequests:0,access_token:null,refresh_token:null,expire_in:null,defaultTimeoutInMs:6e4,activate:function(e){this.setBeeHive(e)},done:function(e,t,n){var i=new r(e);i.setApiQuery(this.request.get("query")),this.api.trigger("api-response",i)},fail:function(e,t,n){console.error("API call failed:",JSON.stringify(this.request.url()),e.status,n);var i=this.api.hasBeeHive()?this.api.getPubSub():null;if(i){var a=new o({code:o.CODES.API_REQUEST_ERROR,msg:t,request:this.request,error:e,psk:this.key||this.api.getPubSub().getCurrentPubSubKey(),errorThrown:n,text:t,beVerbose:!0});i.publish(i.FEEDBACK,a)}else this.api&&this.api.trigger("api-error",this,e,t,n)},initialize:function(){this.always=e.bind(function(){this.outstandingRequests--},this)},getNumOutstandingRequests:function(){return this.outstandingRequests},setVals:function(t){e.each(t,function(e,t){this[t]=e},this)},modifyRequestOptions:function(e){},hardenedInterface:{request:"make a request to the API",setVals:"set a value on API (such as new access token)"}});return d.prototype._request=function(n,i){i=e.extend({},i,n.get("options"));var a,r=this,o=n.get("query");if(o&&!(o instanceof s))throw Error("Api.query must be instance of ApiQuery");o&&(a="application/json"===i.contentType?JSON.stringify(o.toJSON()):o.url());var l,c=n.get("target")||"";if(!(l=(l=c.indexOf("http")>-1?c:this.url+(c.length>0&&0==c.indexOf("/")?c:c?"/"+c:c)).substring(0,this.url.length-2)+l.substring(this.url.length-2,l.length).replace("//","/")))throw Error("Sorry, you can't use api without url");var u={type:"GET",url:l,dataType:"json",data:a,contentType:"application/x-www-form-urlencoded",context:{request:n,api:r},timeout:this.defaultTimeoutInMs,headers:{},cache:!0};if(i.timeout&&(u.timeout=i.timeout),this.clientVersion&&(u.headers["X-BB-Api-Client-Version"]=this.clientVersion),this.access_token&&(u.headers.Authorization=this.access_token),e.extend(u.headers,i.headers),e.extend(u,e.omit(i,"headers")),this.outstandingRequests++,this.modifyRequestOptions(u,n),i.useFetch&&i.fetchOptions){var d=e.assign({credentials:"include",mode:"cors",timeout:this.defaultTimeoutInMs},i.fetchOptions);d.headers=e.assign({"Content-Type":u.contentType},u.headers,i.fetchOptions.headers);var h=window.fetch(u.url,d).then(function(t){if(r.always.call(u.context,t),e.isFunction(u.always)&&u.always.call(u.context,t),!t.ok)throw(u.fail||r.fail).call(u.context,t),Error(t.statusText);(u.done||r.done).call(u.context,t)}).catch(function(e){throw(u.fail||r.fail).call(u.context,e),Error(e)});return e.extend(h,{done:h.then,fail:h.catch})}var p=t.ajax(u).always(u.always?[this.always,u.always]:this.always).done(u.done||this.done).fail(u.fail||this.fail);return p=p.promise(p)},d.prototype.getCurrentUTCMoment=function(){return u().utc()},d.prototype.request=function(n,i){var a=this,r=3,s=function s(){var o=t.Deferred(),l=a.getApiAccess({tokenRefresh:!0,reconnect:!0});return l.done(function(){o.resolve(a._request(n,i))}),l.fail(function(){--r>0?e.delay(s,1e3):o.reject.apply(o,arguments)}),o.promise()};if(!this.expire_in)return s();var o=u.utc(this.expire_in);return this.getCurrentUTCMoment().diff(o,"minutes")>-2?s():a._request(n,i)},e.extend(d.prototype,a.BeeHive,l,c),d});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};define("js/services/default_pubsub",["backbone","underscore","js/components/generic_module","js/components/pubsub_key"],function(e,t,n,i){var a=/\s+/;return n.extend({className:"PubSub",initialize:function(e){this._issuedKeys={},this.strict=!0,this.handleErrors=!0,this._errors={},this.errWarningCount=10,t.extend(this,t.pick(e,["strict","handleErrors","errWarningCount"])),this.pubSubKey=i.newInstance({creator:{}}),this._issuedKeys[this.pubSubKey.getId()]=this.pubSubKey.getCreator(),this.running=!0,this.debug=!1},start:function(){this.publish(this.pubSubKey,this.OPENING_GATES),this.publish(this.pubSubKey,this.OPEN_FOR_BUSINESS),this.running=!0},destroy:function(){this.publish(this.pubSubKey,this.CLOSING_GATES),this.off(),this.publish(this.pubSubKey,this.CLOSED_FOR_BUSINESS),this.running=!1,this._issuedKeys={}},subscribe:function(e,n,i){if(!this.isRunning())throw new Error("PubSub has been closed, ignoring futher requests");if(this._checkKey(e,n,i),t.isUndefined(n))throw new Error("You tried to subscribe to undefined event. Error between chair and keyboard?");this.on(n,i,e),-1==n.indexOf(e.getId())&&this.on(n+e.getId(),i,e)},subscribeOnce:function(e,n,i){if(this._checkKey(e,n,i),t.isUndefined(n))throw new Error("You tried to subscribe to undefined event. Error between chair and keyboard?");this.once(n,i,e),-1==n.indexOf(e.getId())&&this.once(n+e.getId(),i,e)},unsubscribe:function(e,n,i){this._checkKey(e,n,i);var a=e;if(n&&i)this.off(n,i,a),this.off(n+e.getId(),i,a);else if(n||i)this.off(n,i,a),this.off(n+e.getId(),i,a);else{var r,s,o,l,c,u,d=t.keys(this._events),h=[];for(o=0,l=d.length;o<l;o++)if(n=d[o],r=this._events[n])for(u=0,c=r.length;u<c;u++)(s=r[u]).context===a&&h.push({name:n,event:s});t.each(h,function(e){this.off(e.name,e.event.callback,e.event.context)},this)}},publish:function(){if(this.isRunning()){this._checkKey(arguments[0]);var e=Array.prototype.slice.call(arguments,1);if(0==e.length||t.isUndefined(e[0]))throw new Error("You tried to trigger undefined event. Error between chair and keyboard?");return e.push(arguments[0]),this.handleErrors?this.triggerHandleErrors.apply(this,e):this.trigger.apply(this,e)}console.error("PubSub has been closed, ignoring futher requests")},getCurrentPubSubKey:function(){return this.pubSubKey},getPubSubKey:function(){var e=i.newInstance({creator:this.pubSubKey});if(this.strict){if(this._issuedKeys[e.getId()])throw Error("The key with id",e.getId(),"has been already registered!");this._issuedKeys[e.getId()]=e.getCreator()}return e},isStrict:function(){return this.strict},_checkKey:function(e,n,a){if(this.strict){if(t.isUndefined(e))throw new Error("Every request must be accompanied by PubSubKey");if(!(e instanceof i))throw new Error("Key must be instance of PubSubKey. (If you are trying to pass context, you can't do that. Instead, wrap your callback into: _.bind(callback, context))\nPerhaps the PubSub you are using is the non-protected version?");if(!this._issuedKeys.hasOwnProperty(e.getId()))throw new Error("Your key is not known to us, sorry, you can't use this queue.");if(this._issuedKeys[e.getId()]!==e.getCreator())throw new Error("Your key has wrong identity, sorry, you can't use this queue.")}},triggerHandleErrors:function(e){if(!this._events)return this;var t=Array.prototype.slice.call(arguments,1);if(!function(e,t,n,i){if(!n)return!0;if("object"===(void 0===n?"undefined":_typeof(n))){for(var r in n)e[t].apply(e,[r,n[r]].concat(i));return!1}if(a.test(n)){for(var s=n.split(a),o=0,l=s.length;o<l;o++)e[t].apply(e,[s[o]].concat(i));return!1}return!0}(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&this.triggerEvents(n,t),i&&this.triggerEvents(i,arguments),this},triggerEvents:function(e,t){var n,i=-1,a=e.length,r=t[0],s=t[1],o=t[2];switch(t.length){case 0:for(;++i<a;)try{(n=e[i]).callback.call(n.ctx)}catch(e){this.handleCallbackError(e,n,t)}return;case 1:for(;++i<a;)try{(n=e[i]).callback.call(n.ctx,r)}catch(e){this.handleCallbackError(e,n,t)}return;case 2:for(;++i<a;)try{(n=e[i]).callback.call(n.ctx,r,s)}catch(e){this.handleCallbackError(e,n,t)}return;case 3:for(;++i<a;)try{(n=e[i]).callback.call(n.ctx,r,s,o)}catch(e){this.handleCallbackError(e,n,t)}return;default:for(;++i<a;)try{(n=e[i]).callback.apply(n.ctx,t)}catch(e){this.handleCallbackError(e,n,t)}}},handleCallbackError:function(e,t,n){if(console.warn("[PubSub] Error: ",t,n),this.debug)throw e;console.warn(e.stack);var i=t.ctx.getId(),a=this._errors[i]=(this._errors[i]||0)+1;a%this.errWarningCount==0&&this.publish(this.pubSubKey,this.BIG_FIRE,a,e,t,n)},isRunning:function(){return this.running}})}),define("js/services/pubsub",["backbone","underscore","js/mixins/hardened","pubsub_service_impl","js/components/pubsub_events"],function(e,t,n,i,a){var r=i.extend({hardenedInterface:{subscribe:"register callback",unsubscribe:"deregister callback",publish:"send data to the queue",getPubSubKey:"get secret key"}});return t.extend(r.prototype,n,{getHardenedInstance:function(e){e=t.clone(e||this.hardenedInterface);var n={key:this.getPubSubKey()},i=this;e.publish=function(){i.publish.apply(i,[n.key].concat(t.toArray(arguments)))},e.subscribe=function(){i.subscribe.apply(i,[n.key].concat(t.toArray(arguments)))},e.unsubscribe=function(){i.unsubscribe.apply(i,[n.key].concat(t.toArray(arguments)))},e.subscribeOnce=function(){i.subscribeOnce.apply(i,[n.key].concat(t.toArray(arguments)))},e.getCurrentPubSubKey=function(){return n.key};var r=this._getHardenedInstance(e,this);return t.extend(r,a),r}}),t.extend(r.prototype,a),r}),define("js/components/transition",["underscore"],function(e){var t=function(t,n){if(!e.isString(t))throw new Error("Endpoint name must be a string");this.endpoint=t,e.extend(this,n)};return e.extend(t.prototype,{route:!1,trigger:!1,replace:!1,execute:function(){throw new Error("You must override this method")}}),t}),define("js/components/transition_catalog",["underscore","js/components/transition"],function(e,t){var n=function(e){this._catalog={}};return e.extend(n.prototype,{add:function(e){if(!(e instanceof t))throw new Error("You can add only Transition objects");return this._catalog[e.endpoint]=e,e},get:function(e){return this._catalog[e]},remove:function(e){delete this._catalog[e]}}),n}),define("js/components/navigator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/transition","js/components/transition_catalog","analytics"],function(e,t,n,i,a,r,s,o){var l=i.extend({initialize:function(e){e=e||{},this.router=e.router,this.catalog=new s},activate:function(t){this.setBeeHive(t);var n=this.getPubSub();n.subscribe(n.NAVIGATE,e.bind(this.navigate,this))},navigate:function(e,n,i){if(!(this.router&&this.router instanceof Backbone.Router))throw new Error("Navigator must be given 'router' instance");o("send","pageview",{page:e});var a=this.catalog.get(e);if(a){if(a.execute){try{a.execute.apply(a,arguments)}catch(e){this.handleTransitionError(a,e,arguments)}var r=!!(a.replace||n&&n.replace);(decodeURI(window.location.hash)!==a.route&&a.route||""===a.route)&&this.router.navigate(a.route,{trigger:a.trigger||!1,replace:r}),t("head").find("meta[data-highwire]").remove(),document.title="ADS Search"}}else this.handleMissingTransition(arguments)},handleMissingTransition:function(){console.error("Cannot handle 'navigate' event: "+JSON.stringify(arguments)),this.getPubSub().publish(this.getPubSub().BIG_FIRE,"navigation-error",arguments)},handleTransitionError:function(e,t,n){console.error("Error while executing transition",e,n),console.error(t.stack),this.getPubSub().publish(this.getPubSub().CITY_BURNING,"navigation-error",arguments)},set:function(){if(1==arguments.length){if(arguments[1]instanceof r)return this.catalog.add(arguments[1]);throw new Error("You must be kiddin' sir!")}if(2==arguments.length){var t=arguments[0];if(e.isFunction(arguments[1]))return this.catalog.add(new r(t,{execute:arguments[1]}));if(e.isObject(arguments[1])&&arguments[1].execute)return this.catalog.add(new r(t,arguments[1]));throw new Error("Himmm, I dont know how to create a catalog rule with this input:",arguments)}throw new Error("Himmm, I dont know how to create a catalog rule with this input:",arguments)},get:function(e){return this.catalog.get(e)}});return e.extend(l.prototype,a.BeeHive),l}),define("hbs!404",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return"<!doctype html>\n<html>\n<head>\n  <link rel=\"preload\" href=\"./styles/css/styles.css\" as=\"style\">\n  <link rel=\"stylesheet\" href=\"./styles/css/styles.css\">\n  <script src=\"//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js\"><\/script>\n  <script>\n    !window.requirejs && document.write('<script src=\"./libs/requirejs/require.js\">\\x3C/script>');\n  <\/script>\n  <script>\n    require.config({\n      paths: {\n        'underscore': '//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.2/lodash.min',\n        'google-analytics': [\n          '//www.google-analytics.com/analytics',\n          'data:application/javascript,'\n        ],\n        'analytics': 'js/components/analytics',\n        'jquery': '//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min'\n      },\n      shim: {\n        'google-analytics': {\n          exports: '__ga__'\n        },\n        'analytics': {\n          deps: ['google-analytics']\n        }\n      },\n      callback: function () {\n        require(['discovery.vars'], function (config) {\n\n          // google analytics config\n          window.GoogleAnalyticsObject = '__ga__';\n          window.__ga__ = {\n            q: [\n              ['create', config.googleTrackingCode || '', config.googleTrackingOptions ||\n                'auto'\n              ]\n            ],\n            l: Date.now()\n          };\n        });\n      }\n    });\n    require(['analytics'], function (analytics) {\n      analytics('send', 'pageview');\n      analytics('send', 'event', 'error', 'automatic_redirection', '404.html');\n    });\n  <\/script>\n</head>\n<body>\n  <div>\n    <p> Bumblebee failed to load. Please try again.</p>\n  </div>\n</body>\n</html>\n"},useData:!0});return t.registerPartial("404",n),n}),define("hbs!js/apps/discovery/templates/orcid-modal-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n    <p>\n        If you <strong>wish for your ORCID claims to be accessible in the ADS,</strong> please first\n        <a href="#user/settings/orcid">fill out this brief form. </a>\n    </p>\n\n    <p>\n        After you have completed the form, you can immediately begin claiming papers.\n    </p>\n\n\n'},3:function(e,t,n,i){return'\n    <p>\n        If you <strong>want your ORCID claims to be accessible in the ADS,</strong>\n        please sign in to ADS or create an account and provide us with your permission to\n        make your claims public, along with a few other key pieces of information.\n\n    </p>\n    <p>\n        <a href="#user/account/login" class="btn btn-primary">log in to ADS </a>\n        or\n        <a href="#user/account/register" class="btn btn-primary">create a new account</a>\n\n    </p>\n    <p>\n        After you are signed in to your account, go to the "User Preferences" page,\n        click on the "ORCID Settings" tab, and fill in the brief form.\n    </p>\n\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n\n"+(null!=(a=t.if.call(e,null!=e?e.adsLoggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"\n<p>\n    <b>If you don't care about your information being searchable in the ADS, just close this message and continue.</b>\n</p>"},useData:!0});return t.registerPartial("js/apps/discovery/templates/orcid-modal-template",n),n}),define("js/apps/discovery/navigator",["jquery","backbone","underscore","js/components/navigator","js/components/api_feedback","js/components/api_query_updater","js/components/json_response","js/components/api_query","js/components/api_request","js/components/api_targets","hbs!404","hbs!js/apps/discovery/templates/orcid-modal-template"],function(e,t,n,i,a,r,s,o,l,c,u,d){return i.extend({start:function(e){var t=this,i=new r("navigator"),s=function(e){t.getPubSub().publish(t.getPubSub().FEEDBACK,new a(e))},u=function(e){t.getPubSub().publish(t.getPubSub().PAGE_CHANGE,e)},h=["Results","QueryInfo","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","ObjectFacet","NedObjectFacet","VizierFacet","GrantsFacet","GraphTabs","QueryDebugInfo","ExportDropdown","VisualizationDropdown","SearchWidget","Sort","BreadcrumbsWidget","PubtypeFacet","OrcidSelector"],p=["TOCWidget","SearchWidget","ShowResources","ShowAssociated","ShowGraphicsSidebar","ShowLibraryAdd","MetaTagsWidget"];function f(){return!e.getBeeHive().getObject("User").isLoggedIn()&&(e.getService("Navigator").navigate("authentication-page",{subView:"login"}),!0)}function g(t,n){return function(i,a){if(!f()){var r=a.subView||n;r||console.error("no subview or default view provided /to the navigator function!"),e.getObject("MasterPageManager").show("SettingsPage",[t,"UserNavbarWidget"]),e.getWidget("SettingsPage").done(function(e){e.setActive(t,r)}),this.route="#user/settings/"+r,u("settings-page")}}}function m(t,n){var i=n.widgetName,a=n.additional,r=a.format||"bibtex",s=n.subView,o=n.id,l=n.publicView;"ExportWidget"===i&&"authoraff"===r&&(i="AuthorAffiliationTool"),e.getWidget(i).done(function(e){e.reset?e.reset():e.resetWidget&&e.resetWidget()}),"ExportWidget"===i&&"classic"===r||(l?(e.getObject("MasterPageManager").show("PublicLibrariesPage",["IndividualLibraryWidget",i]),this.route="#/public-libraries/"+n.id):(e.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","UserNavbarWidget",i]),this.route="#user/libraries/"+n.id,u("libraries-page"))),function(t){e.getObject("LibraryController").getLibraryBibcodes(t).done(function(o){"ExportWidget"===i&&"classic"===r?e.getWidget(i).done(function(e){e.openClassicExports({bibcodes:o,libid:n.id})}):(e.getWidget(i).done(function(e){e.renderWidgetForListOfBibcodes(o,a)}),e.getWidget("IndividualLibraryWidget").done(function(e){e.setSubView({subView:s,publicView:l,id:t})}))})}(o)}function b(t,r){var o=e.getObject("AppStorage").getCurrentQuery();s({code:a.CODES.MAKE_SPACE});var l=n.map(t.split("-").slice(1),function(e){return e[0].toUpperCase()+e.slice(1)}).join("");e.getObject("MasterPageManager").show("SearchPage",[l].concat(h.slice(1))),this.route="#search/"+i.clean(o.clone()).url()+"/"+t.split("-").slice(1).join("-"),r&&r.onlySelected?e.getWidget(l).done(function(t){var n=e.getObject("AppStorage").getSelectedPapers();t.renderWidgetForListOfBibcodes(n)}):e.getWidget(l).done(function(e){e.renderWidgetForCurrentQuery({currentQuery:o})})}this.set("index-page",function(){e.getObject("MasterPageManager").show("LandingPage",["SearchWidget"]),e.getWidget("LandingPage").done(function(e){e.setActive("SearchWidget")}),this.route=""}),this.set("SearchWidget",function(){this.route="",t.get("index-page").execute()}),this.set("404",function(){e.getObject("MasterPageManager").show("ErrorPage")}),this.set("ClassicSearchForm",function(){e.getObject("MasterPageManager").show("LandingPage",["ClassicSearchForm"]),e.getWidget("LandingPage").done(function(e){e.setActive("ClassicSearchForm")}),this.route="#classic-form"}),this.set("PaperSearchForm",function(){e.getObject("MasterPageManager").show("LandingPage",["PaperSearchForm"]),e.getWidget("LandingPage").done(function(e){e.setActive("PaperSearchForm")}),this.route="#paper-form"}),this.set("LibraryImport",function(t,n){f()||(e.getObject("MasterPageManager").show("SettingsPage",["LibraryImport","UserNavbarWidget"]),e.getWidget("SettingsPage").done(function(e){e.setActive("LibraryImport")}),this.route="#user/settings/libraryimport",u("settings-page"))}),this.set("UserSettings",g("UserSettings",void 0)),this.set("UserPreferences",g("UserPreferences","librarylink")),this.set("AllLibrariesWidget",function(t,n){if(!f()){n=n||"libraries";e.getObject("MasterPageManager").show("LibrariesPage",["AllLibrariesWidget","UserNavbarWidget"]),e.getWidget("AllLibrariesWidget").done(function(e){e.setSubView({view:n})}),this.route="#user/libraries/",u("libraries-page")}}),this.set("LibraryAdminView",function(t){e.getWidget("IndividualLibraryWidget").done(function(t){t.setSubView({subView:"admin"}),e.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","UserNavbarWidget"]),u("libraries-page")})}),this.set("IndividualLibraryWidget",function(t,i){i.publicView=!!i.publicView&&i.publicView,this.route=i.publicView?"#/public-libraries/"+i.id:"#user/libraries/"+i.id,e.getObject("LibraryController").getLibraryMetadata(i.id).done(function(t){i.editRecords=n.contains(["write","admin","owner"],t.permission)&&!i.publicView,e.getWidget("LibraryListWidget").done(function(t){t.setData(i),i.publicView?e.getWidget("IndividualLibraryWidget").done(function(t){t.setSubView(i),e.getObject("MasterPageManager").show("PublicLibrariesPage",["IndividualLibraryWidget","LibraryListWidget"])}):f()||e.getWidget("IndividualLibraryWidget").done(function(t){t.setSubView(i),e.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","LibraryListWidget","UserNavbarWidget"]),u("libraries-page")})})})}),this.set("library-export",m),this.set("library-visualization",m),this.set("library-metrics",m),this.set("library-citation_helper",m),this.set("home-page",function(){e.getObject("MasterPageManager").show("HomePage",[]),u("home-page")}),this.set("authentication-page",function(n,i){var a=(i=i||{}).subView||"login";e.getBeeHive().getObject("User").isLoggedIn()?t.get("index-page").execute():(this.route="#user/account/"+a,e.getObject("MasterPageManager").show("AuthenticationPage",["Authentication"]),e.getWidget("Authentication").done(function(e){e.setSubView(a)}))}),this.set("results-page",function(t,r){e.getObject("MasterPageManager").show("SearchPage",h);var l=e.getObject("AppStorage").getCurrentQuery();if(l&&l.get("__original_url")){var c="#search/"+l.get("__original_url");l.unset("__original_url")}else c="#search/"+i.clean(l).url();if(l instanceof o){var u={};if(l.has("p_")){var d=function(e){if(n.isString(e))try{return parseInt(e)}catch(e){}return!1}(l.get("p_")[0]);u.page=d}else c+="&p_=0";n.isEmpty(u)||e.getWidget("Results").then(function(e){n.isFunction(e.updatePagination)&&e.updatePagination(u)})}l&&l.get("__qid")&&(c+="&__qid="+l.get("__qid")[0]),this.route=c,s({code:a.CODES.UNMAKE_SPACE})}),this.set("export",function(t,n){var i=n.format||"bibtex",r=e.getObject("AppStorage");e.getObject("MasterPageManager").show("SearchPage",["ExportWidget"].concat(h.slice(1))),e.getWidget("ExportWidget").done(function(t){if("classic"!==i)if("authoraff"!==i)if(s({code:a.CODES.MAKE_SPACE}),n.onlySelected&&r.hasSelectedPapers())t.renderWidgetForListOfBibcodes(r.getSelectedPapers(),{format:i});else if(!1===n.onlySelected&&r.hasCurrentQuery())t.renderWidgetForCurrentQuery({format:i,currentQuery:r.getCurrentQuery(),numFound:r.get("numFound")});else if(void 0===n.onlySelected&&r.hasSelectedPapers())t.renderWidgetForListOfBibcodes(r.getSelectedPapers(),{format:i});else if(r.hasCurrentQuery())t.exportQuery({format:i,currentQuery:r.getCurrentQuery(),numFound:r.get("numFound")});else{e.getController("AlertsController").alert({msg:"There are no records to export yet (please search or select some)"}),this.get("results-page")()}else n.onlySelected&&r.hasSelectedPapers()?t.getAuthorAffForm({bibcodes:r.getSelectedPapers()}):t.getAuthorAffForm({currentQuery:r.getCurrentQuery()});else n.onlySelected&&r.hasSelectedPapers()?t.openClassicExports({bibcodes:r.getSelectedPapers()}):t.openClassicExports({currentQuery:r.getCurrentQuery()})})}),this.set("export-query",function(){var t=e.getService("Api"),n=e.getObject("AppStorage").getCurrentQuery(),i=e.getController("AlertsController");n=new o({query:n.url()}),t.request(new l({query:n,target:c.MYADS_STORAGE+"/query",options:{done:function(){},type:"POST",xhrFields:{withCredentials:!1}}})).done(function(e){i.alert(new a({code:a.CODES.ALERT,msg:'The query has been saved. You can insert the following snippet in a webpage: <br/><img src="'+c.MYADS_STORAGE+"/query2svg/"+e.qid+'"></img><br/><br/><textarea rows="10" cols="50"><a href="'+location.protocol+"//"+location.host+location.pathname+"#execute-query/"+e.qid+'"><img src="'+c.MYADS_STORAGE+"/query2svg/"+e.qid+'"></img></a></textarea>',modal:!0}))})}),this.set("execute-query",function(n,i){e.getService("Api").request(new l({target:c.MYADS_STORAGE+"/query/"+i,options:{done:function(e){var n=(new o).load(JSON.parse(e.query).query);t.getPubSub().publish(t.getPubSub().START_SEARCH,n)},fail:function(){e.getController("AlertsController").alert(new a({code:a.CODES.ERROR,msg:"The query with the given UUID cannot be found"})),t.get("index-page").execute()},type:"GET",xhrFields:{withCredentials:!1}}}))}),this.set("orcid-instructions",function(){this.route="#orcid-instructions",e.getObject("MasterPageManager").show("OrcidInstructionsPage")}),this.set("orcid-page",function(i,r){var s=e.getService("OrcidApi"),o=e.getService("PersistentStorage"),l=e.getObject("AppStorage");if(!s.hasAccess()&&s.hasExchangeCode())return o?o.set("orcidAuthenticating",!0):console.warn("no persistent storage service available"),void s.getAccessData(s.getExchangeCode()).done(function(e){s.saveAccessData(e),t.getPubSub().publish(t.getPubSub().APP_EXIT,{url:window.location.pathname+(r&&n.isString(r)?r:window.location.hash)})}).fail(function(){console.warn("Unsuccessful login to ORCID"),t.get("index-page").execute(),e.getController("AlertsController").alert(new a({code:a.CODES.ALERT,msg:"Error getting OAuth code to access ORCID",modal:!0}))});s.hasAccess()?(o.get("orcidAuthenticating")&&(o.remove("orcidAuthenticating"),s.getADSUserData().done(function(t){t.hasOwnProperty("authorizedUser")||'["UserPreferences",{"subView":"orcid"}]'===JSON.stringify(l.get("stashedNav"))||e.getController("AlertsController").alert(new a({code:a.CODES.ALERT,msg:d({adsLoggedIn:e.getObject("User").isLoggedIn()}),type:"success",title:"You are now logged in to ORCID",modal:!0}))}).fail(function(e){console.warn(e)})),this.route="#user/orcid",e.getObject("MasterPageManager").show("OrcidPage",["OrcidBigWidget","SearchWidget"])):(this.route="",t.get("index-page").execute())}),this.set("show-author-network",function(e,t){b.apply(this,arguments)}),this.set("show-concept-cloud",function(e,t){b.apply(this,arguments)}),this.set("show-paper-network",function(e,t){b.apply(this,arguments)}),this.set("show-bubble-chart",function(e,t){b.apply(this,arguments)}),this.set("show-metrics",function(e,t){b.apply(this,arguments)}),this.set("visualization-closed",this.get("results-page"));var v=function(t,n){e.getObject("MasterPageManager").show("DetailsPage",t),e.getWidget("DetailsPage").done(function(e){e.setActive(n)})};this.set("ShowAbstract",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowCitations",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowReferences",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowCoreads",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowTableOfContents",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowSimilar",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowMetrics",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("ShowPaperExport",function(t,n){var i=n.subView;e.getObject("MasterPageManager").show("DetailsPage",[t].concat(p)),e.getWidget("DetailsPage").done(function(e){e.setActive(t,i)})}),this.set("ShowGraphics",function(e,t){v([e].concat(p),e),this.route=t.href}),this.set("show-author-affiliation-tool",function(t,n){var r=e.getObject("AppStorage").getCurrentQuery();e.getObject("MasterPageManager").show("SearchPage",["AuthorAffiliationTool"].concat(h.slice(1))),this.route="#search/"+i.clean(r).url(),e.getWidget("AuthorAffiliationTool").done(function(t){if(n&&n.onlySelected){var i=e.getObject("AppStorage").getSelectedPapers();t.renderWidgetForListOfBibcodes(i)}else t.renderWidgetForCurrentQuery({currentQuery:r})}),s({code:a.CODES.MAKE_SPACE})})}})}),define("js/components/persistent_storage",["underscore","js/components/generic_module","js/mixins/dependon","persist-js","module"],function(e,t,n,i,a){var r=a.config().namespace||"",s=t.extend({constructor:function(e){e=e||{},this._store=this.createStore(r+(e.name||""))},createStore:function(e){return this._createStore(e)},_createStore:function(t){var n=new i.Store(t,{about:"This is bumblebee persistent storage",defer:!0}),a=n.get("#keys");if(a)try{a=JSON.parse(a),e.isObject(a)||n.set("#keys","{}")}catch(e){n.set("#keys","{}")}else n.set("#keys","{}");return n},set:function(t,n){this._checkKey(t),e.isString(n)||(n=JSON.stringify(n)),this._store.set(t,n),this._setKey(t)},get:function(e){this._checkKey(e);var t=this._store.get(e);if(!t)return t;try{return JSON.parse(t)}catch(e){return t}},remove:function(e){this._checkKey(e),this._store.remove(e),this._delKey(e)},clear:function(){var e=this.get("#keys");for(var t in e)this._store.remove(t);this._store.set("#keys","{}")},keys:function(){return JSON.parse(this._store.get("#keys"))},_setKey:function(e){var t=this.keys()||{};t[e]=1,this._store.set("#keys",JSON.stringify(t))},_delKey:function(e){var t=this.keys()||{};delete t[e],this._store.set("#keys",JSON.stringify(t))},_checkKey:function(t){if(!e.isString(t))throw new Error("key must be string, received: "+t)}});return e.extend(s.prototype,n.BeeHive),s}),define("js/services/storage",["underscore","js/components/persistent_storage"],function(e,t){var n=t.extend({activate:function(e){},onAppBootstrapped:function(){var e=this.getBeeHive().getObject("DynamicConfig");if(!e)throw new Error("DynamicConfig is missing");var t=e.namespace;t||(console.warn("Application namespace not set; persistent storage will be created without it"),t=""),this._store=this._createStore(t)}});return function(){return new n({name:"storage-service"})}}),define("js/components/history_manager",["js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/pubsub_key"],function(e,t,n,i){var a=e.extend({initialize:function(){this._history=[]},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.NAVIGATE,_.bind(this.recordNav,this))},recordNav:function(){this._history.push([].slice.apply(arguments))},getCurrentNav:function(){return this._history[this._history.length-1]},getPreviousNav:function(){return this._history[this._history.length-2]},hardenedInterface:{getPreviousNav:"",getCurrentNav:""}});return _.extend(a.prototype,t.BeeHive,n),a}),define("js/components/user",["underscore","backbone","js/components/api_request","js/components/api_targets","js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/api_feedback","js/mixins/api_access"],function(e,t,n,i,a,r,s,o,l){var c,u,d;return c=t.Model.extend({defaults:function(){return{isOrcidModeOn:!1,perPage:void 0}}}),u=t.Model.extend({defaults:function(){return{user:void 0,link_server:void 0,minAuthorPerResult:4,externalLinkAction:"Open in new tab",defaultDatabase:[{name:"Physics",value:!1},{name:"Astronomy",value:!1},{name:"General",value:!1}],defaultExportFormat:"BibTeX",defaultHideSidebars:"Show"}}}),d=a.extend({initialize:function(t){this.localStorageModel=new c,this.listenTo(this.localStorageModel,"change",this.broadcastUserDataChange),this.userModel=new u,this.listenTo(this.userModel,"change:user",this.broadcastUserChange),this.listenTo(this.userModel,"change",function(e){"user"!==e&&this.broadcastUserDataChange.apply(this,arguments)}),e.bindAll(this,"completeLogIn","completeLogOut"),this.base_url=this.test?"location.origin":location.origin,this.buildAdditionalParameters()},activate:function(e){this.setBeeHive(e);this.getPubSub().subscribe(this.getPubSub().APP_STARTING,function(){var t=e.getService("OrcidApi"),n=e.getObject("User");null!==t.authData&&t.checkAccessOrcidApiAccess().fail(function(e){var i=e&&e.status;i&&"401"===i&&(t.signOut(),n.setOrcidMode(0))})});var t=e.getService("PersistentStorage");if(t){var n=t.get("UserPreferences");n&&this.localStorageModel.set(n)}},_persistModel:function(){var e=this.getBeeHive().getService("PersistentStorage");e&&e.set("UserPreferences",this.localStorageModel.toJSON())},setLocalStorage:function(e){this.localStorageModel.set(e),this._persistModel()},getLocalStorage:function(e){return this.localStorageModel.toJSON()},setOrcidMode:function(e){this.localStorageModel.set("isOrcidModeOn",e),this._persistModel()},isOrcidModeOn:function(){return this.localStorageModel.get("isOrcidModeOn")},broadcastUserDataChange:function(e){this.getPubSub().publish(this.getPubSub().USER_ANNOUNCEMENT,this.USER_INFO_CHANGE,e.changed)},broadcastUserChange:function(){var e=this.userModel.get("user")?this.USER_SIGNED_IN:this.USER_SIGNED_OUT;this.getPubSub().publish(this.getPubSub().USER_ANNOUNCEMENT,e,this.userModel.get("user")),this.redirectIfNecessary()},buildAdditionalParameters:function(){var e={};e.CHANGE_EMAIL={verify_url:this.base_url+"/#user/account/verify/change-email"},this.additionalParameters=e},handleFailedPOST:function(e,t,n,i){var a;this.getPubSub();a=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText?e.responseText:"error unknown",console.error("POST request failed for endpoint: ["+i+"]",a)},handleFailedGET:function(e,t,n,i){var a;this.getPubSub();a=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText?e.responseText:"error unknown",console.error("GET request failed for endpoint: ["+i+"]",a)},fetchData:function(e){return this.composeRequest({target:e,method:"GET"})},postData:function(t,n){return this.additionalParameters[t]&&e.extend(n,this.additionalParameters[t]),this.composeRequest({target:t,method:"POST",data:n})},putData:function(t,n){return this.additionalParameters[t]&&e.extend(n,this.additionalParameters[t]),this.composeRequest({target:t,method:"PUT",data:n})},sendRequestWithNewCSRF:function(t){t=e.bind(t,this),this.getBeeHive().getObject("CSRFManager").getCSRF().done(t)},composeRequest:function(t){var a,r=t.target,s=t.method,o=(l=t.data||{}).csrf,l=e.omit(l,"csrf"),c=i[r],u=this,d=$.Deferred();return a={target:c,options:{context:this,type:s,data:e.isEmpty(l)?void 0:JSON.stringify(l),contentType:"application/json",done:function(){d.resolve.apply(d,arguments)},fail:function(){var e="GET"==s?u.handleFailedGET:u.handleFailedPOST,t=[].slice.apply(arguments);t.push(r),e.apply(u,t),d.reject.apply(d,arguments)}}},o?this.sendRequestWithNewCSRF(function(e){a.options.headers={"X-CSRFToken":e},this.getBeeHive().getService("Api").request(new n(a))}):this.getBeeHive().getService("Api").request(new n(a)),d},redirectIfNecessary:function(){var e=this.getPubSub();if("AuthenticationPage"===this.getBeeHive().getObject("MasterPageManager").currentChild&&this.isLoggedIn()){var t=this.getBeeHive().getService("HistoryManager").getPreviousNav();t||(t="index-page"),e.publish.apply(e,[e.NAVIGATE].concat(t))}else"SettingsPage"!==this.getBeeHive().getObject("MasterPageManager").currentChild||this.isLoggedIn()||e.publish(e.NAVIGATE,"authentication-page")},setUser:function(e){this.userModel.set("user",e),this.isLoggedIn()&&this.completeLogIn()},completeLogIn:function(){var e=this;this.fetchData("USER_DATA").done(function(t){e.userModel.set(t)})},completeLogOut:function(){this.userModel.clear()},deleteAccount:function(){var e=this;return this.postData("DELETE",{csrf:!0}).done(function(){e.getApiAccess({reconnect:!0}).done(function(){e.completeLogOut()})})},changeEmail:function(t){var n=t.email;return t=e.extend(t,{csrf:!0}),this.postData("CHANGE_EMAIL",t).done(e.bind(function(){this.getPubSub().subscribeOnce(this.getPubSub().NAVIGATE,e.bind(function(){var e="<p>Please check <b>"+n+"</b> for further instructions</p><p>(If you don't see the email, please <b>check your spam folder</b>)</p>";this.getPubSub().publish(this.getPubSub().ALERT,new o({code:0,msg:e,type:"success",title:"Success",modal:!0}))},this)),this.getBeeHive().getObject("Session").logout()},this))},changePassword:function(t){return t=e.extend(t,{csrf:!0}),this.postData("CHANGE_PASSWORD",t)},getToken:function(){return this.fetchData("TOKEN")},generateToken:function(){return this.putData("TOKEN",{csrf:!0})},getUserData:function(){return this.userModel.toJSON()},setUserData:function(e){var t=this;return this.postData("USER_DATA",e).done(function(e){t.userModel.set(e)})},getUserName:function(){return this.userModel.get("user")},isLoggedIn:function(){return!!this.userModel.get("user")},setMyADSData:function(e){return this.postData("USER_DATA",e)},getOpenURLConfig:function(){return this.getSiteConfig("link_servers")},getSiteConfig:function(e){var t=$.Deferred();var a=new n({target:e?i.SITE_CONFIGURATION+"/"+e:i.SITE_CONFIGURATION,options:{type:"GET",done:function(e){t.resolve(e)},fail:function(e){t.reject(e)}}});return this.getBeeHive().getService("Api").request(a),t.promise()},hardenedInterface:{setUser:"set username into user",isLoggedIn:"whether the user is logged in",getUserName:"get the user's email before the @",setLocalStorage:"sets an object in to user's local storage",getLocalStorage:"gives you a json object for user's local storage",isOrcidModeOn:"figure out if user has Orcid mode activated",setOrcidMode:"set orcid ui on or off",getOpenURLConfig:"get list of openurl endpoints",getUserData:"myads data",setUserData:"POST user data to myads endpoint",generateToken:"PUT to token endpoint to make a new token",getToken:"GET from token endpoint",deleteAccount:"POST to delete account endpoint",changePassword:"POST to change password endpoint",changeEmail:"POST to change email endpoint",setMyADSData:"",USER_SIGNED_IN:"constant",USER_SIGNED_OUT:"constant",USER_INFO_CHANGE:"constant"}}),e.extend(d.prototype,s,r.BeeHive,r.App,l,{USER_SIGNED_IN:"user_signed_in",USER_SIGNED_OUT:"user_signed_out",USER_INFO_CHANGE:"user_info_change"}),d}),define("js/components/session",["backbone","js/components/api_request","js/components/api_targets","js/mixins/hardened","js/components/generic_module","js/mixins/dependon","js/components/api_query","js/components/user","js/components/api_feedback","js/mixins/api_access"],function(e,t,n,i,a,r,s,o,l,c){var u=e.Model.extend({defaults:function(){return{resetPasswordToken:void 0}}}),d=a.extend({initialize:function(e){e=e||{};this.model=new u,this.test=!!e.test||void 0,_.bindAll(this,["loginSuccess","loginFail","registerSuccess","registerFail","resetPassword1Success","resetPassword1Fail","resetPassword2Success","resetPassword2Fail"])},activate:function(e){this.setBeeHive(e)},login:function(e){var i=$.Deferred(),a=this;return this.sendRequestWithNewCSRF(function(r){var o=new t({target:n.USER,query:new s({}),options:{type:"POST",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":r},done:function(){i.resolve.apply(i,arguments),a.loginSuccess.apply(a,arguments)},fail:function(){i.reject.apply(i,arguments),a.loginFail.apply(a,arguments)},beforeSend:function(e,t){e.session=this}}});return this.getBeeHive().getService("Api").request(o)}),i.promise()},sendRequestWithNewCSRF:function(e){e=_.bind(e,this),this.getBeeHive().getObject("CSRFManager").getCSRF().done(e)},logout:function(){this.sendRequestWithNewCSRF(function(e){var i=new t({target:n.LOGOUT,query:new s({}),options:{context:this,type:"POST",headers:{"X-CSRFToken":e},contentType:"application/json",done:this.logoutSuccess}});return this.getBeeHive().getService("Api").request(i)})},register:function(e){var i=this.test?"location.origin":location.origin;_.extend(e,{verify_url:i+"/#user/account/verify/register"}),this.sendRequestWithNewCSRF(function(i){var a=new t({target:n.REGISTER,query:new s({}),options:{type:"POST",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":i},done:this.registerSuccess,fail:this.registerFail}});return this.getBeeHive().getService("Api").request(a)})},resetPassword1:function(e){var i=this.test?"location.origin":location.origin;_.extend(e,{reset_url:i+"/#user/account/verify/reset-password"});var a=e.email;e=_.omit(e,"email");this.sendRequestWithNewCSRF(function(i){var r=new t({target:n.RESET_PASSWORD+"/"+a,query:new s({}),options:{type:"POST",data:JSON.stringify(e),headers:{"X-CSRFToken":i},contentType:"application/json",done:this.resetPassword1Success,fail:this.resetPassword1Fail}});return this.getBeeHive().getService("Api").request(r)})},resetPassword2:function(e){this.sendRequestWithNewCSRF(function(i){var a=new t({target:n.RESET_PASSWORD+"/"+this.model.get("resetPasswordToken"),query:new s({}),options:{type:"PUT",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":i},done:this.resetPassword2Success,fail:this.resetPassword2Fail}});return this.getBeeHive().getService("Api").request(a)})},setChangeToken:function(e){this.model.set("resetPasswordToken",e)},loginSuccess:function(e,t,n){this.getApiAccess({reconnect:!0}).done(function(){})},loginFail:function(e,t,n){var i=this.getPubSub(),a="Log in was unsuccessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseJSON&&e.responseJSON.message?e.responseJSON.message:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:a,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"login_fail",a)},logoutSuccess:function(e,t,n){var i=this;this.getApiAccess({reconnect:!0}).done(function(){i.getBeeHive().getObject("User").completeLogOut()})},registerSuccess:function(e,t,n){var i=this.getPubSub();i.publish(i.USER_ANNOUNCEMENT,"register_success")},registerFail:function(e,t,n){var i=this.getPubSub(),a="Registration was unsuccessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:a,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"register_fail",a)},resetPassword1Success:function(e,t,n){var i=this.getPubSub();i.publish(i.USER_ANNOUNCEMENT,"reset_password_1_success")},resetPassword1Fail:function(e,t,n){var i=this.getPubSub(),a="password reset step 1 was unsucessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:a,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"reset_password_1_fail")},resetPassword2Success:function(e,t,n){var i,a;i=this.getApiAccess({reconnect:!0}),a=this.getPubSub(),i.done(function(){a.publish(a.USER_ANNOUNCEMENT,"reset_password_2_success"),a.publish(a.NAVIGATE,"index-page");a.publish(a.ALERT,new l({code:0,msg:"Your password has been successfully reset!",type:"success",modal:!0}))}),i.fail(function(){a.publish(a.USER_ANNOUNCEMENT,"reset_password_2_fail");a.publish(a.ALERT,new l({code:0,msg:"Your password was not successfully reset. Please try to follow the link from the email you received again.",type:"danger",modal:!0}))})},resetPassword2Fail:function(e,t,n){var i=this.getPubSub(),a="password reset step 2 was unsucessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:a,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"reset_password_2_fail")},hardenedInterface:{login:"log the user in",logout:"log the user out",register:"registers a new user",resetPassword1:"sends an email to account",resetPassword2:"updates the password",setChangeToken:"the router stores the token to reset password here"}});return _.extend(d.prototype,r.BeeHive,i,c),d}),define("js/mixins/widget_utility",[],function(){var e={extendMethod:function(e,t,n){if(!_.isUndefined(t[n])){var i=e[n];e[n]=function(){var e=i.apply(this,arguments);return t[n].apply(this,arguments),e}}}};return e}),define("js/mixins/widget_mixin_method",["js/mixins/widget_utility"],function(e){return function(t,n){var i=this.prototype;_.extend(t,i),_.extend(t.events,i.events),_.each(Array.prototype.slice.call(arguments,1),function(n){e.extendMethod(i,t,n)})}}),define("js/mixins/widget_state_manager",["underscore","js/components/api_feedback"],function(e,t){return{activateWidget:function(){this.__widgetHandlerManager=new function(){this.handlers={},this.on=function(e,t){this.handlers[e].push(t)},this.off=function(t){e.forEach(this.handlers,function(e,n){var i=e.indexOf(t);i>-1&&e.splice(i,1)})},this.fire=function(t,n,i){e.forEach(this.handlers[t],function(e){e.apply(i,n)})},e.reduce(t.CODES,function(e,t){return e[t]=[],e},this.handlers)};var n=this.getPubSub();n.subscribe(n.FEEDBACK,e.bind(this.__handleFeedback,this)),this.updateState("ready")},__handleFeedback:function(e,t){this.getPubSub().getCurrentPubSubKey().getId()===t.getId()&&this.__widgetHandlerManager.fire(e.code,arguments,this)},attachHandler:function(e,t){try{this.__widgetHandlerManager.on(e,t)}catch(e){console.error(e)}},attachGeneralHandler:function(n){e.forEach(t.CODES,e.bind(function(e){(e>0||e===t.CODES.API_REQUEST_ERROR)&&this.attachHandler(e,n)},this))},detachHandler:function(e){this.__widgetHandlerManager.off(e)},onReady:e.noop,onLoading:e.noop,onIdle:e.noop,onErrored:e.noop,onStateChange:e.noop,updateState:function(t){if(t&&e.isString(t)&&t!==this.__state){var n=this.__state;this.__state=t,this.__fireStateHandler(),this.onStateChange.call(this,t,n)}},getState:function(){return this.__state},__fireStateHandler:function(){var e={};e.ready=this.onReady,e.loading=this.onLoading,e.idle=this.onIdle,e.errored=this.onErrored,e[this.__state]&&e[this.__state].call(this,this)}}}),define("js/widgets/base/base_widget",["backbone","marionette","js/components/api_query","js/components/api_request","js/mixins/widget_mixin_method","js/components/api_targets","js/mixins/dependon","js/mixins/widget_state_manager"],function(e,t,n,i,a,r,s,o){var l=t.Controller.extend({initialize:function(e){e=e||{},_.bindAll(this,"dispatchRequest","processResponse"),this._currentQuery=new n,this.defaultQueryArguments=this.defaultQueryArguments||{},e.defaultQueryArguments&&(this.defaultQueryArguments=_.extend(this.defaultQueryArguments,e.defaultQueryArguments)),e.view&&(this.view=e.view,this.collection=e.view.collection),this.view&&t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.model&&t.bindEntityEvents(this,this.model,t.getOption(this,"modelEvents"))},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,this.dispatchRequest),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},dispatchNewQuery:function(e){_.each(this.defaultQueryArguments,function(t,n){e.unset(n)});var t=this.getPubSub();t.publish(t.START_SEARCH,e)},dispatchRequest:function(e){this._dispatchRequest(e)},_dispatchRequest:function(e){var t=this.customizeQuery(e);if(t){var n=this.composeRequest(t);if(n){var i=this.getPubSub();i.publish(i.DELIVERING_REQUEST,n)}}},customizeQuery:function(e){var t=e.clone();return t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t)),t},processResponse:function(e){var t=e.getApiQuery();throw this.setCurrentQuery(t),new Error("you need to customize this function")},composeRequest:function(e){return new i({target:r.SEARCH,query:e})},setCurrentQuery:function(e){this._currentQuery=e},getCurrentQuery:function(){var e,t;return this._currentQuery instanceof n?e=this._currentQuery:_.isFunction(this.getBeeHive)&&(t=this.getBeeHive()).hasObject("AppStorage")&&(e=t.getObject("AppStorage").getCurrentQuery()),e instanceof n?e:new n},composeQuery:function(e,t){var n;return n=t||(n=this.getCurrentQuery()).clone(),e&&_.each(e,function(e,t){n.has(t)||n.set(t,e)}),n},onDestroy:function(){this.view.destroy()},getEl:function(){return this.view.el&&this.view.$el.children().length?this.view.el:this.view.render().el},render:function(){return this.view.render()}},{mixin:a});return _.extend(l.prototype,s.BeeHive,o),l}),define("hbs!js/page_managers/templates/results-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="results-page-layout" class="s-results-page-layout">\n    <div class="row s-stable-search-bar-height">\n        <div class="s-search-bar-full-width-container">\n            <div class="col-xs-0 col-sm-12 col-md-2 s-back-button-container">\n                <a href="#" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left"></i> Start New Search</a>\n            </div>\n            <div class="col-xs-12 col-sm-9 col-md-7 s-search-bar-row" id="search-bar-row" data-widget="SearchWidget"></div>\n        </div>\n    </div>\n    <div class="row s-message-control-row" id="message-control-row"><span data-widget="AlertsWidgetx"></span></div>\n    <div class="row s-results-control-row" id="results-control-row">\n    </div>\n    <div class="row">\n        <div class="col-xs-12 s-dynamic-page-body" id="dynamic-page-body">\n            <div class="max-width-wrapper">\n                <div class="row">\n                    <div class="hidden-xs col-sm-3 col-md-2 s-left-column s-results-column" id="results-left-column">\n                        <h2 class="sr-only">Filters for the Current Search</h2>\n                        <div class="left-col-container s-left-col-container">\n                            <div data-widget="AuthorFacet"/>\n                            <div data-widget="DatabaseFacet"/>\n                            <div data-widget="RefereedFacet"/>\n                            <div data-widget="KeywordFacet"/>\n                            <div data-widget="BibstemFacet"/>\n                            <div data-widget="BibgroupFacet"/>\n                            <div data-widget="ObjectFacet"/>\n                            <div data-widget="NedObjectFacet"/>\n                            <div data-widget="DataFacet"/>\n                            <div data-widget="VizierFacet"/>\n                            <div data-widget="PubtypeFacet"/>\n                        </div>\n                    </div>\n\n                    <div class="col-sm-9 col-md-7  s-results-middle-column s-results-column" id="results-middle-column">\n                        <div class="main-content-container s-main-content-container" id="main-content" tabindex="-1" role="main" aria-label="container for search results and other main content">\n                            <div data-widget="Results"/>\n                            <div data-widget="AuthorAffiliationTool"/>\n                            <div data-widget="ExportWidget" data-origin="results-page"/>\n                            <div data-widget="AuthorNetwork"/>\n                            <div data-widget="PaperNetwork"/>\n                            <div data-widget="Metrics" data-allow-redirect="true"/>\n                            <div data-widget="BubbleChart"/>\n                            <div data-widget="ConceptCloud"/>\n                            <div data-widget="CitationHelper"/>\n                        </div>\n                    </div>\n\n                    <div class="hidden-xs col-sm-3 col-md-3 results-right-column s-right-column s-results-column" id="results-right-column">\n                        <h2 class="sr-only">Additional Functionality (Information about your query, and more search filters)</h2>\n\n                        <div data-widget="QueryInfo"/>\n                        <div data-widget="OrcidSelector"/>\n                        <div data-widget="GraphTabs"/>\n                        <div data-widget="QueryDebugInfo" data-debug="true"/>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/results-page-layout",n),n}),define("hbs!js/page_managers/templates/results-control-row",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-results-control-row-container">\n    <div class="col-sm-6">\n        <div data-widget="BreadcrumbsWidget" class="s-display-inline-block"/>\n    </div>\n\n\n    <div class="col-sm-6" style="padding-right:0">\n        <div class="s-results-action-buttons">\n            <div class="col-md-6 clearfix" style="margin-bottom:10px;">\n                <div data-widget="Sort" class="s-display-inline-block pull-right"/>\n            </div>\n            <div class="col-md-6">\n                <div data-widget="VisualizationDropdown" class="s-display-inline-block pull-right"/>\n                <div data-widget="ExportDropdown" class="s-display-inline-block pull-right"/>\n            </div>\n        </div>\n    </div>\n\n</div>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/results-control-row",n),n}),define("js/page_managers/three_column_view",["underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget"],function(e,t,n,i){var a=Backbone.Model.extend({defaults:function(){return{left:"open",right:"open",user_left:null,user_right:null}}});return t.ItemView.extend({initialize:function(e){e=e||{};this.widgets=e.widgets,this.model=new a},destroy:function(){t.ItemView.prototype.destroy.call(this,arguments)},template:n,modelEvents:{"change:left":"_updateColumnView","change:right":"_updateColumnView"},events:{"click .btn-expand":"onClickToggleColumns"},onRender:function(){this.$("#results-control-row").append(i()),this.displaySearchBar(this.options.displaySearchBar),this.displayControlRow(this.options.displayControlRow),this.displayLeftColumn(this.options.displayLeftColumn),this.displayRightColumn(this.options.displayRightColumn),this.displayMiddleColumn(this.options.displayMiddleColumn)},onShow:function(){this.displaySearchBar(!0)},displaySearchBar:function(e){$("#search-bar-row").toggle(null===e||e)},displayLeftColumn:function(e){this.$(".s-left-col-container").toggle(null===e||e)},displayControlRow:function(e){this.$("#results-control-row").toggle(null===e||e)},displayRightColumn:function(e){this.$(".s-left-col-container").toggle(null===e||e)},displayMiddleColumn:function(e){this.$(".s-left-col-container").toggle(null===e||e)},_returnBootstrapClasses:function(){var t=this.classList,n=[];return e.each(t,function(e){-1!==e.indexOf("col-")&&n.push(e)}),n.join(" ")},showCols:function(e){e=e||{left:!0,right:!0,force:!1};for(var t=["left","right"],n=0;n<t.length;n++){var i=t[n];if(i in e)null===this.model.get("user_"+i)?this.model.set(i,e[i]?"open":"closed"):e.force&&(this.model.set(i,e[i]?"open":"closed"),this.model.set("user_"+i,null))}},_updateColumnView:function(){var t,n,i,a,r;t=this.model.get("left"),n=this.model.get("right"),i=this.$("#results-left-column"),a=this.$("#results-right-column"),r=this.$("#results-middle-column"),e.each([["left",t,i],["right",n,a]],function(e){if("open"==e[1]){e[2].removeClass("hidden");var t=e[2];setTimeout(function(){t.children().show(0)},200)}else e[2].addClass("hidden")}),"open"===t&&"open"===n?r.removeClass(this._returnBootstrapClasses).addClass("col-sm-9 col-md-7"):"closed"===t&&"closed"===n&&r.removeClass(this._returnBootstrapClasses).addClass("col-md-12 col-sm-12")}})}),define("js/page_managers/view_mixin",["underscore","jquery"],function(e,t){return{getWidgetsFromTemplate:function(n,i){var a={},r=t(n).find("[data-widget]");return r.length>0&&e.each(r,function(e){var t=e.getAttribute("data-widget"),n=e.getAttribute("data-debug");n&&"true"==n&&!n||(a[t]=e)}),a}}}),define("js/page_managers/controller",["jquery","underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget","./three_column_view","./view_mixin","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l){var c=r.extend({initialize:function(e){this.widgets={},this.widgetDoms={},this.initialized=!1,this.widgetId=null,this.assembled=!1,t.extend(this,t.pick(e,["debug","widgetId"]))},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets})},setWidgetId:function(e){this.widgetId=e},createView:function(e){return new s(e)},assemble:function(n){if(this.assembled)return this.view.el;this.assembled=!0,this.view.render();var i,a=this;t.extend(a.widgetDoms,a.getWidgetsFromTemplate(a.view.$el)),t.each(a.widgetDoms,function(r,s){if(!n.hasWidget(s))return delete a.widgetDoms[s],void delete a.widgets[s];var o=n._getWidget(s);this.persistentWidgets&&this.persistentWidgets.indexOf(s)>-1&&n._getWidget(s),o&&(o.assemble&&o.assemble(n),t.assign(o,{componentParams:e(r).data()}),i=o.getEl?o.getEl():o.render().el,e(a.widgetDoms[s]).empty().append(i),a.widgets[s]=o)},this)},disAssemble:function(n){t.each(t.keys(this.widgets),function(t){var i=this.widgets[t];i.disAssemble&&i.disAssemble(),n.returnWidget(t),n._isBarbarianAlive("widget:"+t)?e(this.widgetDoms[t]).detach():e(this.widgetDoms[t]).empty(),delete this.widgets[t],delete this.widgetDoms[t]},this),this.assembled=!1},show:function(e){var n=this;if(e){this.hideAll();var i=[].slice.apply(arguments);t.each(i,function(e){if(n.widgets[e]){var i=n.widgets[e],a=n.view.$el.find('[data-widget="'+e+'"]');if(a.length){var r=a.data("debug");if(void 0!==r&&r&&!n.debug)return;a.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:a.data()});try{n.widgets[e].triggerMethod("show")}catch(t){console.error("Error when displaying widget: "+e,t.message,t.stack)}}else console.warn("Cannot insert widget: "+e+' (no selector [data-widget="'+e+'"])')}else n.debug&&console.error("Cannot show widget: "+e+"(because, frankly... there is no such widget there!)")})}else this.showAll();return this.triggerMethod("show"),this.view},hideAll:function(){return t.each(this.widgets,function(e){e.noDetach||("detach"in e&&t.isFunction(e.detach)?e.detach():e.view&&e.view.$el?e.view.$el.detach():e.$el&&e.$el.detach())}),this.view},showAll:function(){var e=this;return t.each(t.keys(e.widgets),function(n){var i=e.widgets[n],a=e.view.$el.find('[data-widget="'+n+'"]');a.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:a.data()}),e.widgets[n].triggerMethod("show")}),this.view},broadcast:function(){var e=arguments;t.each(this.widgets,function(t,n){t.trigger.apply(t,e)},this)}});return t.extend(c.prototype,o,l.BeeHive,{getPubSub:function(){return this._ps&&this.hasPubSub()?this._ps:(this._ps=this.getBeeHive().getHardenedInstance().getService("PubSub"),this._ps)}}),c}),define("hbs!js/page_managers/templates/aria-announcement",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'<a href="#main-content" id="skip-to-main-content" class="sr-only sr-only-focusable">Skip to main content</a>\n'},3:function(e,t,n,i){return'<a href="#main-content"  id="skip-to-main-content" class="sr-only sr-only-focusable">Skip to main content</a>\n'},5:function(e,t,n,i){return"    home page\n"},7:function(e,t,n,i){return"    search results page\n"},9:function(e,t,n,i){return"    article abstract page\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"SearchPage",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"DetailsPage",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'\n<div id="aria-announcement-container">\n    Now on\n'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"LandingPage",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"SearchPage",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"DetailsPage",{name:"compare",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n"},useData:!0});return t.registerPartial("js/page_managers/templates/aria-announcement",n),n}),define("hbs!js/page_managers/templates/master-page-manager",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="navbar-container">\n  <div data-widget="NavbarWidget"/>\n</div>\n\n<div id="alerts-container">\n  <div data-widget="AlertsWidget"/>\n</div>\n\n<div id="content-container">\n  <div class="dynamic-container s-dynamic-container"></div>\n</div>\n\n<div id="footer-container">\n  <div data-widget="FooterWidget"/>\n</div>\n\n<button id="backToTopBtn" title="Go to top">\n  <i class="fa fa-caret-up" aria-hidden="true"></i> Top\n</button>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/master-page-manager",n),n}),define("js/page_managers/master",["js/widgets/base/base_widget","js/components/generic_module","js/page_managers/controller","hbs!js/page_managers/templates/aria-announcement","hbs!js/page_managers/templates/master-page-manager","marionette","js/mixins/dependon"],function(e,t,n,i,a,r,s){var o=Backbone.Model.extend({defaults:function(){return{id:void 0,isSelected:!1,object:void 0,options:void 0}}}),l=Backbone.Collection.extend({model:o,selectOne:function(e){var t=null;this.each(function(n){n.id==e?t=n:n.set("isSelected",!1,{silent:!0})}),t.set("isSelected",!0)}}),c=Backbone.Model.extend({defaults:function(){return{name:void 0,numCalled:0,numAttached:0,ariaAnnouncement:void 0}}}),u=r.ItemView.extend({className:"s-master-page-manager",constructor:function(e){(e=e||{}).collection||(e.collection=new l),e.model||(e.model=new c),e.template=a,r.ItemView.prototype.constructor.call(this,e)},changeManager:function(){var e=this.collection.findWhere({isSelected:!0}),t=e.attributes.object.show.apply(e.attributes.object,e.attributes.options);this.$(".dynamic-container").children().detach(),this.$(".dynamic-container").append(t.$el),e.attributes.numAttach+=1,document.body.scrollTop=document.documentElement.scrollTop=0,$("#app-container").scrollTop(0),$(".s-search-bar-full-width-container").removeClass("s-search-bar-motion"),$(".s-quick-add").removeClass("hidden")},changeWithinManager:function(){var e=this.collection.findWhere({isSelected:!0});e.attributes.object.show.apply(e.attributes.object,e.attributes.options),e.attributes.numAttach+=1}}),d=n.extend({initialize:function(e){e=e||{},this.view=new u(e),this.collection=this.view.collection,this.model=this.view.model,n.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.ARIA_ANNOUNCEMENT,this.handleAriaAnnouncement)},assemble:function(e){this.setApp(e),n.prototype.assemble.call(this,e)},show:function(e,t){var n=this.getApp();this.collection.find({id:e})||this.collection.add({id:e});var i,a=this.collection.find({id:e});a.get("object")?i=a.get("object"):(i=n._getWidget(e),a.set("object",i)),i||console.error("unable to find page manager: "+e),i.assemble?i.assemble(n):console.error("eeeek, "+e+" has no assemble() method!"),a.get("isSelected")?(a.set({options:t,object:i}),this.view.changeWithinManager()):(a.set({options:t,object:i}),this.collection.selectOne(e),this.view.changeManager());var r=this.currentChild;if(this.currentChild=e,r&&r!=e){var s=this.collection.find({id:r});s&&s.get("object")&&(s.set("numDetach",s.get("numDetach")+1),s.get("object").disAssemble(n))}this.getPubSub().publish(this.getPubSub().ARIA_ANNOUNCEMENT,e);var o=$("#backToTopBtn"),l=$("#app-container");l.scroll(function(){l.scrollTop()>100?o.css("display","block"):o.css("display","none")}),o.click(function(){l.scrollTop(0)})},getCurrentActiveChild:function(){return this.collection.get(this.currentChild).get("object")},disAssemble:function(){_.each(this.collection.models,function(e){if(e.attributes.isSelected){var t=e.get("object");if(t.disAssemble)t.disAssemble(this.getApp());else{if(!t.destroy)throw new Error("Contract breach, no way to get ridd of the widget/page manager");t.destroy()}}e.set({isSelected:!1,object:null}),this.assembled=!1},this)},handleAriaAnnouncement:function(e){$("a#skip-to-main-content").remove(),$("div#aria-announcement-container").remove(),$("#app-container").before(i({page:e}))}});return _.extend(d.prototype,s.App),d}),define("js/components/app_storage",["backbone","underscore","js/components/api_query","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i,a){var r=e.Model.extend({activate:function(e){this.setBeeHive(e),t.bindAll(this,"onPaperSelection","onBulkPaperSelection");var n=this.getPubSub();n.subscribe(n.PAPER_SELECTION,this.onPaperSelection),n.subscribe(n.BULK_PAPER_SELECTION,this.onBulkPaperSelection)},initialize:function(){this.on("change:selectedPapers",function(e){if(this._updateNumSelected(),this.hasPubSub())var t=this.getPubSub();t.publish(t.STORAGE_PAPER_UPDATE,this.getNumSelectedPapers())})},setCurrentQuery:function(e){if(e||(e=new n),!(e instanceof n))throw new Error("You must save ApiQuery instance");this.set("currentQuery",e),this.getBeeHive().hasService("PersistentStorage")&&this.getBeeHive().getService("PersistentStorage").set("currentQuery",e.toJSON())},setCurrentNumFound:function(e){this.set("numFound",e)},getCurrentQuery:function(){return this.get("currentQuery")},hasCurrentQuery:function(){return this.has("currentQuery")},hasSelectedPapers:function(){return!!t.keys(this.get("selectedPapers")).length},getSelectedPapers:function(){return t.keys(this.get("selectedPapers")||{})},clearSelectedPapers:function(){this.set("selectedPapers",{})},addSelectedPapers:function(e){var n=t.clone(this.get("selectedPapers")||{}),i=!1;t.isArray(e)?t.each(e,function(e){n[e]||(n[e]=!0,i=!0)}):n[e]||(n[e]=!0,i=!0),i&&this.set("selectedPapers",n)},isPaperSelected:function(e){if(t.isArray(e))throw new Error("Identifier must be a string or a number");return!!(this.get("selectedPapers")||{})[e]},removeSelectedPapers:function(e){var n=t.clone(this.get("selectedPapers")||{});t.isArray(e)?t.each(e,function(e){delete n[e]}):e?delete n[e]:n={},this.set("selectedPapers",n)},getNumSelectedPapers:function(){return this._numSelectedPapers||0},_updateNumSelected:function(){this._numSelectedPapers=t.keys(this.get("selectedPapers")||{}).length},onPaperSelection:function(e){this.isPaperSelected(e)?this.removeSelectedPapers(e):this.addSelectedPapers(e)},onBulkPaperSelection:function(e,t){"remove"!=t?this.addSelectedPapers(e):this.removeSelectedPapers(e)},setConfig:function(e){this.set("dynamicConfig",e)},getConfigCopy:function(){return JSON.parse(JSON.stringify(this.get("dynamicConfig")))},hardenedInterface:{getNumSelectedPapers:"getNumSelectedPapers",isPaperSelected:"isPaperSelected",hasSelectedPapers:"hasSelectedPapers",getSelectedPapers:"getSelectedPapers",clearSelectedPapers:"clearSelectedPapers",getCurrentQuery:"getCurrentQuery",hasCurrentQuery:"hasCurrentQuery",getConfigCopy:"get read-only copy of dynamic config",set:"set a value into app storage",get:"get a val from app storage"}});return t.extend(r.prototype,i,a.BeeHive),r}),define("js/components/recaptcha_manager",["backbone","js/components/generic_module","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i){var a=$.Deferred();onRecaptchaLoad=function(){a.resolve()};var r=t.extend({initialize:function(){this.grecaptchaDeferred=a,this.siteKeyDeferred=$.Deferred(),this.when=$.when(this.siteKeyDeferred,this.grecaptchaDeferred)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["getRecaptchaKey"]),t.subscribe(t.APP_STARTED,this.getRecaptchaKey)},getRecaptchaKey:function(){var e=this.getBeeHive().getObject("AppStorage").getConfigCopy().recaptchaKey;this.siteKeyDeferred.resolve(e)},activateRecaptcha:function(e){this.when.done(_.partial(this.renderRecaptcha,e))},renderRecaptcha:function(e,t,n){grecaptcha.render(e.$(".g-recaptcha")[0],{sitekey:t,callback:function(t){e.model&&e.model.set("g-recaptcha-response",t)}})},hardenedInterface:{activateRecaptcha:"activateRecaptcha"}});return _.extend(r.prototype,n,i.BeeHive),r}),define("js/components/csrf_manager",["backbone","js/components/generic_module","js/mixins/hardened","js/components/api_request","js/components/api_targets","js/mixins/dependon"],function(e,t,n,i,a,r){var s=t.extend({activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["resolvePromiseWithNewKey"]),t.subscribe(t.DELIVERING_RESPONSE,this.resolvePromiseWithNewKey)},getCSRF:function(){this.deferred=$.Deferred();var e=new i({target:a.CSRF}),t=this.getPubSub();return t.publish(t.EXECUTE_REQUEST,e),this.deferred.promise()},resolvePromiseWithNewKey:function(e){var t=e.toJSON().csrf;this.deferred.resolve(t)},hardenedInterface:{getCSRF:"getCSRF"}});return _.extend(s.prototype,n,r.BeeHive),s}),define("js/components/library_controller",["backbone","js/components/generic_module","js/mixins/hardened","js/components/api_targets","js/components/api_request","js/components/api_feedback","js/components/api_query","js/mixins/dependon"],function(e,t,n,i,a,r,s,o){var l=e.Model.extend({defaults:function(){return{num_documents:0,date_last_modified:void 0,permission:void 0,description:"",public:!1,num_users:1,owner:void 0,date_created:void 0,id:void 0,title:""}}}),c=e.Collection.extend({model:l}),u=t.extend({initialize:function(){this.collection=new c},activate:function(t){this.setBeeHive(t.getHardenedInstance());var n=this.getBeeHive().getService("PubSub");n.subscribe(n.INVITING_REQUEST,_.bind(this.updateCurrentQuery,this)),n.subscribe(n.USER_ANNOUNCEMENT,_.bind(this.handleUserAnnouncement,this)),_.each(["change","add","reset","remove"],function(t){this.listenTo(this.collection,t,function(i,a){"change"==t&&i instanceof e.Model?(n.publish(n.LIBRARY_CHANGE,this.collection.toJSON(),{ev:t,id:i.id}),delete this._libraryBibcodeCache[i.id]):n.publish(n.LIBRARY_CHANGE,this.collection.toJSON(),{ev:t})})},this)},handleUserAnnouncement:function(e){"user_signed_in"==e?this._fetchAllMetadata():"user_signed_out"==e&&this.collection.reset({})},updateCurrentQuery:function(e){this._currentQuery=e},composeRequest:function(e,t,n){var i,r=(n=n||{}).data||void 0,s=$.Deferred();return i=new a({target:e,options:{context:this,type:t,data:JSON.stringify(r),contentType:"application/json",done:function(){var e=[_.extend(arguments[0],n.extraArguments),[].slice(arguments,1)];s.resolve.apply(void 0,e)},fail:function(){s.reject.apply(void 0,arguments)}}}),this.getBeeHive().getService("Api").request(i),s},_executeApiRequest:function(e){var t=new a({target:i.SEARCH,query:e}),n=$.Deferred(),r=this.getPubSub();return r.subscribeOnce(r.DELIVERING_RESPONSE,_.bind(function(e){n.resolve(e)}),this),r.publish(r.EXECUTE_REQUEST,t),n},_getBibcodes:function(e){var t=$.Deferred(),n=this;if("all"==e.bibcodes){var i=e.limit||2e3,a=0,r=100,s=[],o=this._currentQuery.clone();o.unlock(),o.set("rows",100),o.set("fl","bibcode"),function e(){o.set("start",a),this._executeApiRequest(o).done(function(o){var l=_.map(o.get("response.docs"),function(e){return e.bibcode});[].push.apply(s,l),(a+=r)<i?e.call(n):t.resolve(s)})}.call(this)}else if("selected"==e.bibcodes){var l=this.getBeeHive().getObject("AppStorage").getSelectedPapers();t.resolve(l)}else{if(!_.isArray(e.bibcodes))throw new Error("should we add all bibcodes or only selected ones?");t.resolve(e.bibcodes)}return t.promise()},_fetchAllMetadata:function(){var e=this,t=i.LIBRARIES;return this.composeRequest(t,"GET").done(function(t){e._metadataLoaded=!0,e.collection.reset(t.libraries)})},getLibraryMetadata:function(e){if(e&&!this.collection.get(e))return this.fetchLibraryMetadata(e);var t=$.Deferred(),n=this;if(this._metadataLoaded){var i=e?n.collection.get(e).toJSON():n.collection.toJSON();t.resolve(i)}else this._fetchAllMetadata().done(function(i){setTimeout(function(){var i=e?n.collection.get(e).toJSON():n.collection.toJSON();t.resolve(i)},1)});return t.promise()},fetchLibraryMetadata:function(e){var t=this;if(!e)throw new Error("need to provide a library id");var n=$.Deferred();return this.composeRequest(i.LIBRARIES+"/"+e).done(function(e){n.resolve(e.metadata),t.collection.add(e.metadata,{merge:!0})}).fail(function(){t.getPubSub().publish(t.getPubSub().NAVIGATE,"404")}),n.promise()},_libraryBibcodeCache:{},getLibraryBibcodes:function(e){var t=$.Deferred(),n=this,r=1e4;if(this._libraryBibcodeCache[e])return t.resolve(this._libraryBibcodeCache[e]),t.promise();var o=r,l=0,c=100,u=[],d=i.LIBRARIES+"/"+e;n=this;function h(i){o=i.solr.response.numFound>r?r:i.solr.response.numFound;var a=_.pluck(i.solr.response.docs,"bibcode");[].push.apply(u,a),(l+=c)<o?p():(n._libraryBibcodeCache[e]=u,t.resolve(u))}function p(){var e=new s;e.set("rows",100),e.set("fl","bibcode"),e.set("start",l);var t=new a({target:d,query:e,options:{context:this,contentType:"application/x-www-form-urlencoded",done:h,fail:this.handleError}});n.getBeeHive().getService("Api").request(t)}return p.call(this),t.promise()},createLibrary:function(e){var t=this,n=i.LIBRARIES;return this.composeRequest(n,"POST",{data:e}).done(function(e){t._fetchAllMetadata()})},deleteLibrary:function(e,t){var n=this,a=i.DOCUMENTS+"/"+e;return this.composeRequest(a,"DELETE").done(function(){n.collection.remove(e),n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").NAVIGATE,"AllLibrariesWidget","libraries");var i="Library <b>"+t+"</b> was successfully deleted";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new r({code:0,msg:i,type:"success"}))}).fail(function(e){var i=JSON.parse(e.responseText).error,a="Library <b>"+t+"</b> could not be deleted : ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new r({code:0,msg:a,type:"danger"}))})},updateLibraryContents:function(e,t){var n=this,a={data:t,extraArguments:{numBibcodesRequested:t.bibcode.length}},s=i.DOCUMENTS+"/"+e;return this.composeRequest(s,"POST",a).done(function(){n.fetchLibraryMetadata(e)}).fail(function(t){var i=JSON.parse(t.responseText).error,a="Library <b>"+n.collection.get(e).title+"</b> could not be updated: ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new r({code:0,msg:a,type:"danger"}))})},updateLibraryMetadata:function(e,t){var n=this,a=i.DOCUMENTS+"/"+e;return this.composeRequest(a,"PUT",{data:t}).done(function(t){n.collection.get(e).set(t)}).fail(function(t){var i=JSON.parse(t.responseText).error,a="Library <b>"+n.collection.get(e).get("name")+"</b> could not be updated: ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new r({code:0,msg:a,type:"danger"}))})},addBibcodesToLib:function(e){var t=this;return this._getBibcodes(e).then(function(n){return t.updateLibraryContents(e.library,{bibcode:n,action:"add"}).fail(function(){var n="Library <b>"+t.collection.get(e.library).title+"</b> could not be updated";t.getBeeHive().getService("PubSub").publish(t.getBeeHive().getService("PubSub").ALERT,new r({code:0,msg:n,type:"danger"}))})})},createLibAndAddBibcodes:function(e){var t=this;return this._getBibcodes(e).then(function(n){if(!n)throw new Error("Solr returned no bibcodes, can't put them in the new library");return e.bibcode=n,t.createLibrary(e).fail(function(){var e="Library <b>"+name+"</b> could not be created";t.getBeeHive().getService("PubSub").publish(t.getBeeHive().getService("PubSub").ALERT,new r({code:0,msg:e,type:"danger"}))})})},importLibraries:function(e){var t,n=$.Deferred(),r=this;if("classic"===e)t=i.LIBRARY_IMPORT_CLASSIC_TO_BBB;else{if("twopointoh"!==e)return void console.error("didn't recognize library endpoint! should be one of 'classic' or 'twopointoh' ");t=i.LIBRARY_IMPORT_ADS2_TO_BBB}return this.getBeeHive().getService("Api").request(new a({target:t,options:{done:function(e){n.resolve.apply(void 0,[].slice.apply(arguments)),r._fetchAllMetadata()},fail:function(e){n.reject.apply(void 0,[].slice.apply(arguments))}}})),n.promise()},hardenedInterface:{getLibraryMetadata:"returns json list of libraries, optional lib id as param",createLibrary:"createLibrary",createLibAndAddBibcodes:"createLibAndAddBibcodes",addBibcodesToLib:"addBibcodesToLib",deleteLibrary:"deleteLibrary",updateLibraryContents:"updateLibraryContents",updateLibraryMetadata:"updateLibraryMetadata",importLibraries:"importLibraries",getLibraryBibcodes:"getLibraryBibcodes"}});return _.extend(u.prototype,n,o.BeeHive),u}),define("js/components/doc_stash_controller",["backbone","js/components/generic_module","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i){var a=t.extend({_docs:[],activate:function(e){this.setBeeHive(e.getHardenedInstance());var t=this.getBeeHive().getService("PubSub");t.subscribe(t.START_SEARCH,_.bind(this.emptyStash,this))},stashDocs:function(e){this._docs.push.apply(this._docs,e)},getDocs:function(){return _.cloneDeep(this._docs)},emptyStash:function(){this.docs=[]},hardenedInterface:{stashDocs:"stash docs",getDocs:"getDocs"}});return _.extend(a.prototype,n,i.BeeHive),a}),define("babel",{}),define("es6",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("es6!js/widgets/facet/toggle_list.jsx",["react","underscore","d3","react-prop-types","create-react-class"],function(e,t,n,i,a){var r=a({displayName:"FacetCheckbox",format:function(e){return n.format("s")(e).replace(/\.\d{2,}/,function(e){return e.slice(0,2)}).replace(".0","")},updateFacetSelect:function(e){e.target.checked?(this.props.selectFacet(this.props.id),this.props.reduxState&&2===this.props.reduxState.config.hierMaxLevels&&this.props.toggleFacet(this.props.id,!0)):this.props.unselectFacet(this.props.id)},render:function(){var t=e.createElement("label",{className:"facet-label"},e.createElement("input",{type:"checkbox",onChange:this.updateFacetSelect,checked:this.props.isChecked})," ",e.createElement("span",null,e.createElement("span",{className:"facet-label__title"},this.props.name),e.createElement("span",{className:"facet-label__amount",title:this.props.count},this.format(this.props.count))));return this.props.hierarchical?e.createElement(s,{id:this.props.value,reduxState:this.props.reduxState,currentLevel:this.props.currentLevel+1,showMoreFacets:this.props.showMoreFacets,resetVisibleFacets:this.props.resetVisibleFacets,toggleFacet:this.props.toggleFacet,selectFacet:this.props.selectFacet,unselectFacet:this.props.unselectFacet},t):t},propTypes:{isChecked:i.bool.isRequired,name:i.string.isRequired,count:i.number.isRequired,reduxState:i.object,currentLevel:i.number,showMoreFacets:i.func,resetVisibleFacets:i.func,toggleFacet:i.func,selectFacet:i.func,unselectFacet:i.func}}),s=a({displayName:"ToggleList",render:function(){var n=1===this.props.currentLevel?this.props.reduxState:this.props.reduxState.facets[this.props.id],i=n.state.open,a=n.state.visible,s=n.pagination.finished||!1,o=t.values(t.pick(this.props.reduxState.facets,n.children)),l="";if("loading"===n.pagination.state?l=e.createElement("span",null,"loading..."):"failure"===n.pagination.state?l=e.createElement("span",null,e.createElement("i",{className:"icon-danger"}),"request failed"):"success"!==n.pagination.state||o.length||(l=e.createElement("span",null,"no data retrieved")),o.length)c=o.slice(0,a).map(function(n){var i={isChecked:this.props.reduxState.state.selected.indexOf(n.value)>-1,name:n.name,count:n.count,hierarchical:this.props.reduxState.config.hierMaxLevels>this.props.currentLevel,value:n.value,id:n.value,selectFacet:this.props.selectFacet,unselectFacet:this.props.unselectFacet};return i.hierarchical&&t.extend(i,t.pick(this.props,["showMoreFacets","resetVisibleFacets","toggleFacet","reduxState","currentLevel"])),e.createElement("li",{key:n.value},e.createElement(r,i))},this);else var c=e.createElement("li",null);var u,d=!s||o.length>a?"btn btn-default btn-xs facet__pagination-button":" hidden",h=a>5?"btn btn-default btn-xs facet__pagination-button":"hidden",p=this.props.currentLevel>1?"facet__list-container facet__list-container--child":"facet__list-container";return i&&(u=e.createElement("div",{className:p},e.createElement("ul",{className:"facet__list"},c),e.createElement("div",{className:"facet__state-message"},l),e.createElement("div",{className:"facet__pagination-container"},e.createElement("button",{className:h,onClick:t.partial(this.props.resetVisibleFacets,this.props.id)},"less"),e.createElement("button",{className:d,onClick:t.partial(this.props.showMoreFacets,this.props.id)},"more")))),e.createElement("div",null,e.createElement("div",{className:"facet__toggle"},e.createElement("i",{className:i?"facet__icon facet__icon--open":"facet__icon facet__icon--closed",onClick:t.partial(this.props.toggleFacet,this.props.id,!i)})," ",this.props.children),u)},propTypes:{reduxState:i.object.isRequired,currentLevel:i.number.isRequired,showMoreFacets:i.func.isRequired,resetVisibleFacets:i.func.isRequired,toggleFacet:i.func.isRequired,selectFacet:i.func.isRequired,unselectFacet:i.func.isRequired}});return s}),define("js/widgets/facet/reducers",["underscore"],function(e){function t(e,n){switch(e||(e=t.getDefaultState()),n.type){case"DATA_REQUESTED":return t.dataRequested(e,n.id);case"DATA_RECEIVED":return t.dataReceived(e,n.data,n.id);case"INCREASE_VISIBLE":return t.increaseVisible(e,n.num,n.id);case"RESET_VISIBLE":return t.resetVisible(e,n.id);case"FACET_SELECTED":return t.facetSelected(e,n.id);case"FACET_UNSELECTED":return t.facetUnselected(e,n.id);case"FACET_TOGGLED":return t.facetToggled(e,n.open,n.id);case"SUBMIT_FILTER":return t.submitFilter(e,n.logicOption);case"RESET_STATE":return t.getDefaultState(e);default:return e}}function n(e){var t=e.split("/");if(t.length>2){var n=t[t.length-2];return n=parseInt(e[0])-1+"/"+n}}function i(t,n,i,a){if(a=a||"state",!n){var r=e.assign({},t);return r[a]=e.assign({},t[a],i),r}var s={};return s[n]=e.assign({},t.facets[n]),s[n][a]=e.assign({},t.facets[n][a],i),e.assign({},t,{facets:e.assign({},t.facets,s)})}return t.getActiveFacets=function(e,t){return t.map(function(e){return!(t.indexOf(n(e))>-1)&&e}).filter(function(e){if(e)return e})},t.facetSelected=function(t,n){var i=t.facets[n].state.visible,a=e.unique(t.state.selected.concat(t.facets[n].children.slice(0,i).concat([n]))),r=e.filter(e.pairs(t.facets),function(e){return e[1].children.indexOf(n)>-1});if(r.length){r=r[0][0];var s=t.facets[r],o=s.children.slice(0,s.state.visible);e.intersection(a,o).length===o.length&&(a=a.concat([r]))}return e.assign({},t,{state:e.assign({},t.state,{selected:a})})},t.facetUnselected=function(t,i){var a=e.without(t.state.selected,i),r=n(i);return r&&(a=e.without(a,r)),a=e.without.apply(void 0,[a].concat(t.facets[i].children)),e.assign({},t,{state:e.assign({},t.state,{selected:a})})},t.resetVisible=function(e,t){return i(e,t,{visible:5})},t.increaseVisible=function(e,t,n){return i(e,n,n?{visible:e.facets[n].state.visible+t}:{visible:e.state.visible+t})},t.facetToggled=function(e,t,n){return i(e,n,{open:t})},t.dataRequested=function(t,n){if(n)a=e.assign({},t.facets[n].pagination,{state:"loading"});else var a=e.assign({},t.pagination,{state:"loading"});return i(t,n,a,"pagination")},t.processData=function(n,i){i=i||[],e.isFunction(i)&&(i=[i]);n=n.map(function(i,a){if(a%2==0)return{name:i.split("/")[i.split("/").length-1],value:i,count:n[a+1],pagination:e.assign({},e.cloneDeep(t.defaultState.pagination)),children:[],state:e.assign({},e.cloneDeep(t.defaultState.state))}}).filter(function(e){if(e)return e});return e.compose.apply(e,i)(n)},t.dataReceived=function(n,i,a){var r=i.facet_counts.facet_fields[Object.keys(i.facet_counts.facet_fields)[0]],s=r.length/2!=parseInt(i.responseHeader.params["facet.limit"]),o=(r=t.processData(r,n.config.preprocessors)).map(function(e){return e.value});if(r=e.object(o,r),!a)return e.assign({},n,{pagination:e.assign({},n.pagination,{state:"success",finished:s}),facets:e.assign({},n.facets,r),children:n.children.concat(o)});var l=e.assign({},n.facets[a],{children:n.facets[a].children.concat(o),pagination:e.assign({},n.facets[a].pagination,{state:"success",finished:s})}),c=e.assign({},n.facets,r);if(c[a]=l,n.state.selected.indexOf(a)>-1)var u=e.uniq(n.state.selected.concat(o.slice(0,n.facets[a].state.visible)));else u=n.state.selected;return e.assign({},n,{facets:c,state:e.assign({},n.state,{selected:u})})},t.submitFilter=function(e){throw new Error("this should be overridden by the widget")},t.defaultState={config:{preprocessors:[],hierMaxLevels:1,facetField:void 0,openByDefault:!1},state:{open:!1,visible:5,selected:[]},pagination:{state:void 0,finished:!1},children:[],facets:{}},t.getDefaultState=function(t){return e.assign({},this.defaultState,{config:t.config})},t}),define("es6!js/widgets/facet/facet-container.jsx",["react","react-redux","underscore","es6!./toggle_list.jsx","./reducers","create-react-class"],function(e,t,n,i,a,r){var s=r({displayName:"ContainerComponent",createDropdown:function(){return 0===this.props.activeFacets.length?"":this.props.activeFacets.length>25?e.createElement("div",{className:"facet__dropdown"},"select no more than 25 facets at a time"):"invalid choice"==(t=1===this.props.activeFacets.length?this.props.reduxState.config.logicOptions.single:this.props.reduxState.config.logicOptions.multiple)[0]?e.createElement("div",{className:"facet__dropdown"},"invalid choice!"):e.createElement("div",{className:"facet__dropdown"},e.createElement("div",{className:"facet__dropdown__title"},e.createElement("b",null,this.props.activeFacets.length)," selected"),t.map(function(t){return e.createElement("label",{key:t},e.createElement("input",{type:"radio",onChange:n.partial(this.props.submitFilter,t)})," ",t)},this));var t},render:function(){var t=e.createElement("h3",{className:"facet__header",onClick:n.partial(this.props.toggleFacet,void 0)},this.props.reduxState.config.facetTitle);return e.createElement("div",{className:"facet__container"},e.createElement(e.addons.CSSTransitionGroup,{transitionName:"swoop",transitionEnterTimeout:300,transitionLeaveTimeout:300},this.createDropdown()),e.createElement(i,{reduxState:this.props.reduxState,currentLevel:1,showMoreFacets:this.props.showMoreFacets,resetVisibleFacets:this.props.resetVisibleFacets,toggleFacet:this.props.toggleFacet,selectFacet:this.props.selectFacet,unselectFacet:this.props.unselectFacet},t))}});return t.connect(function(e,t){return{reduxState:e,activeFacets:a.getActiveFacets(e,e.state.selected)}},function(e,t){return{selectFacet:function(n){e(t.actions.select_facet(n))},unselectFacet:function(n){e(t.actions.unselect_facet(n))},toggleFacet:function(n,i){e(t.actions.toggle_facet(n,i))},showMoreFacets:function(n){e(t.actions.increase_visible(n))},resetVisibleFacets:function(n){e(t.actions.reset_visible(n))},submitFilter:function(n){e(t.actions.submit_filter(n))}}})(s)}),define("js/widgets/facet/actions",["underscore"],function(e){var t={data_requested:function(e){return{type:"DATA_REQUESTED",id:e}},reset_visible:function(e){return{type:"RESET_VISIBLE",id:e}},increase_visible:function(e){return function(n,i){(e?i().facets[e].children.length:i().children.length)-((e?i().facets[e].state.visible:i().state.visible)+5)<=5&&n(this.fetch_data(e)),n({type:"INCREASE_VISIBLE",id:e,num:5}),i().state.selected.indexOf(e)>-1&&n(t.select_facet(e))}.bind(this)},data_received:function(e,t){return{type:"DATA_RECEIVED",data:e,id:t}},toggle_facet:function(t,n){return function(i,a){var r=t?a().facets[t].state.open:a().state.open;n=e.isBoolean(n)?n:!r;var s=t?a().facets[t].children.length:a().children.length;n&&!s&&i(this.fetch_data(t)),i({type:"FACET_TOGGLED",open:n,id:t})}.bind(this)},fetch_data:function(e,t){throw new Error("this was supposed to be overridden!")},select_facet:function(e){return{type:"FACET_SELECTED",id:e}},unselect_facet:function(e){return{type:"FACET_UNSELECTED",id:e}},submit_filter:function(e){throw new Error("this was supposed to be overridden!")},reset_state:function(){return{type:"RESET_STATE"}}};return function(){return Object.create(t)}}),define("js/widgets/facet/create_store",["underscore","redux","redux-thunk","js/widgets/facet/reducers"],function(e,t,n,i){return function(a){a={config:e.assign({},i.defaultState.config,a)};var r=e.assign({},e.cloneDeep(i.defaultState),a);return t.createStore(i,r,t.applyMiddleware(n.default))}}),define("js/widgets/facet/widget",["backbone","js/components/api_query","js/components/api_request","js/widgets/base/base_widget","js/components/api_query_updater","analytics","react","react-dom","react-redux","es6!./facet-container.jsx","./actions","./reducers","./create_store"],function(e,t,n,i,a,r,s,o,l,c,u,d,h){var p=e.View.extend({render:function(e,t){return o.render(s.createElement(l.Provider,{store:e},s.createElement(c,{actions:t})),this.el),this},destroy:function(){o.unmountComponentAtNode(this.el)}});return i.extend({initialize:function(e){e=e||{};var t=_.pick(e,["facetTitle","facetField","preprocessors","hierMaxLevels","logicOptions","openByDefault"]);this.defaultQueryArguments=_.extend({},this.defaultQueryArguments,e.defaultQueryArguments,{"facet.field":e.facetField}),this.store=h(t),this.actions=u(),this.queryUpdater=new a(t.facetField),this.actions.fetch_data=function(e){return this._dispatchRequest.bind(this,e)}.bind(this),this.actions.submit_filter=function(e){return this.submitFilter.bind(this,e)}.bind(this),this.view=new p,this.view.render=_.partial(this.view.render,this.store,this.actions),e.debug||(this._dispatchRequest=_.debounce(_.bind(this._dispatchRequest,this),300))},defaultQueryArguments:{facet:"true","facet.mincount":"1","facet.limit":20,fl:"id"},activate:function(e){this.setBeeHive(e),_.bindAll(this,"dispatchRequest","processResponse"),this.getPubSub().subscribe(this.getPubSub().INVITING_REQUEST,this.dispatchRequest),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback),window.store?window.store.push(this.store):window.store=[this.store]},onApiFeedback:function(){var e=this.store.dispatch;setTimeout(function(){e({type:"FACET_TOGGLED",open:!1})},300)},dispatchRequest:function(e){this.setCurrentQuery(e),this.store.dispatch(this.actions.reset_state()),this.store.getState().config.openByDefault&&this.store.dispatch(this.actions.toggle_facet(void 0,!0))},_dispatchRequest:function(e){var t=this.getPubSub(),n=this;this.store.dispatch(this.actions.data_requested(e)),t.subscribeOnce(t.DELIVERING_RESPONSE,function(t){n.store.dispatch(n.actions.data_received(t.toJSON(),e))});var i=this.customizeQuery(this.getCurrentQuery()),a=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;i.set("facet.offset",a),i.set("rows",1),e&&i.set("facet.prefix",e.replace("0/","1/"));var r=this.composeRequest(i);t.publish(t.DELIVERING_REQUEST,r)},submitFilter:function(e){if(-1===["and","or","limit to","expand","exclude"].indexOf(e))throw new Error("we don't recognize this operator you're trying to filter on");var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n.replace("_facet_hier",""),a=d.getActiveFacets(this.store.getState(),this.store.getState().state.selected).map(function(e){return n+':"'+e+'"'});"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",a,{prefix:"filter_"}):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",a,{prefix:"filter_"}):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",a,{prefix:"filter_"}):(a.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",a,{prefix:"filter_"}))),_.forEach(t.toJSON(),function(e,n){/^filter_/.test(n)&&e.length>3&&(t.unset(n),t.set("__"+n,e))});var s="{!type=aqp v=$"+i+"}",o=t.get("fq")||[];o.push(s),t.set("fq",_.unique(o)),t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),r("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:a}))}})}),define("js/widgets/facet/graph-facet/widget",["underscore","js/components/api_query","js/components/api_request","js/widgets/base/base_widget","js/components/api_query_updater"],function(e,t,n,i,a){return i.extend({initialize:function(t){t=t||{},this.processResponse=t.processResponse,this.model=new Backbone.Model,this.view=new t.graphView(e.extend(t.graphViewOptions,{model:this.model})),this.isActive=!1,this.isDone=!1,this.listenTo(this.view,"all",this.onAllInternalEvents),this.facetField=t.facetField,this.queryUpdater=new a(this.facetField),i.prototype.initialize.apply(this,arguments),this.listenTo(this.view,"facet-applied",this.handleConditionApplied),this.on("active",this.onActive),this.on("hidden",this.onHidden),this.dispatchRequest=e.debounce(e.bind(this.dispatchRequest,this),300)},activate:function(t){var n=this;this.setBeeHive(t),e.bindAll(this,"dispatchRequest","processResponse");var i=this.getPubSub();i.subscribe(i.INVITING_REQUEST,function(e){n.isDone=!1,n.setCurrentQuery.call(n,e),n.dispatchRequest.call(n,e)}),i.subscribe(i.DELIVERING_RESPONSE,this.processResponse),this.activateWidget(),this.attachGeneralHandler(this.onFeedback)},dispatchRequest:function(e){if(this.isActive&&!this.isDone&&e.has("q")){this.model.unset("graphData"),this.model.unset("statsCount");var t=this.customizeQuery(e),n=this.composeRequest(t),i=this.getPubSub();i.publish(i.DELIVERING_REQUEST,n),this.isDone=!0}},handleConditionApplied:function(e){var t=this.getCurrentQuery();e=this.facetField+":"+e,t=t.clone();this.queryUpdater.updateQuery(t,"q","limit",e),this.dispatchNewQuery(t)},onActive:function(){!this.isActive&&this.isDone&&this.model.get("error")&&(this.isDone=!1,this.model.set("error",!1)),this.isActive=!0,this.dispatchRequest(this.getCurrentQuery())},onHidden:function(){this.isActive=!1},onFeedback:function(e){this.model.set("error",!0)}})}),define("js/widgets/facet/factory",["js/widgets/facet/widget","js/widgets/facet/graph-facet/widget"],function(e,t){return{makeBasicCheckboxFacet:function(t){var n={facetTitle:t.facetTitle,displayNum:5,maxDisplayNum:100,facetField:t.facetField,openByDefault:!1,showOptions:!0,hierMaxLevels:1};return new e(_.extend(n,t))},makeHierarchicalCheckboxFacet:function(e){return e.hierMaxLevels=2,e.defaultQueryArguments=e.defaultQueryArguments||{},e.defaultQueryArguments["facet.prefix"]="0/",this.makeBasicCheckboxFacet.apply(this,arguments)},makeGraphFacet:function(e){return e=_.extend({openByDefault:!0},e),new t(e)}}}),define("js/page_managers/toc_widget",["backbone","marionette"],function(e,t){var n=e.Model.extend({defaults:function(){var e;return(e={id:void 0,path:void 0,title:void 0,showCount:!1,category:void 0,isActive:!1,isSelected:!1,numFound:0}).showCount=!0,e.alwaysThere=!1,e}}),i=e.Collection.extend({model:n,selectOne:function(e){var t=null;this.each(function(n){n.id==e?t=n:n.set("isSelected",!1,{silent:!0})}),t.set("isSelected",!0)},comparator:function(e){return e.get("order")}}),a=e.Model.extend({defaults:function(){return{bibcode:void 0,query:void 0}}});return t.ItemView.extend({initialize:function(e){e=e||{},this.collection=e.collection||new i,this.model=e.model||new a,this.on("page-manager-message",this.onPageManagerMessage),e.template||(this.template=function(){return""})},noDetach:!0,serializeData:function(){var e,t=this.model.toJSON(),n=this.collection.toJSON();return _.find(n,function(e){return void 0!==e.category})?(e=_.groupBy(this.collection.toJSON(),function(e){return e.category}),t=_.extend(t,e)):t=_.extend(t,{tabs:n}),t},events:{"click a":"navigateToPage"},navigateToPage:function(e){var t=$(e.currentTarget),n=t.attr("data-widget-id"),i={idAttribute:n};if(t.find("div").hasClass("s-nav-inactive"))return!1;if(n!==this.$(".s-nav-selected").attr("data-widget-id")){i.href=t.attr("href");var a=n.indexOf("__")>-1?n.split("__"):void 0;a&&(i.idAttribute=a[0],i.subView=a[1]),this.trigger("page-manager-event","widget-selected",i),this.$el.parent(".nav-container").removeClass("show"),$("button.toggle-menu").html(' <i class="fa fa-bars"></i> Show Menu')}return!1},modelEvents:{"change:bibcode":"resetActiveStates",change:"render"},collectionEvents:{add:"render","change:isActive":"render","change:isSelected":"render","change:numFound":"render"},resetActiveStates:function(){this.collection.each(function(e){e.get("alwaysThere")?e.set("isActive",!0):(e.set("isActive",!1),e.set("numFound",0))})},onPageManagerMessage:function(e,n){if("new-widget"==e){var i=arguments[1],a=t.getOption(this,"navConfig"),r=a[i];if(r){var s=_.extend(_.clone(r),{id:i});this.collection.add(s)}else{var o=_.pick(a,function(e,t){return t.split("__")&&t.split("__")[0]==i});_.each(o,function(e,t){var n=_.extend(_.clone(e),{id:t});this.collection.add(n)},this)}}else if("widget-ready"==e){var l=this.collection.get(n.widgetId);_.defaults(n,{isActive:!!n.numFound}),l&&l.set(_.pick(n,l.keys()))}else"broadcast-payload"===e&&this.model.set("bibcode",n.bibcode)}})}),define("js/page_managers/toc_controller",["underscore","marionette","./controller","./toc_widget","analytics"],function(e,t,n,i,a){return n.extend({createView:function(t){return this.pageConfig?new this.pageConfig.view(e.extend(t,{template:this.pageConfig.template})):n.prototype.createView.call(this,t)},assemble:function(a){if(!this.navConfig)throw new Error("TOC widget is being assembled without navigation configuration (navConfig)");if(!this.assembled){n.prototype.assemble.apply(this,arguments);var r=t.getOption(this,"TOCTemplate");this.TOCEvents?this.widgets.tocWidget=new i({template:r,events:t.getOption(this,"TOCEvents"),navConfig:t.getOption(this,"navConfig")}):this.widgets.tocWidget=new i({template:r,navConfig:t.getOption(this,"navConfig")}),this.view.$(".nav-container").append(this.widgets.tocWidget.render().el),e.each(e.keys(this.widgets),function(t){this.listenTo(this.widgets[t],"page-manager-event",e.bind(this.onPageManagerEvent,this,this.widgets[t])),this.broadcast("page-manager-message","new-widget",t)},this)}},onPageManagerEvent:function(t,n,i){i=i||{};var r=null,s=null;if(t&&e.each(e.pairs(this.widgets),function(e){e[1]===t&&(s=e[0],r=e[1])}),"widget-ready"==n&&null!==r)i.widgetId=s,this.broadcast("page-manager-message",n,i);else if("widget-selected"==n){this.getPubSub().publish(this.getPubSub().NAVIGATE,i.idAttribute,i);var o=t.model.get("bibcode"),l=i.idAttribute.toLowerCase().replace("show","");a("send","event","interaction","toc-link-followed",{target:l,bibcode:o})}else"broadcast-payload"==n?this.broadcast("page-manager-message",n,i):"navigate"==n?this.getPubSub().publish(this.getPubSub().NAVIGATE,i.navCommand,i.sub):"apply-function"==n&&i.func.apply(this)},setActive:function(e,t){t&&this.widgets[e].setSubView instanceof Function&&this.widgets[e].setSubView(t),t&&(e=e+"__"+t),this.widgets.tocWidget.collection.selectOne(e)},onDestroy:function(){this.stopListening(),this.widgets={},this.view.destroy()}})}),define("js/page_managers/one_column_view",["marionette","js/widgets/base/base_widget"],function(e){return e.ItemView.extend({initialize:function(e){e=e||{};this.widgets=e.widgets},onRender:function(){}})}),define("hbs!js/wraps/landing_page_manager/landing-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="landing-page-layout" class="s-landing-page-layout">\n   <div class="s-starry-background-wrapper">\n    <section class="s-logo-header">\n        <div>\n                <img src="styles/img/transparent_logo.svg" alt="The Astrophysics Data System Logo"/>\n                <b>astrophysics</b>&nbsp;data system\n        </div>\n     </section>\n       <div  class="nav-container s-landing-nav-container">\n       </div>\n   </div>\n\n    <section class="s-search-bar-row  row">\n\n                \x3c!-- <div class="unobtrusive-landing-page-alert">\n                    <b>\n                        <a href="http://zenodo.org/communities/about/astrothesis/" target="_blank" rel="noopener">\n                            <i class="fa fa-graduation-cap"></i>\n                            Learn how to contribute your thesis to the ADS Astronomy Thesis Collection\n                        </a>\n                    </b>\n                </div> --\x3e\n\n                <div class="search-bar-rows-container s-search-bar-rows-container">\n                    <br/>\n                    <br/>\n                    <div data-widget="SearchWidget"/>\n                    <div data-widget="ClassicSearchForm"/>\n                    <div data-widget="PaperSearchForm"/>\n                    <br/>\n                </div>\n\n                <div class="landing-faq row" >\n                  <a href="#classic-form">\n                  <div class="col-sm-4">\n                      <i class="fa fa-life-ring fa-2x"></i>\n                    <div>\n                      Use a classic ADS-style form\n                    </div>\n                  </div>\n                  </a>\n                  <a href="https://adsabs.github.io/help/search/search-syntax" target="_blank" rel="noopener">\n                    <div class="col-sm-4">\n\n                      <i class="fa fa-search fa-2x"></i>\n                    <div>\n                       Learn more about searching the ADS\n                    </div>\n                  </div>\n                  </a>\n                  <a href="https://github.com/adsabs/adsabs-dev-api" target="_blank" rel="noopener">\n                  <div class="col-sm-4">\n\n                      <i class="fa fa-code fa-2x"></i>\n                    <div>\n                      Access ADS data with our API\n                    </div>\n                  </div>\n                  </a>\n                </div>\n\n    </section>\n\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/landing_page_manager/landing-page-layout",n),n}),define("hbs!js/wraps/landing_page_manager/landing-page-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'            <li class="landing-tab '+(null!=(a=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <a href="'+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n                    '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'\n                    <span class="hidden-xs">\n                        Form\n                    </span>\n                </a>\n            </li>\n'},2:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\n<nav class="s-landing-tabs">\n'+(null!=(a=t.each.call(e,null!=e?e.tabs:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n</nav>"},useData:!0});return t.registerPartial("js/wraps/landing_page_manager/landing-page-nav",n),n}),define("js/wraps/landing_page_manager/landing_page_manager",["js/page_managers/toc_controller","js/page_managers/one_column_view","hbs!js/wraps/landing_page_manager/landing-page-layout","hbs!js/wraps/landing_page_manager/landing-page-nav"],function(e,t,n,i){return e.extend({TOCTemplate:i,className:"s-landing-page-layout",id:"landing-page-layout",pageConfig:{template:n,view:t},navConfig:{ClassicSearchForm:{title:"Classic",order:1,path:"/",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="290px" height="246px" viewBox="0 0 290 246" version="1.1"><title>Artboard 1</title><desc>Created with Sketch.</desc><g stroke="none" stroke-width="5" fill="none" fill-rule="evenodd"><g class="svg-needs-stroke" stroke-width="5" fill="#FFFFFF" fill-opacity="0"><g transform="translate(80.000000, 53.000000)"><rect x="0" y="0" width="129.999945" height="139.429993"/><rect x="13.4714969" y="24.9222692" width="42.4352152" height="24.9222692"/><rect x="74.0932328" y="24.9222692" width="42.4352152" height="24.9222692"/><rect x="13.4714969" y="61.2953108" width="103.056951" height="16.1657963"/><rect x="13.4714969" y="89.5854542" width="103.056951" height="33.0051673"/></g></g></g></svg>'},SearchWidget:{title:"Modern",order:2,path:"/",isSelected:"true",svg:'<svg class="modern-search" xmlns="http://www.w3.org/2000/svg" width="172px" height="28px" viewBox="0 0 172 28" version="1.1"><title>Rectangle 8 + Rectangle 8</title><desc>Created with Sketch.</desc><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-40.000000, -82.000000)" class="svg-needs-fill"><g transform="translate(40.000000, 82.000000)"><path d="M4.26325641e-14 0L4.26325641e-14 27.0939606 164.990643 27.0939606C168.867791 27.0939606 172 23.9622017 172 20.0989813L172 6.9949793C172 3.13448997 168.861804 0 164.990643 0L4.26325641e-14 0ZM164.990643 3C167.205202 3 169 4.7916 169 6.9949793L169 20.0989813C169 22.3064289 167.209851 24.0939606 164.990643 24.0939606L3 24 3 3 164.990643 3Z"/><g transform="translate(147.000000, 6.000000)"><path d="M10.6047437 11.077395C9.59359708 11.8615052 8.32401807 12.3282675 6.9454209 12.3282675 3.64463092 12.3282675 0.968811942 9.65244849 0.968811942 6.35165851 0.968811942 3.05086853 3.64463092 0.375049553 6.9454209 0.375049553 10.2462109 0.375049553 12.9220299 3.05086853 12.9220299 6.35165851 12.9220299 7.26156094 12.7186956 8.12397211 12.354987 8.89593202L17.4624135 13.6586842C17.4624135 13.6586842 17.5766368 15.1532905 17.3179164 15.4307342 16.9425866 15.8332262 15.5602627 15.6984912 15.5602627 15.6984912L10.6047437 11.077395 10.6047437 11.077395ZM6.9454209 10.3360645C9.14594755 10.3360645 10.9298269 8.55218516 10.9298269 6.35165851 10.9298269 4.15113185 9.14594755 2.36725254 6.9454209 2.36725254 4.74489424 2.36725254 2.96101493 4.15113185 2.96101493 6.35165851 2.96101493 8.55218516 4.74489424 10.3360645 6.9454209 10.3360645Z"/></g><path d="M138 2.5L138 25.5 138 27 141 27 141 25.5 141 2.5 141 1 138 1 138 2.5 138 2.5Z"/></g></g></g></svg>'},PaperSearchForm:{title:"Paper",order:3,path:"/",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="290px" height="246px" viewBox="0 0 290 246" version="1.1"><title>Artboard 1 Copy 2</title><desc>Created with Sketch.</desc><g stroke="none" stroke-width="2" fill="none" fill-rule="evenodd"><g><g transform="translate(80.000000, 50.000000)"><path d="M11.1420871 139.441341L0 139.441341 0 0 119.984612 0 119.984612 8.26117318" class="svg-needs-stroke"stroke-width="5" fill-opacity="0" /><g transform="translate(9.289131, 6.536313)"><rect class="svg-needs-stroke"stroke-width="5" fill-opacity="0"  x="0" y="0" width="119.984612" height="139.441341"/><rect class="svg-needs-fill" x="13.8443783" y="27.5977654" width="92.2958552" height="5.81005587"/><rect class="svg-needs-fill" x="13.8443783" y="41.396648" width="92.2958552" height="5.81005587"/><rect class="svg-needs-fill" x="13.8443783" y="55.9217877" width="92.2958552" height="5.81005587"/></g></g></g></g></svg>'}}})}),define("js/wraps/results_page_manager",["js/page_managers/controller","js/page_managers/three_column_view","hbs!js/page_managers/templates/results-page-layout"],function(e,t,n){return e.extend({persistentWidgets:["PubtypeFacet","SearchWidget","BreadcrumbsWidget","Sort","ExportDropdown","VisualizationDropdown","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","VizierFacet","GrantsFacet","Results","OrcidBigWidget","QueryInfo","GraphTabs","OrcidSelector"],createView:function(e){return(e=e||{}).template=e.template||n,new t({template:n})}})}),define("hbs!js/wraps/abstract_page_manager/abstract-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'                <a href="" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left"></i> Back to results</a>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div id="abstract-page-layout" class="s-abstract-page-layout">\n\n    <div class="row s-stable-search-bar-height">\n        <div class="s-search-bar-full-width-container">\n            <div class="col-xs-0 col-sm-12 col-md-2 s-back-button-container">\n'+(null!=(a=t.if.call(e,null!=e?e.query:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'            </div>\n            <div class="col-xs-12 col-sm-9 col-md-7 s-search-bar-row" id="search-bar-row" data-widget="SearchWidget"></div>\n        </div>\n    </div>\n    <div class="row nav-button-container s-nav-button-container">\n       <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n     </div>\n    <div class="row s-dynamic-page-body" id="dynamic-page-body">\n        <div class="s-abstract-content">\n\n            <div class="col-sm-2 nav-container s-nav-container" id="left-column"> </div>\n\n            <div class="col-sm-9 col-md-7 s-middle-column" id="middle-column">\n                \x3c!--id is for screen readers--\x3e\n                <div class="main-content-container s-main-content-container" id="main-content" tabindex="-1">\n                    <div class="print-visible"><h2 style="margin-left:6.1%;">NASA/ADS</h2> </div>\n\n                    <div id="abstract-title-container" class="s-abstract-title-container"></div>\n                    <div id="current-subview">\n                        <div data-widget="ShowAbstract"/>\n                        <div data-widget="ShowCitations"/>\n                        <div data-widget="ShowReferences"/>\n                        <div data-widget="ShowCoreads"/>\n                        <div data-widget="ShowTableOfContents"/>\n                        <div data-widget="ShowSimilar" data-debug="true"/>\n                        <div data-widget="ShowGraphics" />\n                        <div data-widget="ShowPaperExport" data-origin="abstract"/>\n                        <div data-widget="ShowMetrics" data-allow-redirect="false"/>\n                        <div data-widget="MetaTagsWidget"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="s-right-col-container col-sm-3 col-lg-2 s-right-column" id="right-col-container">\n                <div data-widget="ShowResources"/>\n                <div data-widget="ShowLibraryAdd"/>\n                <div data-widget="ShowGraphicsSidebar"/>\n                <div data-widget="ShowAssociated"/>\n            </div>\n\n            <div class="col-lg-1"></div>\n        </div>\n    </div>\n</div>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/abstract_page_manager/abstract-page-layout",n),n}),define("hbs!js/wraps/abstract_page_manager/abstract-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i,a,r){var s;return'\n    <a href="/abs/'+this.escapeExpression(this.lambda(null!=r[1]?r[1].bibcode:r[1],e))+"/"+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" '+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+' data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n    <div class="abstract-nav s-nav '+(null!=(s=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(4,i,0,a,r),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(6,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'">\n            <span class="s-content">\n            '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n"+(null!=(s=t.if.call(e,null!=e?e.showCount:e,{name:"if",hash:{},fn:this.program(8,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"            </span>\n    </div>\n    </a>\n\n"},2:function(e,t,n,i){return' aria-disabled="true" '},4:function(e,t,n,i){return" s-nav-selected "},6:function(e,t,n,i){return" s-nav-inactive "},8:function(e,t,n,i){var a;return'            <span class="num-items"> '+(null!=(a=t.if.call(e,null!=e?e.numFound:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+"</span>\n"},9:function(e,t,n,i){return"("+this.escapeExpression(this.lambda(null!=e?e.numFound:e,e))+")"},11:function(e,t,n,i,a,r){var s;return'    <a href="/abs/'+this.escapeExpression(this.lambda(null!=r[1]?r[1].bibcode:r[1],e))+"/"+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n      <div class="abstract-nav s-nav '+(null!=(s=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(4,i,0,a,r),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(6,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'">\n        <span class="content">\n          Export\n        </span>\n      </div>\n    </a>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s;return'\n<nav>\n    <div class="s-nav-header s-view-nav"> <i class="icon-list"></i> <h3>view </h3> </div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.view:e,{name:"each",hash:{},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n"+(null!=(s=t.each.call(e,null!=e?e.export:e,{name:"each",hash:{},fn:this.program(11,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n</nav>\n"},useData:!0,useDepths:!0});return t.registerPartial("js/wraps/abstract_page_manager/abstract-nav",n),n}),define("js/wraps/abstract_page_manager/abstract_page_manager",["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/abstract_page_manager/abstract-page-layout","hbs!js/wraps/abstract_page_manager/abstract-nav"],function(e,t,n,i){return e.extend({persistentWidgets:["SearchWidget","ShowAbstract","ShowCitations","ShowReferences","tocWidget"],TOCTemplate:i,createView:function(e){return(e=e||{}).template=e.template||n,new t({template:n})},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets});var t=this.getPubSub();t.subscribe(t.DISPLAY_DOCUMENTS,_.bind(this.onDisplayDocuments,this))},assemble:function(t){e.prototype.assemble.apply(this,arguments);var n=t.getObject("AppStorage");n&&n.hasCurrentQuery()&&this.addQuery(n.getCurrentQuery())},addQuery:function(e){this.view.model&&this.view.model.set("query",e.url())},show:function(t){var n=e.prototype.show.apply(this,arguments);return this.view.model&&this.view.model.has("query")&&n.$el.find(".s-back-button-container").empty().html('<a href="#search/'+this.view.model.get("query")+'" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left"></i> Back to results</a>'),"ShowAbstract"===t&&"function"==typeof window.scrollTo&&window.scrollTo(0,0),n},onDisplayDocuments:function(e){var t=e.get("q");t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this.widgets.tocWidget.model.set("bibcode",t))},navConfig:{ShowAbstract:{title:"Abstract",path:"abstract",showCount:!1,isSelected:!0,category:"view",alwaysThere:"true"},ShowCitations:{title:"Citations",path:"citations",category:"view"},ShowReferences:{title:"References",path:"references",category:"view"},ShowCoreads:{title:"Co-Reads",path:"coreads",category:"view",showCount:!1},ShowTableOfContents:{title:"Volume Content",path:"tableofcontents",category:"view",showCount:!1},ShowSimilar:{title:"Similar Papers",path:"similar",category:"view"},ShowGraphics:{title:"Graphics",path:"graphics",showCount:!1,category:"view"},ShowMetrics:{title:"Metrics",path:"metrics",showCount:!1,category:"view"},ShowPaperExport__default:{title:"Export",path:"export",category:"export",alwaysThere:"true"}}})}),define("hbs!js/page_managers/templates/authentication-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="row s-message-control-row" id="message-control-row">\n    <div data-widget="AlertsWidget"/>\n</div>\n<div class="row s-darker-background">\n    <div class="col-sm-12">\n        <div data-widget="Authentication"/>\n\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/authentication-page-layout",n),n}),define("js/wraps/authentication_page_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/page_managers/templates/authentication-page-layout"],function(e,t,n){return e.extend({createView:function(e){return(e=e||{}).template=e.template||n,new t({template:n,className:"s-authentication-page-layout s-100-height",id:"user-page-layout"})}})}),define("hbs!js/wraps/user_settings_page_manager/user-settings-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div class="row">\n    <div class="col-sm-12">\n        <div data-widget="UserNavbarWidget"/>\n    </div>\n</div>\n<div class="nav-button-container s-nav-button-container row">\n    <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n</div>\n\n<div class="row s-darker-background">\n\n    <div class="col-sm-2 nav-container s-nav-container"></div>\n\n    <div class="col-sm-10">\n        <div data-widget="LibraryImport"/>\n        <div data-widget="UserSettings"/>\n        <div data-widget="UserPreferences"/>\n    </div>\n</div>\n\n\x3c!--show this when user enters information and navigates away--\x3e\n<div class="modal fade confirm-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">Confirm navigation</h4>\n            </div>\n            <div class="modal-body">\n                <p>You are leaving an unsubmitted form. The data you have entered will be lost. </p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default stay-on-form" data-dismiss="modal"> Stay on form</button>\n                <button type="button" class="btn btn-primary leave-form" data-dismiss="modal"> Leave form</button>\n            </div>\n        </div>\x3c!-- /.modal-content --\x3e\n    </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n'},useData:!0});return t.registerPartial("js/wraps/user_settings_page_manager/user-settings-layout",n),n}),define("hbs!js/wraps/user_settings_page_manager/user_nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'        <a href="#/'+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'"  >\n        <div class="abstract-nav s-nav '+(null!=(a=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <span class="s-content">\n                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n                </span>\n        </div>\n        </a>\n"},2:function(e,t,n,i){return" s-nav-selected "},4:function(e,t,n,i,a,r){var s;return'--\x3e\n            \x3c!--<a href="/abs/'+this.escapeExpression(this.lambda(null!=r[1]?r[1].bibcode:r[1],e))+"/"+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" '+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(5,i,0,a,r),inverse:this.noop,data:i}))?s:"")+' >--\x3e\n            \x3c!--<div class="abstract-nav s-nav '+(null!=(s=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(7,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">--\x3e\n                        \x3c!--<span class="s-content">--\x3e\n                        \x3c!--'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"--\x3e\n                        \x3c!--"+(null!=(s=t.if.call(e,null!=e?e.showCount:e,{name:"if",hash:{},fn:this.program(9,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"--\x3e\n                        \x3c!--</span>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--</a>--\x3e\n        \x3c!--"},5:function(e,t,n,i){return' aria-disabled="true" '},7:function(e,t,n,i){return" s-nav-inactive "},9:function(e,t,n,i){var a;return'--\x3e\n                        \x3c!--<span class="num-items"> '+(null!=(a=t.if.call(e,null!=e?e.numFound:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"</span>--\x3e\n                        \x3c!--"},10:function(e,t,n,i){return"("+this.escapeExpression(this.lambda(null!=e?e.numFound:e,e))+")"},12:function(e,t,n,i){var a;return'\n        <a href="#/'+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n        <div class="abstract-nav s-nav '+(null!=(a=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <span class="s-content">\n                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n"+(null!=(a=t.if.call(e,null!=e?e.showCount:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?a:"")+"                </span>\n        </div>\n        </a>\n\n"},13:function(e,t,n,i){var a;return'                <span class="num-items"> '+(null!=(a=t.if.call(e,null!=e?e.numFound:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s;return'\n<nav>\n\n    <h2 class="s-nav-top-title"><i class="fa fa-cog"></i> Customize Settings</h2>\n\n    <div class="s-nav-header s-view-nav">user preferences</div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.preferences:e,{name:"each",hash:{},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'\n    <div class="s-nav-header s-view-nav">notification settings</div>\n\n    <div class="abstract-nav s-nav">Coming soon</div>\n\n        \x3c!--'+(null!=(s=t.each.call(e,null!=e?e.notifications:e,{name:"each",hash:{},fn:this.program(4,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'--\x3e\n\n\n    <div class="s-nav-header s-view-nav">account settings</div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.settings:e,{name:"each",hash:{},fn:this.program(12,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n\n\n</nav>\n"},useData:!0,useDepths:!0});return t.registerPartial("js/wraps/user_settings_page_manager/user_nav",n),n}),define("js/wraps/user_settings_page_manager/user_page_manager",["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/user_settings_page_manager/user-settings-layout","hbs!js/wraps/user_settings_page_manager/user_nav"],function(e,t,n,i){return e.extend({TOCTemplate:i,createView:function(e){return(e=e||{}).template=e.template||n,new t({template:n,className:"s-user-settings-page-layout s-100-height",id:"user-page-layout"})},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets})},navConfig:{UserPreferences__librarylink:{title:"Library Link Server",path:"user/settings/librarylink",category:"preferences"},UserPreferences__orcid:{title:"ORCID Settings",path:"user/settings/orcid",category:"preferences"},LibraryImport:{title:"Import Libraries",path:"user/settings/libraryimport",category:"preferences"},UserPreferences__application:{title:"Application",path:"user/settings/application",category:"preferences"},UserSettings__email:{title:"Change Email",path:"user/settings/email",category:"settings"},UserSettings__password:{title:"Change Password",path:"user/settings/password",category:"settings"},UserSettings__token:{title:"API Token",path:"user/settings/token",category:"settings"},UserSettings__delete:{title:"Delete Account",path:"user/settings/delete",category:"settings"}}})}),define("hbs!js/wraps/orcid_page_manager/orcid-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="row s-stable-search-bar-height">\n    <div class="s-search-bar-full-width-container">\n        <div class="col-sm-7 col-md-7 col-sm-offset-2 s-search-bar-row" id="search-bar-row"\n             data-widget="SearchWidget">\n        </div>\n    </div>\n</div>\n<div data-widget="OrcidBigWidget"/>\n\n'},useData:!0});return t.registerPartial("js/wraps/orcid_page_manager/orcid-page-layout",n),n}),define("js/wraps/orcid_page_manager/orcid_page_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/orcid_page_manager/orcid-page-layout"],function(e,t,n){return e.extend({createView:function(e){return(e=e||{}).template=n,new t({template:n,className:"s-orcid-layout",id:"orcid-page-layout"})}})}),define("hbs!js/wraps/orcid-instructions-page-manager/orcid-instructions",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="orcid-info">\n\n    <section class="orcid-info__intro col-sm-8 col-sm-offset-2">\n            <div class="header">\n                <div class="logos">\n                        <img src="../../styles/img/ads-orcid.svg" alt="the ADS logo combined with the ORCID logo" style="max-width: 150px;">\n\n                </div>\n\n                <h1>ADS-ORCID Integration</h1>\n\n            </div>\n\n    </section>\n    <div class="row">\n        <div class="col-sm-8 col-sm-offset-2">\n\n            \x3c!-- Nav tabs --\x3e\n            <ul class="nav nav-tabs" role="tablist">\n                <li role="presentation" class="active"><a href="#orcid-instructions__claim" aria-controls="orcid-instructions__claim" role="tab" data-toggle="tab">Claim Papers</a></li>\n                <li role="presentation"><a href="#orcid-instructions__search" aria-controls="#orcid-instructions__search" role="tab" data-toggle="tab">Find Papers</a></li>\n                \x3c!--<li role="presentation"><a href="#orcid-instructions__benefit" aria-controls="#orcid-instructions__benefit" role="tab" data-toggle="tab">Benefit</a></li>--\x3e\n            </ul>\n\n            \x3c!-- Tab panes --\x3e\n            <div class="tab-content">\n                <div role="tabpanel" class="tab-pane active" id="orcid-instructions__claim">\n\n                    <section class="orcid-info__instructions">\n\n                        <h2 id="method-one-recommended-if-you-care-about-having-your-orcid-claims-searchable-in-the-ads"><b>Recommended Method:</b> If you care about having your ORCID claims searchable in the ADS</h2>\n                        <ol>\n                            <li><h3 id="make-sure-you-re-signed-in-to-ads">Make sure you&#39;re signed in to ADS</h3>\n                                If you are not signed in already, <a href="#user/account/login">sign in here</a> or <a\n                                        href="#user/account/register">create an account.</a>\n                            <li><h3 id="authenticate-with-orcid">Authenticate with ORCID</h3>\n                                Click on the ORCID button in the top navigation bar and follow the instructions.</li>\n                            <li><h3 id="enter-a-bit-of-extra-information-in-your-ads-user-profile">Enter a bit of extra information in your ADS User Profile</h3>\n                               If you haven\'t done this already, <a href="#user/settings/orcid">go to the ORCID settings page in your ADS account</a>. Enter in 1) your current affiliation, and 2) any name variations under which you might have published. Submitting the form will grant ADS permission to track your claims, allowing us to put your data in our system and marking it as trusted so that others can find it.</li>\n                            <li><h3 id="claim-papers-one-by-one-safe-but-slow-">Claim papers one-by-one</h3>\n                                <p>Search for your name variations in the search interface. Make sure ORCID mode is &quot;on&quot; (click on the ORCID button in the navigation bar to toggle the setting), and you will see a button underneath each search result allowing you to claim the paper.</p>\n                            </li>\n                            \x3c!--<li><h3 id="bulk-claiming-your-papers-fast-and-slightly-less-safe-">Bulk claiming your papers (fast and slightly less safe)</h3>--\x3e\n                                \x3c!--<p>Because you are signed in, you have the option to use an ADS library to bulk export your papers to ORCID.--\x3e\n                                    \x3c!--To create a library, perform a search for your name variations and for each page of results:</p>--\x3e\n                                \x3c!--<ol>--\x3e\n                                    \x3c!--<li>Click the &quot;select all&quot; checkbox at the top and de-select any papers that are not by you.</li>--\x3e\n                                    \x3c!--<li>Open the &quot;add papers to library&quot; panel and either create a special library for your ORCID papers or add your papers to a pre-existing library.--\x3e\n                                        \x3c!--Once you have collected all your papers in a library, go to your ADS Libraries page and open up the library with your ORCID papers in it. Go to the export dropdown and click &quot;ORCID&quot;.  This will send all papers in the library to ORCID as a single list.</li>--\x3e\n                                \x3c!--</ol>--\x3e\n                            \x3c!--</li>--\x3e\n                        </ol>\n                        <hr>\n                        <h2 id="method-two-if-you-just-want-to-use-ads-to-send-claims-to-your-orcid-profile-"><b>Alternate Method: </b> If you just want to use ADS to send claims to your ORCID profile*</h2>\n                        <ol>\n                            <li><h3 id="authenticate-with-orcid">Authenticate with ORCID</h3>\n                                Click on the ORCID button in the top navigation bar and follow the instructions.</li>\n                            <li><h3 id="claim-papers-one-by-one">Claim papers one-by-one</h3>\n                                Search for your name in the ADS and you&#39;ll get a list of search results. Make sure ORCID mode is &quot;on&quot; (click on the ORCID button in the navigation bar to toggle the setting). When the ORCID claiming mode is on, you&#39;ll see a button underneath each search result allowing you to claim the paper in ORCID.</li>\n                            <li><h3 id="it-s-not-too-late-to-change-your-mind-">It&#39;s not too late to change your mind!</h3>\n                                <p> You can always sign into your ADS account (or create a new one) and  <a href="#user/settings/orcid">submit the user profile information described above</a> to facilitate indexing your claims in ADS. Without performing this final step, some of your claims may not be properly indexed in ADS due to our inability to match your name variations against the published records.  </p>\n                            </li>\n                        </ol>\n\n                        <p>\n                            * most of your papers will likely still be eventually findable in the ADS, but they will be marked as less trusted than papers claimed using Method #1\n                        </p>\n\n                    </section>\n\n                </div>\n                <div role="tabpanel" class="tab-pane" id="orcid-instructions__search">\n                    <section class="search">\n                        <br>\n                        <p class="lead">The ORCID claims you make will be indexed in ADS within 24 hours, and can be found by using the &quot;orcid&quot; search field.</p>\n                        <hr>\n                        <p>\n                            e.g. to find Andrea Comastri\'s papers, search <a href="#search/q=orcid%3A0000-0003-3451-9970&sort=date+desc"> orcid:0000-0003-3451-9970</a>.\n                        </p>\n                    </section>\n                </div>\n                \x3c!--<div role="tabpanel" class="tab-pane" id="orcid-instructions__benefit">--\x3e\n                    \x3c!--<br>--\x3e\n                    \x3c!--<p class="lead">In the future, ORCID integration will be central to the ADS search interface.</p>--\x3e\n                    \x3c!--<hr>--\x3e\n                    \x3c!--<p>With data from ORCID, we can make our author searches smarter, reducing the problems caused by author name disambiguation.</p>--\x3e\n                    \x3c!--<p>Once we can associate a user with the papers he or she has written, we can offer smarter notification and recommendation services.</p>--\x3e\n\n                \x3c!--</div>--\x3e\n            </div>\n        </div>\n    </div>\n\n\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/orcid-instructions-page-manager/orcid-instructions",n),n}),define("js/wraps/orcid-instructions-page-manager/manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/orcid-instructions-page-manager/orcid-instructions","bootstrap"],function(e,t,n,i){return e.extend({createView:function(e){return(e=e||{}).template=n,new t({template:n,className:"orcid-info"})}})}),define("hbs!js/wraps/libraries_page_manager/libraries-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div class="row">\n    <div class="col-sm-12">\n    <div data-widget="UserNavbarWidget"/>\n    </div>\n</div>\n\n<div class="row nav-button-container s-nav-button-container">\n    <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n</div>\n\n<div class="row s-darker-background">\n\n    <div class="col-sm-2 nav-container s-nav-container"></div>\n    <div class="col-sm-10 body-min-height">\n        <div data-widget="IndividualLibraryWidget"/>\n        <div data-widget="AllLibrariesWidget"/>\n        <div data-widget="LibraryListWidget"/>\n        <div data-widget="ExportWidget" class="s-inner-div-background" data-origin="library"/>\n        <div data-widget="AuthorAffiliationTool" class="s-inner-div-background" data-origin="library"/>\n        <div data-widget="Metrics" class="s-inner-div-background"/>\n        <div data-widget="AuthorNetwork" class="s-inner-div-background"/>\n        <div data-widget="PaperNetwork" class="s-inner-div-background"/>\n        <div data-widget="BubbleChart" class="s-inner-div-background"/>\n        <div data-widget="ConceptCloud" class="s-inner-div-background"/>\n        <div data-widget="CitationHelper" class="s-inner-div-background"/>\n     </div>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/libraries_page_manager/libraries-page-layout",n),n}),define("hbs!js/wraps/libraries_page_manager/libraries-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<nav class="library-nav">\n  <div>\n    <button class="btn btn-link create-library">\n      <i class="fa fa-plus"></i>&nbsp;&nbsp;Add a library\n    </button>\n  </div>\n  <div>\n    <a href="#/user/libraries"><i class="fa fa-list"></i>&nbsp;&nbsp;View all libraries</a>\n  </div>\n  <div>\n    <a href="https://adsabs.github.io/help/libraries/creating-libraries" target="_blank" rel="noopener">\n      <i class="fa fa-info-circle"></i>&nbsp;&nbsp;Library Help\n    </a>\n  </div>\n\n</nav>\n'},useData:!0});return t.registerPartial("js/wraps/libraries_page_manager/libraries-nav",n),n}),define("js/wraps/libraries_page_manager/libraries_page_manager",["js/page_managers/toc_controller","js/page_managers/toc_widget","js/page_managers/three_column_view","hbs!js/wraps/libraries_page_manager/libraries-page-layout","hbs!js/wraps/libraries_page_manager/libraries-nav"],function(e,t,n,i,a){return e.extend({TOCTemplate:a,TOCEvents:{"click button.create-library":function(){this.trigger("page-manager-event","apply-function",{func:function(){var e=this;this.getBeeHive().getObject("LibraryController").createLibrary().done(function(t){e.getPubSub().publish(e.getPubSub().NAVIGATE,"IndividualLibraryWidget",{sub:"library",id:t.id})})}})}},createView:function(e){return(e=e||{}).template=e.template||i,new n({template:i,className:"s-libraries-layout s-100-height",id:"libraries-layout"})},navConfig:[]})}),define("hbs!js/wraps/home_page_manager/home-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div class="row">\n    <div class="col-sm-12">\n        <div data-widget="UserNavbarWidget"/>\n    </div>\n</div>\n\n<div class="nav-button-container s-nav-button-container row">\n    <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n</div>\n\n\n<div class="row s-darker-background">\n\n    <div class="col-sm-2 nav-container s-nav-container">\n    </div>\n    <div class="col-sm-10 body-min-height">\n    </div>\n</div>'},useData:!0});return t.registerPartial("js/wraps/home_page_manager/home-page-layout",n),n}),define("hbs!js/wraps/home_page_manager/home-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<nav>\n    <h2 class="s-nav-top-title"><i class="fa fa-user"></i> My Home Page</h2>\n\n    <div class="s-nav">\n        Nothing here yet!\n        We are working on features such as:\n        <ul>\n            <li>a public profile with customized metrics</li>\n            <li>a customized ads dashboard</li>\n            <li>research notifications</li>\n            <li>saved searches</li>\n        </ul>\n    </div>\n</nav>'},useData:!0});return t.registerPartial("js/wraps/home_page_manager/home-nav",n),n}),define("js/wraps/home_page_manager/home_page_manager",["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/home_page_manager/home-page-layout","hbs!js/wraps/home_page_manager/home-nav"],function(e,t,n,i){return e.extend({TOCTemplate:i,createView:function(e){return(e=e||{}).template=e.template||n,new t({template:n,className:"s-home-layout s-100-height",id:"home-layout"})},navConfig:[]})}),define("hbs!js/wraps/public_libraries_page_manager/public-libraries-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n\n<div class="row s-darker-background">\n    <div class="col-sm-12">\n        <div class="s-public-lib-descriptor"><h3>  <i class="fa fa-lg fa-unlock text-success" title="this library is public"></i> ADS Public Library</h3> <a href=""><i class="fa fa-icon-help"></i></a><i class="fa fa-icon-help"></i></div>\n        <div data-widget="IndividualLibraryWidget"/>\n        <div data-widget="LibraryListWidget" />\n\n        <div data-widget="ExportWidget" class="s-inner-div-background"/>\n        <div data-widget="Metrics" class="s-inner-div-background"/>\n        <div data-widget="AuthorNetwork" class="s-inner-div-background"/>\n        <div data-widget="PaperNetwork" class="s-inner-div-background"/>\n        \x3c!--<div data-widget="BubbleChart" class="s-inner-div-background"/>--\x3e\n        <div data-widget="ConceptCloud" class="s-inner-div-background"/>\n        <div data-widget="CitationHelper" class="s-inner-div-background"/>\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/public_libraries_page_manager/public-libraries-page-layout",n),n}),define("js/wraps/public_libraries_page_manager/public_libraries_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/public_libraries_page_manager/public-libraries-page-layout"],function(e,t,n){return e.extend({createView:function(e){return(e=e||{}).template=n,new t({template:n,className:"s-public-libraries-layout s-libraries-layout",id:"landing-page-layout"})}})}),define("hbs!js/wraps/error_page_manager/404",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div >\n    <img src="styles/img/404.jpg"\n         class="img-responsive"\n         style="margin:auto;"\n         alt="incredibly cute 404 error image made by Jason Bitterman"/>\n   <p style="text-align: center"><a href="/">Click here to reload Bumblebee</a> or use your browser\'s back button to go to a previous page.</p>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/error_page_manager/404",n),n}),define("js/wraps/error_page_manager/error_page_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/error_page_manager/404"],function(e,t,n){return e.extend({createView:function(e){return e=e||{},new t({template:n,className:"error-page-layout s-100-height"})}})}),define("js/mixins/form_view_functions",["underscore"],function(e){return{checkValidationState:function(){this.model.isValidSafe()&&this.$("button[type=submit]").prev(".help-block").html("").addClass("no-show")},triggerSubmit:function(e){if(e.preventDefault(),this.submit=!0,this.model.isValid(!0)){this.trigger("submit-form",this.model),this.$("button[type=submit]").prev(".help-block").addClass("no-show"),this.$("button[type=submit]").removeClass("btn-success").addClass("disabled").html('<i class="fa fa-lg fa-spinner fa-pulse"></i> Working...')}else this.$("button[type=submit]").prev(".help-block").removeClass("no-show").html("Fields missing or incomplete")},activateValidation:function(){Backbone.Validation.bind(this,{forceUpdate:!0}),this.stickit()},isValidSafe:function(){var t=!0;if(e.each(this.validation,function(e,n){e.required&&!this.get(n)&&(t=!1)},this),t&&this.isValid(!0))return!0},reset:function(){var t=e.keys(this.validation);e.each(this.attributes,function(n,i){e.contains(t,i)&&this.unset(i,{silent:!0})},this)}}}),define("hbs!js/widgets/success/success_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\n<div class="panel panel-default">\n    <div class="panel-heading">\n        <i class="icon-success fa-3x"> </i> '+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'\n    </div>\n    <div class="panel-body">\n        <p> '+(null!=(a="function"==typeof(r=null!=(r=t.message||(null!=e?e.message:e))?r:t.helperMissing)?r.call(e,{name:"message",hash:{},data:i}):r)?a:"")+"</p>\n    </div>\n\n</div>\n\n\n"},useData:!0});return t.registerPartial("js/widgets/success/success_template",n),n}),define("js/widgets/success/view",["marionette","hbs!js/widgets/success/success_template"],function(e,t){return e.ItemView.extend({initialize:function(e){_.extend(this,e)},title:"Success!",message:"Check your email for further instructions.",template:t,serializeData:function(){return{title:this.title,message:this.message}}})}),define("hbs!js/widgets/authentication/templates/log-in",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'    <div class="row">\n        <div class="col-sm-10 col-sm-offset-1 text-center">\n            <div class="alert alert-danger">\n                <p>'+this.escapeExpression("function"==typeof(a=null!=(a=t.errorMsg||(null!=e?e.errorMsg:e))?a:t.helperMissing)?a.call(e,{name:"errorMsg",hash:{},data:i}):a)+'</p>\n                <p><a class="link" id="dismiss-error">Dismiss</a></p>\n            </div>\n        </div>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="panel panel-default">\n    <legend class="panel-heading">Log in to ADS\n        <button class="show-register btn btn-default pull-right"> sign up for an account </button>\n        <div class="s-form-note"> <i class="fa fa-info-circle"></i> Your ADS Classic credentials will not work here.\n            <br/> You\'ll have to make a new account to access this system. </div>\n\n    </legend>\n    <form class="panel-body">\n\n        <div class="form-group has-feedback">\n            <label for="username" class="control-label"> Email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="username" id="username" placeholder="Enter email">\n        </div>\n\n        <div class="form-group has-feedback">\n            <label for="password" class="control-label"> Password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password" id="password" placeholder="Password">\n        </div>\n\n        <div class="form-group has-feedback">\n            <span class="help-block no-show s-help-block s-help-block-submit"></span>\n            <button type="submit" class="btn btn-primary-faded submit-login">Submit</button>\n        </div>\n\n        <div class="form-group">\n            <button class="btn btn-link show-reset-password-1">Forgot your password?</button>\n            <span class="help-block no-show s-help-block"></span>\n        </div>\n\n    </form>\n\n'+(null!=(a=t.if.call(e,null!=e?e.hasError:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n"},useData:!0});return t.registerPartial("js/widgets/authentication/templates/log-in",n),n}),define("hbs!js/widgets/authentication/templates/register",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'    <div class="row">\n        <div class="col-sm-10 col-sm-offset-1 text-center">\n            <div class="alert alert-danger">\n                <p>'+this.escapeExpression("function"==typeof(a=null!=(a=t.errorMsg||(null!=e?e.errorMsg:e))?a:t.helperMissing)?a.call(e,{name:"errorMsg",hash:{},data:i}):a)+'</p>\n                <p><a class="link" id="dismiss-error">Dismiss</a></p>\n            </div>\n        </div>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="panel panel-default">\n            <legend class="panel-heading">Register for an ADS Account\n             <button class="show-login btn btn-default pull-right"> I already have an account </button>\n            </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> Email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="email" id="email" placeholder="Enter email"/>\n\n        </div>\n        <div class="form-group has-feedback">\n            <label for="password1" class="control-label"> Password <small class="s-user-help"> at least 5 characters, with at least 1 number and 1 letter</small> </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password1" id="password1" placeholder="Password"/>\n\n        </div>\n\n        <div class="form-group has-feedback">\n            <label  for="password2" class="control-label"> Re-enter Password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password2" id="password2" placeholder="Re-enter password"/>\n        </div>\n\n        <div class="form-group">\n            <div class="g-recaptcha"></div>\n        </div>\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded submit-register">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n        </div>\n    </form>\n\n'+(null!=(a=t.if.call(e,null!=e?e.hasError:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</div>"},useData:!0});return t.registerPartial("js/widgets/authentication/templates/register",n),n}),define("hbs!js/widgets/authentication/templates/container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="form-container s-form-container  col-sm-10 col-sm-offset-1  col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/container",n),n}),define("hbs!js/widgets/authentication/templates/reset-password-1",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default">\n    <legend class="panel-heading"> Password Reset\n        <button class="show-login btn btn-default pull-right"> return to login form </button>\n    </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> Email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="email" id="email" placeholder="Enter email"/>\n        </div>\n\n        <div class="form-group">\n            <div class="g-recaptcha"></div>\n        </div>\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded submit-reset-password">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/reset-password-1",n),n}),define("hbs!js/widgets/authentication/templates/reset-password-2",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default">\n    <legend class="panel-heading"> Password Reset\n    </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="password1" class="control-label"> New password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <div class="s-user-help">Passwords should be at least five characters and include at least one number and one letter.</div>\n            <input type="password" class="form-control" name="password1" id="password1" placeholder="Password"/>\n\n        </div>\n\n        <div class="form-group has-feedback">\n            <label  for="password2" class="control-label"> Re-enter new password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password2" id="password2" placeholder="Re-enter password"/>\n        </div>\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded submit-reset-password">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/reset-password-2",n),n}),define("js/widgets/authentication/widget",["marionette","js/widgets/base/base_widget","js/components/api_feedback","js/mixins/form_view_functions","js/widgets/success/view","js/components/api_targets","hbs!js/widgets/authentication/templates/log-in","hbs!js/widgets/authentication/templates/register","hbs!js/widgets/authentication/templates/container","hbs!js/widgets/authentication/templates/reset-password-1","hbs!js/widgets/authentication/templates/reset-password-2","js/components/user","backbone-validation","backbone.stickit","google-recaptcha"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h,p,f,g,m,b,v,y,w,S,E=/(?=.*\d)(?=.*[a-zA-Z]).{5,}/;h=e.ItemView.extend({activateValidation:i.activateValidation,checkValidationState:i.checkValidationState,triggerSubmit:i.triggerSubmit,dissmissError:function(){this.model.set(this.model.defaults()),this.render()},modelEvents:{change:"checkValidationState"},events:{"click button[type=submit]":"triggerSubmit","click a#dismiss-error":"dissmissError"}}),p=Backbone.Model.extend({isValidSafe:i.isValidSafe,reset:i.reset,defaults:function(){return{hasError:!1,errorMsg:""}}}),f=p.extend({validation:{email:{required:!0,pattern:"email",msg:"(A valid email is required)"},password1:{required:!0,pattern:E,msg:"(Password isn't valid)"},password2:{required:!0,equalTo:"password1",msg:"(The passwords do not match)"},"g-recaptcha-response":{required:!0}},target:"REGISTER"}),g=h.extend({template:o,className:"register s-register",bindings:{"input[name=email]":{observe:"email",setOptions:{validate:!0}},"input[name=password1]":{observe:"password1",setOptions:{validate:!0}},"input[name=password2]":{observe:"password2",setOptions:{validate:!0}},"g-recaptcha-response":{required:!0}},onRender:function(){this.activateValidation(),this.trigger("activate-recaptcha")}}),b=p.extend({validation:{username:{required:!0,pattern:"email",msg:"(A valid email is required)"},password:{required:!0,pattern:E,msg:"(A valid password is required)"}},target:"USER"}),m=h.extend({template:s,className:"log-in s-log-in",bindings:{"input[name=username]":{observe:"username",setOptions:{validate:!0}},"input[name=password]":{observe:"password",setOptions:{validate:!0}}},onRender:function(){this.activateValidation()}}),y=p.extend({validation:{email:{required:!0,pattern:"email",msg:"(A valid email is required)"},"g-recaptcha-response":{required:!0}},target:"RESET_PASSWORD",method:"POST"}),v=h.extend({template:c,className:"reset-password-1 s-reset-password-1",bindings:{"input[name=email]":{observe:"email",setOptions:{validate:!0}}},onRender:function(){this.activateValidation(),this.trigger("activate-recaptcha")}}),S=p.extend({validation:{password1:{required:!0,pattern:E,msg:"(Password isn't valid)"},password2:{required:!0,equalTo:"password1",pattern:E,msg:"(The passwords do not match)"}},target:"RESET_PASSWORD",method:"PUT"}),w=h.extend({template:u,className:"reset-password-2 s-reset-password-2",bindings:{"input[name=password1]":{observe:"password1",setOptions:{validate:!0}},"input[name=password2]":{observe:"password2",setOptions:{validate:!0}}},onRender:function(){this.activateValidation()}});var x=Backbone.Model.extend({defaults:function(){return{subView:void 0}}}),A=e.LayoutView.extend({template:l,initialize:function(){this.logInModel=new b,this.registerModel=new f,this.resetPassword1Model=new y,this.resetPassword2Model=new S},modelEvents:{"change:subView":"renderSubView"},className:"s-authentication-container row s-form-widget",regions:{container:".form-container"},triggers:{"click .show-login":"navigateToLoginForm","click .show-register":"navigateToRegisterForm","click .show-reset-password-1":"navigateToResetPassword1Form"},onRender:function(){this.renderSubView()},renderSubView:function(){var e=this.model.get("subView");"login"===e?this.showLoginForm():"register"===e?this.showRegisterForm():"reset-password-1"===e?this.showResetPasswordForm1():"reset-password-2"===e&&this.showResetPasswordForm2()},showLoginForm:function(e){var t=new m({model:this.logInModel});e&&t.model.set({hasError:!0,errorMsg:e}),t.on("submit-form",this.forwardSubmit,this),this.container.show(t)},showRegisterForm:function(e){var t=new g({model:this.registerModel});e&&t.model.set({hasError:!0,errorMsg:e}),t.on("submit-form",this.forwardSubmit,this),t.on("activate-recaptcha",_.bind(this.forwardActivateRecaptcha,this,t)),this.container.show(t)},showResetPasswordForm1:function(){var e=new v({model:this.resetPassword1Model});e.on("submit-form",this.forwardSubmit,this),e.on("activate-recaptcha",_.bind(this.forwardActivateRecaptcha,this,e)),this.container.show(e)},showResetPasswordForm2:function(){var e=new w({model:this.resetPassword2Model});e.on("submit-form",this.forwardSubmit,this),this.container.show(e)},showRegisterSuccessView:function(){var e=new a({title:"Registration Successful"});this.container.show(e)},showResetPasswordSuccessView:function(){var e=new a({title:"Password Reset Successful"});this.container.show(e)},forwardSubmit:function(e){this.trigger("submit-form",e)},forwardActivateRecaptcha:function(e){this.trigger("activate-recaptcha",e)}});return t.extend({initialize:function(e){e=e||{},this.stateModel=new x,this.view=new A({controller:this,model:this.stateModel}),this.listenTo(this.view,"submit-form",this.triggerCorrectSubmit),this.listenTo(this.view,"navigateToLoginForm",this.navigateToLoginForm),this.listenTo(this.view,"navigateToRegisterForm",this.navigateToRegisterForm),this.listenTo(this.view,"navigateToResetPassword1Form",this.navigateToResetPassword1Form),this.listenTo(this.view,"activate-recaptcha",this.activateRecaptcha),e.test&&(window.grecaptcha=null)},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");_.bindAll(this,["handleUserAnnouncement"]),t.subscribe(t.USER_ANNOUNCEMENT,this.handleUserAnnouncement)},navigateToLoginForm:function(){this._navigate({subView:"login"})},navigateToRegisterForm:function(){this._navigate({subView:"register"})},navigateToResetPassword1Form:function(){this._navigate({subView:"reset-password-1"})},_navigate:function(e){var t=this.getPubSub();t.publish(t.NAVIGATE,"authentication-page",e)},setSubView:function(e){this.stateModel.set("subView",e)},handleUserAnnouncement:function(e,t){switch(this.resetAll(),e){case d.prototype.USER_SIGNED_IN:break;case"login_fail":this.view.showLoginForm(t);break;case"register_success":this.view.showRegisterSuccessView();break;case"register_fail":this.view.showRegisterForm(t);break;case"reset_password_1_success":this.view.showResetPasswordSuccessView();break;case"reset_password_1_fail":this.view.showResetPasswordForm1()}},resetAll:function(){this.view.logInModel.reset(),this.view.registerModel.reset(),this.view.resetPassword1Model.reset()},triggerCorrectSubmit:function(e){var t=e.toJSON();"REGISTER"==e.target?(_.extend(t,{verify_url:location.origin+"/#user/account/verify/"+r.REGISTER}),this.getBeeHive().getObject("Session").register(e.toJSON())):"USER"==e.target?this.getBeeHive().getObject("Session").login(e.toJSON()).done(function(){}):"RESET_PASSWORD"==e.target&&"POST"===e.method?this.getBeeHive().getObject("Session").resetPassword1(t):"RESET_PASSWORD"==e.target&&"PUT"===e.method&&this.getBeeHive().getObject("Session").resetPassword2(t)},onShow:function(){this.view.render()},activateRecaptcha:function(e){this.getBeeHive().getObject("RecaptchaManager").activateRecaptcha(e)}})}),define("hbs!js/widgets/user_settings/templates/api_key",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n            <p><i class="icon-loading"></i> Loading...</p>\n\n'},3:function(e,t,n,i){var a;return'\n        <div class="input-group">\n            <input type="text" class="form-control" readonly value="'+(null!=(a=t.if.call(e,null!=e?e.access_token:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?a:"")+'" style="cursor:text">\n              <span class="input-group-btn">\n                <button class="btn btn-primary-faded" type="submit">Generate a new key</button>\n              </span>\n        </div>\x3c!-- /input-group --\x3e\n\n        <div class="description">\n            <br/>\n            <br/>\n            <p> This API token allows you to access ADS data programmatically. For instance, to fetch the first few bibcodes for the query "star", make the following request: </p>\n            <p>\n                <code> curl -H \'Authorization: Bearer:'+(null!=(a=t.if.call(e,null!=e?e.access_token:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+"' 'https://api.adsabs.harvard.edu/v1/search/query?q=star&fl=bibcode'</code>\n            </p>\n            <p>\n                <i>(If you've generated a token, you can copy-paste the preceding line directly into your terminal)</i>\n            </p>\n            <p> Documentation on how to use the API is available on the <a href=\"https://github.com/adsabs/adsabs-dev-api#access-settings\"> ADS API Github repo.</a></p>\n            <p> <b>Make sure to keep your API key secret to protect it from abuse.</b></p>\n            <p> If your key has been exposed publically (say, by accidentally  being commited to a Github repo) you can generate a new one by clicking on the button above. </p>\n        </div>\n\n"},4:function(e,t,n,i){var a;return this.escapeExpression("function"==typeof(a=null!=(a=t.access_token||(null!=e?e.access_token:e))?a:t.helperMissing)?a.call(e,{name:"access_token",hash:{},data:i}):a)},6:function(e,t,n,i){return" No token currently exists "},8:function(e,t,n,i){return"[YOUR TOKEN HERE]"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="panel panel-default form-horizontal s-form-container">\n    <legend class="panel-heading"> API Token\n    </legend>\n    <div class="panel-body">\n\n'+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"\n    </div>\n\n\n</div>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/api_key",n),n}),define("hbs!js/widgets/user_settings/templates/change_email",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="panel panel-default s-form-container">\n    <legend class="panel-heading"> Change Email Address\n    </legend>\n    <form class="panel-body">\n        <div class="form-group">\n            <label class="control-label">Current email address:&nbsp;&nbsp; </label>\n            <p class="form-control-static">'+this.escapeExpression("function"==typeof(a=null!=(a=t.user||(null!=e?e.user:e))?a:t.helperMissing)?a.call(e,{name:"user",hash:{},data:i}):a)+'</p>\n        </div>\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> New email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="email" id="email">\n        </div>\n\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> Confirm new email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="confirm-email" id="confirm-email">\n        </div>\n\n        <div class="form-group has-feedback">\n            <label for="password" class="control-label"> Password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password" id="password">\n        </div>\n\n        <div class="form-group">\n           <div>\n                You will be logged out of your account until you click\n                the link from the verification email.\n            </div>\n            <button class="btn btn-primary-faded initial-submit" type="submit" data-toggle="modal" data-target=".confirm-change-email">Change my email</button>\n\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/change_email",n),n}),define("hbs!js/widgets/user_settings/templates/change_password",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default s-form-container">\n    <legend class="panel-heading"> Change Your Password\n    </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="old_password" class="control-label"> Current password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="old_password" id="old_password">\n        </div>\n        <div class="form-group has-feedback">\n            <label for="new_password1" class="control-label"> New password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <div class="s-user-help">Passwords should be at least five characters and include at least one number and one letter.</div>\n            <input type="password" class="form-control" name="new_password1" id="new_password1" >\n\n        </div>\n        <div class="form-group has-feedback">\n            <label for="new_password2" class="control-label"> Retype new password  </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="new_password2" id="new_password2">\n\n        </div>\n\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/change_password",n),n}),define("hbs!js/widgets/user_settings/templates/delete_account",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default s-form-container">\n    <legend class="panel-heading">Delete Account\n    </legend>\n    <div class="panel-body">\n        <div class="form-group">\n            <p> This action cannot be reversed.\n            </p>\n            <div>\n                <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".confirm-delete">Delete my account</button>\n            </div>\n        </div>\n\n    </div>\n</div>\n\n<div class="modal fade confirm-delete" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">\n    <div class="modal-dialog modal-sm">\n        <div class="modal-content">\n            <div class="modal-header">\n              <h4>  <i class="fa fa-lg fa-exclamation-triangle"></i> Confirm deletion</h4>\n            </div>\n            <div class="modal-body">\n                Are you sure you want to delete your account permanently?\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>\n                <button type="submit" class="btn btn-sm btn-primary" data-dismiss="modal">Yes, delete my account</button>\n            </div>\n        </div>\n\n    </div>\n</div>'},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/delete_account",n),n}),define("js/widgets/user_settings/widget",["marionette","js/widgets/base/base_widget","js/mixins/form_view_functions","js/widgets/success/view","js/components/api_feedback","hbs!js/widgets/user_settings/templates/api_key","hbs!js/widgets/user_settings/templates/change_email","hbs!js/widgets/user_settings/templates/change_password","hbs!js/widgets/user_settings/templates/delete_account","backbone-validation","backbone.stickit","bootstrap"],function(e,t,n,i,a,r,s,o,l,c){var u,d,h,p,f,g,m,b,v,y,w,S=/(?=.*\d)(?=.*[a-zA-Z]).{5,}/;u=e.ItemView.extend({activateValidation:n.activateValidation,checkValidationState:n.checkValidationState,triggerSubmit:n.triggerSubmit,modelEvents:{change:"checkValidationState"},events:{"click button[type=submit]":"triggerSubmit"}}),p=(d=Backbone.Model.extend({isValidSafe:n.isValidSafe,reset:n.reset})).extend({validation:{email:{required:!0,pattern:"email",msg:"(A valid email is required)"},"confirm-email":{required:!0,pattern:"email",equalTo:"email",msg:"(This email must be valid and match the one above)"},password:{required:!0,pattern:S,msg:"(A valid password is required)"}}}),h=u.extend({template:s,className:"change-email",triggerSubmit:function(){this.model.unset("user"),n.triggerSubmit.apply(this,arguments)},checkValidationState:function(){this.model.isValidSafe()&&this.$("button.initial-submit").prev(".help-block").html("").addClass("no-show")},bindings:{"input[name=email]":{observe:"email",setOptions:{validate:!0}},"input[name=confirm-email]":{observe:"confirm-email",setOptions:{validate:!0}},"input[name=password]":{observe:"password",setOptions:{validate:!0}}},onRender:function(){this.activateValidation()}}),g=d.extend({validation:{old_password:{required:!0,pattern:S,msg:"(A valid password is required)"},new_password1:{required:!0,pattern:S,msg:"(A valid password is required)"},new_password2:{required:!0,equalTo:"new_password1",pattern:S,msg:"(The passwords do not match)"}}}),f=u.extend({template:o,className:"change-password",onRender:function(){this.activateValidation()},bindings:{"input[name=old_password]":{observe:"old_password",setOptions:{validate:!0}},"input[name=new_password1]":{observe:"new_password1",setOptions:{validate:!0}},"input[name=new_password2]":{observe:"new_password2",setOptions:{validate:!0}}}}),b=Backbone.Model.extend({defaults:function(){return{access_token:void 0,loading:!1}}}),m=e.ItemView.extend({template:r,className:"change-token",triggerSubmit:n.triggerSubmit,events:{"click button[type=submit]":"triggerSubmit"},modelEvents:{"change:access_token":"render","change:loading":"render"}}),y=d.extend({}),v=u.extend({template:l,className:"delete-account",triggerSubmit:function(){this.$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),n.triggerSubmit.apply(this,arguments)}}),w=e.LayoutView.extend({template:function(){return'<div class="content-container"></div>'},className:"s-user-settings s-form-widget",regions:{content:".content-container"},events:{"click .user-pill-nav a:not(.dropdown-toggle)":"stopPropagation"},stopPropagation:function(){return!1},setSubView:function(t){var n=e.getOption(this,"config"),i=new n[t].model,a=new n[t].view({model:i}),r=this;this.model.set("subView",t),"token"==t?this.model.get("access_token")?i.set("access_token",this.model.get("access_token")):(i.set("loading",!0),this.getToken().done(function(e){r.model.set("access_token",e.access_token),i.set("access_token",e.access_token),i.set("loading",!1)})):"email"==t&&i.set("user",this.model.get("user")),this.listenToOnce(a,"submit-form",this.forwardSubmit),this.content.show(a)},showPasswordSuccessView:function(){this.content.show(new i({title:"Password Changed",message:"Next time you log in, please use your new password"}))},forwardSubmit:function(e){this.trigger("submit-form",e)}});var E=Backbone.Model.extend({defaults:function(){return{user:void 0,token:void 0,subView:void 0}}});return t.extend({config:{email:{view:h,model:p},password:{view:f,model:g},token:{view:m,model:b},delete:{view:v,model:y}},initialize:function(e){e=e||{},this.model=new E,this.view=new w({model:this.model,config:this.config}),t.prototype.initialize.apply(this,arguments)},setSubView:function(e){_.isArray(e)&&(e=e[0]),this.view.setSubView(e)},activate:function(e){var t=this;this.setBeeHive(e);var n=e.getService("PubSub");_.bindAll(this,["handleUserAnnouncement"]),n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),this.view.getToken=function(){return t.getBeeHive().getObject("User").getToken()},this.model.set("user",this.getBeeHive().getObject("User").getUserName())},viewEvents:{"submit-form":"submitForm"},handleUserAnnouncement:function(e,t){var n=this.getBeeHive().getObject("User");e==n.USER_SIGNED_IN?this.model.set("user",t):e==n.USER_SIGNED_OUT&&this.model.clear()},submitForm:function(e){var t=this.getBeeHive().getObject("User"),n=this;e instanceof this.config.token.model?t.generateToken().done(function(e){n.model.set("access_token",e.access_token),n.setSubView("token")}):e instanceof this.config.delete.model?t.deleteAccount():e instanceof this.config.email.model?t.changeEmail(e.toJSON()):e instanceof this.config.password.model&&t.changePassword(e.toJSON()).done(function(){n.view.showPasswordSuccessView()})}})}),define("hbs!js/widgets/preferences/templates/openurl",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'      <div class="alert alert-danger">\n        Error retrieving user link servers, please try again later.\n      </div>\n'},3:function(e,t,n,i){return'      <div class="row">\n        <div class="col-sm-12 text-center">\n          <i class="icon-loading"></i> Loading...\n        </div>\n      </div>\n'},5:function(e,t,n,i,a,r){var s;return null!=(s=t.unless.call(e,null!=e?e.openURLError:e,{name:"unless",hash:{},fn:this.program(6,i,0,a,r),inverse:this.noop,data:i}))?s:""},6:function(e,t,n,i,a,r){var s;return'        <div class="row">\n          <div class="col-sm-12">\n'+(null!=(s=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(7,i,0,a,r),inverse:this.program(9,i,0,a,r),data:i}))?s:"")+'          </div>\n        </div>\n        <div class="help-block">\n          <button id="change-link-server" class="btn btn-primary">\n            <i class="fa fa-cog"></i> Update\n          </button>\n          <button id="clear-link-server"\n            class="btn btn-link '+(null!=(s=t.if.call(e,null!=e?e.editing:e,{name:"if",hash:{},fn:this.program(11,i,0,a,r),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.openURLName:e,void 0,{name:"compare",hash:{},fn:this.program(11,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'">\n            <span class="text-danger">\n              <i class="fa fa-trash"></i> Clear\n            </span>\n          </button>\n        </div>\n'+(null!=(s=t.if.call(e,null!=e?e.editing:e,{name:"if",hash:{},fn:this.program(13,i,0,a,r),inverse:this.noop,data:i}))?s:"")+(null!=(s=t.if.call(e,null!=e?e.confirming:e,{name:"if",hash:{},fn:this.program(17,i,0,a,r),inverse:this.noop,data:i}))?s:"")+(null!=(s=t.unless.call(e,null!=e?e.confirming:e,{name:"unless",hash:{},fn:this.program(19,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'        <div class="row">\n          <div class="col-md-8">\n            <div class="h4">\n              <i class="fa fa-question-circle"></i>\n              What Is a Library Link Server?\n            </div>\n            <p>\n              Users who have access to electronic resources through their library\n              subscriptions can configure their user preferences so that the appropriate\n              links to the fulltext will be provided when viewing a record in the ADS.\n            </p>\n            <p>\n              After your selection, look for the <span class="link-server-univ-icon"><strong>My Institution</strong> <i class="fa fa-university"></i></span>\n              entry in the source list on an abstract page.\n            </p>\n            <p>\n              If you find your institution in the above list, please select it so that we\n              can generate the appropriate links for you. For more information,\n              please visit our <a rel="noopener" target="_blank" href="//adsabs.github.io/help/userpreferences/library-servers">Help Docs.</a>\n            </p>\n          </div>\n          <div class="col-md-4"></div>\n        </div>\n        <div class="row">\n          <div class="col-md-8">\n              <div class="h4">\n                <i class="fa fa-exclamation-triangle"></i>\n                Institution Not Found?\n              </div>\n              <p>\n                Please contact your electronic resources librarian and request that\n                they email <em>adshelp@cfa.harvard.edu</em> with the relevant\n                openurl information.\n              </p>\n              <p>\n                If you are still having difficulties,\n                <strong><a href="mailto:adshelp@cfa.harvard.edu">Contact Us</a></strong>\n                for help.\n              </p>\n          </div>\n          <div class="col-md-4"></div>\n        </div>\n'},7:function(e,t,n,i){var a;return'              <div class="h4">\n                Current Link Server: <strong>'+this.escapeExpression("function"==typeof(a=null!=(a=t.openURLName||(null!=e?e.openURLName:e))?a:t.helperMissing)?a.call(e,{name:"openURLName",hash:{},data:i}):a)+"</strong>.\n              </div>\n"},9:function(e,t,n,i){return'              <div class="h4">\n                No Link Server Selected.\n              </div>\n'},11:function(e,t,n,i){return" disabled "},13:function(e,t,n,i,a,r){var s;return'        <div class="link-server-form-container">\n          <form class="form-inline">\n            <div class="input-group">\n              <label for="set-link-server">Choose Your Institution\n                <select name="set-link-server" id="set-link-server" class="form-control" style="width: 100%">\n'+(null!=(s=t.each.call(e,null!=e?e.openURLConfig:e,{name:"each",hash:{},fn:this.program(14,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'                </select>\n              </label>\n            </div>\n            <div class="help-block">\n              <button class="btn btn-success" id="link-server-apply">Apply</button>\n              <button class="btn btn-danger" id="link-server-cancel">Cancel</button>\n            </div>\n          </form>\n        </div>\n'},14:function(e,t,n,i,a,r){var s;return'                  <option value="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=r[1]?r[1].link_server:r[1],null!=e?e.link:e,{name:"compare",hash:{},fn:this.program(15,i,0,a,r),inverse:this.noop,data:i}))?s:"")+">"+(null!=(s=this.lambda(null!=e?e.name:e,e))?s:"")+"</option>\n"},15:function(e,t,n,i){return' selected="selected" '},17:function(e,t,n,i){return'          <div id="link-server-clear-confirm">\n            <div class="row col-sm-6 col-sm-offset-3">\n              <div class="alert alert-info text-center">\n                <p>\n                  <strong>Are you sure?</strong>\n                </p>\n                <p>\n                  <button class="btn btn-success btn-sm submit" id="clear-link-server-confirm">Yes, clear</button>\n                  <button class="btn btn-danger btn-sm reset" id="clear-link-server-cancel">Cancel</button>\n                </p>\n              </div>\n            </div>\n            <div class="col-sm-3"></div>\n          </div>\n'},19:function(e,t,n,i){return'          <hr class="hr">\n'},21:function(e,t,n,i){return'  <p>\n    <i class="icon-loading"></i>\n    Loading...\n  </p>\n'},23:function(e,t,n,i,a,r){var s;return(null!=(s=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(24,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'\n    <div id="link-server-container" class="'+(null!=(s=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(27,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'">\n      <br/>\n      <form class="form-inline">\n        <div class="form-group" style="min-width:300px">\n          <label for="set-link-server">Choose Your Institution</label>\n          <br/>\n          <select name="set-link-server" id="set-link-server" class="form-control" style="width: 100%">\n'+(null!=(s=t.each.call(e,null!=e?e.openURLConfig:e,{name:"each",hash:{},fn:this.program(29,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'          </select>\n        </div>\n        <button class="btn btn-sm btn-success submit">submit</button>\n\n        <br/>\n        <br/>\n        <br/>\n\n        <p>\n          <b>Can\'t find your institution in the list above?</b>\n        </p>\n        <p>\n          Please contact your electronic resources librarian and request that he or she email adshelp@cfa.harvard.edu with the relevant\n          openurl information.\n        </p>\n        <p>\n          If you are still having difficulties,\n          <b>\n            <a href="mailto:adshelp@cfa.harvard.edu">contact us</a>\n          </b> for help.\n        </p>\n      </form>\n      <br/>\n      <div>\n        <div class="h3">\n          <i class="fa fa-question-circle"></i>\n          What Is a Library Link Server?\n        </div>\n        <p>\n          Users who have access to electronic resources through their library\n          subscriptions can configure their user preferences so that the appropriate\n          links to the fulltext will be provided when viewing a record in the ADS.\n        </p>\n        <p>\n          Look for the <span class="link-server-univ-icon"><strong>My Institution</strong> <i class="fa fa-university"></i></span>\n          entry in the source list on the abstract page.\n        </p>\n        <p>\n          If you find your institution in the above list, please select it so that we\n          can generate the appropriate links for you. For more information,\n          please visit our <a href="//adsabs.github.io/help/userpreferences/library-servers">Help Docs.</a>\n        </p>\n      </div>\n    </div>\n\n'+(null!=(s=t.if.call(e,null!=e?e.showConfirm:e,{name:"if",hash:{},fn:this.program(31,i,0,a,r),inverse:this.noop,data:i}))?s:"")},24:function(e,t,n,i){var a,r;return'    <div class="current-link-server">\n      <p>Your Library Link Server is set to\n      <b>'+(null!=(a="function"==typeof(r=null!=(r=t.openURLName||(null!=e?e.openURLName:e))?r:t.helperMissing)?r.call(e,{name:"openURLName",hash:{},data:i}):r)?a:"")+'</b>.</p>\n      <button id="change-link-server" class="btn btn-primary-faded '+(null!=(a=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.noop,data:i}))?a:"")+'" data-toggle="collapse" data-target="#link-server-container">\n      <i class="toggle-icon"></i> Change Library Link Server</button>\n      <button id="clear-link-server" class="btn btn-danger">Clear Link Server</button>\n    </div>\n'},25:function(e,t,n,i){return" collapsed "},27:function(e,t,n,i){return" collapse "},29:function(e,t,n,i,a,r){var s;return'            <option value="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=r[1]?r[1].link_server:r[1],null!=e?e.link:e,{name:"compare",hash:{},fn:this.program(15,i,0,a,r),inverse:this.noop,data:i}))?s:"")+">"+(null!=(s=this.lambda(null!=e?e.name:e,e))?s:"")+"</option>\n"},31:function(e,t,n,i){return'      <div id="link-server-clear-confirm">\n        <div class="container">\n          <div class="row" style="margin-top: 20px; max-width: 300px">\n            <div class="alert alert-info text-center">\n              <p>\n                <strong>Are you sure?</strong>\n              </p>\n              <p>\n                <button class="btn btn-success btn-sm" id="clear-link-server-confirm">Yes, clear</button>\n                <button class="btn btn-danger btn-sm" id="clear-link-server-cancel">Cancel</button>\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s;return'<div class="panel-heading"> Library Link Server </div>\n\n<div class="panel-body">\n  <div class="container-fluid link-server-container">\n'+(null!=(s=t.if.call(e,null!=e?e.openURLError:e,{name:"if",hash:{},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+(null!=(s=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(3,i,0,a,r),inverse:this.program(5,i,0,a,r),data:i}))?s:"")+"  </div>\n\n\n\n\n\x3c!--\n\n"+(null!=(s=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(21,i,0,a,r),inverse:this.program(23,i,0,a,r),data:i}))?s:"")+"</div> --\x3e\n"},useData:!0,useDepths:!0});return t.registerPartial("js/widgets/preferences/templates/openurl",n),n}),define("js/widgets/preferences/views/openurl",["marionette","hbs!js/widgets/preferences/templates/openurl","bootstrap","select2"],function(e,t,n,i){return e.ItemView.extend({template:t,className:"panel panel-default s-form-container",onRender:function(){this.$("select[name=set-link-server]").select2()},serializeData:function(){var e=this.model.toJSON();if(e.openURLError)return e.loading=!1,e;if(_.isEmpty(e.openURLConfig)||_.isEmpty(e.user))return e.loading=!0,e;_.isEmpty(e.openURLName)&&(e.openURLName="None",this.editing=!0);var t=_.find(e.openURLConfig,{link:e.link_server});return e.openURLName=!!t&&t.name,e},modelEvents:{"change:link_server":"render","change:user":"render","change:openURLConfig":"render","change:editing":"render","change:confirming":"render","change:loading":"render","change:openURLError":"render"},events:{"click #link-server-apply":"changeLinkServer","click #link-server-cancel":"onCancelLinkServer","click #change-link-server":"onChangeClick","click #clear-link-server":"onClearClick","click #clear-link-server-confirm":"onConfirmClear","click #clear-link-server-cancel":"onConfirmCancel"},changeLinkServer:function(e){e.preventDefault();var t=this.$("#set-link-server").val();if(this.model.has("link_server")&&t===this.model.get("link_server"))return this.model.set("editing",!1);this.$(e.currentTarget).html('<i class="fa fa-spinner fa-pulse"></i> Loading'),this.trigger("change:link_server",t),this.model.set("editing",!1)},onCancelLinkServer:function(){this.model.set({editing:!1,confirming:!1,showConfirm:!1})},onChangeClick:function(){if(this.model.get("editing"))return this.model.set("editing",!1);this.model.set({confirming:!1,editing:!0})},onClearClick:function(){this.model.set({editing:!1,confirming:!0})},onConfirmCancel:function(){this.model.set({editing:!1,confirming:!1})},onConfirmClear:function(){this.trigger("change:link_server",""),this.model.set({openURLName:"",editing:!1,confirming:!1})}})}),define("hbs!js/widgets/preferences/templates/orcid",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <div class="panel-heading">ORCID SETTINGS</div>\n<div class="panel-body"> <p><i class="icon-loading"></i> Loading...</p></div>\n'},3:function(e,t,n,i){var a;return'\n    <div class="panel-heading">\n\n        ORCID Settings\n'+(null!=(a=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'\n    </div>\n    <div class="panel-body">\n\n'+(null!=(a=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(17,i,0),data:i}))?a:"")+"    </div>\n\n\n"},4:function(e,t,n,i){var a;return"        <h4>You are signed in to ORCID as <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.prettyOrcidName||(null!=e?e.prettyOrcidName:e))?a:t.helperMissing)?a.call(e,{name:"prettyOrcidName",hash:{},data:i}):a)+'</b></h4>\n\n        <p> Not you?\n            <button class="btn btn-sm btn-default orcid-authenticate">Sign into ORCID as a different user</button>\n        </p>\n'},6:function(e,t,n,i){var a,r;return'\n        <div class="form-group">\n            <h4>1. Your Current Academic Affiliation</h4>\n            <div class="form-group">\n                <label for="#aff-input" class="sr-only">your current academic affiliation</label>\n                <input type="text"\n                       '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.userSubmitted:e)?a.currentAffiliation:a,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'\n                id="aff-input"\n                class="form-control"\n                placeholder="e.g. Wesleyan University"\n                style="width:300px">\n            </div>\n        </div>\n\n        <br>\n        <h4 id="name-variant-header">2. Names Under Which You Have Published</h4>\n        <p class="emphasis-text">\n            If you have published under a different surname, for example,\n            or using a middle name, please add those name variations here.\n        </p>\n\n        <div class="form-group well orcid-name-container clearfix" aria-labelledby="#name-variant-header">\n\n            <div class="input-list">\n                <div class="original-orcid-name">\n                    \x3c!--this isnt editable--\x3e\n                    <label for="original-orcid-name">ORCID name</label>\n                    <input class="form-control input-list__input"\n                           type="text"\n                           id="original-orcid-name"\n                           value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidName||(null!=e?e.orcidName:e))?r:t.helperMissing)?r.call(e,{name:"orcidName",hash:{},data:i}):r)+'" disabled>\n                </div>\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.userSubmitted:e)?a.nameVariations:a,{name:"each",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'                <button class="btn btn-primary-faded pull-right add-another-orcid-name"><i class="fa fa-plus"> </i> add a name</button>\n\n                <div class="warning '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.userSubmitted:e)?a.authorizedUser:a,!1,{name:"compare",hash:{operator:"!=="},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" style="clear:both;padding-top:15px" >\n                <i class="fa fa-lg fa-warning"></i>\n                To become an ADS-verified user and have the above name data used to enrich your ORCID matches in ADS, you must check the box below.\n            </div>\n        </div>\n    </div>\n    <br>\n    <div class="form-group">\n        <h4> 3. Permission for ADS to Record and Publish Claims</h4>\n\n        <div class="checkbox">\n            <label class="emphasis-text">\n                <input type="checkbox"\n                       '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.userSubmitted:e)?a.authorizedUser:a,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?a:"")+"\n                "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.userSubmitted:e)?a.authorizedUser:a,void 0,{name:"compare",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?a:"")+'\n                class="authorized-ads-user">\n                I allow the ADS to record my claims and to make them available publically for auditing and indexing.\n                <br>This makes me an "ADS Verified User" and allows ADS to validate my name(s) against author lists in papers.\n            </label>\n        </div>\n\n    </div>\n\n    <br>\n\n    <button class="submit btn btn-success">submit</button>\n\n'},7:function(e,t,n,i){var a;return' value="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.userSubmitted:e)?a.currentAffiliation:a,e))+'" '},9:function(e,t,n,i){return'                <div class="orcid-name-row">\n                    <input class="form-control input-list__input" type="text" placeholder="Last, First Middle"  value="'+this.escapeExpression(this.lambda(e,e))+'">\n                    <button class="btn btn-danger btn-inverse remove-name" title="remove this name"><i class="fa fa-minus-circle"></i></button>\n                </div>\n'},11:function(e,t,n,i){return" hidden "},13:function(e,t,n,i){return" checked "},15:function(e,t,n,i){return" checked  "},17:function(e,t,n,i){return'    <br>\n    <button class="btn btn-success orcid-authenticate">Authenticate with ORCID to view ADS ORCID Settings\n    </button>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"\n"},useData:!0});return t.registerPartial("js/widgets/preferences/templates/orcid",n),n}),define("hbs!js/widgets/preferences/templates/orcid-name-row-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="orcid-name-row">\n    <input class="form-control input-list__input" type="text" placeholder="Last, First Middle">\n    <button class="btn btn-danger btn-inverse remove-name" title="remove this name"><i class="fa fa-minus-circle"></i></button>\n</div>'},useData:!0});return t.registerPartial("js/widgets/preferences/templates/orcid-name-row-template",n),n}),define("js/widgets/preferences/views/orcid",["marionette","hbs!js/widgets/preferences/templates/orcid","hbs!js/widgets/preferences/templates/orcid-name-row-template"],function(e,t,n){return e.ItemView.extend({template:t,className:"panel panel-default s-form-container",events:{"click  .submit":"submitForm","change .authorized-ads-user":"toggleWarning","click .add-another-orcid-name":"addNameRow","click .remove-name":"removeNameRow"},toggleWarning:function(e){this.$(".authorized-ads-user").is(":checked")?this.$(".orcid-name-container .warning").addClass("hidden"):this.$(".orcid-name-container .warning").removeClass("hidden")},addNameRow:function(e){this.$(".add-another-orcid-name").before(n())},removeNameRow:function(e){$(arguments[0].currentTarget).parent().remove()},triggers:{"click .orcid-authenticate":"orcid-authenticate"},modelEvents:{change:"render"},submitForm:function(e){e.preventDefault();var t={};t.currentAffiliation=this.$("#aff-input").val(),t.authorizedUser=this.$(".authorized-ads-user").is(":checked"),t.nameVariations=this.$(".orcid-name-row").map(function(e){return $(this).find("input").val()}).get();this.$(".submit").html('<i class="fa fa-spinner fa-pulse"></i> Loading'),this.trigger("orcid-form-submit",t)}})}),define("hbs!js/widgets/preferences/templates/application",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i,a,r){var s;return'              <option\n                value="'+this.escapeExpression(this.lambda(e,e))+'"\n                '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,e,null!=r[1]?r[1].numAuthorsSelected:r[1],{name:"compare",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n              >"+this.escapeExpression(this.lambda(e,e))+"</option>\n"},2:function(e,t,n,i){return' selected="selected" '},4:function(e,t,n,i,a,r){var s;return'              <option\n                value="'+this.escapeExpression(this.lambda(e,e))+'"\n                '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,e,null!=r[1]?r[1].externalLinksSelected:r[1],{name:"compare",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n              >"+this.escapeExpression(this.lambda(e,e))+"</option>\n"},6:function(e,t,n,i){var a;return'              <label\n                class="database-select btn btn-default '+(null!=(a=t.if.call(e,null!=e?e.value:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <input type="checkbox" name="database" checked="'+this.escapeExpression(this.lambda(null!=e?e.value:e,e))+'" id="database_'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+'"> '+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"\n              </label>\n"},7:function(e,t,n,i){return" active "},9:function(e,t,n,i,a,r){var s;return'              <option\n                value="'+this.escapeExpression(this.lambda(e,e))+'"\n                '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,e,null!=r[1]?r[1].exportFormatSelected:r[1],{name:"compare",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n              >"+this.escapeExpression(this.lambda(e,e))+"</option>\n"},11:function(e,t,n,i,a,r){var s;return'              <option\n                value="'+this.escapeExpression(this.lambda(e,e))+'"\n                '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,e,null!=r[1]?r[1].hideSideBarsSelected:r[1],{name:"compare",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n              >"+this.escapeExpression(this.lambda(e,e))+"</option>\n"},13:function(e,t,n,i){return'          <i class="text-muted fa fa-refresh fa-spin fa-3x"></i>\n'},15:function(e,t,n,i){return'          <div class="alert alert-success fade in">\n            <i class="fa fa-check fa-2x"></i>\n            <strong>Settings updated successfully</strong>\n          </div>\n'},17:function(e,t,n,i){return'          <div class="alert alert-danger fade in">\n            <i class="fa fa-times fa-3x"></i>\n            <strong>Settings not updated, please try again.</strong>\n          </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s,o;return'<div class="panel-heading">Application Settings</div>\n\n<div class="panel-body" id="application-settings-container">\n  <div class="row">\n    <div class="col-md-12">\n      <form role="form" class="form-horizontal">\n\n        \x3c!-- NUM AUTHORS --\x3e\n        <div class="form-group">\n          <label for="numAuthors">\n            Authors Visible Per Result\n            <a href="#collapseNumAuthorsDesc" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseNumAuthorsDesc">\n              <i class="fa fa-question-circle"></i>\n            </a>\n          </label>\n          <p>\n            <div class="collapse" id="collapseNumAuthorsDesc">\n              <div class="card card-body text-muted">\n                <p>\n                    Specifies the number of authors to show\n                    under each result before the list is truncated.\n                    <br>\n                    (<strong>default: '+this.escapeExpression("function"==typeof(o=null!=(o=t.numAuthorsDefault||(null!=e?e.numAuthorsDefault:e))?o:t.helperMissing)?o.call(e,{name:"numAuthorsDefault",hash:{},data:i}):o)+'</strong>)\n                </p>\n              </div>\n            </div>\n          </p>\n          <select class="form-control" id="numAuthors" aria-describedby="collapseNumAuthorsDesc">\n'+(null!=(s=t.each.call(e,null!=e?e.numAuthorsOptions:e,{name:"each",hash:{},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'          </select>\n        </div>\n\n        \x3c!-- Always Open Links In New Tab/Same Tab --\x3e\n        <div class="form-group">\n          <label for="externalLinks">\n            Default Action For External Links\n            <a href="#collapseExternalLinks" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseExternalLinks">\n              <i class="fa fa-question-circle"></i>\n            </a>\n          </label>\n          <p>\n            <div class="collapse" id="collapseExternalLinks">\n              <div class="card card-body text-muted">\n                <p>\n                  Select the default action when opening an external link.\n                  <br>\n                  (<strong>default: '+this.escapeExpression("function"==typeof(o=null!=(o=t.externalLinksDefault||(null!=e?e.externalLinksDefault:e))?o:t.helperMissing)?o.call(e,{name:"externalLinksDefault",hash:{},data:i}):o)+'</strong>)\n                </p>\n              </div>\n            </div>\n          </p>\n          <select class="form-control" id="externalLinks" aria-describedby="collapseExternalLinks">\n'+(null!=(s=t.each.call(e,null!=e?e.externalLinksOptions:e,{name:"each",hash:{},fn:this.program(4,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'          </select>\n        </div>\n\n        \x3c!-- Default Database --\x3e\n        <div class="form-group">\n          <label for="database">\n            Default Database(s)\n            <a href="#collapseDatabase" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseDatabase">\n              <i class="fa fa-question-circle"></i>\n            </a>\n          </label>\n          <p>\n            <div class="collapse" id="collapseDatabase">\n              <div class="card card-body text-muted">\n                <p>\n                  This will apply a default database\n                  facet to each search.  You can manually remove or alter it from there.\n                  <br>\n                  (<strong>default: none</strong>)\n                </p>\n              </div>\n            </div>\n          </p>\n          <div class="btn-group" data-toggle="buttons">\n'+(null!=(s=t.each.call(e,null!=e?e.databaseSelected:e,{name:"each",hash:{},fn:this.program(6,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'          </div>\n        </div>\n\n        \x3c!-- Default Export Format --\x3e\n        <div class="form-group">\n          <label for="exportFormat">\n            Default Export Format\n            <a href="#collapseExportFormat" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseExportFormat">\n              <i class="fa fa-question-circle"></i>\n            </a>\n          </label>\n          <p>\n            <div class="collapse" id="collapseExportFormat">\n              <div class="card card-body text-muted">\n                <p>\n                    Select the default export format you would like to use\n                    when opening the Export tool.\n                    <br>\n                    (<strong>default: '+this.escapeExpression("function"==typeof(o=null!=(o=t.exportFormatDefault||(null!=e?e.exportFormatDefault:e))?o:t.helperMissing)?o.call(e,{name:"exportFormatDefault",hash:{},data:i}):o)+'</strong>)\n                </p>\n              </div>\n            </div>\n          </p>\n          <select class="form-control" id="exportFormat" aria-describedby="collapseExportFormat">\n'+(null!=(s=t.each.call(e,null!=e?e.exportFormatOptions:e,{name:"each",hash:{},fn:this.program(9,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'          </select>\n        </div>\n\n        \x3c!-- Default Show/Hide Sidebars --\x3e\n        <div class="form-group">\n          <label for="hideSideBars">\n            Results List Side Bars\n            <a href="#collapseHideSideBars" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseHideSideBars">\n              <i class="fa fa-question-circle"></i>\n            </a>\n          </label>\n          <p>\n            <div class="collapse" id="collapseHideSideBars">\n              <div class="card card-body text-muted">\n                <p>\n                    Select the default state of the results list sidebars (hide/show)\n                    <br>\n                    (<strong>default: '+this.escapeExpression("function"==typeof(o=null!=(o=t.hideSideBarsDefault||(null!=e?e.hideSideBarsDefault:e))?o:t.helperMissing)?o.call(e,{name:"hideSideBarsDefault",hash:{},data:i}):o)+'</strong>)\n                </p>\n              </div>\n            </div>\n          </p>\n          <select class="form-control" id="hideSideBars" aria-describedby="collapseHideSideBars">\n'+(null!=(s=t.each.call(e,null!=e?e.hideSideBarsOptions:e,{name:"each",hash:{},fn:this.program(11,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'          </select>\n        </div>\n\n        <hr class="hr">\n        <button class="btn btn-primary" role="submit" id="appSettingsSubmit">Save</button>\n        <button class="btn btn-default" role="reset" id="appSettingsCancel">Cancel</button>\n        <a href="#" class="link" id="appSettingsReset">Reset To Defaults</a>\n      </form>\n\n      <div class="col-md-6 col-md-offset-3 text-center">\n'+(null!=(s=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(13,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n"+(null!=(s=t.if.call(e,null!=e?e.updateSucceeded:e,{name:"if",hash:{},fn:this.program(15,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n"+(null!=(s=t.if.call(e,null!=e?e.updateFailed:e,{name:"if",hash:{},fn:this.program(17,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"      </div>\n    </div>\n  </div>\n</div>\n"},useData:!0,useDepths:!0});return t.registerPartial("js/widgets/preferences/templates/application",n),n}),define("js/widgets/config",[],function(){return{export:{formats:[{value:"bibtex",label:"BibTeX",help:"BibTeX format",ext:"bbl"},{value:"ads",label:"ADS",help:"ADS format",ext:"txt"},{value:"bibtexabs",label:"BibTeX ABS",help:"BibTeX with abstracts",ext:"bbl"},{value:"endnote",label:"EndNote",help:"EndNote format",ext:"enw"},{value:"procite",label:"ProCite",help:"ProCite format",ext:"txt"},{value:"ris",label:"RIS",help:"Research Information Systems (RIS) format",ext:"txt"},{value:"refworks",label:"RefWorks",help:"RefWorks format",ext:"txt"},{value:"rss",label:"RSS",help:"RSS format",ext:"rss"},{value:"medlars",label:"MEDLARS",help:"Medical Literature Analysis and Retrieval System (MEDLARS) format",ext:"txt"},{value:"dcxml",label:"DC-XML",help:"Dublin Core XML format",ext:"xml"},{value:"refxml",label:"REF-XML",help:"ADS link data in XML format",ext:"xml"},{value:"refabsxml",label:"REFABS-XML",help:"ADS records in XML format",ext:"xml"},{value:"aastex",label:"AASTeX",help:"LaTeX format for AAS journals",ext:"txt"},{value:"icarus",label:"Icarus",help:"LaTeX format for use in Icarus",ext:"txt"},{value:"mnras",label:"MNRAS",help:"LaTeX format for use in MNRAS",ext:"txt"},{value:"soph",label:"Solar Physics",help:"LaTeX format for use in Solar Physics",ext:"txt"},{value:"votable",label:"VOTable",help:"VOTable XML format",ext:"xml"},{value:"custom",label:"Custom Format",help:"Enter Your Own Custom Format",ext:"txt"}]}}}),define("js/widgets/preferences/views/application",["underscore","marionette","hbs!js/widgets/preferences/templates/application","js/widgets/config"],function(e,t,n,i){var a={numAuthors:{initialOptions:e.range(1,11).concat(["all"]),initialValue:4},externalLinks:{initialOptions:["Auto","Open new tab","Open in current tab"],initialValue:"Auto"},exportFormat:{initialOptions:e.map(i.export.formats,"label"),initialValue:"BibTeX"},database:{initialValue:[{name:"Physics",value:!1},{name:"Astronomy",value:!1},{name:"General",value:!1}]},hideSidebars:{initialValue:"Show",initialOptions:["Show","Hide"]}};return t.ItemView.extend({initialize:function(){var t=this.model.get("minAuthorsPerResult")||a.numAuthors.initialValue,n=this.model.get("externalLinkAction")||a.externalLinks.initialValue,i=this.model.get("defaultDatabase")||a.database.initialValue,r=this.model.get("defaultExportFormat")||a.exportFormat.initialValue,s=this.model.get("defaultHideSidebars")||a.hideSidebars.initialValue;this.model.set({numAuthorsOptions:a.numAuthors.initialOptions,numAuthorsDefault:a.numAuthors.initialValue,numAuthorsSelected:this._convertToNumber(e.clone(t)),externalLinksOptions:a.externalLinks.initialOptions,externalLinksDefault:a.externalLinks.initialValue,externalLinksSelected:e.clone(n),databaseSelected:e.cloneDeep(i),exportFormatOptions:a.exportFormat.initialOptions,exportFormatDefault:a.exportFormat.initialValue,exportFormatSelected:e.clone(r),hideSideBarsDefault:a.hideSidebars.initialValue,hideSideBarsOptions:a.hideSidebars.initialOptions,hideSideBarsSelected:e.clone(s)}),this.model.trigger("change")},template:n,className:"panel panel-default s-form-container",events:{"click #appSettingsSubmit":"onSubmit","click #appSettingsCancel":"onCancel","click #appSettingsReset":"onResetToDefaults","click .database-select":"onDatabaseSelect","change select":"syncModel"},modelEvents:{change:"render"},onDatabaseSelect:function(t){var n=this.model.get("databaseSelected"),i=$(".database-select",this.el).index(t.currentTarget),a=e.assign({},n[i],{value:!n[i].value}),r=n.slice(0,i).concat(a).concat(n.slice(i+1));this.model.set("databaseSelected",r),this.model.trigger("change")},_convertToNumber:function(t){try{return e.isNaN(Number(t))?t:Number(t)}catch(e){return t}},_convertToString:function(e){try{return"[object Object]"!==String(e)?String(e):e}catch(t){return e}},syncModel:function(){var e={},t=this._convertToNumber;$(".form-control",this.el).each(function(){var n=$(this),i=n.val();e[n.attr("id")+"Selected"]=t(i)}),this.model.set(e)},onSubmit:function(e){e.preventDefault(),this.model.set({updateSucceeded:!1,updateFailed:!1,loading:!0}),this.syncModel(),this.trigger("change:applicationSettings",{minAuthorsPerResult:this._convertToString(this.model.get("numAuthorsSelected")),externalLinkAction:this.model.get("externalLinksSelected"),defaultDatabase:this.model.get("databaseSelected"),defaultExportFormat:this.model.get("exportFormatSelected"),defaultHideSidebars:this.model.get("hideSideBarsSelected")})},onCancel:function(e){e.preventDefault(),this.initialize()},onResetToDefaults:function(){this.model.set({minAuthorsPerResult:void 0,externalLinkAction:void 0,defaultDatabase:void 0,defaultExportFormat:void 0,defaultHideSidebars:void 0},{unset:!0}),this.onCancel.apply(this,arguments)},onError:function(){var e=this.model;e.set({updateFailed:!0,loading:!1}),setTimeout(function(){e.set("updateFailed",!1)},5e3)},onSuccess:function(){var e=this.model;e.set({updateSucceeded:!0,loading:!1}),setTimeout(function(){e.set("updateSucceeded",!1)},5e3)}})}),define("hbs!js/widgets/preferences/templates/orcid-form-submit-modal",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<p>You can always resubmit the form if your information changes.</p>\n\n<p><a href="#user/orcid" class="btn btn-default">Go to my ORCID profile page in ADS</a></p>\n'},useData:!0});return t.registerPartial("js/widgets/preferences/templates/orcid-form-submit-modal",n),n}),define("js/widgets/preferences/widget",["underscore","marionette","js/widgets/base/base_widget","./views/openurl","./views/orcid","./views/application","js/components/api_feedback","hbs!js/widgets/preferences/templates/orcid-form-submit-modal"],function(e,t,n,i,a,r,s,o){var l=Backbone.Model.extend({defaults:function(){return{openURLConfig:void 0,orcidLoggedIn:void 0}}}),c=t.LayoutView.extend({template:function(){return'<div class="content-container"></div>'},className:"s-preferences preferences-widget",regions:{content:".content-container"},setSubView:function(e){var t=new e({model:this.model});this.getRegion("content").show(t),this.listenTo(t,"all",function(){this.trigger.apply(this,arguments)})}});return n.extend({initialize:function(t){t=t||{},this.model=new l,this.view=new c({model:this.model}),this.listenTo(this.view,"all",this.handleViewEvents),n.prototype.initialize.apply(this,arguments),this.fetchNecessaryData=e.debounce(e.bind(this.fetchNecessaryData,this),300)},activate:function(t){this.setBeeHive(t),e.bindAll(this);var n=t.getService("PubSub");n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),n.subscribe(n.ORCID_ANNOUNCEMENT,this.handleOrcidAnnouncement),this.updateFromUser()},updateFromUser:function(){var e=this.model,t=this.getBeeHive().getObject("User");t.getOpenURLConfig().done(function(t){e.set({openURLConfig:t,openURLError:!1})}).fail(function(){e.set("openURLError",!0)}),e.set(t.getUserData())},views:{orcid:a,librarylink:i,application:r},setSubView:function(t){e.isArray(t)&&(t=t[0]);var n=this.views[t];n?(this.view.setSubView(n),this.fetchNecessaryData.apply(this,arguments)):console.warn("don't recognize this subview: ",t)},fetchNecessaryData:function(t){var n=this;if(this.updateFromUser(),this.model.set("orcidLoggedIn",this.getBeeHive().getService("OrcidApi").hasAccess()),"orcid"===t&&this.model.get("orcidLoggedIn")){this.model.set("loading",!0);var i=this.getBeeHive().getService("OrcidApi").getUserProfile(),a=this.getBeeHive().getService("OrcidApi").getADSUserData();$.when(i,a).done(function(t,i){var a={userSubmitted:e.isArray(i)?i[0]:i};try{var r=t.getFirstName(),s=t.getLastName();a.orcidName=s+", "+r,a.prettyOrcidName=r+" "+s}catch(e){a.orcidName="unknown",a.prettyOrcidName="unknown"}a.loading=!1,n.model.set(a)})}},handleViewEvents:function(t,n,i){var a=this;if("change:link_server"===t)this.getBeeHive().getObject("User").setUserData({link_server:n});else if("orcid-authenticate"===t)this.getBeeHive().getService("OrcidApi").signIn();else if("orcid-form-submit"===t)this.getBeeHive().getService("OrcidApi").setADSUserData(n).done(function(){a.getPubSub().publish(a.getPubSub().ALERT,new s({code:s.CODES.ALERT,msg:o(),type:"success",title:"Thanks for submitting your supplemental ORCID information",modal:!0})),a.setSubView("orcid")}).fail(function(){a.getPubSub().publish(a.getPubSub().ALERT,new s({code:s.CODES.ALERT,msg:"Please try again later.",type:"danger",title:"Your ORCID information was not submitted",modal:!0}))});else if("change:applicationSettings"===t){var r=this.view.content.currentView;this.getBeeHive().getObject("User").setUserData(n).done(e.bind(r.onSuccess,r)).fail(e.bind(r.onError,r))}},handleUserAnnouncement:function(e,t){e==this.getBeeHive().getObject("User").USER_INFO_CHANGE&&this.model.set(t)},handleOrcidAnnouncement:function(e){"login"===e?this.model.set("orcidLoggedIn",!1):"logout"===e&&this.model.set("orcidLoggedIn",!1)}})}),define("hbs!js/widgets/library_import/templates/tab-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-form-container">\n    <div class="panel panel-default">\n        <div class="panel-heading">\n            <h3>Import Libraries from Older ADS Accounts</h3>\n        </div>\n\n        <div class="panel-body">\n            \x3c!-- Nav tabs --\x3e\n            <ul class="nav nav-tabs" role="tablist">\n                <li role="presentation" class="active"><a href="#classic-import-tab" aria-controls="classic-import-tab" role="tab" data-toggle="tab"><h4>Import from ADS Classic</h4></a></li>\n                <li role="presentation"><a href="#twopointoh-import-tab" aria-controls="twopointoh-import-tab" role="tab" data-toggle="tab"><h4>Import from ADS 2.0</h4></a></li>\n            </ul>\n\n            \x3c!-- Tab panes --\x3e\n            <div class="tab-content">\n                <div role="tabpanel" class="tab-pane active" id="classic-import-tab">\n\n                </div>\n                <div role="tabpanel" class="tab-pane" id="twopointoh-import-tab">\n\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/library_import/templates/tab-container",n),n}),define("hbs!js/widgets/library_import/templates/authentication-form-partial",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'        <div class="form-group">\n            <label for="classic-mirror-list">Choose an ADS Classic Mirror Site</label>\n            <select name="classic_mirror" class="form-control" id="classic-mirror-list">\n'+(null!=(a=t.each.call(e,null!=e?e.mirrors:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"            </select>\n        </div>\n"},2:function(e,t,n,i){return"                <option>"+this.escapeExpression(this.lambda(e,e))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\n<form class="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'-form basic-form-style">\n    <div class="form-group">\n        <label for="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'-username">Email address</label>\n        <input name="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'_email" type="email" class="form-control" id="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'-username" placeholder="Email">\n    </div>\n    <div class="form-group">\n        <label for="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'-password">Password</label>\n        <input name="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'_password" type="password" class="form-control" id="'+this.escapeExpression("function"==typeof(r=null!=(r=t.endpoint||(null!=e?e.endpoint:e))?r:t.helperMissing)?r.call(e,{name:"endpoint",hash:{},data:i}):r)+'-password" placeholder="Password">\n    </div>\n\n'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.endpoint:e,"classic",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'\n    <button type="submit" class="btn btn-primary-faded submit-credentials pull-right">Submit</button>\n</form>'},useData:!0});return t.registerPartial("js/widgets/library_import/templates/authentication-form-partial",n),t.registerPartial("js/widgets/library_import/templates/authentication-form-partial",n),n}),define("hbs!js/widgets/library_import/templates/import-view-labs",["hbs","hbs/handlebars","hbs!js/widgets/library_import/templates/authentication-form-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"\n"+(null!=(a=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"    ",helpers:t,partials:n}))?a:"")+"\n"},3:function(e,t,n,i){var a,r;return"\n    <div>\n        You are currently authenticated as <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.twopointoh_email||(null!=e?e.twopointoh_email:e))?r:t.helperMissing)?r.call(e,{name:"twopointoh_email",hash:{},data:i}):r)+'</b>.\n    </div>\n    <div>\n        <button class="btn btn-primary-faded import-all-libraries"> <i class="fa fa-arrow-circle-down"></i> Import all ADS 2.0 libraries to this system</button>\n    </div>\n\n    <div>\n        <h4>Download ADS 2.0 Libraries</h4>\n        <hr>\n        <button class="btn btn-default bibtex-import" data-target="zotero">\n            <i class="fa fa-download"></i> to Zotero-style BibTeX\n        </button>\n        &nbsp;\n        <button class="btn btn-default bibtex-import" data-target="mendeley">\n            <i class="fa fa-download"></i> to Mendeley-style BibTeX\n        </button>\n    </div>\n<hr>\n<br>\n\n        <button class="btn btn-default collapsed" data-toggle="collapse" data-target="#ads2-form-container">\n            <i class="toggle-icon"></i>\n            Sign into a new ADS 2.0 account\n        </button>\n    <div class="collapse" id="ads2-form-container">\n'+(null!=(a=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"        ",helpers:t,partials:n}))?a:"")+"    </div>\n\n\n\n"},5:function(e,t,n,i){var a,r;return'    <div class="alert alert-danger alert-dismissible" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        '+(null!=(a="function"==typeof(r=null!=(r=t.errorMessage||(null!=e?e.errorMessage:e))?r:t.helperMissing)?r.call(e,{name:"errorMessage",hash:{},data:i}):r)?a:"")+"\n    </div>\n"},7:function(e,t,n,i){var a,r;return'    <div class="alert alert-success alert-dismissible" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        '+(null!=(a="function"==typeof(r=null!=(r=t.successMessage||(null!=e?e.successMessage:e))?r:t.helperMissing)?r.call(e,{name:"successMessage",hash:{},data:i}):r)?a:"")+"\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n"+(null!=(a=t.unless.call(e,null!=e?e.twopointoh_email:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'\n<div class="status">\n'+(null!=(a=t.if.call(e,null!=e?e.errorMessage:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.successMessage:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/library_import/templates/import-view-labs",n),n}),define("hbs!js/widgets/library_import/templates/import-view-classic",["hbs","hbs/handlebars","hbs!js/widgets/library_import/templates/authentication-form-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"    ",helpers:t,partials:n}))?a:""},3:function(e,t,n,i){var a,r;return"\n<div>\n    You are currently authenticated as <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.classic_email||(null!=e?e.classic_email:e))?r:t.helperMissing)?r.call(e,{name:"classic_email",hash:{},data:i}):r)+"</b>\n    with mirror site <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.classic_mirror||(null!=e?e.classic_mirror:e))?r:t.helperMissing)?r.call(e,{name:"classic_mirror",hash:{},data:i}):r)+'</b>.\n</div>\n\n<div>\n    <button class="btn btn-primary-faded import-all-libraries"> <i class="fa fa-arrow-circle-down"></i>  Import all Classic libraries</button>\n</div>\n\n<hr>\n\n    <button class="btn btn-default collapsed" data-toggle="collapse" data-target="#classic-form-container">\n        <i class="toggle-icon"></i>\n        Sign into a new Classic account\n    </button>\n<div class="collapse" id="classic-form-container">\n'+(null!=(a=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"    ",helpers:t,partials:n}))?a:"")+"</div>\n\n"},5:function(e,t,n,i){var a,r;return'    <div class="alert alert-danger alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        '+(null!=(a="function"==typeof(r=null!=(r=t.errorMessage||(null!=e?e.errorMessage:e))?r:t.helperMissing)?r.call(e,{name:"errorMessage",hash:{},data:i}):r)?a:"")+"\n    </div>\n"},7:function(e,t,n,i){var a,r;return'    <div class="alert alert-success alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\n        '+(null!=(a="function"==typeof(r=null!=(r=t.successMessage||(null!=e?e.successMessage:e))?r:t.helperMissing)?r.call(e,{name:"successMessage",hash:{},data:i}):r)?a:"")+"\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.unless.call(e,null!=e?e.classic_email:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'\n<div class="status">\n'+(null!=(a=t.if.call(e,null!=e?e.errorMessage:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.successMessage:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/library_import/templates/import-view-classic",n),n}),define("hbs!js/widgets/library_import/templates/success-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"<div>\n    The following libraries were successfully imported for the first time:\n    <ul>\n"+(null!=(a=t.each.call(e,null!=e?e.created:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"    </ul>\n\n</div>\n"},2:function(e,t,n,i){return'        <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},4:function(e,t,n,i){var a;return"    <div>\n\n        The following libraries were updated or merged:\n        <ul>\n"+(null!=(a=t.each.call(e,null!=e?e.updated:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"        </ul>\n    </div>\n"},5:function(e,t,n,i){return'            <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"<h4>Success!</h4>\n"+(null!=(a=t.if.call(e,null!=e?e.created:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n"+(null!=(a=t.if.call(e,null!=e?e.updated:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/library_import/templates/success-template",n),n}),define("js/widgets/library_import/widget",["js/widgets/base/base_widget","js/components/api_request","js/components/api_targets","hbs!js/widgets/library_import/templates/tab-container","hbs!js/widgets/library_import/templates/import-view-labs","hbs!js/widgets/library_import/templates/import-view-classic","hbs!js/widgets/library_import/templates/success-template","bootstrap"],function(e,t,n,i,a,r,s,o){var l="twopointoh",c=Backbone.Model.extend({defaults:function(){return{}}}),u=Marionette.ItemView.extend({initialize:function(e){if("classic"!==e.endpoint&&e.endpoint!==l)throw new Error("we don't recognize that endpoint: "+e.endpoint);this.model=new c({endpoint:e.endpoint}),this.template="classic"===e.endpoint?r:a},className:"library-import-form",events:{"click button.submit-credentials":"authenticate","click button.bibtex-import":"importBibtex"},triggers:{"click button.import-all-libraries":"library-import"},modelEvents:{change:"render"},importBibtex:function(e){this.trigger("bibtex-import",{target:$(e.target).data("target")})},authenticate:function(e){e.preventDefault();var t={};this.$("form").serializeArray().forEach(function(e){t[e.name]=e.value}),this.trigger("submit-credentials",t)}}),d=Marionette.LayoutView.extend({initialize:function(e){this.classicView=new u({endpoint:"classic"}),this.ads2View=new u({endpoint:l})},regions:{classic:"#classic-import-tab",ads2:"#"+l+"-import-tab"},template:i,onRender:function(){this.classic.show(this.classicView),this.ads2.show(this.ads2View)}});return e.extend({initialize:function(e){this.view=new d;var i=this;function a(e,n,i){this.getBeeHive().getService("Api").request(new t({target:e,options:{type:"POST",data:i,done:function(e){n.model.set(e,{silent:!0}),n.model.trigger("change")},fail:function(e){n.model.set({successMessage:"",errorMessage:e.responseJSON.error},{silent:!0}),n.model.trigger("change")}}}))}function r(e,t){t.$("button.import-all-libraries").addClass("disabled").html('<i class="fa fa-lg fa-spinner fa-pulse"></i> Working...'),this.getBeeHive().getObject("LibraryController").importLibraries(e).done(function(e){var n={};n.updated=e.filter(function(e){return"updated"===e.action}).map(function(e){return{name:e.name,link:"#user/libraries/"+e.library_id}}),n.created=e.filter(function(e){return"created"===e.action}).map(function(e){return{name:e.name,link:"#user/libraries/"+e.library_id}}),t.model.set({successMessage:s(n),errorMessage:""},{silent:!0}),t.model.trigger("change")}).fail(function(){t.model.set({successMessage:"",errorMessage:"There was a problem and libraries were not imported."},{silent:!0}),t.model.trigger("change")})}a=a.bind(this),this.view.classicView.on("submit-credentials",function(e){a(n.LIBRARY_IMPORT_CLASSIC_AUTH,i.view.classicView,e)}),this.view.ads2View.on("submit-credentials",function(e){a(n.LIBRARY_IMPORT_ADS2_AUTH,i.view.ads2View,e)}),r=r.bind(this),this.view.classicView.on("library-import",function(){r("classic",i.view.classicView)}),this.view.ads2View.on("library-import",function(){r(l,i.view.ads2View)}),this.view.ads2View.on("bibtex-import",function(e){var a="LIBRARY_IMPORT_"+e.target.toUpperCase();i.getBeeHive().getService("Api").request(new t({target:n[a],options:{done:function(){var e='<iframe style="display:none;" src="'+arguments[0].url+'"></iframe>';$(document.body).append(e),setTimeout(function(){$(e).remove()},1e3)}}}))})},activate:function(e){this.setBeeHive(e),_.bindAll(this);var i=this;this.getPubSub();i.getBeeHive().getService("Api").request(new t({target:n.LIBRARY_IMPORT_CLASSIC_MIRRORS,options:{done:function(e){e.indexOf("adsabs.harvard.edu")>-1&&(e=_.without(e,"adsabs.harvard.edu")).unshift("adsabs.harvard.edu"),i.view.classicView.model.set({mirrors:e})},fail:function(){console.error("couldn't load classic mirrors")}}})),i.getBeeHive().getService("Api").request(new t({target:n.LIBRARY_IMPORT_CREDENTIALS,options:{done:function(e){i.view.classicView.model.set(e),i.view.ads2View.model.set(e)},fail:function(e,t){"This user has not set up an ADS Classic account"!=e.responseJSON.error&&console.error(e)}}}))}})}),define("hbs!js/widgets/filter_visualizer/templates/widget-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="filter-visualizer">\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/filter_visualizer/templates/widget-view",n),n}),define("hbs!js/widgets/filter_visualizer/templates/item-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"category",{name:"compare",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+"\n"},2:function(e,t,n,i){return"\n         <h5>"+this.escapeExpression(this.lambda(null!=e?e.display:e,e))+"</h5>\n\n"},4:function(e,t,n,i){return'\n            <span class="filter-'+this.escapeExpression(this.lambda(null!=e?e.type:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.display:e,e))+'</span>\n              <button class="btn btn-xs filter-'+this.escapeExpression(this.lambda(null!=e?e.type:e,e))+'-remove" value="'+this.escapeExpression(this.lambda(null!=e?e.value:e,e))+'" title="remove this filter">\n                <i class="fa fa-remove"></i></button>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n"+(null!=(a=t.each.call(e,null!=e?e.elements:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/filter_visualizer/templates/item-view",n),n}),define("js/widgets/filter_visualizer/widget",["underscore","jquery","backbone","marionette","js/components/api_query","js/components/pubsub_events","hbs!js/widgets/filter_visualizer/templates/widget-view","hbs!js/widgets/filter_visualizer/templates/item-view","js/components/api_feedback","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l,c){var u=n.Model.extend({}),d=n.Collection.extend({model:u}),h=i.ItemView.extend({tagName:"span",className:"filter-topic-group",template:o,events:{"click button":"onClick"},onClick:function(e){e.preventDefault();var n=t(e.target);this.trigger("filter-event",n.attr("value")?n.attr("value"):n.parent().attr("value"))}}),p=i.CompositeView.extend({template:s,childView:h,childViewContainer:"#filter-visualizer",events:{}}),f=i.Controller.extend({activate:function(t){e.bindAll(this,"processFeedback","onFilterEvent"),this.setBeeHive(t),pubsub=t.getService("PubSub"),pubsub.subscribe(pubsub.FEEDBACK,this.processFeedback)},initialize:function(t){t=e.defaults(t,{withoutOperators:!0,maxNumberOfTokens:5,maxQueryLen:100}),this.collection=new d({}),this.view=new p({collection:this.collection}),this.listenTo(this.view,"childview:filter-event",this.onFilterEvent),this.knownFilters={fq_author:"Author",fq_database:"Collection",fq_property:"Property",fq_facets180:"Status",fq_keyword_facet:"Keywords",fq_bibstem_facet:"Publication",fq_bibgroup_facet:"BibGroup",fq_data_facet:"Data",fq_vizier_facet:"Vizier",fq_simbad_object_facet_hier:"Object",fq_ned_object_facet_hier:"Object",fq_grant:"Grant",fq_visualization_author:"Author Network",fq_visualization_paper:"Paper Network",fq_wordcloud:"Concept Cloud",fq_bubble_chart:"Results Graph",fq_doctype:"Pubtype"},this.currentQuery=null,this.withoutOperators=t.withoutOperators,this.maxNumberOfTokens=t.maxNumberOfTokens,this.maxQueryLen=t.maxQueryLen},render:function(){return this.view.render(),this.view.el},processFeedback:function(e){switch(e.code){case l.CODES.SEARCH_CYCLE_STARTED:this.processQuery({numFound:e.numFound,q:e.query.clone()})}},processQuery:function(e){var t=e.q;numFound=e.numFound;var n=this.extractFilters(t);this._saveInfo(t,n);var i=this.prepareGUIData(n);this.collection.reset(i)},_saveInfo:function(t,n){this.currentQuery=t,this.currentFilters={},e.each(n,function(e){this.currentFilters[e.filter_name]=e},this)},extractFilters:function(t){var n=t.toJSON(),i=[];if(!n.fq&&!t.get("__qid"))return i;n.fq;var a=e.keys(n);return e.each(a,function(t){if(0==t.indexOf("fq_")){if(!this.knownFilters[t])return;var r={category:this.knownFilters[t],filter_name:t,filter_query:n[t][0]};if(n[t].length>1)return void console.warn("Breach of an api contract, filter contains too many values",t,n[t]);var s=e.filter(a,function(e){if(e.indexOf(t)>-1&&e!==t)return!0});1==s.length?(r.filter_key=s[0],r.filter_value=n[s[0]]):console.warn("no fq metadata available, so presumably query is being loaded from url (if not, there is a problem!) "),i.push(r)}},this),i=e.sortBy(i,function(t){var n=e.indexOf(self.knownFilters,t.category);return n>-1?n:1e3})},prepareGUIData:function(t){if(this.withoutOperators)return this._prepareGUIDataWithoutOperators(t);var n=[];return e.each(t,function(t){var i=[];if(i.push({type:"category",display:t.category,value:t.filter_name+"|category|"+t.category}),t.filter_value.length-1>this.maxNumberOfTokens||t.filter_value.join(" ").length>this.maxQueryLen)return i.push({type:"control",display:t.filter_value.length-1+" custom values",value:t.filter_name+"|control|x"}),void n.push({elements:i});var a=0,r=t.filter_value[0];e.each(t.filter_value.slice(1),function(e){++a>1&&i.push({type:"operator",display:r,value:t.filter_name+"|operator|"+r}),i.push({type:"operand",display:this.beautifyOperand(t.filter_name,e),value:t.filter_name+"|operand|"+e})},this),i.push({type:"control",display:"",value:t.filter_name+"|control|x"}),n.push({elements:i})},this),n},_prepareGUIDataWithoutOperators:function(t){var n=[];return e.each(t,function(t){var i=[];if(i.push({type:"category",display:t.category,value:t.filter_name+"|category|"+t.category}),!t.filter_value||t.filter_value.length-1>this.maxNumberOfTokens||t.filter_value.join(" ").length>this.maxQueryLen)return i.push({type:"operand",display:"custom filter",value:t.filter_name+"|control|x"}),void n.push({elements:i});var a=0,r=t.filter_value[0],s="";"NOT"==r?s="-":"AND"==r&&(s="+"),e.each(t.filter_value.slice(1),function(o){var l=e.clone(i),c=0==a++&&"NOT"==r?"":s;l.push({type:"operand",display:c+this.beautifyOperand(t.filter_name,o),value:t.filter_name+"|operand|"+o}),n.push({elements:l})},this)},this),n},beautifyOperand:function(e,t){for(var n=t;0==n.indexOf("(")&&n.indexOf(")")==n.length-1;)n=n.substr(1,n.length-2);switch(n=n.replace(/0\/|1\/[^/]+\//,""),e){case"fq_author":n=(n=n.replace(/author_facet_hier:/g,"")).replace(/\d+\//g,"");break;case"fq_database":n=n.replace(/database:/g,"");break;case"fq_facets180":n=n.replace(/property:/g,"");break;case"fq_keyword_facet":n=(n=n.replace(/keyword_facet:/g,"")).replace(/\\/g,"");break;case"fq_bibstem_facet":n=n.replace(/bibstem_facet:/g,"");break;case"fq_bibgroup_facet":n=n.replace(/bibgroup_facet:/g,"");break;case"fq_data_facet":n=n.replace(/data_facet:/g,"");break;case"fq_vizier_facet":n=n.replace(/vizier_facet:/g,"");break;case"fq_grant":n=n.replace(/grant:/g,"");break;case"fq_simbad_object_facet_hier":n=n.replace(/simbad_object_facet_hier:0\\\//g,"");break;case"fq_ned_object_facet_hier":n=n.replace(/ned_object_facet_hier:0\\\//g,"");break;case"fq_doctype":n=n.replace(/doctype:/g,"")}return n=(n=n.replace(/\\?"/g,"")).replace(/\*:\*/,"any")},createModifiedQuery:function(t){var n=t.split("|"),i={};i.name=n[0],i.part=n[1],i.value=n[2];var r=this.currentQuery.toJSON();if(r.fq||r.fq[i.name]){switch(i.part){case"operand":if(r[this.currentFilters[i.name].filter_key].length>2){var s,o=r[this.currentFilters[i.name].filter_key];if(-1==e.indexOf(o,i.value))throw console.error("Cannot find/remove the value: "+i.value,o),Error("Error in modifying the query");if((o=e.reject(o,function(e){return e==i.value})).length>2){var l=" "+o[0]+" ";s="("+o.slice(1).join(l)+")"}else s=o[1];r[i.name]=s,r[this.currentFilters[i.name].filter_key]=o;break}case"control":delete r[i.name],delete r[this.currentFilters[i.name].filter_key],r.fq=e.filter(r.fq,function(e){if(-1==e.indexOf("v=$"+i.name))return!0})}return r.fq&&0==r.fq.length&&delete r.fq,new a(r)}console.error("The current query has no filter: "+i.name)},onLoad:function(e){this.collection?this.collection.reset(this.getData(e)):this.initialize(e)},onFilterEvent:function(e,t){var n=this.createModifiedQuery(t),i=this.getBeeHive().getService("PubSub");i&&i.publish(i.START_SEARCH,n)}});return e.extend(f.prototype,c.BeeHive),f}),define("hbs!js/widgets/navbar/template/navbar",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <a class="navbar-brand s-navbar-brand" href="#"><img class="s-ads-icon" src="styles/img/transparent_logo.svg" alt="ads icon"/>\n                <h1> <b>ads</b></h1>\n            </a>\n'},3:function(e,t,n,i){return'            <div class="s-hourly-warning">\n                <a class="navbar-brand s-navbar-brand" href="#"><i class="icon-danger fa-2x"></i> ADS TEST</a>\n                <span> Nothing you do here will be saved!  <a href="https://ui.adsabs.harvard.edu/">I want the real ADS <i class="fa fa-arrow-right"></i></a>\n                </span>\n            </div>\n'},5:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=e?e.orcidModeOn:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(11,i,0),data:i}))?a:"")+'                \x3c!--end "if/else orcidModeOn"--\x3e\n\n'},6:function(e,t,n,i){var a;return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class=" btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title">\n                         <img src="../../styles/img/orcid-active.svg" alt="orcid symbol"/>\n                            ORCID\n                            <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style">\n                            '+(null!=(a=t.if.call(e,null!=e?e.orcidLastName:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'\n                            <div class="s-orcid-mode-label"><b>ORCID Mode</b></div>\n                            <div class="s-orcid-label-container">\n                                off\n                                <div class="switch">\n                                    <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round orcid-mode" type="checkbox" checked="checked">\n                                    <label for="cmn-toggle-1"></label>\n                                </div>\n                                on\n                            </div>\n                        </li>\n\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-link" href="#user/orcid" >View my ORCID papers in ADS </a>\n                        </li>\n'+(null!=(a=t.if.call(e,null!=e?e.orcidURI:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'                        <li>\n                            <a href="#orcid-instructions"> <i class="fa fa-info-circle"></i> Learn how to make ORCID claims using ADS</a>\n                        </li>\n                        <li class="divider"></li>\n                        <li>\n                            <a href="#" class="orcid-logout" >Log out from ORCID in ADS</a>\n                        <li>\n\n                    </ul>\n                </li>\n\n'},7:function(e,t,n,i){var a;return" <h4> Signed in to ORCID as <br/> <strong>"+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidFirstName||(null!=e?e.orcidFirstName:e))?a:t.helperMissing)?a.call(e,{name:"orcidFirstName",hash:{},data:i}):a)+" "+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidLastName||(null!=e?e.orcidLastName:e))?a:t.helperMissing)?a.call(e,{name:"orcidLastName",hash:{},data:i}):a)+"</strong></h4> "},9:function(e,t,n,i){return'                        <li>\n                            <a href="https://orcid.org/my-orcid" target="_blank" rel="noopener" >View my ORCID profile on orcid.org </a>\n                        </li>\n'},11:function(e,t,n,i){var a;return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title"> <img src="../../styles/img/orcid_inactive.png"\n                                                          alt="orcid symbol"/> ORCID  <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style">\n                            '+(null!=(a=t.if.call(e,null!=e?e.orcidLastName:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'\n                            <div class="s-orcid-mode-label"><b>ORCID Mode</b></div>\n                            <div class="s-orcid-label-container">\n                                off\n                                <div class="switch clearfix">\n                                    <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round orcid-mode" type="checkbox">\n                                    <label for="cmn-toggle-1"></label>\n                                </div>\n                                on\n                            </div>\n                        </li>\n                        <li style="clear:both" class="no-hover-style">You have turned off the ORCID view for the ADS search results page, but are still logged in.</li>\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-link" href="#user/orcid" > View my ORCID papers in ADS</a>\n                        </li>\n'+(null!=(a=t.if.call(e,null!=e?e.orcidURI:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+'                        <li>\n                            <a href="#orcid-instructions"> <i class="fa fa-info-circle"></i> Learn how to claim ORCID papers</a>\n                        </li>\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-logout" >Log out from ORCID</a>\n                        </li>\n                    </ul>\n                </li>\n\n'},13:function(e,t,n,i){return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="dropdown-toggle btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title"> <img src="../../styles/img/orcid_inactive.png"\n                                                          alt="orcid symbol"/>  ORCID  <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style" >\n                            <button class="btn-link orcid-sign-in"> Sign in to ORCID to claim papers in the ADS. </button>\n                        </li>\n                        <li class="no-hover-style">\n                            This functionality is still experimental.\n                        </li>\n                    </ul>\n                </li>\n\n                \x3c!--end "if/else orcidLoggedIn"--\x3e\n\n'},15:function(e,t,n,i){var a;return'\n                \x3c!-- Single button --\x3e\n                <li class="dropdown">\n                    <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                     <i class="fa fa-user"></i> Account <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style" style="padding:15px 10px;">You are signed in as <br/> <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.currentUser||(null!=e?e.currentUser:e))?a:t.helperMissing)?a.call(e,{name:"currentUser",hash:{},data:i}):a)+'</b></li>\n                        <li ><a href="#/user/home"> <i class="fa fa-user"></i> My Home Page</a></li>\n                        <li><a href="#/user/libraries"> <i class="fa fa-book"></i> ADS Libraries</a></li>\n                        <li><a href="#/user/settings"> <i class="fa fa-cog"></i> Customize Settings</a></li>\n                        <li class="divider"></li>\n                        <li><a href="#" class="logout">Log Out</a></li>\n                    </ul>\n                </li>\n\n'},17:function(e,t,n,i){return'                <li class="register"><a href="#user/account/register">Sign Up</a></li>\n                <li class="login"><a href="#user/account/login">Log In</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<nav class="navbar fluid navbar-inverse">\n        \x3c!-- Brand and toggle get grouped for better mobile display --\x3e\n        <div class="navbar-header">\n            <button type="button" class="navbar-toggle" data-toggle="collapse"\n                    data-target="#bs-example-navbar-collapse-1">\n                <span class="sr-only">Toggle navigation</span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n            </button>\n'+(null!=(a=t.unless.call(e,null!=e?e.hourly:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'        </div>\n\n        \x3c!-- Collect the nav links, forms, and other content for toggling --\x3e\n        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n\n            <ul class="nav navbar-nav navbar-right">\n\n                <li>\n                    <button type="button" class="btn btn-primary-faded feedback-button" data-toggle="modal" data-target="#feedback-modal">\n                        <i class="fa fa-comment"></i> Feedback\n                    </button>\n                </li>\n\n'+(null!=(a=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.program(13,i,0),data:i}))?a:"")+'\n                <li class="dropdown">\n                    <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                      <i class="fa fa-question-circle about-page-icon"></i> About <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li> <a href="//ui.adsabs.harvard.edu/about/" target="_blank" rel="noopener"> <i class="fa fa-question-circle"></i> About ADS </a></li>\n                        <li> <a href="//adsabs.github.io/blog/" target="_blank" rel="noopener"> <i class="fa fa-newspaper-o"></i> ADS Blog </a></li>\n                        <li> <a href="//adsabs.github.io/help/" target="_blank" rel="noopener"> <i class="fa fa-info-circle"></i> ADS Help Pages </a></li>\n                        <li> <a href="//ui.adsabs.harvard.edu/about/careers/" target="_blank" rel="noopener"> <i class="fa fa-group"></i> Careers@ADS </a></li>\n                    </ul>\n                </li>\n\n\n'+(null!=(a=t.if.call(e,null!=e?e.currentUser:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.program(17,i,0),data:i}))?a:"")+"\n            </ul>\n\n        </div>\n        \x3c!-- /.navbar-collapse --\x3e\n    </div>\n</nav>\n\x3c!-- /.container-fluid --\x3e\n"},useData:!0});return t.registerPartial("js/widgets/navbar/template/navbar",n),n}),define("hbs!js/widgets/navbar/template/feedback",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="modal fade" id="feedback-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">Feedback Form</h4>\n            </div>\n            <div class="modal-body">\n                <form class="feedback-form">\n\n                    <input type="hidden" name="_subject" value="Bumblebee Feedback" />\n                    <input type="hidden" name="feedback-type" value="feedback" />\n\n                    <input type="text" name="_gotcha" style="display:none" />\n\n                    <div class="form-group half-width">\n                        <label> Name\n                            <input class="form-control" type="text" name="name" required>\n                        </label>\n                    </div>\n                    <div class="form-group half-width">\n                        <label> Email\n                            <input class="form-control" type="email" name="_replyto" required>\n                        </label>\n                    </div>\n\n                    <div class="form-group">\n                        <label>Feedback <br/>\n                        <textarea rows="8" cols="50" name="comments" required/>\n                        </label>\n\n                    </div>\n                    <div class="form-group">\n                        <div class="g-recaptcha"></div>\n                    </div>\n                    <button class="btn btn-success" type="submit" value="Send">Submit</button>\n                </form>\n\n                <br/>\n                <p>You can also reach us at <b>adshelp [at] cfa.harvard.edu</b></p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close without submitting</button>\n            </div>\n        </div>\x3c!-- /.modal-content --\x3e\n    </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n'},useData:!0});return t.registerPartial("js/widgets/navbar/template/feedback",n),n}),define("js/widgets/navbar/widget",["underscore","marionette","js/widgets/base/base_widget","hbs!js/widgets/navbar/template/navbar","hbs!js/widgets/navbar/template/feedback","js/components/api_query_updater","js/components/api_query","js/components/api_request","js/components/api_targets","bootstrap"],function(e,t,n,i,a,r,s,o,l,c){var u,d;return d=Backbone.Model.extend({defaults:function(){return{orcidModeOn:!1,orcidLoggedIn:!1,currentUser:void 0,orcidFirstName:void 0,orcidLastName:void 0,hourly:!1,timeout:6e5}}}),u=t.ItemView.extend({template:i,modelEvents:{change:"render"},events:{"click .orcid-dropdown ul":"stopPropagation","click button.orcid-sign-in":"orcidSignIn","change .orcid-mode":"changeOrcidMode","click .orcid-link":function(){this.trigger("navigate-to-orcid-link")},"click .orcid-logout":function(e){e.preventDefault(),this.trigger("logout-only-orcid")},"click .logout":function(e){e.preventDefault(),this.trigger("logout")},"click .login":function(){this.trigger("navigate-login")},"click .register":function(){this.trigger("navigate-register")},"click button.search-author-name":function(e){this.trigger("search-author")}},stopPropagation:function(e){if("button"==e.target.tagName.toLowerCase()||"a"==e.target.tagName.toLowerCase()||"code"==e.target.tagName.toLowerCase())return!0;e.stopPropagation()},orcidSignIn:function(){this.model.set("orcidModeOn",!0),this.trigger("user-change-orcid-mode")},changeOrcidMode:function(t){var n=e.isBoolean(t)?t:t&&t.currentTarget&&t.currentTarget.checked;this.model.set("orcidModeOn",n),this.trigger("user-change-orcid-mode"),this.render()},onRender:function(){var e=this;if(!this.formAttached){$("body").append(a());var t=$("#feedback-modal");t.on("hidden.bs.modal",function(){t.find(".modal-body").html($(a()).find("form"))}),t.on("shown.bs.modal",function(){e.trigger("activate-recaptcha")}),$(".feedback-form").submit(function(n){n.preventDefault(),e.trigger("feedback-form-submit",$(n.target),t)}),this.formAttached=!0}}}),n.extend({initialize:function(e){e=e||{},this.model=new d,this.view=new u({model:this.model}),n.prototype.initialize.apply(this,arguments),this.qUpdater=new r("NavBar")},activate:function(t){this.setBeeHive(t),e.bindAll(this,["handleUserAnnouncement","getOrcidUserInfo","storeLatestPage","onCustomEvent"]);var n=this.getPubSub();n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),n.subscribe(n.APP_STARTED,this.getOrcidUserInfo),n.subscribe(n.NAVIGATE,this.storeLatestPage),n.subscribe(n.CUSTOM_EVENT,this.onCustomEvent),this.setInitialVals(),this.model.get("timer")||this.resetOrcidTimer()},onCustomEvent:function(e){"orcid-action"===e&&this.resetOrcidTimer()},storeLatestPage:function(e){this._latestPage=e},resetOrcidTimer:function(){var t=this.model.get("timer"),n=this.model.get("timeout");t&&clearTimeout(t),this.model.get("orcidModeOn")&&(t=setTimeout(e.bind(this.toggleOrcidMode,this,!1),n),this.model.set("timer",t))},viewEvents:{"navigate-login":function(){this._navigate("authentication-page",{subView:"login"})},"navigate-register":function(){this._navigate("authentication-page",{subView:"register"})},"navigate-settings":function(){this._navigate("UserPreferences")},logout:function(){this.getBeeHive().getObject("Session").logout(),this.orcidLogout()},"feedback-form-submit":"submitForm","navigate-to-orcid-link":"navigateToOrcidLink","user-change-orcid-mode":"toggleOrcidMode","logout-only-orcid":"orcidLogout","search-author":"searchAuthor","activate-recaptcha":"activateRecaptcha"},submitForm:function(e,t){var n=e.serialize();n+="&user-agent-string="+encodeURIComponent(navigator.userAgent);var i=new o({target:l.FEEDBACK,options:{method:"POST",data:n,dataType:"json",done:function(n){e.find("button[type=submit]").html('<i class="icon-success"></i> Message sent!'),setTimeout(function(){t.modal("hide")},500)},fail:function(t){e.find("button[type=submit]").addClass("btn-danger").html('<i class="icon-danger"></i> There was an error!')},beforeSend:function(){e.find("button[type=submit]").html('<i class="icon-loading"></i> Sending form...')}}});this.getBeeHive().getService("Api").request(i)},navigateToOrcidLink:function(){this._navigate("orcid-page")},_navigate:function(e,t){var n=this.getPubSub();n.publish(n.NAVIGATE,e,t)},setInitialVals:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi").hasAccess();this.model.set({orcidModeOn:e.isOrcidModeOn()&&t,orcidLoggedIn:t}),this.model.set("currentUser",e.getUserName())},getOrcidUserInfo:function(){var e=this.getBeeHive().getService("OrcidApi");if(this.model.get("orcidLoggedIn")){var t=this;e.getUserProfile().done(function(e){var n=e.getFirstName(),i=e.getLastName();t.model.set("orcidFirstName",n),t.model.set("orcidLastName",i),t.model.set("orcidQueryName",i+", "+n),t.model.set("orcidURI",e.getOrcid())})}var n=this.getBeeHive().getObject("AppStorage").getConfigCopy().hourly;this.model.set("hourly",n)},handleUserAnnouncement:function(t,n){var i=this.getBeeHive().getService("OrcidApi"),a=this.getBeeHive().getObject("User");t==a.USER_SIGNED_IN?this.model.set("currentUser",n):t==a.USER_SIGNED_OUT?this.model.set("currentUser",void 0):t==a.USER_INFO_CHANGE&&e.has(n,"isOrcidModeOn")&&(this.model.set({orcidModeOn:n.isOrcidModeOn,orcidLoggedIn:i.hasAccess()}),this.model.get("orcidLoggedIn")&&this.getOrcidUserInfo())},toggleOrcidMode:function(t){var n=this.getBeeHive().getObject("User"),i=this.getBeeHive().getService("OrcidApi"),a=e.isBoolean(t)?t:this.model.get("orcidModeOn");n.setOrcidMode(a),this.model.set("orcidModeOn",a),a&&(i.hasAccess()||i.signIn()),this.resetOrcidTimer()},searchAuthor:function(){var e=this.getPubSub();e.publish(e.START_SEARCH,new s({q:"author:"+this.qUpdater.quote(this.model.get("orcidQueryName"))}))},signOut:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi");t&&t.signOut(),e.setOrcidMode(!1)},orcidLogout:function(){var e=this.getPubSub();this.getBeeHive().getService("OrcidApi").signOut(),this.model.set("orcidLoggedIn",!1),this.getBeeHive().getObject("User").setOrcidMode(!1),"orcid-page"===this._latestPage&&e.publish(e.NAVIGATE,"index-page")},activateRecaptcha:function(){var e=new t.ItemView({el:"#feedback-modal"});this.getBeeHive().getObject("RecaptchaManager").activateRecaptcha(e)}})}),define("hbs!js/widgets/user_navbar/nav_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return' class="active" '},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<ul class="nav nav-pills user-pill-nav s-user-pill-nav">\n\n    <li role="presentation"  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"home-page",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' >\n        <a href="#/user/home">\n            <i class="fa fa-user"></i> My Home Page\n        </a>\n    </li>\n    <li  role="presentation" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"libraries-page",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'>\n        <a href="#/user/libraries">\n            <i class="fa fa-book"></i> ADS Libraries\n        </a>\n    </li>\n    <li role="presentation" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"settings-page",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'>\n        <a href="#/user/settings"><i class="fa fa-cog">\n            </i> Customize Settings\n        </a>\n    </li>\n</ul>'},useData:!0});return t.registerPartial("js/widgets/user_navbar/nav_template",n),n}),define("js/widgets/user_navbar/widget",["marionette","hbs!js/widgets/user_navbar/nav_template","js/mixins/dependon"],function(e,t,n){var i=Backbone.Model.extend({defaults:function(){return{page:void 0,userName:void 0}}}),a=e.ItemView.extend({template:t,modelEvents:{change:"render"}}),r=e.Controller.extend({initialize:function(e){e=e||{},this.model=new i,this.view=new a({model:this.model})},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");_.bindAll(this),t.subscribe(t.PAGE_CHANGE,this.updateCurrentView),t.subscribe(t.USER_ANNOUNCEMENT,this.updateUser)},updateCurrentView:function(e){this.model.set("page",e)},updateUser:function(e,t){var n=this.getBeeHive().getObject("User");if(e==n.USER_SIGNED_IN){var i=t;i&&i.indexOf("@")>-1&&(i=i.split("@")[0]),this.model.set("user",i)}else e==n.USER_SIGNED_OUT&&this.model.set("user",void 0)},render:function(){return this.view.render(),this.view.el}});return _.extend(r.prototype,n.BeeHive),r}),define("hbs!js/widgets/alerts/templates/modal_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'                    <i class="icon-danger fa-2x"></i>\n'},3:function(e,t,n,i){return'                    <i class="icon-success fa-2x"></i>\n'},5:function(e,t,n,i){return""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\n\x3c!--html for modal alerts--\x3e\n\n<div class="modal-dialog '+this.escapeExpression("function"==typeof(r=null!=(r=t.type||(null!=e?e.type:e))?r:t.helperMissing)?r.call(e,{name:"type",hash:{},data:i}):r)+'">\n        <div class="modal-content" id="modal-alert-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n\n                <h4 class="modal-title" id="alert-modal-label">\n'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"danger",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"success",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"warning",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"\n                    "+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'\n\n                </h4>\n            </div>\n            <div class="modal-body">\n                '+(null!=(a="function"==typeof(r=null!=(r=t.msg||(null!=e?e.msg:e))?r:t.helperMissing)?r.call(e,{name:"msg",hash:{},data:i}):r)?a:"")+'\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n'},useData:!0});return t.registerPartial("js/widgets/alerts/templates/modal_template",n),n}),define("js/widgets/alerts/modal_view",["marionette","hbs!js/widgets/alerts/templates/modal_template"],function(e,t){return e.ItemView.extend({id:"#alert-modal-content",template:t,showModal:function(){$("#alert-modal").modal("show")},closeModal:function(){$("#alert-modal").modal("hide")},modelEvents:{change:"render"},render:function(){if($("#modal-alert-content").length||($("body").append('<div class="modal fade" id="alert-modal" tabindex="-1" role="dialog" aria-labelledby="alert-modal-label" aria-hidden="true"></div>'),this.setElement($("#alert-modal")[0])),this.model.get("modal"))return"danger"===this.model.get("type")&&console.error("error feedback: ",this.model.get("title"),this.model.get("msg")),e.ItemView.prototype.render.apply(this,arguments)},onRender:function(){this.showModal()}})}),define("hbs!js/widgets/alerts/templates/page_top_alert",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a,r;return'    <div class="alert alert-'+this.escapeExpression("function"==typeof(r=null!=(r=t.type||(null!=e?e.type:e))?r:t.helperMissing)?r.call(e,{name:"type",hash:{},data:i}):r)+'" id="page-top-alert">\n        <div>\n            '+(null!=(a="function"==typeof(r=null!=(r=t.msg||(null!=e?e.msg:e))?r:t.helperMissing)?r.call(e,{name:"msg",hash:{},data:i}):r)?a:"")+'\n        </div>\n        <div>\n            <button type="button" class="close"><span aria-hidden="true"><i class="fa fa-2x fa-times"></i></span><span class="sr-only">Close</span></button>\n        </div>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.msg:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:""},useData:!0});return t.registerPartial("js/widgets/alerts/templates/page_top_alert",n),n}),define("js/widgets/alerts/page_top_alert",["marionette","hbs!js/widgets/alerts/templates/page_top_alert"],function(e,t){return e.ItemView.extend({tagName:"span",className:"alert-banner",template:t,modelEvents:{change:"render"},events:{"click #page-top-alert button.close":"close"},close:function(){this.$(".alert").css("display","none")},render:function(){return this.model.get("modal")?this:this.model.get("msg")||this.model.get("title")?e.ItemView.prototype.render.apply(this,arguments):(this.$el.html(""),this)}})}),define("js/widgets/alerts/widget",["marionette","js/widgets/base/base_widget","js/components/api_query","js/components/api_feedback","js/components/alerts","./modal_view","./page_top_alert","jquery","jquery-ui","bootstrap"],function(e,t,n,i,a,r,s,o,l,c){var u=Backbone.Model.extend({defaults:{type:"info",msg:void 0,title:void 0,events:void 0,modal:!1}});function d(){var e=this,t=this.model.get("events"),n=/^(\S+)\s*(.*)$/;this.$el&&this.$el.off(".customEvents"+this.mid),t&&_.each(t,function(t,i){var a=i.match(n),r=a[1],s=a[2],o=i,l=function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.model.get("promise"),n=this.model.get("events");n[o]?t.resolve(n[o]):t.resolve(o),this.model.get("modal")||this.model.set("msg",null)};l=_.bind(l,e),r+=".customEvents"+this.mid,""===s?e.$el.on(r,l):e.$el.on(r,s,l)})}var h=r.prototype.onRender;r.prototype.onRender=function(){d.apply(this,arguments),h&&h.apply(this,arguments)};var p=s.prototype.onRender;return s.prototype.onRender=function(){d.apply(this,arguments),p&&p.apply(this,arguments)},t.extend({initialize:function(e){this.model=new u,this.view=new s({model:this.model}),this.modalView=new r({model:this.model}),t.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.NAVIGATE,this.modalView.closeModal)},alert:function(e){var t=o.Deferred();return this.model.set({msg:e.msg,events:e.events,title:e.title,type:e.type||"info",modal:e.modal,promise:t}),t.promise()},closeView:function(){this.view.close(),this.modalView.closeModal()}})}),define("hbs!js/widgets/classic_form/form",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<form action="">\n    <div class="pull-right">\n        <button style="position: relative;top: -13px;" class="btn btn-primary" type="submit" disabled="true"><i class="fa fa-search"></i> Search</button>\n    </div>\n\n    <div data-field="database">\n        Databases to query : <label> <input type="checkbox" checked="true" name="astronomy"/> Astronomy </label>&nbsp;&nbsp; <label> <input type="checkbox"  name="physics"/> Physics </label>\n    </div>\n    <div class="clearfix">\n        <div class="col-sm-6"  data-field="author" data-textInput="true">\n            <div class="classic-form__logic-group logic-group">\n                <label> <input type="radio" name="author-logic" value="AND" checked="true"/> and </label>\n                <label> <input type="radio" name="author-logic" value="OR"/> or </label>\n                <label> <input type="radio" name="author-logic" value="BOOLEAN"/> boolean </label>\n            </div>\n            <div>\n                <label class="classic-author-label" for="#classic-author">Author</label>\n                <textarea id="classic-author"name="author-names"cols="30" rows="2" placeholder="(Last, First M) one per line"></textarea>\n            </div>\n        </div>\n        <div class="col-sm-6"  data-field="object" data-textInput="true">\n           <div class="pull-right-sm">\n            <div class="classic-form__logic-group logic-group">\n                <label> <input type="radio" name="object-logic" value="AND" checked="true"/> and </label>\n                <label> <input type="radio" name="object-logic" value="OR" /> or </label>\n                <label> <input type="radio" name="object-logic" value="BOOLEAN" /> boolean </label>\n            </div>\n            <div>\n                <label class="classic-object-label" for="#classic-object">Object</label>\n                <textarea id="classic-object" name="object-names" id="" cols="30" rows="2" placeholder="SIMBAD object search"></textarea>\n            </div>\n           </div>\n       </div>\n    </div>\n    <div data-field="date">\n        <div>\n         <b>Publication date</b> between <br/>\n            <input  class="form-control  date-control" maxlength="2" placeholder="MM" type="text" value="" name="month_from" style="margin-top:6px">/\n            <input  class="form-control  date-control" maxlength="4" placeholder="YYYY" type="text" value="" name="year_from">and\n            <input  class="form-control  date-control" maxlength="2" placeholder="MM" type="text" value="" name="month_to">/\n            <input  class="form-control  date-control" maxlength="4" placeholder="YYYY" type="text" value="" name="year_to">\n        </div>\n    </div>\n    <div data-field="title" data-textInput="true">\n        <div class="classic-form__logic-group logic-group pull-right" >\n            <label> <input type="radio" name="title-logic" value="AND" checked="true"/> and </label>\n            <label> <input type="radio" name="title-logic" value="OR" /> or </label>\n            <label> <input type="radio" name="title-logic" value="BOOLEAN"/> boolean </label>\n        </div>\n        <div>\n            <label for="#classic_title_input"> Title</label>\n            <input id="classic_title_input" class="form-control" name="title" type="text"/>\n        </div>\n    </div>\n    <div  data-field="abs" data-textInput="true">\n        <div class="classic-form__logic-group logic-group pull-right">\n            <label> <input type="radio" name="abstract-logic" value="AND" checked="true"/> and </label>\n            <label> <input type="radio" name="abstract-logic" value="OR"/> or </label>\n            <label> <input type="radio" name="abstract-logic" value="BOOLEAN"/> boolean </label>\n        </div>\n        <div>\n        <label for="#classic_abstract_input"> Abstract/Keywords</label>\n        <input id="clasic_abstract_input" class="form-control" name="abs" type="text"/>\n        </div>\n    </div>\n    <div data-field="property">\n        <label>\n            <input type="checkbox" name="refereed">&nbsp;Refereed only&nbsp;\n        </label>\n        &nbsp;&nbsp;&nbsp;\n        <label>\n            <input type="checkbox" name="article">&nbsp;Articles only&nbsp;\n        </label>\n    </div>\n    <div data-field="bibstem" data-textInput="true">\n        <div class="logic-group">\n            <input type="checkbox" class="hidden" value="OR" checked="true"/>\n        </div>\n        <label for="#classic-bibstem">Publication(s)</label>\n        <p class="help-block small">Press Return Key To Add Publication</p>\n        <input id="classic-bibstem" type="text" class="form-control" name="bibstem" placeholder="Comma-separated bibstems of journal titles" autocomplete="off"/>\n    </div>\n\n    <div class="pull-right">\n        <button class="btn" type="reset"><i class="fa fa-times"></i> Clear</button>\n        <button class="btn btn-primary" type="submit" disabled="true"><i class="fa fa-search"></i> Search</button>\n    </div>\n</form>\n'},useData:!0});return t.registerPartial("js/widgets/classic_form/form",n),n}),define("js/widgets/paper_search_form/topterms",[],function(){return[{value:"PhRvL",label:"Physical Review Letters (PhRvL)"},{value:"ApJ",label:"The Astrophysical Journal (ApJ)"},{value:"PhRvB",label:"Physical Review B (PhRvB)"},{value:"JChPh",label:"Journal of Chemical Physics (JChPh)"},{value:"Natur",label:"Nature (Natur)"},{value:"PhRvD",label:"Physical Review D (PhRvD)"},{value:"ApPhL",label:"Applied Physics Letters (ApPhL)"},{value:"Sci",label:"Science (Sci)"},{value:"JGR",label:"Journal of Geophysical Research (JGR)"},{value:"A&A",label:"Astronomy and Astrophysics (A&A)"},{value:"JAP",label:"Journal of Applied Physics (JAP)"},{value:"PhRv",label:"Physical Review (PhRv)"},{value:"MNRAS",label:"Monthly Notices of the Royal Astronomical Society (MNRAS)"},{value:"PhRvA",label:"Physical Review A (PhRvA)"},{value:"PhLB",label:"Physics Letters B (PhLB)"},{value:"NuPhB",label:"Nuclear Physics B (NuPhB)"},{value:"PNAS",label:"Proceedings of the National Academy of Science (PNAS)"},{value:"arXiv",label:"ArXiv e-prints (arXiv)"},{value:"GeoRL",label:"Geophysical Research Letters (GeoRL)"},{value:"PhRvE",label:"Physical Review E (PhRvE)"},{value:"PhRvC",label:"Physical Review C (PhRvC)"},{value:"JHEP",label:"Journal of High Energy Physics (JHEP)"},{value:"AJ",label:"The Astronomical Journal (AJ)"},{value:"CPL",label:"Chemical Physics Letters (CPL)"},{value:"NuPhA",label:"Nuclear Physics A (NuPhA)"},{value:"RvMP",label:"Reviews of Modern Physics (RvMP)"},{value:"OptL",label:"Optics Letters (OptL)"},{value:"E&PSL",label:"Earth and Planetary Science Letters (E&PSL)"},{value:"GeCoA",label:"Geochimica et Cosmochimica Acta (GeCoA)"},{value:"SurSc",label:"Surface Science (SurSc)"},{value:"ApOpt",label:"Applied Optics (ApOpt)"},{value:"SPIE",label:"Society of Photo-Optical Instrumentation Engineers (SPIE) Conference Series (SPIE)"},{value:"JFM",label:"Journal of Fluid Mechanics (JFM)"},{value:"ApJS",label:"The Astrophysical Journal Supplement Series (ApJS)"},{value:"OExpr",label:"Optics Express (OExpr)"},{value:"PhLA",label:"Physics Letters A (PhLA)"},{value:"JaJAP",label:"Japanese Journal of Applied Physics (JaJAP)"},{value:"JPSJ",label:"Journal of the Physical Society of Japan (JPSJ)"},{value:"SSCom",label:"Solid State Communications (SSCom)"},{value:"RSPSA",label:"Proceedings of the Royal Society of London Series A (RSPSA)"},{value:"JAtS",label:"Journal of Atmospheric Sciences (JAtS)"},{value:"JPCM",label:"Journal of Physics Condensed Matter (JPCM)"},{value:"JPhA",label:"Journal of Physics A Mathematical General (JPhA)"},{value:"PLoSO",label:"PLoS ONE (PLoSO)"},{value:"PhR",label:"Physics Reports (PhR)"},{value:"JPhB",label:"Journal of Physics B Atomic Molecular Physics (JPhB)"},{value:"RScI",label:"Review of Scientific Instruments (RScI)"},{value:"PhFl",label:"Physics of Fluids (PhFl)"},{value:"EnST",label:"Environmental Science and Technology (EnST)"},{value:"JGRD",label:"Journal of Geophysical Research (Atmospheres) (JGRD)"},{value:"MaMol",label:"Macromolecules (MaMol)"},{value:"NanoL",label:"Nano Letters (NanoL)"},{value:"JCli",label:"Journal of Climate (JCli)"},{value:"NIMPA",label:"Nuclear Instruments and Methods in Physics Research A (NIMPA)"},{value:"AtmEn",label:"Atmospheric Environment (AtmEn)"},{value:"ASAJ",label:"Acoustical Society of America Journal (ASAJ)"},{value:"WRR",label:"Water Resources Research (WRR)"},{value:"Icar",label:"Icarus (Icar)"},{value:"JCrGr",label:"Journal of Crystal Growth (JCrGr)"},{value:"JMP",label:"Journal of Mathematical Physics (JMP)"},{value:"TSF",label:"Thin Solid Films (TSF)"},{value:"Geo",label:"Geology (Geo)"},{value:"PhPl",label:"Physics of Plasmas (PhPl)"},{value:"JMMM",label:"Journal of Magnetism and Magnetic Materials (JMMM)"},{value:"OptCo",label:"Optics Communications (OptCo)"},{value:"EL",label:"EPL (Europhysics Letters) (EL)"},{value:"MWRv",label:"Monthly Weather Review (MWRv)"},{value:"JCoPh",label:"Journal of Computational Physics (JCoPh)"},{value:"AnPhy",label:"Annals of Physics (AnPhy)"},{value:"Tectp",label:"Tectonophysics (Tectp)"},{value:"JPhD",label:"Journal of Physics D Applied Physics (JPhD)"},{value:"NIMPB",label:"Nuclear Instruments and Methods in Physics Research B (NIMPB)"},{value:"ITM",label:"IEEE Transactions on Magnetics (ITM)"},{value:"CMaPh",label:"Communications in Mathematical Physics (CMaPh)"},{value:"JPhC",label:"Journal of Physics C Solid State Physics (JPhC)"},{value:"PSSBR",label:"Physica Status Solidi B Basic Research (PSSBR)"},{value:"JNCS",label:"Journal of Non Crystalline Solids (JNCS)"},{value:"CQGra",label:"Classical and Quantum Gravity (CQGra)"},{value:"SoPh",label:"Solar Physics (SoPh)"},{value:"ACP",label:"Atmospheric Chemistry & Physics (ACP)"},{value:"IJQE",label:"IEEE Journal of Quantum Electronics (IJQE)"},{value:"PhDT",label:"Ph.D. Thesis (PhDT)"},{value:"MolPh",label:"Molecular Physics (MolPh)"},{value:"NatMa",label:"Nature Materials (NatMa)"},{value:"ApSS",label:"Applied Surface Science (ApSS)"},{value:"PASP",label:"Publications of the Astronomical Society of the Pacific (PASP)"},{value:"AIPC",label:"American Institute of Physics Conference Series (AIPC)"},{value:"PhyC",label:"Physica C Superconductivity (PhyC)"},{value:"PThPh",label:"Progress of Theoretical Physics (PThPh)"},{value:"BpJ",label:"Biophysical Journal (BpJ)"},{value:"JNuM",label:"Journal of Nuclear Materials (JNuM)"},{value:"ITED",label:"IEEE Transactions on Electron Devices (ITED)"},{value:"PhyA",label:"Physica A Statistical Mechanics and its Applications (PhyA)"},{value:"JPCS",label:"Journal of Physics and Chemistry of Solids (JPCS)"},{value:"ITGRS",label:"IEEE Transactions on Geoscience and Remote Sensing (ITGRS)"},{value:"CoMP",label:"Contributions to Mineralogy and Petrology (CoMP)"},{value:"JHyd",label:"Journal of Hydrology (JHyd)"},{value:"ZPhy",label:"Zeitschrift fur Physik (ZPhy)"},{value:"CP",label:"Chemical Physics (CP)"},{value:"A&AS",label:"Astronomy and Astrophysics Supplement Series (A&AS)"},{value:"JCAP",label:"Journal of Cosmology and Astro-Particle Physics (JCAP)"},{value:"ARA&A",label:"Annual Review of Astronomy and Astrophysics (ARA&A)"},{value:"QJRMS",label:"Quarterly Journal of the Royal Meteorological Society (QJRMS)"},{value:"GeoJI",label:"Geophysical Journal International (GeoJI)"},{value:"EPJC",label:"European Physical Journal C (EPJC)"},{value:"JOSAB",label:"Journal of the Optical Society of America B Optical Physics (JOSAB)"},{value:"JVST",label:"Journal of Vacuum Science Technology (JVST)"},{value:"JMoSp",label:"Journal of Molecular Spectroscopy (JMoSp)"},{value:"JPO",label:"Journal of Physical Oceanography (JPO)"},{value:"ITAP",label:"IEEE Transactions on Antennas and Propagation (ITAP)"},{value:"NatSR",label:"Scientific Reports (NatSR)"},{value:"JGRA",label:"Journal of Geophysical Research (Space Physics) (JGRA)"},{value:"RSEnv",label:"Remote Sensing of Environment (RSEnv)"},{value:"PhyB",label:"Physica B Condensed Matter (PhyB)"},{value:"ITNS",label:"IEEE Transactions on Nuclear Science (ITNS)"},{value:"JPCA",label:"Journal of Physical Chemistry A (JPCA)"},{value:"IPTL",label:"IEEE Photonics Technology Letters (IPTL)"},{value:"NJPh",label:"New Journal of Physics (NJPh)"},{value:"PSSAR",label:"Physica Status Solidi Applied Research (PSSAR)"},{value:"NatCo",label:"Nature Communications (NatCo)"},{value:"JMatS",label:"Journal of Materials Science (JMatS)"},{value:"CoPhC",label:"Computer Physics Communications (CoPhC)"},{value:"GSAB",label:"Geological Society of America Bulletin (GSAB)"},{value:"RPPh",label:"Reports on Progress in Physics (RPPh)"},{value:"JLwT",label:"Journal of Lightwave Technology (JLwT)"},{value:"NatPh",label:"Nature Physics (NatPh)"},{value:"RSPTA",label:"Philosophical Transactions of the Royal Society of London Series A (RSPTA)"},{value:"PCCP",label:"Physical Chemistry Chemical Physics (Incorporating Faraday Transactions) (PCCP)"},{value:"P&SS",label:"Planetary and Space Science (P&SS)"},{value:"Geop",label:"Geophysics (Geop)"},{value:"ITMTT",label:"IEEE Transactions on Microwave Theory Techniques (ITMTT)"},{value:"ChGeo",label:"Chemical Geology (ChGeo)"},{value:"JPS",label:"Journal of Power Sources (JPS)"},{value:"APS",label:"APS Meeting Abstracts (APS)"},{value:"ASPC",label:"Astronomical Society of the Pacific Conference Series (ASPC)"},{value:"JOSAA",label:"Journal of the Optical Society of America A (JOSAA)"},{value:"CaJPh",label:"Canadian Journal of Physics (CaJPh)"},{value:"JSV",label:"Journal of Sound Vibration (JSV)"},{value:"JGRB",label:"Journal of Geophysical Research (Solid Earth) (JGRB)"},{value:"Nanot",label:"Nanotechnology (Nanot)"},{value:"PhyD",label:"Physica D Nonlinear Phenomena (PhyD)"},{value:"AGUFM",label:"AGU Fall Meeting Abstracts (AGUFM)"},{value:"SSRv",label:"Space Science Reviews (SSRv)"},{value:"AIAAJ",label:"AIAA Journal (AIAAJ)"},{value:"JOSA",label:"Journal of the Optical Society of America (1917-1983) (JOSA)"},{value:"JETP",label:"Soviet Journal of Experimental and Theoretical Physics (JETP)"},{value:"JSSCh",label:"Journal of Solid State Chemistry France (JSSCh)"},{value:"QSRv",label:"Quaternary Science Reviews (QSRv)"},{value:"PMag",label:"Philosophical Magazine (PMag)"},{value:"JETPL",label:"Soviet Journal of Experimental and Theoretical Physics Letters (JETPL)"},{value:"JSP",label:"Journal of Statistical Physics (JSP)"},{value:"MedPh",label:"Medical Physics (MedPh)"},{value:"NucIM",label:"Nuclear Instruments and Methods (NucIM)"},{value:"Ap&SS",label:"Astrophysics and Space Science (Ap&SS)"},{value:"IAUS",label:"IAU Symposium (IAUS)"},{value:"JQSRT",label:"Journal of Quantitative Spectroscopy and Radiative Transfer (JQSRT)"},{value:"SSEle",label:"Solid State Electronics (SSEle)"},{value:"IEDL",label:"IEEE Electron Device Letters (IEDL)"},{value:"ApPhA",label:"Applied Physics A: Materials Science & Processing (ApPhA)"},{value:"NucFu",label:"Nuclear Fusion (NucFu)"},{value:"NaPho",label:"Nature Photonics (NaPho)"},{value:"JVGR",label:"Journal of Volcanology and Geothermal Research (JVGR)"},{value:"JApMe",label:"Journal of Applied Meteorology (JApMe)"},{value:"JPhG",label:"Journal of Physics G Nuclear Physics (JPhG)"},{value:"PEPI",label:"Physics of the Earth and Planetary Interiors (PEPI)"},{value:"AdSpR",label:"Advances in Space Research (AdSpR)"},{value:"IJRS",label:"International Journal of Remote Sensing (IJRS)"},{value:"ApPhB",label:"Applied Physics B: Lasers and Optics (ApPhB)"},{value:"JMoSt",label:"Journal of Molecular Structure (JMoSt)"},{value:"BAMS",label:"Bulletin of the American Meteorological Society (BAMS)"},{value:"JMagR",label:"Journal of Magnetic Resonance (JMagR)"},{value:"NucPh",label:"Nuclear Physics (NucPh)"},{value:"AdPhy",label:"Advances in Physics (AdPhy)"},{value:"AcSpA",label:"Spectrochimica Acta Part A: Molecular Spectroscopy (AcSpA)"},{value:"ClDy",label:"Climate Dynamics (ClDy)"},{value:"NatNa",label:"Nature Nanotechnology (NatNa)"},{value:"PASJ",label:"Publications of the Astronomical Society of Japan (PASJ)"},{value:"JGRC",label:"Journal of Geophysical Research (Oceans) (JGRC)"},{value:"AmJPh",label:"American Journal of Physics (AmJPh)"},{value:"IJMPA",label:"International Journal of Modern Physics A (IJMPA)"},{value:"Phy",label:"Physica (Phy)"},{value:"CMAME",label:"Computer Methods in Applied Mechanics and Engineering (CMAME)"},{value:"JSG",label:"Journal of Structural Geology (JSG)"},{value:"JMatR",label:"Journal of Materials Research (JMatR)"},{value:"NYASA",label:"Annals of the New York Academy of Sciences (NYASA)"},{value:"PMB",label:"Physics in Medicine and Biology (PMB)"},{value:"Litho",label:"Lithos (Litho)"},{value:"GBioC",label:"Global Biogeochemical Cycles (GBioC)"},{value:"PhyS",label:"Physica Scripta (PhyS)"},{value:"AnP",label:"Annalen der Physik (AnP)"},{value:"ITSP",label:"IEEE Transactions on Signal Processing (ITSP)"},{value:"PPCF",label:"Plasma Physics and Controlled Fusion (PPCF)"},{value:"JPet",label:"Journal of Petrology (JPet)"},{value:"GeoJ",label:"Geophysical Journal (GeoJ)"},{value:"JPhCS",label:"Journal of Physics Conference Series (JPhCS)"},{value:"ZPhyB",label:"Zeitschrift fur Physik B Condensed Matter (ZPhyB)"},{value:"MPLA",label:"Modern Physics Letters A (MPLA)"},{value:"HyPr",label:"Hydrological Processes (HyPr)"},{value:"JLTP",label:"Journal of Low Temperature Physics (JLTP)"},{value:"JVSTB",label:"Journal of Vacuum Science Technology B: Microelectronics and Nanometer Structures (JVSTB)"},{value:"Tecto",label:"Tectonics (Tecto)"},{value:"JG",label:"Journal of Geology (JG)"},{value:"PreR",label:"Precambrian Research (PreR)"},{value:"EPJB",label:"European Physical Journal B (EPJB)"},{value:"NuPhS",label:"Nuclear Physics B Proceedings Supplements (NuPhS)"},{value:"ZNatA",label:"Zeitschrift Naturforschung Teil A (ZNatA)"},{value:"AcSpe",label:"Spectrochimica Acta (AcSpe)"},{value:"ITPS",label:"IEEE Transactions on Plasma Science (ITPS)"},{value:"LNP",label:"Lecture Notes in Physics, Berlin Springer Verlag (LNP)"},{value:"DSRII",label:"Deep Sea Research Part II: Topical Studies in Oceanography (DSRII)"},{value:"JATP",label:"Journal of Atmospheric and Terrestrial Physics (JATP)"},{value:"Geomo",label:"Geomorphology (Geomo)"},{value:"PalOc",label:"Paleoceanography (PalOc)"},{value:"math",label:"ArXiv Mathematics e-prints (math)"},{value:"JPhF",label:"Journal of Physics F Metal Physics (JPhF)"},{value:"BoLMe",label:"Boundary-Layer Meteorology (BoLMe)"},{value:"ZPhyC",label:"Zeitschrift fur Physik C Particles and Fields (ZPhyC)"},{value:"SuScT",label:"Superconductor Science Technology (SuScT)"},{value:"RaSc",label:"Radio Science (RaSc)"},{value:"PhL",label:"Physics Letters (PhL)"},{value:"JCIS",label:"Journal of Colloid and Interface Science (JCIS)"},{value:"OptEn",label:"Optical Engineering (OptEn)"},{value:"JPoSA",label:"Journal of Polymer Science A Polymer Chemistry (JPoSA)"},{value:"IJNME",label:"International Journal for Numerical Methods in Engineering (IJNME)"},{value:"AnGeo",label:"Annales Geophysicae (AnGeo)"},{value:"ApSpe",label:"Applied Spectroscopy (ApSpe)"},{value:"NatGe",label:"Nature Geoscience (NatGe)"},{value:"SMat",label:"Soft Matter (SMat)"},{value:"AnRFM",label:"Annual Review of Fluid Mechanics (AnRFM)"},{value:"SeScT",label:"Semiconductor Science Technology (SeScT)"},{value:"PPS",label:"Proceedings of the Physical Society (PPS)"},{value:"ZPhyA",label:"Zeitschrift fur Physik A Hadrons and Nuclei (ZPhyA)"},{value:"GReGr",label:"General Relativity and Gravitation (GReGr)"},{value:"JMPSo",label:"Journal of Mechanics Physics of Solids (JMPSo)"},{value:"RvGeo",label:"Reviews of Geophysics (RvGeo)"},{value:"ADNDT",label:"Atomic Data and Nuclear Data Tables (ADNDT)"},{value:"LimOc",label:"Limnology and Oceanography (LimOc)"},{value:"JLum",label:"Journal of Luminescence (JLum)"},{value:"ARPC",label:"Annual Review of Physical Chemistry (ARPC)"},{value:"GGG",label:"Geochemistry, Geophysics, Geosystems (GGG)"},{value:"IJCli",label:"International Journal of Climatology (IJCli)"},{value:"JAtOT",label:"Journal of Atmospheric and Oceanic Technology (JAtOT)"},{value:"JEMat",label:"Journal of Electronic Materials (JEMat)"},{value:"JGlac",label:"Journal of Glaciology (JGlac)"},{value:"DRM",label:"Diamond and Related Materials (DRM)"},{value:"CaJES",label:"Canadian Journal of Earth Sciences (CaJES)"},{value:"ECSS",label:"Estuarine Coastal and Shelf Science (ECSS)"},{value:"CSR",label:"Continental Shelf Research (CSR)"},{value:"Ana",label:"The Analyst (Ana)"},{value:"ChPhL",label:"Chinese Physics Letters (ChPhL)"},{value:"QuRes",label:"Quaternary Research (QuRes)"},{value:"NCimA",label:"Nuovo Cimento A Serie (NCimA)"},{value:"AN",label:"Astronomische Nachrichten (AN)"},{value:"ITIP",label:"IEEE Transactions on Image Processing (ITIP)"},{value:"QuEle",label:"Quantum Electronics (QuEle)"},{value:"Nanos",label:"Nanoscale (Nanos)"},{value:"AREPS",label:"Annual Review of Earth and Planetary Sciences (AREPS)"},{value:"NW",label:"Naturwissenschaften (NW)"},{value:"MeScT",label:"Measurement Science and Technology (MeScT)"},{value:"Sedim",label:"Sedimentology (Sedim)"},{value:"CSF",label:"Chaos Solitons and Fractals (CSF)"},{value:"LPI",label:"Lunar and Planetary Science Conference (LPI)"},{value:"EPJA",label:"European Physical Journal A (EPJA)"},{value:"BVol",label:"Bulletin of Volcanology (BVol)"},{value:"SoEn",label:"Solar Energy (SoEn)"},{value:"SedG",label:"Sedimentary Geology (SedG)"},{value:"EGUGA",label:"EGU General Assembly Conference Abstracts (EGUGA)"},{value:"JMOp",label:"Journal of Modern Optics (JMOp)"},{value:"APh",label:"Astroparticle Physics (APh)"},{value:"PhT",label:"Physics Today (PhT)"},{value:"JGRE",label:"Journal of Geophysical Research (Planets) (JGRE)"},{value:"AmMin",label:"American Mineralogist (AmMin)"},{value:"ARNPS",label:"Annual Review of Nuclear and Particle Science (ARNPS)"},{value:"RvGSP",label:"Reviews of Geophysics and Space Physics (RvGSP)"},{value:"ESPL",label:"Earth Surface Processes and Landforms (ESPL)"},{value:"ScTEn",label:"Science of the Total Environment (ScTEn)"},{value:"ESRv",label:"Earth Science Reviews (ESRv)"},{value:"JRSp",label:"Journal of Raman Spectroscopy (JRSp)"},{value:"ASSL",label:"Astrophysics and Space Science Library (ASSL)"},{value:"JPoSB",label:"Journal of Polymer Science B Polymer Physics (JPoSB)"},{value:"IJMSI",label:"International Journal of Mass Spectrometry and Ion Processes (IJMSI)"},{value:"PApGe",label:"Pure and Applied Geophysics (PApGe)"},{value:"EPJD",label:"European Physical Journal D (EPJD)"},{value:"JPCRD",label:"Journal of Physical and Chemical Reference Data (JPCRD)"},{value:"ITAS",label:"IEEE Transactions on Applied Superconductivity (ITAS)"},{value:"M&PS",label:"Meteoritics and Planetary Science (M&PS)"},{value:"JAM",label:"Journal of Applied Mechanics (JAM)"},{value:"PrOce",label:"Progress in Oceanography (PrOce)"},{value:"JASTP",label:"Journal of Atmospheric and Solar-Terrestrial Physics (JASTP)"},{value:"EOSTr",label:"EOS Transactions (EOSTr)"},{value:"OptMa",label:"Optical Materials (OptMa)"},{value:"ESASP",label:"ESA Special Publication (ESASP)"},{value:"PhyE",label:"Physica E Low-Dimensional Systems and Nanostructures (PhyE)"},{value:"PMagA",label:"Philosophical Magazine, Part A (PMagA)"},{value:"PSST",label:"Plasma Sources Science Technology (PSST)"},{value:"PMagB",label:"Philosophical Magazine, Part B (PMagB)"},{value:"JHyMe",label:"Journal of Hydrometeorology (JHyMe)"},{value:"GPC",label:"Global and Planetary Change (GPC)"},{value:"BGeo",label:"Biogeosciences (BGeo)"},{value:"PhFlB",label:"Physics of Fluids B (PhFlB)"},{value:"MGeol",label:"Marine Geology (MGeol)"},{value:"DSRA",label:"Deep Sea Research A (DSRA)"},{value:"HESS",label:"Hydrology and Earth System Sciences (HESS)"},{value:"IJMPB",label:"International Journal of Modern Physics B (IJMPB)"},{value:"JChEd",label:"Journal of Chemical Education (JChEd)"},{value:"QuInt",label:"Quaternary International (QuInt)"},{value:"PhST",label:"Physica Scripta Volume T (PhST)"},{value:"Chaos",label:"Chaos (Chaos)"},{value:"MEPS",label:"Marine Ecology Progress Series (MEPS)"},{value:"OptSp",label:"Optics and Spectroscopy (OptSp)"},{value:"IJMPD",label:"International Journal of Modern Physics D (IJMPD)"},{value:"AdWR",label:"Advances in Water Resources (AdWR)"},{value:"HyInt",label:"Hyperfine Interactions (HyInt)"},{value:"JAESc",label:"Journal of Asian Earth Sciences (JAESc)"},{value:"AmJS",label:"American Journal of Science (AmJS)"},{value:"IAUC",label:"International Astronomical Union Circular (IAUC)"},{value:"PrPNP",label:"Progress in Particle and Nuclear Physics (PrPNP)"},{value:"RaPC",label:"Radiation Physics and Chemistry (RaPC)"},{value:"PThPS",label:"Progress of Theoretical Physics Supplement (PThPS)"},{value:"AAS",label:"American Astronomical Society Meeting Abstracts (AAS)"},{value:"JPhE",label:"Journal of Physics E Scientific Instruments (JPhE)"},{value:"PCPS",label:"Proceedings of the Cambridge Philosophical Society (PCPS)"},{value:"Cryo",label:"Cryogenics (Cryo)"},{value:"AnGla",label:"Annals of Glaciology (AnGla)"},{value:"IJTP",label:"International Journal of Theoretical Physics (IJTP)"},{value:"ITAES",label:"IEEE Transactions on Aerospace Electronic Systems (ITAES)"},{value:"SvPhU",label:"Soviet Physics Uspekhi (SvPhU)"},{value:"JSMTE",label:"Journal of Statistical Mechanics: Theory and Experiment (JSMTE)"},{value:"GSLSP",label:"Geological Society of London Special Publications (GSLSP)"},{value:"JDE",label:"Journal of Differential Equations (JDE)"},{value:"Chmsp",label:"Chemosphere (Chmsp)"},{value:"WtFor",label:"Weather and Forecasting (WtFor)"},{value:"JRScT",label:"Journal of Research in Science Teaching (JRScT)"},{value:"ArRMA",label:"Archive for Rational Mechanics and Analysis (ArRMA)"},{value:"JPlPh",label:"Journal of Plasma Physics (JPlPh)"},{value:"NCimB",label:"Nuovo Cimento B Serie (NCimB)"},{value:"CG",label:"Computers and Geosciences (CG)"},{value:"PhFlA",label:"Physics of Fluids A (PhFlA)"},{value:"SMaS",label:"Smart Material Structures (SMaS)"},{value:"GCBio",label:"Global Change Biology (GCBio)"},{value:"JMiMi",label:"Journal of Micromechanics and Microengineering (JMiMi)"},{value:"SuMi",label:"Superlattices and Microstructures (SuMi)"},{value:"SurSR",label:"Surface Science Reports (SurSR)"},{value:"ChPhB",label:"Chinese Physics B (ChPhB)"},{value:"TellB",label:"Tellus Series B Chemical and Physical Meteorology B (TellB)"},{value:"AcCrA",label:"Acta Crystallographica Section A (AcCrA)"},{value:"Oecol",label:"Oecologia (Oecol)"},{value:"AuJPh",label:"Australian Journal of Physics (AuJPh)"},{value:"BAAS",label:"Bulletin of the American Astronomical Society (BAAS)"},{value:"AgFM",label:"Agricultural and Forest Meteorology (AgFM)"},{value:"PCM",label:"Physics and Chemistry of Minerals (PCM)"},{value:"JMS",label:"Journal of Marine Systems (JMS)"},{value:"IJNMF",label:"International Journal for Numerical Methods in Fluids (IJNMF)"},{value:"JBO",label:"Journal of Biomedical Optics (JBO)"},{value:"ExFl",label:"Experiments in Fluids (ExFl)"},{value:"APExp",label:"Applied Physics Express (APExp)"},{value:"JRheo",label:"Journal of Rheology (JRheo)"},{value:"DSRI",label:"Deep Sea Research Part I: Oceanographic Research (DSRI)"},{value:"PPSA",label:"Proceedings of the Physical Society A (PPSA)"},{value:"ICRC",label:"International Cosmic Ray Conference (ICRC)"},{value:"LanB",label:"Landolt B&ouml;rnstein (LanB)"},{value:"AcA",label:"Acta Astronomica (AcA)"},{value:"PPP",label:"Palaeogeography Palaeoclimatology Palaeoecology (PPP)"},{value:"Tell",label:"Tellus (Tell)"},{value:"SciEd",label:"Science Education (SciEd)"},{value:"JMetG",label:"Journal of Metamorphic Geology (JMetG)"},{value:"PLSCB",label:"PLoS Computational Biology (PLSCB)"},{value:"IBVS",label:"Information Bulletin on Variable Stars (IBVS)"},{value:"Metro",label:"Metrologia (Metro)"},{value:"JGCD",label:"Journal of Guidance Control Dynamics (JGCD)"},{value:"AnRMS",label:"Annual Review of Materials Science (AnRMS)"},{value:"NatCC",label:"Nature Climate Change (NatCC)"},{value:"MTA",label:"Metallurgical Transactions A (MTA)"},{value:"ThApC",label:"Theoretical and Applied Climatology (ThApC)"},{value:"CzJPh",label:"Czechoslovak Journal of Physics (CzJPh)"},{value:"IJMSp",label:"International Journal of Mass Spectrometry (IJMSp)"},{value:"JSpRo",label:"Journal of Spacecraft and Rockets (JSpRo)"},{value:"Nonli",label:"Nonlinearity (Nonli)"},{value:"LaPhL",label:"Laser Physics Letters (LaPhL)"},{value:"LMaPh",label:"Letters in Mathematical Physics (LMaPh)"},{value:"RemS",label:"Remote Sensing (RemS)"},{value:"CCM",label:"Clays and Clay Minerals (CCM)"},{value:"SSASJ",label:"Soil Science Society of America Journal (SSASJ)"},{value:"IJBC",label:"International Journal of Bifurcation and Chaos (IJBC)"},{value:"Metic",label:"Meteoritics (Metic)"},{value:"PhSS",label:"Physics of the Solid State (PhSS)"},{value:"JGRF",label:"Journal of Geophysical Research (Earth Surface) (JGRF)"},{value:"ZPhyD",label:"Zeitschrift fur Physik D Atoms Molecules Clusters (ZPhyD)"},{value:"MSSP",label:"Mechanical Systems and Signal Processing (MSSP)"},{value:"IGRSL",label:"IEEE Geoscience and Remote Sensing Letters (IGRSL)"},{value:"InMat",label:"Inventiones Mathematicae (InMat)"},{value:"gr.qc",label:"ArXiv General Relativity and Quantum Cosmology e-prints (gr.qc)"},{value:"MMTA",label:"Metallurgical and Materials Transactions A (MMTA)"},{value:"EP&S",label:"Earth, Planets, and Space (EP&S)"},{value:"GeopP",label:"Geophysical Prospecting (GeopP)"},{value:"IJSEd",label:"International Journal of Science Education (IJSEd)"},{value:"FaDi",label:"Faraday Discussions (FaDi)"},{value:"AtmRe",label:"Atmospheric Research (AtmRe)"},{value:"InvPr",label:"Inverse Problems (InvPr)"},{value:"SvA",label:"Soviet Astronomy (SvA)"},{value:"SPhD",label:"Soviet Physics Doklady (SPhD)"},{value:"AcAau",label:"Acta Astronautica (AcAau)"},{value:"JCHyd",label:"Journal of Contaminant Hydrology (JCHyd)"},{value:"ForPh",label:"Fortschritte der Physik (ForPh)"},{value:"Vacuu",label:"Vacuum (Vacuu)"},{value:"JApMC",label:"Journal of Applied Meteorology and Climatology (JApMC)"},{value:"OptLT",label:"Optics Laser Technology (OptLT)"},{value:"STIN",label:"NASA STI/Recon Technical Report N (STIN)"},{value:"GCN",label:"GRB Coordinates Network (GCN)"},{value:"ER",label:"Environmental Research (ER)"},{value:"JPRS",label:"ISPRS Journal of Photogrammetry and Remote Sensing (JPRS)"},{value:"JAWRA",label:"Journal of the American Water Resources Association (JAWRA)"},{value:"JSedR",label:"Journal of Sedimentary Research (JSedR)"},{value:"ZhPmR",label:"ZhETF Pisma Redaktsiiu (ZhPmR)"},{value:"ERL",label:"Environmental Research Letters (ERL)"},{value:"PhRvS",label:"Physical Review Accelerators and Beams (PhRvS)"},{value:"ApPhy",label:"Applied Physics (ApPhy)"},{value:"PhyU",label:"Physics Uspekhi (PhyU)"},{value:"AuJES",label:"Australian Journal of Earth Sciences (AuJES)"},{value:"ATel",label:"The Astronomer's Telegram (ATel)"},{value:"AZh",label:"Astronomicheskii Zhurnal (AZh)"},{value:"PAN",label:"Physics of Atomic Nuclei (PAN)"},{value:"GApFD",label:"Geophysical and Astrophysical Fluid Dynamics (GApFD)"},{value:"PhRvX",label:"Physical Review X (PhRvX)"},{value:"SciAm",label:"Scientific American (SciAm)"},{value:"JQS",label:"Journal of Quaternary Science (JQS)"},{value:"Prama",label:"Pramana (Prama)"},{value:"BuSSA",label:"The Bulletin of the Seismological Society of America (BuSSA)"},{value:"GeoRu",label:"Geologische Rundschau (GeoRu)"},{value:"NRL",label:"Nanoscale Research Letters (NRL)"},{value:"AerST",label:"Aerosol Science Technology (AerST)"},{value:"ZhETF",label:"Zhurnal Eksperimentalnoi i Teoreticheskoi Fiziki (ZhETF)"},{value:"JGRG",label:"Journal of Geophysical Research (Biogeosciences) (JGRG)"},{value:"ElL",label:"Electronics Letters (ElL)"},{value:"JAfES",label:"Journal of African Earth Sciences (JAfES)"},{value:"RSPSB",label:"Proceedings of the Royal Society of London Series B (RSPSB)"},{value:"JInst",label:"Journal of Instrumentation (JInst)"},{value:"FoPh",label:"Foundations of Physics (FoPh)"},{value:"NewA",label:"New Astronomy (NewA)"},{value:"PSSCR",label:"Physica Status Solidi C Current Topics (PSSCR)"},{value:"NDS",label:"Nuclear Data Sheets (NDS)"},{value:"IAWPL",label:"IEEE Antennas and Wireless Propagation Letters (IAWPL)"},{value:"LPSC",label:"Lunar and Planetary Science Conference Proceedings (LPSC)"},{value:"NCim",label:"Il Nuovo Cimento (NCim)"},{value:"RSPTB",label:"Philosophical Transactions of the Royal Society of London Series B (RSPTB)"},{value:"JCoMa",label:"Journal of Composite Materials (JCoMa)"},{value:"Optik",label:"Optik (Optik)"},{value:"CNSNS",label:"Communications in Nonlinear Science and Numerical Simulations (CNSNS)"},{value:"OcMod",label:"Ocean Modelling (OcMod)"},{value:"NIMPR",label:"Nuclear Instruments and Methods in Physics Research (NIMPR)"},{value:"JAerS",label:"Journal of Aerosol Science (JAerS)"},{value:"ZA",label:"Zeitschrift fur Astrophysik (ZA)"},{value:"CoTPh",label:"Communications in Theoretical Physics (CoTPh)"},{value:"MPLB",label:"Modern Physics Letters B (MPLB)"},{value:"TMP",label:"Theoretical and Mathematical Physics (TMP)"},{value:"AcPPB",label:"Acta Physica Polonica B (AcPPB)"},{value:"AMM",label:"Applied Mechanics and Materials (AMM)"},{value:"Obs",label:"The Observatory (Obs)"},{value:"ConPh",label:"Contemporary Physics (ConPh)"},{value:"MAP",label:"Meteorology and Atmospheric Physics (MAP)"},{value:"JFS",label:"Journal of Fluids and Structures (JFS)"},{value:"AMT",label:"Atmospheric Measurement Techniques (AMT)"},{value:"PrSS",label:"Progress In Surface Science (PrSS)"},{value:"ISPM",label:"IEEE Signal Processing Magazine (ISPM)"},{value:"PMagL",label:"Philosophical Magazine Letters (PMagL)"},{value:"GondR",label:"Gondwana Research (GondR)"},{value:"LRR",label:"Living Reviews in Relativity (LRR)"},{value:"CeMDA",label:"Celestial Mechanics and Dynamical Astronomy (CeMDA)"},{value:"KvanE",label:"Kvantovaia Elektronika Moscow (KvanE)"},{value:"PhyBC",label:"Physica B+C (PhyBC)"},{value:"NPhS",label:"Nature Physical Science (NPhS)"},{value:"NHESS",label:"Natural Hazards and Earth System Sciences (NHESS)"},{value:"PPSB",label:"Proceedings of the Physical Society B (PPSB)"},{value:"GMS",label:"Washington DC American Geophysical Union Geophysical Monograph Series (GMS)"},{value:"HydJ",label:"Hydrogeology Journal (HydJ)"},{value:"Holoc",label:"The Holocene (Holoc)"},{value:"TellA",label:"Tellus Series A (TellA)"},{value:"JOptA",label:"Journal of Optics A: Pure and Applied Optics (JOptA)"},{value:"IEEEP",label:"IEEE Proceedings (IEEEP)"},{value:"JOpt",label:"Journal of Optics (JOpt)"},{value:"IJNLM",label:"International Journal of Non Linear Mechanics (IJNLM)"},{value:"JGeod",label:"Journal of Geodesy (JGeod)"},{value:"NatCh",label:"Nature Chemistry (NatCh)"},{value:"PlPh",label:"Plasma Physics (PlPh)"},{value:"MPEC",label:"Minor Planet Electronic Circulars (MPEC)"},{value:"ISPL",label:"IEEE Signal Processing Letters (ISPL)"},{value:"GeoM",label:"Geological Magazine (GeoM)"},{value:"LaPhy",label:"Laser Physics (LaPhy)"},{value:"CAP",label:"Current Applied Physics (CAP)"},{value:"SSSci",label:"Solid State Sciences (SSSci)"},{value:"JScI",label:"Journal of Scientific Instruments (JScI)"},{value:"BJAP",label:"British Journal of Applied Physics (BJAP)"},{value:"CorRe",label:"Coral Reefs (CorRe)"},{value:"RuMaS",label:"Russian Mathematical Surveys (RuMaS)"},{value:"ZaMM",label:"Zeitschrift Angewandte Mathematik und Mechanik (ZaMM)"},{value:"Semic",label:"Semiconductors (Semic)"},{value:"IJMPE",label:"International Journal of Modern Physics E (IJMPE)"},{value:"GMD",label:"Geoscientific Model Development (GMD)"},{value:"CompM",label:"Computational Mechanics (CompM)"},{value:"IJMPC",label:"International Journal of Modern Physics C (IJMPC)"},{value:"AstL",label:"Astronomy Letters (AstL)"},{value:"AcOpt",label:"Optica Acta (AcOpt)"},{value:"JPoSc",label:"Journal of Polymer Science (JPoSc)"},{value:"A&ARv",label:"Astronomy and Astrophysics Review (A&ARv)"},{value:"JGP",label:"Journal of Geometry and Physics (JGP)"},{value:"Geode",label:"Geofisica Internacional (Geode)"},{value:"MinM",label:"Mineralogical Magazine (MinM)"},{value:"PhTea",label:"The Physics Teacher (PhTea)"},{value:"MmSAI",label:"Memorie della Societa Astronomica Italiana (MmSAI)"},{value:"TCry",label:"The Cryosphere (TCry)"},{value:"NewAR",label:"New Astronomy Reviews (NewAR)"},{value:"MT",label:"Metallurgical Transactions (MT)"},{value:"ApL",label:"Astrophysical Letters (ApL)"},{value:"PASA",label:"Publications of the Astronomical Society of Australia (PASA)"},{value:"MSMSE",label:"Modelling Simul. Mater. Sci. Eng. (MSMSE)"},{value:"IJEaS",label:"International Journal of Earth Sciences (IJEaS)"},{value:"ASIC",label:"NATO Advanced Science Institutes (ASI) Series C (ASIC)"},{value:"AdTMP",label:"Advances in Theoretical and Mathematical Physics (AdTMP)"},{value:"MPC",label:"Minor Planet Circulars (MPC)"},{value:"IJT",label:"International Journal of Thermophysics (IJT)"},{value:"MinDe",label:"Mineralium Deposita (MinDe)"},{value:"OptLE",label:"Optics and Lasers in Engineering (OptLE)"},{value:"ACPD",label:"Atmospheric Chemistry & Physics Discussions (ACPD)"},{value:"Wthr",label:"Weather (Wthr)"},{value:"ChPhy",label:"Chinese Physics (ChPhy)"},{value:"CeMec",label:"Celestial Mechanics (CeMec)"},{value:"TePhL",label:"Technical Physics Letters (TePhL)"},{value:"JOM",label:"JOM - Journal of the Minerals, Metals and Materials Society (JOM)"},{value:"JNR",label:"Journal of Nanoparticle Research (JNR)"},{value:"BAN",label:"Bulletin of the Astronomical Institutes of the Netherlands (BAN)"},{value:"AIPA",label:"AIP Advances (AIPA)"},{value:"JSAES",label:"Journal of South American Earth Sciences (JSAES)"},{value:"LTP",label:"Low Temperature Physics (LTP)"},{value:"TeNov",label:"Terra Nova (TeNov)"},{value:"CoPP",label:"Contributions to Plasma Physics (CoPP)"},{value:"JAG",label:"Journal of Applied Geophysics (JAG)"},{value:"SIAMR",label:"SIAM Review (SIAMR)"},{value:"AsBio",label:"Astrobiology (AsBio)"},{value:"Ge&Ae",label:"Geomagnetism and Aeronomy (Ge&Ae)"},{value:"SJNA",label:"SIAM Journal on Numerical Analysis (SJNA)"},{value:"MiMic",label:"Microscopy and Microanalysis (MiMic)"},{value:"LPB",label:"Laser and Particle Beams (LPB)"},{value:"ChSBu",label:"Chinese Science Bulletin (ChSBu)"},{value:"EPJE",label:"European Physical Journal E (EPJE)"},{value:"NHTA",label:"Numerical Heat Transfer Part A - Applications (NHTA)"},{value:"MS&E",label:"Materials Science and Engineering Conference Series (MS&E)"},{value:"JKPS",label:"Journal of Korean Physical Society (JKPS)"},{value:"ZK",label:"Zeitschrift fur Kristallographie (ZK)"},{value:"AdAtS",label:"Advances in Atmospheric Sciences (AdAtS)"},{value:"JGG",label:"Journal of Geomagnetism and Geoelectricity (JGG)"},{value:"ChPhC",label:"Chinese Physics C (ChPhC)"},{value:"SvAL",label:"Soviet Astronomy Letters (SvAL)"},{value:"ZaMP",label:"Zeitschrift Angewandte Mathematik und Physik (ZaMP)"},{value:"AnAp",label:"Annales d'Astrophysique (AnAp)"},{value:"EPJST",label:"European Physical Journal Special Topics (EPJST)"},{value:"RpMP",label:"Reports on Mathematical Physics (RpMP)"},{value:"JOptB",label:"Journal of Optics B: Quantum and Semiclassical Optics (JOptB)"},{value:"GML",label:"Geo-Marine Letters (GML)"},{value:"Msngr",label:"The Messenger (Msngr)"},{value:"CliPa",label:"Climate of the Past (CliPa)"},{value:"InfPh",label:"Infrared Physics (InfPh)"},{value:"SPIE1",label:"Society of Photo-Optical Instrumentation Engineers (SPIE) Conference Series (SPIE1)"},{value:"JGeo",label:"Journal of Geodynamics (JGeo)"},{value:"RMxAA",label:"Revista Mexicana de Astronomia y Astrofisica (RMxAA)"},{value:"R&QE",label:"Radiophysics and Quantum Electronics (R&QE)"},{value:"IJAEO",label:"International Journal of Applied Earth Observation and Geoinformation (IJAEO)"},{value:"RadR",label:"Radiation Research (RadR)"},{value:"JTST",label:"Journal of Thermal Spray Technology (JTST)"},{value:"PlPhR",label:"Plasma Physics Reports (PlPhR)"},{value:"yCat",label:"VizieR Online Data Catalog (yCat)"},{value:"Mate",label:"Materials (Mate)"},{value:"ITNan",label:"IEEE Transactions on Nanotechnology (ITNan)"},{value:"IJBm",label:"International Journal of Biometeorology (IJBm)"},{value:"WASP",label:"Water Air and Soil Pollution (WASP)"},{value:"EM&P",label:"Earth Moon and Planets (EM&P)"},{value:"S&T",label:"Sky and Telescope (S&T)"},{value:"IJSSC",label:"IEEE Journal of Solid-State Circuits (IJSSC)"},{value:"ApMRv",label:"Applied Mechanics Reviews (ApMRv)"},{value:"ARep",label:"Astronomy Reports (ARep)"},{value:"DPS",label:"AAS/Division for Planetary Sciences Meeting Abstracts (DPS)"},{value:"InPhT",label:"Infrared Physics and Technology (InPhT)"},{value:"NPGeo",label:"Nonlinear Processes in Geophysics (NPGeo)"},{value:"IJIMW",label:"International Journal of Infrared and Millimeter Waves (IJIMW)"},{value:"SGeo",label:"Surveys in Geophysics (SGeo)"},{value:"EPJWC",label:"European Physical Journal Web of Conferences (EPJWC)"},{value:"FBS",label:"Few-Body Systems (FBS)"},{value:"PCE",label:"Physics and Chemistry of the Earth (PCE)"},{value:"MinPe",label:"Mineralogy and Petrology (MinPe)"},{value:"IJQC",label:"International Journal of Quantum Chemistry (IJQC)"},{value:"CaJRS",label:"Canadian Journal of Remote Sensing (CaJRS)"},{value:"CRPhy",label:"Comptes Rendus Physique (CRPhy)"},{value:"JRASC",label:"Journal of the Royal Astronomical Society of Canada (JRASC)"},{value:"JTePh",label:"Journal of Technical Physics (JTePh)"},{value:"IGRv",label:"International Geology Review (IGRv)"},{value:"OcDyn",label:"Ocean Dynamics (OcDyn)"},{value:"DyAtO",label:"Dynamics of Atmospheres and Oceans (DyAtO)"},{value:"JCoAM",label:"Journal of Computational and Applied Mathematics (JCoAM)"},{value:"JSR",label:"Journal of Sea Research (JSR)"},{value:"TrAGU",label:"Transactions, American Geophysical Union (TrAGU)"},{value:"RuCRv",label:"Russian Chemical Reviews (RuCRv)"},{value:"RadM",label:"Radiation Measurements (RadM)"},{value:"JMolE",label:"Journal of Molecular Evolution (JMolE)"},{value:"AdAMP",label:"Advances in Atomic and Molecular Physics (AdAMP)"},{value:"LPICo",label:"LPI Contributions (LPICo)"},{value:"Afz",label:"Astrofizika (Afz)"},{value:"BAICz",label:"Bulletin of the Astronomical Institutes of Czechoslovakia (BAICz)"},{value:"IAPM",label:"IEEE Antennas and Propagation Magazine (IAPM)"},{value:"EJPh",label:"European Journal of Physics (EJPh)"},{value:"JPhy1",label:"Journal de Physique I (JPhy1)"},{value:"PhPro",label:"Physics Procedia (PhPro)"},{value:"PQE",label:"Progress in Quantum Electronics (PQE)"},{value:"Entrp",label:"Entropy (Entrp)"},{value:"SoilS",label:"Soil Science (SoilS)"},{value:"EPJAP",label:"European Physical Journal Applied Physics (EPJAP)"},{value:"BrJPh",label:"Brazilian Journal of Physics (BrJPh)"},{value:"HPR",label:"High Pressure Research (HPR)"},{value:"SbMat",label:"Sbornik: Mathematics (SbMat)"},{value:"JApSp",label:"Journal of Applied Spectroscopy (JApSp)"},{value:"AGUSM",label:"AGU Spring Meeting Abstracts (AGUSM)"},{value:"EnGeo",label:"Environmental Geology (EnGeo)"},{value:"MmRAS",label:"Memoirs of the Royal Astronomical Society (MmRAS)"},{value:"EnMan",label:"Environmental Management (EnMan)"},{value:"COSSM",label:"Current Opinion in Solid State and Materials Science (COSSM)"},{value:"CRGeo",label:"Comptes Rendus Geoscience (CRGeo)"},{value:"IAM",label:"International Applied Mechanics (IAM)"},{value:"AdQC",label:"Advances in Quantum Chemistry (AdQC)"},{value:"RvMG",label:"Reviews in Mineralogy and Geochemistry (RvMG)"},{value:"AAMOP",label:"Advances in Atomic Molecular and Optical Physics (AAMOP)"},{value:"RCMS",label:"Rapid Communications in Mass Spectrometry (RCMS)"},{value:"EJMin",label:"European Journal of Mineralogy (EJMin)"},{value:"QJRAS",label:"Quarterly Journal of the Royal Astronomical Society (QJRAS)"},{value:"SciA",label:"Science Advances (SciA)"},{value:"JMEP",label:"Journal of Materials Engineering and Performance (JMEP)"},{value:"JSup",label:"Journal of Superconductivity (JSup)"},{value:"MTB",label:"Metallurgical Transactions B (MTB)"},{value:"NCimC",label:"Nuovo Cimento C Geophysics Space Physics C (NCimC)"},{value:"NASSP",label:"NASA Special Publication (NASSP)"},{value:"NHTB",label:"Numerical Heat Transfer Part B - Fundamentals (NHTB)"},{value:"JAMTP",label:"Journal of Applied Mechanics and Technical Physics (JAMTP)"},{value:"ITPE",label:"IEEE Transactions on Power Electronics (ITPE)"},{value:"ClMin",label:"Clay Minerals (ClMin)"},{value:"SpecL",label:"Spectroscopy Letters (SpecL)"},{value:"JAtC",label:"Journal of Atmospheric Chemistry (JAtC)"},{value:"PrAeS",label:"Progress in Aerospace Sciences (PrAeS)"},{value:"MMAS",label:"Mathematical Methods in the Applied Sciences (MMAS)"},{value:"DoSSR",label:"Akademiia Nauk SSSR Doklady (DoSSR)"},{value:"JBAA",label:"Journal of the British Astronomical Association (JBAA)"},{value:"VA",label:"Vistas in Astronomy (VA)"},{value:"MarMP",label:"Marine Micropaleontology (MarMP)"},{value:"IJNAM",label:"International Journal for Numerical and Analytical Methods in Geomechanics (IJNAM)"},{value:"PhyEd",label:"Physics Education (PhyEd)"},{value:"OLEB",label:"Origins of Life and Evolution of the Biosphere (OLEB)"},{value:"RAA",label:"Research in Astronomy and Astrophysics (RAA)"},{value:"STAdM",label:"Science and Technology of Advanced Materials (STAdM)"},{value:"QuIP",label:"Quantum Information Processing (QuIP)"},{value:"MMTB",label:"Metallurgical and Materials Transactions B (MMTB)"},{value:"BasR",label:"Basin Research (BasR)"},{value:"PSSRR",label:"Physica Status Solidi Rapid Research Letters (PSSRR)"},{value:"SpWea",label:"Space Weather (SpWea)"},{value:"SCPMA",label:"Science China Physics, Mechanics, and Astronomy (SCPMA)"},{value:"ARCMP",label:"Annual Review of Condensed Matter Physics (ARCMP)"},{value:"JCAMD",label:"Journal of Computer-Aided Molecular Design (JCAMD)"},{value:"FlDyR",label:"Fluid Dynamics Research (FlDyR)"},{value:"ITPSy",label:"IEEE Transactions on Power Systems (ITPSy)"},{value:"DokES",label:"Doklady Earth Sciences (DokES)"},{value:"OptFT",label:"Optical Fiber Technology (OptFT)"},{value:"EJMF",label:"European Journal of Mechanics B Fluids (EJMF)"},{value:"CryRp",label:"Crystallography Reports (CryRp)"},{value:"IJCA",label:"International Journal of Computer Applications (IJCA)"},{value:"JPhy2",label:"Journal de Physique II (JPhy2)"},{value:"MeApp",label:"Meteorological Applications (MeApp)"},{value:"ISTSP",label:"IEEE Journal of Selected Topics in Signal Processing (ISTSP)"},{value:"JMSp",label:"Journal of Mass Spectrometry (JMSp)"},{value:"REDS",label:"Radiation Effects and Defects in Solids (REDS)"},{value:"JGSoc",label:"Journal of the Geological Society (JGSoc)"},{value:"PASAu",label:"Proceedings of the Astronomical Society of Australia (PASAu)"},{value:"IJSTQ",label:"IEEE Journal of Selected Topics in Quantum Electronics (IJSTQ)"},{value:"JApMM",label:"Journal of Applied Mathematics and Mechanics (JApMM)"},{value:"AdGeo",label:"Advances in Geophysics (AdGeo)"},{value:"MaCom",label:"Mathematics of Computation (MaCom)"},{value:"JDisT",label:"Journal of Display Technology (JDisT)"},{value:"ApGC",label:"Applied Geochemistry (ApGC)"},{value:"ClRes",label:"Climate Research (ClRes)"},{value:"E&ES",label:"IOP Conference Series: Earth and Environmental Science (E&ES)"},{value:"JApA",label:"Journal of Astrophysics and Astronomy (JApA)"},{value:"NCimD",label:"Nuovo Cimento D Serie (NCimD)"},{value:"JArEn",label:"Journal of Arid Environments (JArEn)"},{value:"GeCAS",label:"Geochimica et Cosmochimica Acta Supplement (GeCAS)"},{value:"ExA",label:"Experimental Astronomy (ExA)"},{value:"AnHP",label:"Annales Henri Poincar&eacute; (AnHP)"},{value:"FlDy",label:"Fluid Dynamics (FlDy)"},{value:"JJAPS",label:"Japanese Journal of Applied Physics Supplement (JJAPS)"},{value:"DSR",label:"Deep Sea Research (DSR)"},{value:"IRPC",label:"International Reviews in Physical Chemistry (IRPC)"},{value:"EJMS",label:"European Journal of Mechanics Solids (EJMS)"},{value:"HMT",label:"Heat and Mass Transfer (HMT)"},{value:"PA",label:"Popular Astronomy (PA)"},{value:"SPTP",label:"Soviet Physics Technical Physics (SPTP)"},{value:"CBET",label:"Central Bureau Electronic Telegrams (CBET)"},{value:"C&T",label:"Ciel et Terre (C&T)"},{value:"MPCPS",label:"Mathematical Proceedings of the Cambridge Philosophical Society (MPCPS)"},{value:"CRSSM",label:"Critical Reviews in Solid State & Materials Sciences (CRSSM)"},{value:"JMSB",label:"Journal of Macromolecular Science, Part B (JMSB)"},{value:"RvMaP",label:"Reviews in Mathematical Physics (RvMaP)"},{value:"NJSR",label:"Netherlands Journal of Sea Research (NJSR)"},{value:"JNEng",label:"Journal of Neural Engineering (JNEng)"},{value:"JAMES",label:"Journal of Advances in Modeling Earth Systems (JAMES)"},{value:"JPoSL",label:"Journal of Polymer Science: Polymer Letters Edition (JPoSL)"},{value:"WiEn",label:"Wind Energy (WiEn)"},{value:"RuPhJ",label:"Russian Physics Journal (RuPhJ)"},{value:"MetZe",label:"Meteorologische Zeitschrift (MetZe)"},{value:"JCP",label:"Journal de Chimie Physique (JCP)"},{value:"ThCFD",label:"Theoretical and Computational Fluid Dynamics (ThCFD)"},{value:"PhRvP",label:"Physical Review Applied (PhRvP)"},{value:"ESOC",label:"European Southern Observatory Conference and Workshop Proceedings (ESOC)"},{value:"ShWav",label:"Shock Waves (ShWav)"},{value:"EAEJA",label:"EGS - AGU - EUG Joint Assembly (EAEJA)"},{value:"PKM",label:"Physik der Kondensierten Materie (PKM)"},{value:"PAZh",label:"Pisma v Astronomicheskii Zhurnal (PAZh)"},{value:"OcSci",label:"Ocean Science (OcSci)"},{value:"JASMS",label:"Journal of The American Society for Mass Spectrometry (JASMS)"},{value:"StGG",label:"Studia Geophysica et Geodaetica (StGG)"},{value:"RScEd",label:"Research in Science Education (RScEd)"},{value:"IzMat",label:"Izvestiya: Mathematics (IzMat)"},{value:"PhyM",label:"Physiological Measurement (PhyM)"},{value:"RSPT",label:"Philosophical Transactions of the Royal Society of London Series I (RSPT)"},{value:"BaltA",label:"Baltic Astronomy (BaltA)"},{value:"MSHT",label:"Metal Science and Heat Treatment (MSHT)"},{value:"Moon",label:"Moon (Moon)"},{value:"EPJP",label:"European Physical Journal Plus (EPJP)"},{value:"BASI",label:"Bulletin of the Astronomical Society of India (BASI)"},{value:"RMxAC",label:"Revista Mexicana de Astronomia y Astrofisica Conference Series (RMxAC)"},{value:"BGD",label:"Biogeosciences Discussions (BGD)"},{value:"ITEdu",label:"IEEE Transactions on Education (ITEdu)"},{value:"OptRv",label:"Optical Review (OptRv)"},{value:"SRL",label:"Surface Review and Letters (SRL)"},{value:"JNS",label:"Journal of NonLinear Science (JNS)"},{value:"LAstr",label:"L'Astronomie (LAstr)"},{value:"SvPhJ",label:"Soviet Physics Journal (SvPhJ)"},{value:"PlST",label:"Plasma Science and Technology (PlST)"},{value:"Geosp",label:"Geosphere (Geosp)"},{value:"Ap",label:"Astrophysics (Ap)"},{value:"JElS",label:"Journal of the Electrochemical Society (JElS)"},{value:"DokPh",label:"Physics - Doklady (DokPh)"},{value:"FCPh",label:"Fundamentals of Cosmic Physics (FCPh)"},{value:"MSRv",label:"Mass Spectrometry Reviews (MSRv)"},{value:"MarGR",label:"Marine Geophysical Research (MarGR)"},{value:"NDT",label:"Nuclear Data Tables (NDT)"},{value:"NASCP",label:"NASA Conference Publication (NASCP)"},{value:"SurSL",label:"Surface Science Letters (SurSL)"},{value:"ISenJ",label:"IEEE Sensors Journal (ISenJ)"},{value:"JEnMa",label:"Journal of Engineering Mathematics (JEnMa)"},{value:"RMRE",label:"Rock Mechanics and Rock Engineering (RMRE)"},{value:"HDP",label:"Handbuch der Physik (HDP)"},{value:"LRSP",label:"Living Reviews in Solar Physics (LRSP)"},{value:"PTEP",label:"Progress of Theoretical and Experimental Physics (PTEP)"},{value:"PhBio",label:"Physical Biology (PhBio)"},{value:"AmSci",label:"American Scientist (AmSci)"},{value:"JSeis",label:"Journal of Seismology (JSeis)"},{value:"AcMSn",label:"Acta Mechanica Sinica (AcMSn)"},{value:"Palai",label:"PALAIOS (Palai)"},{value:"OptPN",label:"Optics & Photonics News (OptPN)"},{value:"LNCS",label:"Lecture Notes in Computer Science (LNCS)"},{value:"GrCo",label:"Gravitation and Cosmology (GrCo)"},{value:"UsFiN",label:"Uspekhi Fizicheskikh Nauk (UsFiN)"},{value:"RJPCA",label:"Russian Journal of Physical Chemistry A (RJPCA)"},{value:"IJTPE",label:"IEEJ Transactions on Power and Energy (IJTPE)"},{value:"ARMS",label:"Annual Review of Marine Science (ARMS)"},{value:"SIGMA",label:"SIGMA (SIGMA)"},{value:"CoPhR",label:"Computer Physics Reports (CoPhR)"},{value:"ECMS",label:"Estuarine and Coastal Marine Science (ECMS)"},{value:"CMT",label:"Continuum Mechanics and Thermodynamics (CMT)"},{value:"APhy",label:"Acoustical Physics (APhy)"},{value:"ApSRv",label:"Applied Spectroscopy Reviews (ApSRv)"},{value:"Sc&Ed",label:"Science & Education (Sc&Ed)"},{value:"ChOpL",label:"Chinese Optics Letters (ChOpL)"},{value:"PDiff",label:"Powder Diffraction (PDiff)"},{value:"AnPh",label:"Annales de Physique (AnPh)"},{value:"HEDP",label:"High Energy Density Physics (HEDP)"},{value:"SoSyR",label:"Solar System Research (SoSyR)"},{value:"ITPAS",label:"IEEE Transactions on Power Apparatus Systems (ITPAS)"},{value:"prpl.conf",label:"Protostars and Planets (prpl.conf)"},{value:"NCimR",label:"Nuovo Cimento Rivista Serie (NCimR)"},{value:"AAM",label:"Archive of Applied Mechanics (AAM)"},{value:"PDAO",label:"Publications of the Dominion Astrophysical Observatory Victoria (PDAO)"},{value:"JPall",label:"Journal of Palaeolimnology (JPall)"},{value:"RaF",label:"Radiofizika (RaF)"},{value:"EJASP",label:"EURASIP Journal on Applied Signal Processing (EJASP)"},{value:"RuGG",label:"Russian Geology and Geophysics (RuGG)"},{value:"JEI",label:"Journal of Electronic Imaging (JEI)"},{value:"TSICE",label:"Transactions of the Society of Instrument and Control Engineers (TSICE)"},{value:"HTrEn",label:"Heat Transfer Engineering (HTrEn)"},{value:"ATsir",label:"Astronomicheskij Tsirkulyar (ATsir)"},{value:"ClCh",label:"Climatic Change (ClCh)"},{value:"SciMo",label:"The Scientific Monthly (SciMo)"},{value:"InJPh",label:"Indian Journal of Physics (InJPh)"},{value:"HESSD",label:"Hydrology and Earth System Sciences Discussions (HESSD)"},{value:"SAOSR",label:"SAO Special Report (SAOSR)"},{value:"JEP",label:"Journal of Engineering Physics (JEP)"},{value:"IJTFM",label:"IEEJ Transactions on Fundamentals and Materials (IJTFM)"},{value:"AD",label:"Atomic Data (AD)"},{value:"ITEIS",label:"IEEJ Transactions on Electronics, Information and Systems (ITEIS)"},{value:"WRM",label:"Waves in Random Media (WRM)"},{value:"PZETF",label:"Pisma v Zhurnal Eksperimentalnoi i Teoreticheskoi Fiziki (PZETF)"},{value:"HiA",label:"Highlights of Astronomy (HiA)"},{value:"CRASM",label:"Academie des Sciences Paris Comptes Rendus Serie Sciences Mathematiques (CRASM)"},{value:"AIHPC",label:"Annales de L'Institut Henri Poincare Section (C) Non Linear Analysis (AIHPC)"},{value:"CosRe",label:"Cosmic Research (CosRe)"},{value:"MsT",label:"Masters Thesis (MsT)"},{value:"NCimL",label:"Nuovo Cimento Lettere (NCimL)"},{value:"FizPl",label:"Fizika Plazmy (FizPl)"},{value:"ISPAr",label:"ISPRS - International Archives of the Photogrammetry, Remote Sensing and Spatial Information Sciences (ISPAr)"},{value:"AcO",label:"Acta Oecologica (AcO)"},{value:"JESS",label:"Journal of Earth System Science (JESS)"},{value:"JTurb",label:"Journal of Turbulence (JTurb)"},{value:"APLM",label:"APL Materials (APLM)"},{value:"IJTIA",label:"IEEJ Transactions on Industry Applications (IJTIA)"},{value:"JMAA",label:"Journal of Mathematical Analysis and Applications (JMAA)"},{value:"JNOPM",label:"Journal of Nonlinear Optical Physics and Materials (JNOPM)"},{value:"JNET",label:"Journal of Non Equilibrium Thermodynamics (JNET)"},{value:"SScEd",label:"Studies in Science Education (SScEd)"},{value:"MRE",label:"Materials Research Express (MRE)"},{value:"TDM",label:"2D Materials (TDM)"},{value:"ComPh",label:"Computers in Physics (ComPh)"},{value:"IEITE",label:"IEICE Transactions on Electronics (IEITE)"},{value:"JApSc",label:"Journal of Applied Sciences (JApSc)"},{value:"M&PSA",label:"Meteoritics and Planetary Science Supplement (M&PSA)"},{value:"PFR",label:"Plasma and Fusion Research (PFR)"},{value:"RaEl",label:"Radiotekhnika i Elektronika (RaEl)"},{value:"AcASn",label:"Acta Astronomica Sinica (AcASn)"},{value:"ChJAA",label:"Chinese Journal of Astronomy and Astrophysics (ChJAA)"},{value:"TTSP",label:"Transport Theory and Statistical Physics (TTSP)"},{value:"JSemi",label:"Journal of Semiconductors (JSemi)"},{value:"RSPS",label:"Proceedings of the Royal Society of London Series I (RSPS)"},{value:"XRS",label:"X-ray Spectrometry (XRS)"},{value:"CEJPh",label:"Central European Journal of Physics (CEJPh)"},{value:"AtScL",label:"Atmospheric Science Letters (AtScL)"},{value:"JPhy4",label:"Journal de Physique IV (JPhy4)"},{value:"KosIs",label:"Kosmicheskie Issledovaniia (KosIs)"},{value:"BRASP",label:"Bulletin of the Russian Academy of Sciences, Physics (BRASP)"},{value:"PolRe",label:"National Institute Polar Research Memoirs (PolRe)"},{value:"JNIS",label:"Journal of Near Infrared Spectroscopy (JNIS)"},{value:"PMM",label:"Physics of Metals and Metallography (PMM)"},{value:"PDU",label:"Physics of the Dark Universe (PDU)"},{value:"SvApM",label:"Soviet Applied Mechanics (SvApM)"},{value:"CRMec",label:"Comptes Rendus Mecanique (CRMec)"},{value:"MNSSA",label:"Monthly Notes of the Astronomical Society of South Africa (MNSSA)"},{value:"OrLi",label:"Origins of Life (OrLi)"},{value:"ScChA",label:"Science in China A: Mathematics (ScChA)"},{value:"PRPER",label:"Physical Review Physics Education Research (PRPER)"},{value:"IEITC",label:"IEICE Transactions on Communications (IEITC)"},{value:"JVSJ",label:"Journal of the Vacuum Society of Japan (JVSJ)"},{value:"EurSS",label:"Eurasian Soil Science (EurSS)"},{value:"IPhoJ",label:"IEEE Photonics Journal (IPhoJ)"},{value:"PhNan",label:"Photonics and Nanostructures (PhNan)"},{value:"ITTST",label:"IEEE Transactions on Terahertz Science and Technology (ITTST)"},{value:"ChJOL",label:"Chinese Journal of Oceanology and Limnology (ChJOL)"},{value:"CRASB",label:"Academie des Sciences Paris Comptes Rendus Serie B Sciences Physiques (CRASB)"},{value:"JFuE",label:"Journal of Funsion Energy (JFuE)"},{value:"DSROA",label:"Deep Sea Research and Oceanographic Abstracts (DSROA)"},{value:"RadEf",label:"Radiation Effects (RadEf)"},{value:"JSTEd",label:"Journal of Science Teacher Education (JSTEd)"},{value:"M&P",label:"Moon and Planets (M&P)"},{value:"JRPC",label:"Journal of Reinforced Plastics and Composites (JRPC)"},{value:"STMP",label:"Springer Tracts in Modern Physics (STMP)"},{value:"AntSc",label:"Antarctic Science (AntSc)"},{value:"RvPP",label:"Reviews of Plasma Physics (RvPP)"},{value:"JAVSO",label:"Journal of the American Association of Variable Star Observers (JAAVSO) (JAVSO)"},{value:"JBIS",label:"Journal of the British Interplanetary Society (JBIS)"},{value:"ASSP",label:"Astrophysics and Space Science Proceedings (ASSP)"},{value:"QJMat",label:"The Quarterly Journal of Mathematics (QJMat)"},{value:"MitAG",label:"Mitteilungen der Astronomischen Gesellschaft Hamburg (MitAG)"},{value:"PhyOJ",label:"Physics Online Journal (PhyOJ)"},{value:"JKAS",label:"Journal of Korean Astronomical Society (JKAS)"},{value:"JNMP",label:"Journal of Nonlinear Mathematical Physics (JNMP)"},{value:"IJHMT",label:"International Journal of Heat and Mass Transfer (IJHMT)"},{value:"GeoPA",label:"Geofisica Pura e Applicata (GeoPA)"},{value:"TeMAE",label:"Terrestrial Magnetism and Atmospheric Electricity (Journal of Geophysical Research) (TeMAE)"},{value:"ITEnC",label:"IEEE Transactions on Energy Conversion (ITEnC)"},{value:"BGeod",label:"Bulletin Geodesique (BGeod)"},{value:"PhRvI",label:"Physical Review Series I (PhRvI)"},{value:"JAChS",label:"Journal of the American Chemical Society (JAChS)"},{value:"ESSD",label:"Earth System Science Data (ESSD)"},{value:"IEITF",label:"IEICE Transactions on Fundamentals of Electronics Communications and Computer Sciences (IEITF)"},{value:"PApOp",label:"Pure Applied Optics (PApOp)"},{value:"TrGeo",label:"Treatise on Geochemistry (TrGeo)"},{value:"CTM",label:"Combustion Theory and Modelling (CTM)"},{value:"Lsphe",label:"Lithoshere (Lsphe)"},{value:"ChA&A",label:"Chinese Astronomy and Astrophysics (ChA&A)"},{value:"JDDE",label:"Journal of Dynamics and Differential Equations (JDDE)"},{value:"A&AT",label:"Astronomical and Astrophysical Transactions (A&AT)"},{value:"JSEdT",label:"Journal of Science Education and Technology (JSEdT)"},{value:"LIACo",label:"Liege International Astrophysical Colloquia (LIACo)"},{value:"PPN",label:"Physics of Particles and Nuclei (PPN)"},{value:"JARS",label:"Journal of Applied Remote Sensing (JARS)"},{value:"AnMat",label:"Annals of Mathematics (AnMat)"},{value:"SoEnM",label:"Solar Energy Materials (SoEnM)"},{value:"AcPPA",label:"Acta Physica Polonica A (AcPPA)"},{value:"CoAst",label:"Communications in Asteroseismology (CoAst)"},{value:"ScChG",label:"Science in China: Physics, Mechanics and Astronomy (ScChG)"},{value:"AcGeo",label:"Acta Geophysica (AcGeo)"},{value:"JNuE",label:"Journal of Nuclear Energy (JNuE)"},{value:"JEPT",label:"Journal of Engineering Physics and Thermophysics (JEPT)"},{value:"IzAOP",label:"Izvestiya Atmospheric and Oceanic Physics (IzAOP)"},{value:"EGSGA",label:"E&amp;G Quaternary Science Journal (EGSGA)"},{value:"ComAp",label:"Comments on Astrophysics (ComAp)"},{value:"ChEG",label:"Chemie der Erde / Geochemistry (ChEG)"},{value:"JLasA",label:"Journal of Laser Applications (JLasA)"},{value:"IJGMM",label:"International Journal of Geometric Methods in Modern Physics (IJGMM)"},{value:"MMI",label:"Metals and Materials International (MMI)"},{value:"IzKry",label:"Izvestiya Ordena Trudovogo Krasnogo Znameni Krymskoj Astrofizicheskoj Observatorii (IzKry)"},{value:"EaInt",label:"Earth Interactions (EaInt)"},{value:"Freq",label:"Frequenz (Freq)"},{value:"LicOB",label:"Lick Observatory Bulletin (LicOB)"},{value:"IJSTA",label:"IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing (IJSTA)"},{value:"PCEA",label:"Physics and Chemistry of the Earth A (PCEA)"},{value:"CoSka",label:"Contributions of the Astronomical Observatory Skalnate Pleso (CoSka)"},{value:"BiBi",label:"Bioinspiration and Biomimetics (BiBi)"},{value:"AeoRe",label:"Aeolian Research (AeoRe)"},{value:"AdAst",label:"Advances in Astronomy (AdAst)"},{value:"DeHyZ",label:"Deutsche Hydrographische Zeitschrift (DeHyZ)"},{value:"SvJPP",label:"Soviet Journal of Plasma Physics (SvJPP)"},{value:"IEITI",label:"IEICE Transactions on Information and Systems (IEITI)"},{value:"FrPhy",label:"Frontiers of Physics (FrPhy)"},{value:"EAS",label:"EAS Publications Series (EAS)"},{value:"Physi",label:"Physics (Physi)"},{value:"ITAC",label:"IEEE Transactions on Automatic Control (ITAC)"},{value:"AnHar",label:"Annals of Harvard College Observatory (AnHar)"},{value:"RCD",label:"Regular and Chaotic Dynamics (RCD)"},{value:"GescJ",label:"Geosciences Journal (GescJ)"},{value:"JMPh",label:"Journal of Modern Physics (JMPh)"},{value:"AuJPA",label:"Australian Journal of Physics Astrophysical Supplement (AuJPA)"},{value:"SSI",label:"Space Science Instrumentation (SSI)"},{value:"JPhys",label:"Journal de Physique (JPhys)"},{value:"SJADS",label:"SIAM Journal on Applied Dynamical Systems (SJADS)"},{value:"PhLRv",label:"Physics of Life Reviews (PhLRv)"},{value:"IJMPS",label:"International Journal of Modern Physics Conference Series (IJMPS)"},{value:"JGeEd",label:"Journal of Geoscience Education (JGeEd)"},{value:"JBR",label:"Journal of Breath Research (JBR)"},{value:"PhuZ",label:"Physik in unserer Zeit (PhuZ)"},{value:"EML",label:"Electronic Materials Letters (EML)"},{value:"KFNT",label:"Kinematika i Fizika Nebesnykh Tel (KFNT)"},{value:"ApL&C",label:"Astrophysical Letters and Communications (ApL&C)"},{value:"IJAsB",label:"International Journal of Astrobiology (IJAsB)"},{value:"HWM",label:"Helgol&auml;nder Wissenschaftliche Meeresuntersuchungen (HWM)"},{value:"AMTD",label:"Atmospheric Measurement Techniques Discussions (AMTD)"},{value:"JRadR",label:"Journal of Radiation Research (JRadR)"},{value:"HEAD",label:"AAS/High Energy Astrophysics Division (HEAD)"},{value:"HMR",label:"Helgoland Marine Research (HMR)"},{value:"ChJPh",label:"Chinese Journal of Physics (ChJPh)"},{value:"IJOE",label:"IEEE Journal of Oceanic Engineering (IJOE)"},{value:"JRP",label:"Journal of Radiological Protection (JRP)"},{value:"JOptT",label:"Journal of Optical Technology (JOptT)"},{value:"PZ",label:"Peremennye Zvezdy (PZ)"},{value:"CMMPh",label:"Computational Mathematics and Mathematical Physics (CMMPh)"},{value:"MCM",label:"Mechanics of Composite Materials (MCM)"},{value:"PPNL",label:"Physics of Particles and Nuclei Letters (PPNL)"},{value:"IrAJ",label:"Irish Astronomical Journal (IrAJ)"},{value:"ARAC",label:"Annual Review of Analytical Chemistry (ARAC)"},{value:"IJCFD",label:"International Journal of Computational Fluid Dynamics (IJCFD)"},{value:"AcSSn",label:"Acta Seismologica Sinica (AcSSn)"},{value:"CoASP",label:"Comments on Astrophysics and Space Physics (CoASP)"},{value:"NewSc",label:"New Scientist (NewSc)"},{value:"IzSSR",label:"Akademiia Nauk SSSR Izvestiia Seriia Fizicheskaia (IzSSR)"},{value:"NuAlg",label:"Numerical Algorithms (NuAlg)"},{value:"ResPh",label:"Results in Physics (ResPh)"},{value:"JIMO",label:"WGN, Journal of the International Meteor Organization (JIMO)"},{value:"FNCN",label:"Fullerene Nanotubes and Carbon Nanostructures (FNCN)"},{value:"JO",label:"Journal des Observateurs (JO)"},{value:"CzJPS",label:"Czechoslovak Journal of Physics Supplement (CzJPS)"},{value:"JGE",label:"Journal of Geophysics and Engineering (JGE)"},{value:"JIEEJ",label:"Journal of The Institute of Electrical Engineers of Japan (JIEEJ)"},{value:"SolE",label:"Solid Earth (SolE)"},{value:"IJDE",label:"International Journal of Digital Earth (IJDE)"},{value:"JIPM",label:"Journal of Information Processing and Management (JIPM)"},{value:"BAAA",label:"Boletin de la Asociacion Argentina de Astronomia La Plata Argentina (BAAA)"},{value:"JHA",label:"Journal for the History of Astronomy (JHA)"},{value:"QuOpt",label:"Quantum Optics (QuOpt)"},{value:"CoLPL",label:"Communications of the Lunar and Planetary Laboratory (CoLPL)"},{value:"IzPSE",label:"Izvestiya Physics of the Solid Earth (IzPSE)"},{value:"cosp",label:"COSPAR Scientific Assembly (cosp)"},{value:"OMExp",label:"Optical Materials Express (OMExp)"},{value:"AstBu",label:"Astrophysical Bulletin (AstBu)"},{value:"SCoA",label:"Smithsonian Contributions to Astrophysics (SCoA)"},{value:"ITGE",label:"IEEE Transactions on Geoscience Electronics (ITGE)"},{value:"GeoSu",label:"Geophysical Surveys (GeoSu)"},{value:"RSTEd",label:"Research in Science and Technological Education (RSTEd)"},{value:"JSMEB",label:"JSME International Journal Series B (JSMEB)"},{value:"PCEB",label:"Physics and Chemistry of the Earth B (PCEB)"},{value:"ASIB",label:"NATO Advanced Science Institutes (ASI) Series B (ASIB)"},{value:"LPRv",label:"Laser & Photonics Review (LPRv)"},{value:"PhyEs",label:"Physics Essays (PhyEs)"},{value:"InEPS",label:"Indian Academy of Sciences Proceedings: Earth and Planetary Sciences (InEPS)"},{value:"ApPRv",label:"Applied Physics Reviews (ApPRv)"},{value:"JAnSc",label:"Journal of the Astronautical Sciences (JAnSc)"},{value:"OptEL",label:"Optoelectronics Letters (OptEL)"},{value:"MPBu",label:"Minor Planet Bulletin (MPBu)"},{value:"AnaCh",label:"Analytical Chemistry (AnaCh)"},{value:"CosEl",label:"Cosmic Electrodynamics (CosEl)"},{value:"RvMA",label:"Reviews in Modern Astronomy (RvMA)"}]}),define("js/widgets/classic_form/widget",["js/widgets/base/base_widget","js/components/api_query","js/components/api_query_updater","hbs!js/widgets/classic_form/form","jquery-ui","js/widgets/paper_search_form/topterms","analytics"],function(e,t,n,i,a,r,s){function o(e){return e.split(/,\s*/)}var l=Marionette.ItemView.extend({template:i,className:"classic-form",events:{"click button[type=submit]":"submitForm","input input":"checkValid","input textarea":"checkValid"},checkValid:function(){this.$("input[type=text], textarea").map(function(){return $(this).val()}).get().join("")?this.$("button[type=submit]").prop("disabled",!1):this.$("button[type=submit]").prop("disabled",!0)},submitForm:function(e){e.preventDefault();var t=this.serializeClassic();t.q.length||t.q.push("*"),this.trigger("submit",t),this.$("button[type=submit]").each(function(){var e=$(this),t=e.html();e.html('<i class="icon-loading"/>  Loading...'),setTimeout(function(){e.html(t)},3e3)})},serializeClassic:function(){var e,t,i,a,r={q:[],fq:[]},s={month_from:"01",year_from:"0000",month_to:"12",year_to:"9999"};if((e=this.$("div[data-field=database] input:checked").map(function(){return $(this).attr("name")})).length>0){var o=1===e.length?e[0]:"(astronomy or physics)";r.fq.push("database: "+o),r.fq.push("{!type=aqp v=$fq_database}"),r.fq_database="database: "+o}var l=this.$("div[data-field=property] input:checked").map(function(){return $(this).attr("name")});if(l.length>0){var c=1===l.length?l[0]:"(refereed or notrefereed)";r.fq.push("property: "+c),r.fq.push("{!type=aqp v=$fq_property}"),r.fq_property="property: "+c}return this.$("div[data-field=date] input").map(function(){return $(this).val()}).get().join("")&&(i="["+(t=this.$("div[data-field=date] input").map(function(){var e=$(this);return e.val()||s[e.attr("name")]}))[1]+"-"+t[0]+" TO "+t[3]+"-"+t[2]+"]",r.q.push("pubdate:"+i)),a={default:/=?"[^"]+"|[=\w]+/g,author:/.+/gm,object:/.+/gm,bibstem:/[^,^\s]+/g},this.$("div[data-textInput=true]").each(function(){var e,t,i,s,o=$(this),l=o.find("input[type=text], textarea").val();if(""!==l)if(e=o.find(".logic-group input:checked").val(),t=o.data("field"),"BOOLEAN"===e){var c=new n(" "),u=l.split(/(?:\n)/);l=(u=$.map(u,$.trim)).reduce(function(e,t){return e+(t=/[+\-]/.test(t[0])?t[0]+c.quoteIfNecessary(t.slice(1))+" ":"+"+c.quoteIfNecessary(t)+" ")},""),r.q.push(t+":("+l.trim()+")")}else e=" "+e+" ",i=a[t]?a[t]:a.default,s=l.match(i),s=_.filter(s,function(e){return!/^(and|or)$/i.test(e)}),s="author"==t||"object"==t?_.map(s,function(e){return/^[=\-+]/.test(e)?e.replace(/^([=\-+])(.*)/,'$1"$2"'):e.replace(/^(.*)$/,'"$1"')}):s,"bibstem"===t?(r.fq.push("{!type=aqp v=$fq_bibstem_facet}"),r.fq_bibstem_facet="("+_.map(s,function(e){return'bibstem_facet:"'+e+'"'}).join(e)+")"):(s=s.length>1?s.join(e):s[0],r.q.push(t+":("+s+")"))}),r},onRender:function(e){var t=function(e){return _.last(e.split(/(,\s|;\s|[,;])/))};this.$("input[name=bibstem]").autocomplete({minLength:1,autoFocus:!0,source:function(e,n){return n($.map(r,function(n){if(_.isString(e.term)){var i=t(e.term).toUpperCase(),a=n.value.toUpperCase(),r=n.label.toUpperCase();if(0===a.indexOf(i)||0===r.indexOf(i)||0===r.replace(/^THE\s/,"").indexOf(i))return n}}))},focus:function(){return!1},select:function(e,t){var n=o(this.value);return n.pop(),n.push(t.item.value),n.push(""),this.value=n.join(", "),!1}}).data("ui-autocomplete")._renderItem=function(e,n){var i=t(this.term).toUpperCase().trim(),a=new RegExp("("+i+")","i"),r=n.label;i.length>0&&(r=r.replace(a,'<span class="ui-state-highlight">$1</span>'));var s=$("<li/>").appendTo(e);return $("<a/>").attr("href","#").html(r).appendTo(s),s}}});return e.extend({initialize:function(e){e=e||{},this.view=new l,this.listenTo(this.view,"submit",this.submitForm)},activate:function(e){this.setBeeHive(e)},onShow:function(){this.view.$("button[type=submit]").each(function(){$(this).html('<i class="fa fa-search"></i> Search')}),this.view.$("#classic-author").focus()},submitForm:function(e){var n=_.assign(e,{q:e.q.join(" "),sort:"date desc"});n=new t(n),this.getPubSub().publish(this.getPubSub().START_SEARCH,n),s("send","event","interaction","classic-form-submit",JSON.stringify(e))},dontKillMe:!0})}),define("hbs!js/widgets/search_bar/templates/search_bar_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a,r;return" "+(null!=(a=t.if.call(e,null!=e?e.libraryName:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+'            <input type="text" class="form-control q hasbigquery" name="q" autofocus aria-label="Start typing a query here to begin an ADS Search" autocomplete="off" value='+this.escapeExpression("function"==typeof(r=null!=(r=t.currentQueryVal||(null!=e?e.currentQueryVal:e))?r:t.helperMissing)?r.call(e,{name:"currentQueryVal",hash:{},data:i}):r)+'>\n            <i class="icon-clear s-clear-control"></i> '},2:function(e,t,n,i){var a;return'\n            <div class="btn btn-xs btn-info bigquery-tag"><i class="fa fa-book" />&nbsp;<span>'+this.escapeExpression("function"==typeof(a=null!=(a=t.libraryName||(null!=e?e.libraryName:e))?a:t.helperMissing)?a.call(e,{name:"libraryName",hash:{},data:i}):a)+'</span>&nbsp;<i class="fa fa-close fa-lg bigquery-close" title="click to remove" /></div>\n'},4:function(e,t,n,i){return'            <div class="btn btn-xs btn-info bigquery-tag"><i class="fa fa-list-ul" />&nbsp;&nbsp;Bulk query&nbsp;&nbsp;<i class="fa fa-close fa-lg bigquery-close" title="click to remove" /></div>\n'},6:function(e,t,n,i){var a;return'\n            <input type="text" class="form-control q" name="q" autofocus aria-label="Start typing a query here to begin an ADS Search" autocomplete="off" value='+this.escapeExpression("function"==typeof(a=null!=(a=t.currentQueryVal||(null!=e?e.currentQueryVal:e))?a:t.helperMissing)?a.call(e,{name:"currentQueryVal",hash:{},data:i}):a)+'>\n            <i class="icon-clear s-clear-control"></i> '},8:function(e,t,n,i){var a,r;return'    <div class="s-num-found">\n      <span class="s-light-font description">Your search returned</span>\n        <b><span class="num-found-container">'+this.escapeExpression("function"==typeof(r=null!=(r=t.numFound||(null!=e?e.numFound:e))?r:t.helperMissing)?r.call(e,{name:"numFound",hash:{},data:i}):r)+'</span></b>\n        <span class="s-light-font"> results</span>\n'+(null!=(a=t.if.call(e,null!=e?e.citationCount:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+"    </div>\n"},9:function(e,t,n,i){var a;return'        <span class="search-bar__citation-count"> with <b><span class="citation-count-container">'+this.escapeExpression("function"==typeof(a=null!=(a=t.citationCount||(null!=e?e.citationCount:e))?a:t.helperMissing)?a.call(e,{name:"citationCount",hash:{},data:i}):a)+'</span></b>\n          <span class="s-light-font description">total '+this.escapeExpression("function"==typeof(a=null!=(a=t.citationLabel||(null!=e?e.citationLabel:e))?a:t.helperMissing)?a.call(e,{name:"citationLabel",hash:{},data:i}):a)+"</span>\n        </span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div role="search">\n  <div class="row">\n    <h2 class="sr-only">Search Bar to Enter New Query</h2>\n    <div class="col-sm-12 s-quick-add" aria-label="quick add fields">\n      <div id="expanded-search-form" class="unselectable">\n        <div id="field-options">\n          <span class="s-field-options">quick field:</span>\n\n          <span class="visible-sm-inline visible-md-inline visible-lg-inline">\n            <button class="btn btn-link btn-sm" title=\'search for an author, e.g. author:"Kurtz,M"\' data-toggle="tooltip" data-field="author" data-punc=\'"\'>Author</button>\n            <button class="btn btn-link btn-sm" title=\'search for a first author, e.g. author:"^Kurtz,M"\' data-toggle="tooltip" data-field="first-author" data-punc=\'"\'>First Author</button>\n            <button class="btn btn-link btn-sm" title="limit search to abstract, title and keyword fields" data-toggle="tooltip" data-field="abs" data-punc=\'"\'>Abstract</button>\n          </span>\n\n          <span class="visible-lg-inline">\n            <button class="btn btn-link btn-sm" title="e.g. year:1999 or year:1999-2016" data-toggle="tooltip" data-field="year">Year</button>\n            <button class="btn btn-link btn-sm" title="search titles, abstract, text, keywords and acknowledgements of the articles" data-toggle="tooltip" data-field="full" data-punc=\'"\'>Fulltext</button>\n          </span>\n\n          \x3c!--container for additional fields/operators--\x3e\n          <span id="option-dropdown-container"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row"></div>\n  <div class="row">\n    <div class="col-sm-12 search-bar-input-row s-search-bar-input-row">\n      <form name="main-query">\n        <div class="form-group has-feedback">\n          <div class="input-group">\n            '+(null!=(a=t.if.call(e,null!=e?e.bigquery:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(6,i,0),data:i}))?a:"")+'\n            <span class="input-group-btn">\n                       <button type="submit" class="btn btn-primary search-submit s-search-submit" aria-label="submit">\n                           <i class="fa fa-search"></i></button>\n                  </span>\n\n          </div>\n          \x3c!-- /input-group --\x3e\n        </div>\n        \x3c!-- /form-group--\x3e\n      </form>\n    </div>\n  </div>\n</div>\n<div class="row">\n  <div class="only-show-on-landing">\n    <div class="quick-reference">\n      <div class="col-sm-6">\n        <dl class="dl-horizontal">\n          <dt>author</dt>\n          <dd>author:"huchra, john"</dd>\n          <dt>first author</dt>\n          <dd>author:"^huchra, john"</dd>\n          <dt>abstract + title</dt>\n          <dd>abs:"dark energy"</dd>\n          <dt>year</dt>\n          <dd>year:2000</dd>\n          <dt>year range</dt>\n          <dd>year:2000-2005</dd>\n          <dt>full text</dt>\n          <dd>full:"gravitational waves"</dd>\n          <dt>publication</dt>\n          <dd>bibstem:ApJ <i class="icon-help" data-toggle="tooltip" title="this field requires the bibstem, or journal abbreviation--try going to the \'Paper\' tab above for an easy-to-use form version"></i></dd>\n        </dl>\n      </div>\n      <div class="col-sm-6  quick-reference">\n        <dl class="dl-horizontal">\n          <dt>citations</dt>\n          <dd>citations(author:"huchra, j") <i class="icon-help" data-toggle="tooltip" title="finds all papers that cite a given set of papers"></i></dd>\n          <dt>references</dt>\n          <dd>references(author:"huchra, j") <i class="icon-help" data-toggle="tooltip" title="finds all papers referenced by a given set of papers"></i></dd>\n          <dt>reviews</dt>\n          <dd>reviews("gamma-ray bursts") <i class="icon-help" data-toggle="tooltip" title="finds articles citing the most relevant papers on the topic being researched"></i></dd>\n          <hr/>\n          <dt>refereed</dt>\n          <dd>property:refereed <i class="icon-help" data-toggle="tooltip" title="limit to non-refereed papers by searching property:notrefereed"></i></dd>\n          <dt>astronomy</dt>\n          <dd>database:astronomy <i class="icon-help" data-toggle="tooltip" title="limit to physics papers by searching database:physics"></i></dd>\n          <dt>OR</dt>\n          <dd>abs:(planet OR star) <i class="icon-help" data-toggle="tooltip" title="default logic is AND, e.g. abs:(planet star) would be interpreted as abs:(planet AND star)"></i></dd>\n        </dl>\n      </div>\n    </div>\n\n  </div>\n\n'+(null!=(a=t.unless.call(e,null!=e?e.loading:e,{name:"unless",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/search_bar/templates/search_bar_template",n),n}),define("hbs!js/widgets/search_bar/templates/search_form_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="search-gui"><span style="text-align:right;font-size:small;float:right;">This tool is still experimental.</span>\n</div>\n\n\n\n'},useData:!0});return t.registerPartial("js/widgets/search_bar/templates/search_form_template",n),n}),define("hbs!js/widgets/search_bar/templates/option-dropdown",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<select class="quick-add-dropdown">\n<optgroup label="fields">\n  <option value="author" data-field="author">author</option>\n  <option value="first-author" data-field="first-author">first author</option>\n  <option value="abs" data-field="abs">abstract</option>\n  <option value="year" data-field="year">year</option>\n  <option value="full" data-field="full">fulltext</option>\n  <option value="aff">affiliation</option>\n  <option value="abstract">abstract only</option>\n  <option value="arxiv_class">arXiv category</option>\n  <option value="bibcode">bibcode</option>\n  <option value="bibgroup">bibliographic group</option>\n  <option value="bibstem">bib abbrev, e.g. ApJ</option>\n  <option value="body">body of article</option>\n  <option value="data">data archive</option>\n  <option value="database">database</option>\n  <option value="doctype">doctype</option>\n  <option value="doi">doi</option>\n  <option value="identifier">identifier</option>\n  <option value="keyword">keyword</option>\n  <option value="orcid">orcid</option>\n  <option value="page">page</option>\n  <option value="property">property</option>\n  <option value="pub">publication full name</option>\n  <option value="pubdate" data-default-value="[2000-01-01 TO 2010-01-01]">date published</option>\n  <option value="title">title</option>\n  <option value="volume">volume</option>\n</optgroup>\n<optgroup label="operators">\n  <option value="citations">citations()</option>\n  <option value="references">references()</option>\n  <option value="reviews">reviews()</option>\n  <option value="topn">topn()</option>\n  <option value="trending">trending()</option>\n  <option value="useful">useful()</option>\n</optgroup>\n<optgroup label="special characters">\n  <option value="?">single wildcard: ?</option>\n  <option value="*">wildcard: *</option>\n  <option value="=">exact match: =</option>\n</optgroup>\n</select>\n'},useData:!0});return t.registerPartial("js/widgets/search_bar/templates/option-dropdown",n),n}),function(e){define("jquery-querybuilder",["jquery"],function(){return function(){!function(e){"use strict";var t=["string","integer","double","date","time","datetime"],n=["text","radio","checkbox","select"],i=function(t,n){var a=this;"extend"in n&&(e.extend(this,n.extend),delete n.extend),this.$el=t,this.settings=e.extend(!0,{},i.DEFAULTS,n),this.filters=this.settings.filters,this.lang=this.settings.lang,this.operators=this.settings.operators,this.template=this.settings.template,this.status={group_id:0,rule_id:0,generatedId:!1},null===this.template.group&&(this.template.group=this.getGroupTemplate),null===this.template.rule&&(this.template.rule=this.getRuleTemplate),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generatedId=!0),this.$el_id=this.$el.attr("id"),(!this.filters||this.filters.length<1)&&e.error("Missing filters list"),this.checkFilters(),this.$el.on("change.queryBuilder",".rules-group-header input[name$=_cond]",function(){var t=e(this);t.is(":checked")&&(t.parent().addClass("active"),t.parent().siblings().removeClass("active"))}),this.$el.on("change.queryBuilder",".rule-filter-container select[name$=_filter]",function(){var t=e(this),n=t.closest(".rule-container");a.createRuleOperators(n,t.val()),a.createRuleInput(n,t.val())}),this.$el.on("change.queryBuilder",".rule-operator-container select[name$=_operator]",function(){var t=e(this),n=t.closest(".rule-container");a.updateRuleOperator(n,t.val())}),this.$el.on("click.queryBuilder","[data-add=rule]",function(){var t=e(this).closest(".rules-group-container").find(">.rules-group-body>.rules-list");a.addRule(t)}),this.$el.on("click.queryBuilder","[data-add=group]",function(){var t=e(this).closest(".rules-group-container").find(">.rules-group-body>.rules-list");a.addGroup(t)}),this.$el.on("click.queryBuilder","[data-delete=rule]",function(){e(this).closest(".rule-container").remove()}),this.$el.on("click.queryBuilder","[data-delete=group]",function(){var t=e(this),n=t.closest(".rules-group-container");t[0].id!=a.$el_id+"_group_0"&&n.remove()}),this.settings.sortable&&this.initSortable(),this.$el.addClass("query-builder"),this.addGroup(this.$el)};i.DEFAULTS={onValidationError:null,onAfterAddGroup:null,onAfterAddRule:null,conditions:["AND","OR"],default_condition:"AND",sortable:!1,filters:[],template:{group:null,rule:null},lang:{add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",and_condition:"AND",or_condition:"OR",filter_select_placeholder:"------",operator_equal:"equal",operator_not_equal:"not equal",operator_in:"in",operator_not_in:"not in",operator_less:"less",operator_less_or_equal:"less or equal",operator_greater:"greater",operator_greater_or_equal:"greater or equal",operator_begins_with:"begins with",operator_not_begins_with:"doesn't begin with",operator_contains:"contains",operator_not_contains:"doesn't contain",operator_ends_with:"ends with",operator_not_ends_with:"doesn't end with",operator_is_empty:"is empty",operator_is_not_empty:"is not empty",operator_is_null:"is null",operator_is_not_null:"is not null"},operators:[{type:"equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"in",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_in",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less",accept_values:!0,apply_to:["number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"greater",accept_values:!0,apply_to:["number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"begins_with",accept_values:!0,apply_to:["string"]},{type:"not_begins_with",accept_values:!0,apply_to:["string"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"not_contains",accept_values:!0,apply_to:["string"]},{type:"ends_with",accept_values:!0,apply_to:["string"]},{type:"not_ends_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!1,apply_to:["string"]},{type:"is_not_empty",accept_values:!1,apply_to:["string"]},{type:"is_null",accept_values:!1,apply_to:["string","number","datetime"]},{type:"is_not_null",accept_values:!1,apply_to:["string","number","datetime"]}]},i.prototype.destroy=function(){this.status.generatedId&&this.$el.removeAttr("id"),this.$el.empty().off("click.queryBuilder change.queryBuilder").removeClass("query-builder").removeData("queryBuilder")},i.prototype.reset=function(){this.status.group_id=1,this.status.rule_id=0,this.addRule(this.$el.find(">.rules-group-container>.rules-group-body>.rules-list").empty())},i.prototype.clear=function(){this.status.group_id=0,this.status.rule_id=0,this.$el.empty()},i.prototype.getRules=function(){this.markRuleAsError(this.$el.find(".rule-container"),!1);var t=this;return function n(i){var a={},r=i.find(">.rules-group-body>.rules-list>*");a.condition=i.find(">.rules-group-header input[name$=_cond]:checked").val(),a.rules=[];for(var s=0,o=r.length;s<o;s++){var l,c=r.eq(s);if(c.hasClass("rule-container")){var u=t.getRuleFilter(c);if("-1"==u)continue;var d=t.getFilterById(u),h=t.getOperatorByType(t.getRuleOperator(c)),p=null;if(h.accept_values){p=t.getRuleValue(c,d),d.valueParser&&(p=d.valueParser.call(this,c,p,d,h));var f=t.validateValue(p,d);if(!0!==f)return t.markRuleAsError(c,!0),t.triggerValidationError(f,c,p,d,h),{}}l={id:d.id,field:d.field,type:d.type,input:d.input,operator:h.type,value:p},a.rules.push(l)}else{if(l=n(c),e.isEmptyObject(l))return{};a.rules.push(l)}}return 0===a.rules.length?{}:a}(this.$el.find(">.rules-group-container"))},i.prototype.setRules=function(t){this.clear();var n=this;!function t(i,a){var r=n.addGroup(a,!1),s=r.find(">.rules-group-body>.rules-list"),o=r.find(">.rules-group-header input[name$=_cond]");if(!i.rules)throw new Error("Missing data.rules element");i.condition||(i.condition=n.settings.default_condition);for(var l,c=n.settings.conditions.length,u=0;u<c;u++)l=n.settings.conditions[u],o.filter("[value="+l+"]").prop("checked",i.condition.toUpperCase()==l);o.trigger("change"),e.each(i.rules,function(i,a){if(a.rules&&a.rules.length>0)t(a,s);else{a.id||e.error("Missing rule field id"),a.value||(a.value=""),a.operator||(a.operator="equal");var r=n.addRule(s),o=n.getFilterById(a.id),l=n.getOperatorByType(a.operator),c=r.find(".rule-value-container");r.find(".rule-filter-container select[name$=_filter]").val(a.id).trigger("change");var u=r.find(".rule-operator-container select[name$=_operator]");if(0==u.children('option[value="'+a.operator+'"]').length){if(!o.createOperatorIfNecessary)throw"Unknown operator: "+a.operator;u.append(e('<option value="'+a.operator+'">'+(n.lang["operator_"+a.operator]||a.operator)+"</option>"))}if(u.val(a.operator).trigger("change"),l.accept_values)switch(o.input){case"radio":c.find('input[name$=_value][value="'+a.value+'"]').prop("checked",!0).trigger("change");break;case"checkbox":e.isArray(a.value)||(a.value=[a.value]),e.each(a.value,function(e,t){c.find('input[name$=_value][value="'+t+'"]').prop("checked",!0).trigger("change")});break;case"select":c.find("select[name$=_value]").val(a.value).trigger("change");break;case"text":default:c.find("input[name$=_value]").val(a.value).trigger("change")}o.onAfterSetValue&&o.onAfterSetValue.call(this,r,a.value,o,l)}})}(t,this.$el)},i.prototype.checkFilters=function(){var i=[];e.each(this.filters,function(a,r){switch(r.id||e.error("Missing filter id: "+a),-1!=i.indexOf(r.id)&&e.error("Filter already defined: "+r.id),i.push(r.id),r.type||e.error("Missing filter type: "+r.id),-1==t.indexOf(r.type)&&e.error("Invalid type: "+r.type),r.input?"function"!=typeof r.input&&-1==n.indexOf(r.input)&&e.error("Invalid input: "+r.input):r.input="text",r.field||(r.field=r.id),r.label||(r.label=r.field),r.type){case"string":r.internalType="string";break;case"integer":case"double":r.internalType="number";break;case"date":case"time":case"datetime":r.internalType="datetime"}switch(r.input){case"radio":case"checkbox":(!r.values||r.values.length<1)&&e.error("Missing values for filter: "+r.id)}})},i.prototype.addGroup=function(t,n){var i=this.nextGroupId(),a=e(this.template.group.call(this,i));return t.append(a),this.settings.onAfterAddGroup&&this.settings.onAfterAddGroup.call(this,a),void 0!==n&&!0!==n||this.addRule(a.find(">.rules-group-body>.rules-list")),a},i.prototype.addRule=function(t){var n=this.nextRuleId(),i=e(this.template.rule.call(this,n)),a=e(this.getRuleFilterSelect(n));return t.append(i),i.find(".rule-filter-container").append(a),this.settings.onAfterAddRule&&this.settings.onAfterAddRule.call(this,i),i},i.prototype.createRuleOperators=function(t,n){var i=t.find(".rule-operator-container").empty();if("-1"!=n){var a=this.getOperators(n),r=e(this.getRuleOperatorSelect(t.attr("id"),a));i.html(r)}},i.prototype.createRuleInput=function(t,n){var i=t.find(".rule-value-container").empty();if("-1"!=n&&this.getOperatorByType(this.getRuleOperator(t)).accept_values){var a=this.getFilterById(n),r=e(this.getRuleInput(t.attr("id"),a));i.append(r).show(),a.onAfterCreateRuleInput&&a.onAfterCreateRuleInput.call(this,t,a),a.plugin&&r[a.plugin](a.plugin_config||{})}},i.prototype.updateRuleOperator=function(e,t){var n=e.find(".rule-value-container"),i=this.getFilterById(this.getRuleFilter(e)),a=this.getOperatorByType(t);a.accept_values?(n.show(),n.is(":empty")&&this.createRuleInput(e,i.id)):n.hide(),i.onAfterChangeOperator&&i.onAfterChangeOperator.call(this,e,i,a)},i.prototype.validateValue=function(e,t){var n=t.validation||{};if(n.callback)return n.callback.call(this,e,t);switch(t.input){case"radio":if(void 0===e)return"radio_empty";break;case"checkbox":if(0===e.length)return"checkbox_empty";break;case"select":if(t.multiple){if(0===e.length)return"select_empty"}else if(void 0===e)return"select_empty";break;case"text":default:switch(t.internalType){case"string":if(void 0!==n.min){if(e.length<n.min)return"string_exceed_min_length"}else if(0===e.length)return"string_empty";if(void 0!==n.max&&e.length>n.max)return"string_exceed_max_length";if(n.format&&!n.format.test(e))return"string_invalid_format";break;case"number":if(isNaN(e))return"number_nan";if("integer"==t.type){if(parseInt(e)!=e)return"number_not_integer"}else if(parseFloat(e)!=e)return"number_not_double";if(void 0!==n.min&&e<n.min)return"number_exceed_min";if(void 0!==n.max&&e>n.max)return"number_exceed_max";if(n.step){var i=e/n.step;if(parseInt(i)!=i)return"number_wrong_step"}break;case"datetime":if(window.moment&&n.format){var a=moment(e,n.format);if(!a.isValid())return"datetime_invalid";if(n.min&&a<moment(n.min,n.format))return"datetime_exceed_min";if(n.max&&a>moment(n.max,n.format))return"datetime_exceed_max"}}}return!0},i.prototype.markRuleAsError=function(e,t){t?e.addClass("has-error"):e.removeClass("has-error")},i.prototype.triggerValidationError=function(e,t,n,i,a){i.onValidationError&&i.onValidationError.call(this,t,e,n,i,a),this.settings.onValidationError&&this.settings.onValidationError.call(this,t,e,n,i,a);var r=jQuery.Event("validationError.queryBuilder",{error:e,filter:i,operator:a,value:n,targetRule:t[0],builder:this});this.$el.trigger(r)},i.prototype.initSortable=function(){e.event.props.push("dataTransfer");var t,n,i=!1;this.$el.on("mousedown",".drag-handle",function(e){i=!0}),this.$el.on("mouseup",".drag-handle",function(e){i=!1}),this.$el.on("dragstart","[draggable]",function(a){a.stopPropagation(),i?(i=!1,a.dataTransfer.setData("text","drag"),n=e(a.target),(t=e('<div class="rule-placeholder">&nbsp;</div>')).css("min-height",n.height()),t.insertAfter(n),setTimeout(function(){n.hide()},0)):a.preventDefault()}),this.$el.on("dragenter","[draggable]",function(n){n.preventDefault(),n.stopPropagation();var i,a=e(n.target);(i=a.closest(".rule-container")).length?t.detach().insertAfter(i):(i=a.closest(".rules-group-container")).length&&t.detach().appendTo(i.find(".rules-list").eq(0))}),this.$el.on("dragover","[draggable]",function(e){e.preventDefault(),e.stopPropagation()}),this.$el.on("drop",function(t){t.preventDefault(),t.stopPropagation();var i,a=e(t.target);(i=a.closest(".rule-container")).length?n.detach().insertAfter(i):(i=a.closest(".rules-group-container")).length&&n.detach().appendTo(i.find(".rules-list").eq(0))}),this.$el.on("dragend","[draggable]",function(e){e.preventDefault(),e.stopPropagation(),n.show(),t.remove()})},i.prototype.nextGroupId=function(){return this.$el_id+"_group_"+this.status.group_id++},i.prototype.nextRuleId=function(){return this.$el_id+"_rule_"+this.status.rule_id++},i.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));var t,n=[];if(e.operators&&e.operators.length>0)for(var i=0,a=e.operators.length;i<a;i++){t=e.operators[i];for(var r=0,s=this.operators.length;r<s;r++)if(this.operators[r].type==t&&this.operators[r].apply_to.indexOf(e.internalType)>-1){n.push({type:t,label:this.lang["operator_"+t]});break}}if(n.length>0)return n;for(i=0,a=this.operators.length;i<a;i++)-1!=this.operators[i].apply_to.indexOf(e.internalType)&&n.push({type:this.operators[i].type,label:this.lang["operator_"+this.operators[i].type]});return e.operators&&n.sort(function(t,n){return e.operators.indexOf(t.type)-e.operators.indexOf(n.type)}),n},i.prototype.getFilterById=function(e){for(var t=0,n=this.filters.length;t<n;t++)if(this.filters[t].id==e)return this.filters[t];throw"Undefined filter: "+e},i.prototype.getOperatorByType=function(e){for(var t=0,n=this.operators.length;t<n;t++)if(this.operators[t].type==e)return this.operators[t];throw"Undefined operator: "+e},i.prototype.getRuleFilter=function(e){return e.find(".rule-filter-container select[name$=_filter]").val()},i.prototype.getRuleOperator=function(e){return e.find(".rule-operator-container select[name$=_operator]").val()},i.prototype.getRuleValue=function(t,n){n=n||this.getFilterByType(this.getRulefilter(t));var i,a=t.find(".rule-value-container");switch(n.input){case"radio":i=a.find("input[name$=_value]:checked").val();break;case"checkbox":i=[],a.find("input[name$=_value]:checked").each(function(){i.push(e(this).val())});break;case"select":n.multiple?(i=[],a.find("select[name$=_value] option:selected").each(function(){i.push(e(this).val())})):i=a.find("select[name$=_value] option:selected").val();break;case"text":default:i=a.find("input[name$=_value]").val()}return i},i.prototype.getGroupTemplate=function(e){for(var t,n=[],i=this.settings.conditions.length,a=0;a<i;a++)t=this.settings.conditions[a],n.push('<label class="btn btn-xs btn-primary '+(this.settings.default_condition==t?"active":"")+'"><input type="radio" name="'+e+'_cond" value="'+t+'"'+(this.settings.default_condition==t?"checked":"")+">"+(this.lang[t.toLowerCase()+"_condition"]||t)+"</label>");return n=n.join("\n"),'<dl id="'+e+'" class="rules-group-container" '+(this.settings.sortable?'draggable="true"':"")+'>   <dt class="rules-group-header">     <div class="btn-group pull-right">       <button type="button" class="btn btn-xs btn-success" data-add="rule"><i class="glyphicon glyphicon-plus"></i> '+this.lang.add_rule+'</button>       <button type="button" class="btn btn-xs btn-success" data-add="group"><i class="glyphicon glyphicon-plus-sign"></i> '+this.lang.add_group+'</button>       <button type="button" class="btn btn-xs btn-danger" data-delete="group"><i class="glyphicon glyphicon-remove"></i> '+this.lang.delete_group+'</button>     </div>     <div class="btn-group">       '+n+"    </div>     "+(this.settings.sortable?'<div class="drag-handle"><i class="glyphicon glyphicon-sort"></i></div>':"")+"   </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>"},i.prototype.getRuleTemplate=function(e){return'<li id="'+e+'" class="rule-container" '+(this.settings.sortable?'draggable="true"':"")+'>   <div class="rule-header">     <div class="btn-group pull-right">       <button type="button" class="btn btn-xs btn-danger" data-delete="rule"><i class="glyphicon glyphicon-remove"></i> '+this.lang.delete_rule+"</button>     </div>   </div>   "+(this.settings.sortable?'<div class="drag-handle"><i class="glyphicon glyphicon-sort"></i></div>':"")+'   <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </li>'},i.prototype.getRuleFilterSelect=function(t){var n='<select name="'+t+'_filter">';return n+='<option value="-1">'+this.lang.filter_select_placeholder+"</option>",e.each(this.filters,function(e,t){n+='<option value="'+t.id+'">'+t.label+"</option>"}),n+="</select>"},i.prototype.getRuleOperatorSelect=function(e,t){for(var n='<select name="'+e+'_operator">',i=0,a=t.length;i<a;i++)n+='<option value="'+t[i].type+'">'+t[i].label+"</option>";return n+="</select>"},i.prototype.getRuleInput=function(t,n){if("function"==typeof n.input){var i=this.$el.find("#"+t);return n.input.call(this,i,n)}var a,r=n.validation||{},s="";switch(n.input){case"radio":a=n.vertical?" class=block":"",e.each(n.values,function(e,n){s+="<label"+a+'><input type="radio" name="'+t+'_value" value="'+e+'"> '+n+"</label> "});break;case"checkbox":a=n.vertical?" class=block":"",e.each(n.values,function(e,n){s+="<label"+a+'><input type="checkbox" name="'+t+'_value" value="'+e+'"> '+n+"</label> "});break;case"select":s+='<select name="'+t+'_value"'+(n.multiple?" multiple":"")+">",n.values&&e.each(n.values,function(e,t){s+='<option value="'+e+'"> '+t+"</option> "}),s+="</select>";break;case"text":default:switch(n.internalType){case"number":s+='<input type="number" name="'+t+'_value"',r.step&&(s+=' step="'+r.step+'"'),r.min&&(s+=' min="'+r.min+'"'),r.max&&(s+=' max="'+r.max+'"'),n.placeholder&&(s+=' placeholder="'+n.placeholder+'"'),s+=">";break;case"datetime":case"text":default:s+='<input type="text" name="'+t+'_value"',n.placeholder&&(s+=' placeholder="'+n.placeholder+'"'),s+=">"}}return s},e.fn.queryBuilder=function(t){this.length>1&&e.error("Unable to initialize multiple instances on the same target");var n=this.data("queryBuilder"),a="object"==typeof t&&t||{};return n||"destroy"!=t?(n||this.data("queryBuilder",new i(this,a)),"string"==typeof t?n[t].apply(n,Array.prototype.slice.call(arguments,1)):this):this},e.fn.queryBuilder.defaults={set:function(t){e.extend(!0,i.DEFAULTS,t)},get:function(t){var n=i.DEFAULTS;return t&&(n=n[t]),e.extend(!0,{},n)}}}(jQuery)}.apply(e,arguments)})}(this),define("js/components/query_builder/rules_translator",["underscore","js/components/generic_module","js/components/api_query_updater"],function(e,t,n){var i=function(e,t){this.operator=e,this.value=t,this.children=[]};i.prototype.addChild=function(e){this.children.push(e)},i.prototype.addChildren=function(t){this.children=e.union(this.children,t)},i.prototype.toString=function(t){if(e.isUndefined(t)&&(t=0),this.value)return this.value;var n=[];e.each(this.children,function(e,i,a){n.push(e.toString(t+1))});var i=this.operator?n.join(" "+this.operator+" "):n.join(" ");return t>0&&(i="("+i+")"),i};var a=function(){this.validOperators={AND:"AND",OR:"OR",DEFOP:"DEFOP"}};return e.extend(a.prototype,{setCondition:function(e){if(this.rules=this.rules||[],e){if(!this.validOperators.hasOwnProperty(e))throw new Error("Unknown operator: "+e);this.condition=this.validOperators[e]}else this.condition=this.validOperators.DEFOP||"AND"},_serializeValue:function(){if(this.value){var e=this.value;return this.fuzzy&&(e+="~"+this.fuzzy),this.boost&&(e+="^"+this.boost),e}},_modifyOperator:function(e){return this.modifier&&("-"==this.modifier?e.operator+="_not":"="==this.modifier&&(e.operator+="_exactly")),e},toJSON:function(){var t=e.clone(e.pick(this,["condition","id","field","type","input","operator"])),n=this._serializeValue();return n&&(t.value=n),this._modifyOperator(t),this.rules&&(t.rules=[],e.each(this.rules,function(e){t.rules.push(e.toJSON())})),t},setValue:function(e,t){this.value=e,this.type=t||"string"},setOffset:function(e){this.offset=e},setType:function(e){this.type=e},setEnd:function(e){this.end=e},getField:function(){return this.field},setField:function(e){this.field=e,this.id=e},setModifier:function(e){this.modifier=e},getModifier:function(){return this.modifier},setFuzzy:function(e){this.fuzzy=e.replace("~","")},setBoost:function(e){this.boost=e.replace("^","")},setOperator:function(e){this.operator=e},addChild:function(e){this.rules=this.rules||[],this.rules.push(e)}}),t.extend({initialize:function(e){this.apiQueryUpdater=new n("rulesTranslator"),this.validFunctions={"topn()":!0,"citations()":!0,"references()":!0,"instructive()":!0,"trending()":!0}},convertQTreeToRules:function(e){if(!e)throw new Error("Empty qtree");this._parentize(e);var t=this._extractRules(e);if(!t.rules){var n=new a;n.addChild(t),t=n}return t.toJSON()},_parentize:function(t,n){var i=this;t.parent=n,e.each(t.children,function(e){i._parentize(e,t)})},_extractRules:function(e){var t=new a;return this._extractRule(e,t),t},_extractRule:function(t,n){var i=this;switch(t.name){case"OPERATOR":if(1==t.children.length){this._extractRule(t.children[0],n);break}n.setCondition(t.label),e.each(t.children,function(e){var t=new a;this._extractRule(e,t),n.addChild(t)},this);break;case"CLAUSE":for(var r=t;r.children&&1==r.children.length&&"OPERATOR"==r.children[0].name;)r=r.children[0];if(r!==t){n.setCondition(r.label),e.each(r.children,function(e){var t=new a;this._extractRule(e,t),n.addChild(t)},this);break}e.each(r.children,function(e){this._extractRule(e,n)},this);break;case"FIELD":if(2==t.children.length)if("CLAUSE"==t.children[1].name){var s=t.children[0].input,o=[];e.each(t.children[1].children,function(e){var t=new a;this._extractRule(e,t),o.push(this.buildQuery(t))},this);var l=new a;l.setField(s),l.setValue(o.join(" ")),l.setOperator("contains"),n.addChild(l)}else n.setField(t.children[0].input),this._extractRule(t.children[t.children.length-1],n);else n.setField("__all__"),this._extractRule(t.children[t.children.length-1],n);break;case"MODIFIER":2==t.children.length&&n.setModifier(t.children[0].name),this._extractRule(t.children[t.children.length-1],n);break;case"TMODIFIER":e.each(t.children,function(e){i._extractRule(e,n)});break;case"BOOST":t.children.length>0&&n.setBoost(t.children[0].label);break;case"FUZZY":t.children.length>0&&n.setFuzzy(t.children[0].label);break;case"QNORMAL":n.setValue(t.children[0].input),n.setOffset(t.children[0].start),n.setEnd(t.children[0].end),n.setOperator("is");break;case"QPHRASE":var c=t.children[0].input;n.setValue(c.substring(1,c.length-1)),n.setOffset(t.children[0].start+1),n.setEnd(t.children[0].end-1),n.setOperator("is_phrase");break;case"QPHRASETRUNC":"*"==(c=t.children[0].input.trim()).substring(c.length-1)?(c=c.substring(0,c.length-1),n.setOperator("starts_with")):n.setOperator("is_wildcard"),n.setValue(c),n.setOffset(t.children[0].start+1),n.setEnd(t.children[0].end-1);break;case"QTRUNCATED":"*"==(c=t.children[0].input.trim()).substring(c.length-1)?(c=c.substring(0,c.length-1),n.setOperator("starts_with")):n.setOperator("is_wildcard"),n.setValue(c),n.setOffset(t.children[0].start),n.setEnd(t.children[0].end);break;case"QRANGEEX":case"QRANGEIN":case"QANYTHING":n.setOperator("is_not_empty");break;case"QDATE":break;case"QPOSITION":if("AUTHOR_SEARCH"==t.children[0].name){c=t.children[0].input.trim();n.setValue(c.replace("^","")),n.setField("^author"),n.setOperator("is")}else e.each(t.children,function(e){this._extractRule(e,n)},this);break;case"QFUNC":var u=t.children[0].input.replace("(","()"),d=this.extractFunctionValues(u,t.children[1]);if(d)n.setValue(d.join("|")),n.setField(u),"MINUS"==n.getModifier()?n.setOperator("is_not_function"):n.setOperator("is_function");else{var h=this._getOriginalQuery(t);if(!h)throw new Error("Eeeek, we can't extract function values - bummmmmmer! Sorry boss");var p=t.children[0].end+1,f=t.children[t.children.length-1].end;if(!p||!f)throw new Error("Eeeek, this is a weird query tree, i don't know how to parse it");n.setValue(t.children[0].input+h.substring(p,f)+")"),n.setField("black_hole"),n.setOperator("is_literal")}break;case"QDELIMITER":break;case"QIDENTIFIER":n.setField(t.children[0].label),n.setValue(t.children[1].input),n.setOffset(t.children[1].start),n.setEnd(t.children[1].end),n.setOperator("is");break;case"QCOORDINATE":case"QREGEX":throw new Error("Not yet ready for: "+JSON.stringify(t));default:console.log("skipping",t)}return n},buildQuery:function(e){if(e.rules){var t=new i(e.condition);if(n=this._buildQueryTree(t,e.rules))return n.toString().split(" DEFOP ").join(" ").split("__all__:").join("")}else{var n;t=new i("DEFOP");if(n=this._buildQueryTree(t,[e]))return n.toString().split(" DEFOP ").join(" ").split("__all__:").join("")}return null},_buildQueryTree:function(t,n){var a=this;return n&&n.length>0&&e.each(n,function(e){if(e.condition){var n=new i(e.condition);t.addChild(n),a._buildQueryTree(n,e.rules)}else if(e.rules)a._buildQueryTree(t,e.rules);else{(n=a._buildOneRule(e))&&t.addChild(n)}}),t},_buildOneRule:function(e){var t,n;if("string"==e.type){var a=this._cleanupFieldValue(e.field,e.value),r=a.value;switch(n=a.field,e.operator){case"is_phrase":case"is_not_phrase":case"contains_phrase":case"contains_not_phrase":t=n+":"+this.apiQueryUpdater.quote(r),e.operator.indexOf("_not")>-1&&(t="-"+t);break;case"is":case"is_not":t=n+":"+this.apiQueryUpdater.quoteIfNecessary(r),e.operator.indexOf("_not")>-1&&(t="-"+t);break;case"contains":case"contains_not":t=n+":"+(r.indexOf(" ")>-1?this.apiQueryUpdater.quoteIfNecessary(r,"(",")"):this.apiQueryUpdater.quoteIfNecessary(r,'"','"')),e.operator.indexOf("_not")>-1&&(t="-"+t);break;case"is_exactly":case"is_not_exactly":t="="+n+":"+this.apiQueryUpdater.quoteIfNecessary(r),e.operator.indexOf("_not_")>-1&&(t="NOT "+t);break;case"is_wildcard":case"is_not_wildcard":case"starts_with":case"starts_not_with":if(r.indexOf("*")>-1||r.indexOf("?")>-1)r=this.apiQueryUpdater.quoteIfNecessary(r);else{var s=this.apiQueryUpdater.quoteIfNecessary(r);s.length!=r.length?r=s.substring(0,s.length-1)+'*"':r+="*"}t=n+":"+r,e.operator.indexOf("_not_")>-1&&(t="-"+t);break;case"regex":t="__all__"==n?"regex(all,"+r+")":"regex("+n+", "+r+")";break;case"is_not_empty":t="__all__"==n?"*:*":n+":?";break;case"is_function":case"is_not_function":switch(n){case"topn()":t="topn("+r.split("|").join(", ")+")";break;default:t=n.replace("()","(")+r.split("|").join(", ")+")"}e.operator.indexOf("_not_")>-1&&(t="-"+t);break;case"is_literal":t=r;break;default:throw new Error("Unknown operator: "+e.operator)}return new i("",t)}throw new Error("Not knowing what to do with: "+JSON.stringify(e))},_cleanupFieldValue:function(e,t){return t=t.trim(),"^"===(e=(e||"__all__").trim()).substring(0,1)&&(t="^"+t,e=e.substring(1,e.length)),{field:e,value:t}},extractFunctionValues:function(t,n){if(!this.validFunctions[t])return null;var i=[];return e.each(n.children,function(e){var t=new a;this._extractRule(e,t),(t.value||t.rules)&&i.push(this.buildQuery(t))},this),i},_getOriginalQuery:function(e){for(var t=e;t.parent;)t=t.parent;return t.originalQuery?t.originalQuery:""},addValidFunctions:function(t){this.validFunctions=e.extend(this.validFunctions,t)},setValidFunctions:function(e){this.validFunctions=e},getValidFunctions:function(){return this.validFunctions}})}),define("hbs!js/components/query_builder/templates/group_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return' draggable="true" '},3:function(e,t,n,i){return'    <div class="drag-handle"><i class="fa fa-sort"></i></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="group-options">\n    <div class="btn-group logic-buttons"  data-toggle="buttons" >\n        '+(null!=(a="function"==typeof(r=null!=(r=t.conditions||(null!=e?e.conditions:e))?r:t.helperMissing)?r.call(e,{name:"conditions",hash:{},data:i}):r)?a:"")+'\n     </div>\n    <button type="button" class="btn btn-xs btn-danger btn-inverse" data-delete="group"><i class="fa fa-times"></i> remove group</button>\n\n</div>\n<dl id="'+this.escapeExpression("function"==typeof(r=null!=(r=t.group_id||(null!=e?e.group_id:e))?r:t.helperMissing)?r.call(e,{name:"group_id",hash:{},data:i}):r)+'" class="rules-group-container" '+(null!=(a=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' >\n<dt class="rules-group-header">\n\n<div>\n    <button type="button" class="btn btn-xs btn-success" data-add="rule"><i class="fa fa-plus"></i>  '+this.escapeExpression("function"==typeof(r=null!=(r=t.addRule||(null!=e?e.addRule:e))?r:t.helperMissing)?r.call(e,{name:"addRule",hash:{},data:i}):r)+'</button>\n    <button type="button" class="btn btn-xs btn-success" data-add="group"><i class="fa fa-plus-circle"></i> '+this.escapeExpression("function"==typeof(r=null!=(r=t.addGroup||(null!=e?e.addGroup:e))?r:t.helperMissing)?r.call(e,{name:"addGroup",hash:{},data:i}):r)+" </button>\n</div>\n"+(null!=(a=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"</dt>\n<dd class=rules-group-body>\n    <ul class=rules-list></ul>\n</dd>\n</dl>"},useData:!0});return t.registerPartial("js/components/query_builder/templates/group_template",n),n}),define("hbs!js/components/query_builder/templates/rule_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return' draggable="true" '},3:function(e,t,n,i){return'            <div class="drag-handle"><i class="fa fa-sort"></i></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<li id="'+this.escapeExpression("function"==typeof(r=null!=(r=t.rule_id||(null!=e?e.rule_id:e))?r:t.helperMissing)?r.call(e,{name:"rule_id",hash:{},data:i}):r)+'" class="rule-container" '+(null!=(a=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' >\n        <div class="rule-header">\n            <div class="btn-group pull-right">\n                <button type="button" class="btn btn-xs btn-danger" data-delete="rule"><i class="fa fa-minus"></i> </button>\n            </div>\n        </div>\n'+(null!=(a=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'\n        <div class="rule-filter-container"></div>\n        <div class="rule-operator-container"></div>\n        <div class="rule-value-container"></div>\n</li>'},useData:!0});return t.registerPartial("js/components/query_builder/templates/rule_template",n),n}),define("js/components/query_builder/plugin",["underscore","bootstrap","jquery","jquery-querybuilder","js/components/generic_module","js/components/query_builder/rules_translator","js/components/api_query","hbs!js/components/query_builder/templates/group_template","hbs!js/components/query_builder/templates/rule_template","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l,c){var u=a.extend({initialize:function(t){if(this._rules=null,this.rulesTranslator=new r,this.rulesTranslator.setValidFunctions({"topn()":!0,"citations()":!0,"references()":!0,"instructive()":!0,"trending()":!0,"pos()":!0}),this.qtreeGetter=t.qtreeGetter||null,this.qtreeGetter&&!this.qtreeGetter.getQTree)throw new Error("qtreeGetter must provide method 'getQTree'");t.el?this.$el=n(t.el):this.$el=n("<div/>"),n.fn.queryBuilder.defaults.set({conditions:["AND","OR"],lang:{defop_condition:"Space",operator_is:"is",operator_is_not:"is not",operator_is_exactly:"is exactly",operator_is_function:"matches",operator_is_not_function:"doesn't match",operator_contains:"has words",operator_contains_not:"excludes words",operator_is_wildcard:"starts with",operator_is_not_wildcard:"doesn't start with",operator_is_phrase:"has phrase",operator_is_wildphrase:"has wildcard",operator_is_not_phrase:"excludes phrase",operator_is_not_empty:"is not empty","operator_pos()":"Limit by Position","operator_citations()":"Get Citations","operator_references()":"Get References","operator_trending()":"Find Trending Papers","operator_instructive()":"Find Instructive Papers",delete_rule:"remove",delete_group:"group",add_rule:"term",add_group:"group"},operators:[{type:"is",accept_values:!0,apply_to:["string","number","datetime"]},{type:"is_not",accept_values:!0,apply_to:["string","number","datetime"]},{type:"is_exactly",accept_values:!0,apply_to:["string","number","datetime"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"contains_not",accept_values:!0,apply_to:["string"]},{type:"is_literal",accept_values:!0,apply_to:["string"]},{type:"is_function",accept_values:!0,apply_to:["string"]},{type:"is_not_function",accept_values:!0,apply_to:["string"]},{type:"is_phrase",accept_values:!0,apply_to:["string"]},{type:"is_wildphrase",accept_values:!0,apply_to:["string"]},{type:"is_not_phrase",accept_values:!0,apply_to:["string"]},{type:"is_wildcard",accept_values:!0,apply_to:["string"]},{type:"is_not_wildcard",accept_values:!0,apply_to:["string"]},{type:"starts_with",accept_values:!0,apply_to:["string"]},{type:"starts_not_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!1,apply_to:["string"]},{type:"is_not_empty",accept_values:!1,apply_to:["string"]},{type:"less",accept_values:!0,apply_to:["number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"greater",accept_values:!0,apply_to:["number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"contains_not",accept_values:!0,apply_to:["string"]},{type:"contains_phrase",accept_values:!0,apply_to:["string"]},{type:"contains_not_phrase",accept_values:!0,apply_to:["string"]},{type:"is_not_empty",accept_values:!1,apply_to:["string"]},{type:"pos()",accept_values:!0,apply_to:["string"]},{type:"citations()",accept_values:!0,apply_to:["string"]},{type:"references()",accept_values:!0,apply_to:["string"]},{type:"trending()",accept_values:!0,apply_to:["string"]},{type:"instructive()",accept_values:!0,apply_to:["string"]}]});var i=["is","is_wildcard","is_exactly","is_not","is_not_wildcard"],a=["contains","is_phrase","contains_not","is_not_phrase","is_wildcard"],s=["is_function","is_not_function"];this.singleTokenOperators=i,this.multiTokenOperators=a,this.functionOperators=s,this.$el.queryBuilder({sortable:!1,filters:[{id:"__all__",label:"Index",type:"string",operators:a,createOperatorIfNecessary:!0,placeholder:"e.g. capillary surfaces"},{id:"author",label:"Author",type:"string",placeholder:"Planck, Max",operators:i,createOperatorIfNecessary:!0},{id:"^author",label:"First Author",type:"string",placeholder:"Einstein, A",operators:i,createOperatorIfNecessary:!0},{id:"title",label:"Title",type:"string",operators:a,createOperatorIfNecessary:!0,placeholder:"e.g. energy survey"},{id:"abstract",label:"Abstract",type:"string",operators:a,createOperatorIfNecessary:!0,placeholder:"e.g. foo bar"},{id:"keyword",label:"Keyword",type:"string",operators:i,createOperatorIfNecessary:!0},{id:"full",label:"Fulltext",type:"string",operators:a,createOperatorIfNecessary:!0},{id:"pos()",label:"position()",type:"string",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"},{id:"start",label:"start",type:"number",placeholder:"start position, e.g. 1"},{id:"end",label:"end",type:"number",placeholder:"end:optional, e.g. 100"}])},onAfterSetValue:function(e,t,n,i){var a=t.split("|");e.find("input[name=query]").val(a[0]),e.find("input[name=start]").val(a[1]),a[2]&&e.find("input[name=end]").val(a[2])}},{id:"citations()",label:"citations()",type:"string",placeholder:"query",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var a=t.split("|");e.find("input[name=query]").val(a[0])}},{id:"references()",label:"references()",type:"string",placeholder:"instructive(title:&quot;monte carlo&quot;)",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var a=t.split("|");e.find("input[name=query]").val(a[0])}},{id:"trending()",label:"trending()",type:"string",placeholder:"(any valid query)",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var a=t.split("|");e.find("input[name=query]").val(a[0])}},{id:"reviews()",label:"reviews()",type:"string",placeholder:"(any valid query)",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var a=t.split("|");e.find("input[name=query]").val(a[0])}},{id:"topn()",label:"topn()",type:"string",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden"},{id:"query",label:"query",type:"text",placeholder:"any valid query"},{id:"number",label:"number",type:"number",placeholder:"how many results, e.g 50"},{id:"sorting",label:"sorting",type:"string",input:"select",values:{"citation_count desc":"Pick first n most cited","citation_count asc":"Pick first n least cited","date desc":"Pick first n newest","date asc":"Pick first n oldest",relevance:"Pick first n most relevant"}}])},onAfterSetValue:function(e,t,n,i){var a=t.split("|");e.find("input[name=number]").val(a[0]),e.find("input[name=query]").val(a[1]),a[2]&&e.find("input[name=sorting]").val(a[3])}},{id:"_version_",label:"Version",type:"string",placeholder:"xxx",operators:i,createOperatorIfNecessary:!0},{id:"ack",label:"Acknowledgements",type:"string",placeholder:"ADS",operators:i,createOperatorIfNecessary:!0},{id:"aff",label:"Affiliation",type:"string",placeholder:"Harvard",operators:i,createOperatorIfNecessary:!0},{id:"alternate_bibcode",label:"Alternate Bibcode",type:"string",placeholder:"e.g. 2015ASPC..492..208G",operators:i,createOperatorIfNecessary:!0},{id:"alternate_title",label:"Alternate Title",type:"string",placeholder:"e.g. freisetzen (de)",operators:i,createOperatorIfNecessary:!0},{id:"arxiv_class",label:"Arxiv category",type:"string",placeholder:"e.g. phys",operators:i,createOperatorIfNecessary:!0},{id:"author_facet",label:"Author Facet",type:"string",placeholder:"e.g. 1/Einstein, A./Einstein, Albert",operators:i,createOperatorIfNecessary:!0},{id:"bibgroup",label:"Bibliographic Group",type:"string",placeholder:"e.g. CFA",operators:i,createOperatorIfNecessary:!0},{id:"body",label:"Body",type:"string",placeholder:"will search in full text (minus title, abstract...)",operators:i,createOperatorIfNecessary:!0},{id:"citation",label:"Citation",type:"string",placeholder:"e.g. 2015SPIE*",operators:i,createOperatorIfNecessary:!0},{id:"citation_count",label:"Citation count",type:"string",placeholder:"e.g. [0 TO 100]",operators:i,createOperatorIfNecessary:!0},{id:"comment",label:"Comment",type:"string",placeholder:"# reserved for librarians",operators:i,createOperatorIfNecessary:!0},{id:"copyright",label:"Copyright",type:"string",placeholder:"e.g. ",operators:i,createOperatorIfNecessary:!0},{id:"data",label:"Data",type:"string",placeholder:"# reserved for librarians",operators:i,createOperatorIfNecessary:!0},{id:"database",label:"Database",type:"string",placeholder:"e.g. physics",operators:i,createOperatorIfNecessary:!0},{id:"date",label:"Date",type:"string",placeholder:"# e.g. 1976-01-02T00:30:00Z",operators:i,createOperatorIfNecessary:!0},{id:"doctype",label:"Document Type",type:"string",placeholder:"e.g. book",operators:i,createOperatorIfNecessary:!0},{id:"doi",label:"DOI",type:"string",placeholder:"e.g. 010.1038/srep04183",operators:i,createOperatorIfNecessary:!0},{id:"eid",label:"Electronic ID",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"email",label:"Email",type:"string",placeholder:"e.g. adsabs@harvard.edu",operators:i,createOperatorIfNecessary:!0},{id:"facility",label:"Facility",type:"string",placeholder:"e.g. CERN",operators:i,createOperatorIfNecessary:!0},{id:"grant",label:"Grant ID",type:"string",placeholder:"e.g. NNX12AG54G",operators:i,createOperatorIfNecessary:!0},{id:"id",label:"ID",type:"string",placeholder:"e.g. 15",operators:i,createOperatorIfNecessary:!0},{id:"identifier",label:"Identifier",type:"string",placeholder:"any bibcode, eid, doi or other ids",operators:i,createOperatorIfNecessary:!0},{id:"indexstamp",label:"Indexstamp",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"isbn",label:"ISBN",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"issn",label:"ISSN",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"issue",label:"Issue",type:"string",placeholder:"1",operators:i,createOperatorIfNecessary:!0},{id:"lang",label:"Language",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"orcid",label:"ORCID",type:"string",placeholder:"0000-0001-8178-9506",operators:i,createOperatorIfNecessary:!0},{id:"page",label:"Page",type:"string",placeholder:"2",operators:i,createOperatorIfNecessary:!0},{id:"property",label:"Property",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"pub",label:"Publication",type:"string",placeholder:"apj",operators:i,createOperatorIfNecessary:!0},{id:"pubdate",label:"Publ. Date",type:"string",placeholder:"2014-08",operators:i,createOperatorIfNecessary:!0},{id:"read_count",label:"Times read",type:"string",placeholder:"[10 TO 20]",operators:i,createOperatorIfNecessary:!0},{id:"reference",label:"Reference",type:"string",placeholder:"e.g. 2015SPIE*",operators:i,createOperatorIfNecessary:!0},{id:"simbid",label:"SIMBAD ID",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"thesis",label:"Thesis",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"vizier",label:"Vizier",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"volume",label:"Volume",type:"string",placeholder:"e.g. v1",operators:i,createOperatorIfNecessary:!0},{id:"year",label:"Year",type:"string",placeholder:"e.g. 2015",operators:i,createOperatorIfNecessary:!0},{id:"black_hole",label:"Literal Input",type:"string",operators:s,createOperatorIfNecessary:!0,placeholder:'e.g. ^"$%^&*"'}],extend:{createFunctionInputs:function(t){var i,a,r;a=n("<span/>"),(r=n(this.getRuleInput(t[0].id,t[0]))).addClass("hide");for(var s=1;s<t.length;s++){var o=this.getRuleInput(t[s].id,t[s]);(i=n(o.replace('_value"','"'))).attr("index",s-1),i.change(function(){var t=r.val();if(e.isString(t)){var i=t.split("|");i[parseInt(n(this).attr("index"))||0]=n(this).val(),r.val(i.join("|"))}}),a.append(i)}return a.append(r),a},getGroupTemplate:function(e){for(var t,n=[],i=this.settings.conditions.length,a=0;a<i;a++)t=this.settings.conditions[a],n.push('<label class="btn btn-xs btn-primary-faded logic-button '+(this.settings.default_condition==t?"active":"")+'"><input type="radio" name="'+e+'_cond" value="'+t+'"'+(this.settings.default_condition==t?"checked":"")+">"+(this.lang[t.toLowerCase()+"_condition"]||t)+"</label>");return n=n.join("\n"),'<dl id="'+e+'" class="rules-group-container" '+(this.settings.sortable?'draggable="true"':"")+'>   <dt class="rules-group-header">     <div class="btn-group">       '+n+'      &nbsp;&nbsp;    </div>     <div class="btn-group">       <button type="button" class="btn btn-xs btn-success" data-add="rule"><i class="fa fa-plus"></i> '+this.lang.add_rule+'</button>       <button type="button" class="btn btn-xs btn-success" data-add="group"><i class="fa fa-plus-square"></i> '+this.lang.add_group+'</button>       <button type="button" class="btn btn-xs btn-danger" data-delete="group"><i class="fa fa-minus"></i> '+this.lang.delete_group+"</button>     </div>     "+(this.settings.sortable?'<div class="drag-handle"><i class="fa fa-sort"></i></div>':"")+"   </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>"},getRuleTemplate:function(e){return l({rule_id:e,sortable:this.settings.sortable,deleteRule:this.lang.delete_rule})}}}),this.$el.on("click.queryBuilder","[data-delete=rule]",function(e){e.stopPropagation()}),this.$el.on("click.queryBuilder","[data-delete=group]",function(e){e.stopPropagation()})},loadCss:function(){var e=require.toUrl("jquery-querybuilder")+".css";if(0==n(document.getElementsByTagName("head")[0]).find("link[href='"+e+"']").length){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}},setRules:function(e){this._rules=e,this.$el.queryBuilder("setRules",e)},getRules:function(){return this.$el.queryBuilder("getRules")},reset:function(){this._rules=null,this.$el.queryBuilder("reset")},getQuery:function(t){return t||(t=this.getRules()),e.isEmpty(t)?"":this.rulesTranslator.buildQuery(t)||""},getRulesFromQTree:function(e){var t=this.rulesTranslator.convertQTreeToRules(e);return this.checkRulesConstraints(t)},updateQueryBuilder:function(e){if(!this.qtreeGetter)throw new Error("You must provide qtreeGetter object for this to work");var t=this;return this.qtreeGetter.getQTree(e).done(function(n){n.originalQuery=e;var i=t.getRulesFromQTree(n);t.setRules(i)})},checkRulesConstraints:function(e){return this._checkRulesConstraints(e),e},_checkRulesConstraints:function(t){t.rules&&e.each(t.rules,function(e){this._checkRulesConstraints(e)},this)},isDirty:function(e){if(!this.$el.data("queryBuilder"))return!1;try{var t=this.getQuery();return!(!e||!t||t==e)||""!=t&&!(!this._rules||this.getQuery(this._rules)==t)}catch(e){console.trace(e)}return!0},setQTreeGetter:function(e){this.qtreeGetter=e},attachHeartBeat:function(t,n){n||(n=100);var i=e.debounce(t,n);this.$el.on("change.queryBuilder",function(e){i()}),this.$el.on("click.queryBuilder",function(e){i()}),this.$el.on("keypress.input",function(e){i()})},destroy:function(){this.$el.off("change.queryBuilder"),this.$el.off("click.queryBuilder"),this.$el.off("keypress.input")}});return u.buildQTreeGetter=function(t){var i=function(e){this.activate(e)};return e.extend(i.prototype,{activate:function(t){this.setBeeHive(t);var n=this.getPubSub();n.subscribe(n.DELIVERING_RESPONSE,e.bind(this.getResponse,this))},getQTree:function(e){return this.promise=n.Deferred(),this.getPubSub().publish(this.getPubSub().GET_QTREE,new s({q:e})),this.promise},getResponse:function(e){if(e.has("qtree")){var t=JSON.parse(e.get("qtree"));this.promise&&t&&this.promise.resolve(t)}}},c.BeeHive),new i(t)},u}),define("js/mixins/formatter",[],function(){var e={formatNum:function(e){var t=[],n=(e+="").split("."),i="";return 2===n.length&&(e=n[0],i="."+n[1]),e.length<4?e+i:(e=e.split("").reverse(),_.each(e,function(n,i){t.unshift(n),(i+1)%3==0&&i!==e.length-1&&t.unshift(",")}),t.join("")+i)}};return e}),define("js/widgets/search_bar/autocomplete",[],function(){return[{value:'author:""',label:"Author",match:'author:"'},{value:'author:"^"',label:"First Author",match:'author:"'},{value:'author:"^"',label:"First Author",match:"first author"},{value:'author:"^"',label:"First Author",match:"^author"},{value:'author:"^"',label:"First Author",match:'author:"^'},{value:'bibstem:""',label:"Publication (must use bibstem)",desc:"e.g. bibstem:ApJ",match:'bibstem:"'},{value:'bibstem:""',label:"Publication (must use bibstem)",desc:"e.g. bibstem:ApJ",match:"publication (bibstem)"},{value:"arXiv:",label:"arXiv ID",match:"arxiv:"},{value:"doi:",label:"DOI",match:"doi:"},{value:'full:""',label:"Full text search",desc:"title, abstract, and body",match:"full:"},{value:'full:""',label:"Full text search",desc:"itle, abstract, and body",match:"fulltext"},{value:'full:""',label:"Full text search",desc:"title, abstract, and body",match:"text"},{value:"year:",label:"Year",match:"year"},{value:"year:",label:"Year Range",desc:"e.g. 1999-2005",match:"year range"},{value:'aff:""',label:"Affiliation",match:"affiliation"},{value:'aff:""',label:"Affiliation",match:"aff:"},{value:'abs:""',label:"Search abstract + title + keywords",match:"abs:"},{value:"database:astronomy",label:"Limit to papers in the astronomy database",match:"database:astronomy"},{value:"database:physics",label:"Limit to papers in the physics database",match:"database:physics"},{value:'title:""',label:"Title",match:"title:("},{value:"orcid:",label:"ORCiD identifier",match:"orcid:"},{value:"object:",label:"SIMBAD object (e.g. object:LMC)",match:"object:"},{value:"citations()",label:"Citations",desc:"Get papers citing your search result set",match:"citations("},{value:"references()",label:"References",desc:"Get papers referenced by your search result set",match:"references("},{value:"trending()",label:"Trending",desc:"the list of documents most read by users who read recent papers on the topic being researched",match:"trending("},{value:"reviews()",label:"Review Articles",desc:"review articles citing most relevant papers",match:"reviews("},{value:"useful()",label:"Useful",desc:"documents frequently cited by the most relevant papers on the topic being researched",match:"useful("},{value:"property:refereed",label:"Limit to refereed",desc:"(property:refereed)",match:"refereed"},{value:"property:refereed",label:"Limit to refereed",desc:"(property:refereed)",match:"property:refereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"non-refereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"property:notrefereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"notrefereed"},{value:"property:eprint",label:"Limit to eprints",desc:"(property:eprint)",match:"eprint"},{value:"property:eprint",label:"Limit to eprints",desc:"(property:eprint)",match:"property:eprint"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"open access"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"property:openaccess"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"openaccess"},{value:"property:software",label:"Limit to software",desc:"(property:software)",match:"software"},{value:"property:software",label:"Limit to software",desc:"(property:software)",match:"property:software"},{value:"property:inproceedings",label:"Limit to papers in conference proceedings",desc:"(property:inproceedings)",match:"conference proceedings"},{value:"property:inproceedings",label:"Limit to papers in conference proceedings",desc:"(property:inproceedings)",match:"property:inproceedings"}]}),define("js/components/query_validator",["underscore"],function(e){function t(e,t){var n=new RegExp(e,t);return function(e){return n.test(e)?null:e}}function n(e,t,n){this.field=e,this.value=t,this.token=n}return function(){var i=function(e){return!!e};this.validate=function(a){var r={result:!0},s=[i,new t(/^$/),new t(/^""$/),new t(/^\(\)$/),new t(/^\(\^\)$/),new t(/^\(""\)$/),new t(/^\("\^"\)$/),new t(/^"\^"$/)];try{var o=a.get("q").join(" ").trim();if(!o.length)return r;var l=function(e){for(var t=new RegExp(/:/),i=e.split(/\s+\b/),a=[],r=0;r<i.length;r++){var s=i[r].split(t);2===s.length&&a.push(new n(s[0],s[1],i[r]))}return a}(o)}catch(e){return r}var c=function(t,n){var i=[];for(var a in n){var r=e.compose.apply(e,t)(n[a].value);r||i.push({token:n[a].token,result:r})}return i}(s,l);return r.result=e.every(e.pluck(c,"result")),c.length&&(r.tests=c),r}}}),define("libs/select2/matcher",["jquery"],function(e){return function(t){return function(n,i){var a=e.extend(!0,{},i);if(null==n.term||""===e.trim(n.term))return a;if(i.children){for(var r=i.children.length-1;r>=0;r--){var s=i.children[r];t(n.term,s.text,s)||a.children.splice(r,1)}if(a.children.length>0)return a}return t(n.term,i.text,i)?a:null}}}),define("js/widgets/search_bar/search_bar_widget",["underscore","marionette","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/search_bar/templates/search_bar_template","hbs!js/widgets/search_bar/templates/search_form_template","hbs!js/widgets/search_bar/templates/option-dropdown","js/components/query_builder/plugin","js/components/api_request","js/components/api_targets","js/components/api_feedback","js/mixins/formatter","./autocomplete","bootstrap","jquery-ui","js/mixins/dependon","analytics","js/components/query_validator","select2","libs/select2/matcher"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g,m,b,v,y){var _;function w(e){var t="";return window.getSelection?t=e.value.substring(e.selectionStart,e.selectionEnd):document.selection&&"Control"!=document.selection.type&&(t=document.selection.createRange().text),t}function S(t){var n=e.filter(t.split(/\s+/),function(e){if(e)return!0}),i={active:n[n.length-1]};return n.length>1?(n.pop(),i.inactive=n.join(" ")):i.inactive="",i}$.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n}}},$.fn.selectRange=function(e,t){return t||(t=e),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})};var E=Backbone.Model.extend({defaults:function(){return{citationCount:void 0,numFound:void 0,bigquery:!1,bigquerySource:void 0}}}),x=t.ItemView.extend({template:a,className:"s-search-bar-widget",initialize:function(t){e.bindAll(this,"fieldInsert"),this.queryBuilder=new o,this.queryValidator=new b,this.defaultDatabases=[]},activate:function(e){this.setBeeHive(e),this.queryBuilder.setQTreeGetter(o.buildQTreeGetter(e));var t=this;this.queryBuilder.attachHeartBeat(function(){t.onBuilderChange()})},onBuilderChange:function(){if(this.queryBuilder.isDirty(this.getFormVal())){var e=this.queryBuilder.getQuery();this.setFormVal(e)}},modelEvents:{change:"render"},onRender:function(){var t=this;this.$("#option-dropdown-container").append(s);var n=this.$(".quick-add-dropdown");n.select2({placeholder:"All Search Terms",matcher:y(function(e,t){return 0==t.toUpperCase().indexOf(e.toUpperCase())})}).on("change",function(e){var i=e.target.value;if(i){var a=$(this).find('option[value="'+e.target.value+'"]'),r=a.data("defaultValue"),s=a.closest("optgroup").attr("label");n.val(null).trigger("change"),setTimeout(function(){t.selectFieldInsert(i,s,r)},100)}}).val(null).trigger("change"),this.$("#search-gui").append(this.queryBuilder.$el);var i=this.$("input.q");this.$input=i;var a=!0;i.autocomplete({minLength:1,autoFocus:!0,delay:0,source:function(t,n){var r,s,o;a&&i.getCursorPosition()===i.val().length?(r=S(t.term).active)&&(s=new RegExp("^"+$.ui.autocomplete.escapeRegex(r),"i"),o=$.grep(h,function(e){return s.test(e.match)}),n(o=e.uniq(o,!1,function(e){return e.label}))):i.autocomplete("close")},focus:function(e,t){var n,a,r,s,o,l,c=i.val().replace(/^\s+/,""),u=t.item.value,d=w(i[0]);(a=(s=S(n=d?c.slice(0,c.length-d.length):c)).active,r=s.inactive,i.data("ui-autocomplete").suggestedQ=r?r+" "+t.item.value:t.item.value,0==u.indexOf(a))?(l=(o=r?r+" "+a:a)+u.slice(a.length),i.val(l),i.selectRange(o.length,l.length)):i.val(n);return!1},select:function(e,t){i.val(i.data("ui-autocomplete").suggestedQ);var n=t.item.value.split("").reverse()[0];return'"'==n||")"==n?i.selectRange(i.val().length-1):i.selectRange(i.val().length),m("send","event","interaction","autocomplete-used",t.item.value),!1}}),i.data("ui-autocomplete")._renderItem=function(e,t){return t.desc?$("<li>").append("<a>"+t.label+'<span class="s-auto-description">&nbsp;&nbsp;'+t.desc+"</span></a>").appendTo(e):$("<li>").append("<a>"+t.label+"</a>").appendTo(e)},i.keydown(function(e){a=8!=e.keyCode&&32!=e.keyCode}),i.popover({placement:"bottom",title:"Empty Search!",content:"Please enter a query to search.",animation:!0,trigger:"manual"}),this.$('[data-toggle="tooltip"]').tooltip()},events:(_={"click #field-options button":"fieldInsert","keyup .q":"toggleClear","click .show-form":"onShowForm","submit form[name=main-query]":"submitQuery","click .icon-clear":"clearInput"},_["keyup .q"]="storeCursorInfo",_["select .q"]="storeCursorInfo",_["click .q"]="storeCursorInfo",_["click .bigquery-close"]="clearBigquery",_["click .back-button"]="onNewSearch",_),toggleClear:function(){Boolean(this.$input.val())?this.$(".icon-clear").removeClass("hidden"):this.$(".icon-clear").addClass("hidden")},onNewSearch:function(){this.trigger("new-search")},clearInput:function(){this.$input.val(""),this.toggleClear()},getFormVal:function(){return this.$input.val()},setFormVal:function(e){this.model.get("bigquery")&&"*:*"===e?this.$(".q").val(""):this.$(".q").val(e),this.toggleClear()},serializeData:function(){var e=this.model.toJSON();return e.numFound=e.numFound?this.formatNum(e.numFound):0,e.citationCount=!!e.citationCount&&this.formatNum(e.citationCount),this.model.get("bigquerySource")&&this.model.get("bigquerySource").match(/library/i)&&this.model.set({libraryName:this.model.get("bigquerySource").match(/library:(.*)/i)[1]}),e},onShowForm:function(){var t=this.getFormVal();t.trim().length>0?this.queryBuilder.isDirty(this.getFormVal())||e.isEmpty(this.queryBuilder.getRules())?this.queryBuilder.updateQueryBuilder(t):this.queryBuilder.setRules(this.queryBuilder.getRules()):this.queryBuilder.setRules({condition:"AND",rules:[{id:"author",field:"author",type:"string",input:"text",operator:"is",value:""}]}),this.specifyFormWidth()},toggleFormSection:function(e){var t=$(e.target).parent();t.next().toggleClass("hide"),t.toggleClass("search-form-header-active")},_cursorInfo:{selected:"",startIndex:0},storeCursorInfo:function(e){var t=w(e.currentTarget),n=this.$input.getCursorPosition();this._cursorInfo={selected:t,startIndex:n},this.toggleClear()},selectFieldInsert:function(e,t,n){var i,a,r=this._cursorInfo.selected,s=this._cursorInfo.startIndex,o=this.getFormVal(),l='"'+r+'"';switch(0===r.length&&n&&(l=n),t){case"fields":"first-author"===e?(e="author",l=l.replace(/"/,'"^')):"year"===e&&(l=l.replace(/"/g,"")),i=e+":"+l;break;case"operators":i=e+"("+l+")";break;case"special characters":i="="===e?e+l:l+e,a=!0}if(r.length)this.setFormVal(o.substr(0,s)+i+o.substr(s+l.length));else{var c=o?o+" "+i:i;this.setFormVal(c),a?this.$input.selectRange(c.length):this.$input.selectRange(c.length-1)}},fieldInsert:function(e){e.preventDefault();var t,n,i=this.getFormVal(),a=$(e.target),r=a.attr("data-field"),s=a.attr("data-punc"),o=this._cursorInfo.startIndex,l=this._cursorInfo.selected;if(r.indexOf("operator-")>-1){if(n=r.split("-").reverse()[0],s="(",!l)return t=n+"("+i+")",i="",void this.setFormVal(t);t=n+"("+l+")"}else"first-author"==r?t=' author:"^'+l+'"':'"'==s?t=r+':"'+l+'"':"("==s?t=r+":("+l+")":s||(t=r+":"+l);if(l)this.setFormVal(i.substr(0,o)+t+i.substr(o+l.length));else{var c=i+" "+t;this.setFormVal(c),s?this.$input.selectRange(c.length-1):this.$input.selectRange(c.length)}m("send","event","interaction","field-insert-button-pressed",r)},submitQuery:function(t){var i,a,r;t.preventDefault(),t.stopPropagation(),r=this.getFormVal();var s=$("input",t.currentTarget);if(e.isString(r)&&e.isEmpty(r)&&!this.model.get("bigquery"))return s.popover("show"),s.on("input change blur",function(){$(this).popover("hide")}),!1;s.popover("hide"),r=r.replace(/([A-Z])\w+:/g,function(e){return e.toLowerCase()}),this.original_query=r,!r&&this.model.get("bigquery")&&(r="*:*");var o=new n({q:r}),l=this.queryValidator.validate(o);if(l.result)this.trigger("start_search",o),i=e.chain(h).pluck("value").map(function(e){var t=e.match(/\w+:|\w+\(/);if(t&&t.length)return t[0]}).unique().value(),a=!1,e.each(i,function(e){r.indexOf(e)>-1&&(a=!0)}),m("send","event","interaction",a?"fielded-query-submitted-from-search-bar":"unfielded-query-submitted-from-search-bar",r),this._queryBuilderUsed&&m("send","event","interaction","querybuilder-used",r),this._queryBuilderUsed=!1;else{var c=e.pluck(l.tests,"token");c=c.length>1?c.join(", "):c[0];var d=this.getPubSub();d.publish(d.ALERT,new u({code:0,msg:'<p><i class="fa fa-exclamation-triangle fa-2x" aria-hidden="true"></i> Sorry! We aren\'t able to understand: <strong><i>'+c+'</i></strong></p><p><strong><a href="/">Try looking at the search examples on the home page</a></strong> or <strong><a href="https://adsabs.github.io/help/search/search-syntax">reading our help page.</a></strong></p>',type:"info",fade:!0}))}},clearBigquery:function(){this.trigger("clear_big_query")}});e.extend(x.prototype,d,g.BeeHive);var A=i.extend({initialize:function(e){this.model=new E,this.view=new x({model:this.model}),this.listenTo(this.view,"start_search",function(e){this.changeDefaultSort(e),this.navigate(e),this.updateState("loading"),this.view.setFormVal(e.get("q"))}),this.listenTo(this.view,"clear_big_query",function(e){(e=this._currentQuery.clone()).unset("__qid"),e.unset("__bigquerySource"),e.set("__clearBigQuery","true"),this.clearBigQueryPill(),this.navigate(e)}),this.listenTo(this.view,"render",function(){if(!this.model.get("loading")){var e="",t=this.getCurrentQuery(),n=t.get("q");n&&(e=t.get("__original_query")?t.get("__original_query")[0]:n.join(" ")),this.listenTo(this.view,"new-search",this.newSearch),e&&this.view.setFormVal(e),this.view.toggleClear()}}),i.prototype.initialize.call(this,e)},newSearch:function(){var e=this.getPubSub();e.publish(e.NAVIGATE,"index-page")},activate:function(t){this.setBeeHive(t),this.activateWidget();var n=this.getPubSub();n.subscribe(n.FEEDBACK,e.bind(this.handleFeedback,this)),n.subscribe(n.NAVIGATE,e.bind(this.onNavigate,this)),this.view.activate(t.getHardenedInstance()),n.subscribe(n.INVITING_REQUEST,e.bind(this.dispatchRequest,this)),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),n.subscribe(n.USER_ANNOUNCEMENT,e.bind(this.updateFromUserData,this)),this.updateFromUserData()},getUserData:function(){try{var t=e.isFunction(this.getBeeHive)&&this.getBeeHive(),n=e.isFunction(t.getObject)&&t.getObject("User");return e.isPlainObject(n)?e.isFunction(n.getUserData)&&n.getUserData("USER_DATA"):{}}catch(e){return{}}},updateFromUserData:function(){var t=this.getUserData();this.defaultDatabases=e.has(t,"defaultDatabase")?e.map(e.filter(t.defaultDatabase,{value:!0}),"name"):this.defaultDatabases},applyDefaultFilters:function(t){var n=this.defaultDatabases;if(n.length>0){var i="{!type=aqp v=$fq_database}",a=t.get("fq");if(a=e.isArray(a)?a:[a],e.indexOf(i)<0&&(a.push(i),t.set("fq",a)),!t.has("fq_database")){var r=e.reduce(n,function(e,t,n){var i=t.toLowerCase();return e.replace(/(\(.*)(\))/,0===n?"$1database:"+i+"$2":"$1 OR database:"+i+"$2")},"()");t.set("fq_database",r)}if(!t.has("__filter_database_fq_database")){var s=e.map(n,function(e){return"database:"+e.toLowerCase()});t.set("__filter_database_fq_database",["OR"].concat(s))}}return t},processResponse:function(t){var n=t.toJSON();if(n.stats){var i=e.keys(n.stats.stats_fields)[0],a=n.stats.stats_fields[i].sum;"citation_count_norm"===i?this.model.set({citationCount:a.toFixed(2),citationLabel:"normalized citations"}):"citation_count"===i&&this.model.set({citationCount:a,citationLabel:"citations"})}else this.model.unset("citationCount"),this.model.unset("citationLabel")},defaultQueryArguments:{fl:"id"},dispatchRequest:function(t){var n=t.get("sort"),a=this.defaultQueryArguments;/citation_count_norm/i.test(n)?a=e.extend(a,{stats:"true","stats.field":"citation_count_norm"}):/citation_count/i.test(n)?a=e.extend(a,{stats:"true","stats.field":"citation_count"}):(this.model.unset("citationCount"),this.model.unset("citationLabel")),i.prototype.dispatchRequest.call(this,t)},focusInput:function(e){"index-page"==e&&(this.clearBigQueryPill(),this.view.$("input.q").focus().val(""))},clearBigQueryPill:function(){this.model.unset("bigquerySource"),this.model.unset("bigquery")},onNavigate:function(e){this.currentPage=e,this.focusInput(e)},handleFeedback:function(e){if(e.code===u.CODES.SEARCH_CYCLE_STARTED||e.code===u.CODES.SEARCH_CYCLE_FAILED_TO_START){var t=e.query?e.query:e.request.get("query"),n=t.get("__original_query")?t.get("__original_query")[0]:t.get("q").join(" ");this.setCurrentQuery(t),this.model.set({bigquerySource:t.get("__bigquerySource")?t.get("__bigquerySource")[0]:"Bulk query",bigquery:!!t.get("__qid"),numFound:e.numFound}),this.view.setFormVal(n),this.updateState("idle")}},changeDefaultSort:function(t){if(!t.has("sort")){var n=t.get("q")[0],i=e.find(["trending(","instructive(","useful(","references(","reviews("],function(e){if(-1!==n.indexOf(e))return e});"references("==i?t.set("sort","first_author asc"):i?t.set("sort","score desc"):i||t.set("sort","date desc")}},navigate:function(t){var i=t.toJSON(),a=e.omit(this.getCurrentQuery().toJSON(),function(e,t){return/^hl.*/.test(t)||/^p_$/.test(t)||/^__original_query$/.test(t)});"index-page"!==this.currentPage&&(t=new n(e.assign({},a,i))),"index-page"===this.currentPage&&(t=this.applyDefaultFilters(t)),t.has("__clearBigQuery")&&t.unset("__qid"),this.view.setFormVal(t.get("q")[0]),this.setCurrentQuery(t),this.getPubSub().publish(this.getPubSub().START_SEARCH,t)},openQueryAssistant:function(e){e&&this.view.setFormVal(e),this.view.$el.find(".show-form").click()},onShow:function(){if("index-page"===this.currentPage){var e=this.view.$("input[name=q]");!function t(n){if(e.blur().focus(),e.is(":focus")||n>9)return clearTimeout(void 0);setTimeout(t,500,n+1)}(0)}},onDestroy:function(){this.view.queryBuilder.destroy(),this.view.destroy()},onLoading:function(){this.model.set("loading",!0)},onIdle:function(){this.model.set("loading",!1)}});return e.extend(A.prototype,g.BeeHive),A}),define("hbs!js/widgets/paper_search_form/form",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <div class="form-group">\n      <label for="#bibcode-textarea">List of Bibcodes</label>\n      <div class="s-light-font">\n        Enter Bibcodes (e.g. 1989ApJ...342L..71R), one per line.\n      </div>\n      <textarea class="form-control" name="" id="bibcode-textarea" cols="30" rows="12"></textarea>\n    </div>\n    <div class="form-group">\n      <div class="button-div pull-right" style="padding-top: 7px;">\n        <button class="btn clear"><i class="fa fa-times"></i> Clear</button>\n        <button class="btn btn-primary author-submit" disabled="true" type="submit"><i class="fa fa-search"></i> Search</button>\n      </div>\n    </div>\n'},3:function(e,t,n,i){return'    <b>List of Bibcodes Form</b>\n    <div style="padding-top:20px">\n      <a href="#user/account/login" class="btn btn-success"> <i class="fa fa-sign-in"></i> log in to ADS to use this form</a>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="row">\n  <form class="paper-form s-paper-form col-md-6 clearfix">\n    <div class="form-group">\n      <label for="pub-input">Publication </label>\n      <button class="btn btn-link" style="top:-3px;position:relative" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">\n        <span class="s-light-font">type publication name to find bibstem  <i class="fa fa-question-circle"/></span>\n      </button>\n      <div class="collapse" id="collapseExample">\n        <div class="well">\n          A bibstem is an abbreviation that the ADS uses to identify a journal.\n          <a href="http://adsabs.harvard.edu/abs_doc/journals1.html#">A full list is available here.</a> The input field below will autocomplete on the 1,000 most popular journal names, allowing you to type "Astrophysical Journal", for instance,\n          to find the bibstem "apJ".\n        </div>\n      </div>\n      <input type="text" class="form-control" id="pub-input" data-term="bibstem" placeholder="e.g Astrophysical Journal">\n    </div>\n    <div class="form-group">\n      <label for="year-input">Year</label>\n      <input type="text" class="form-control" id="year-input" data-term="year">\n    </div>\n    <div class="form-group">\n      <label for="volume-input">Volume</label>\n      <input type="text" class="form-control" id="volume-input" data-term="volume">\n    </div>\n    <div class="form-group">\n      <label for="page-input">Page</label>\n      <input type="text" class="form-control" id="page-input" data-term="page">\n    </div>\n    <div class="form-group">\n      <div class="button-div pull-right">\n        <button class="btn clear"><i class="fa fa-times"></i> Clear</button>\n        <button class="btn btn-primary author-submit" disabled="true" type="submit"><i class="fa fa-search"></i> Search</button>\n      </div>\n    </div>\n  </form>\n\n  <form class="bibcode-form col-md-6 clearfix">\n'+(null!=(a=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"  </form>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/paper_search_form/form",n),n}),define("js/widgets/paper_search_form/widget",["js/widgets/base/base_widget","js/components/api_query","js/components/api_feedback","hbs!js/widgets/paper_search_form/form","./topterms","jquery-ui"],function(e,t,n,i,a,r){var s=Backbone.Model.extend({defaults:function(){return{loggedIn:void 0}}}),o=Marionette.ItemView.extend({template:i,className:"paper-search-form",events:{"keyup .paper-form input":"checkPaperFormDisabled","enter .paper-form input":"submitPaperForm","click .paper-form button[type=submit]":"submitPaperForm","keyup .bibcode-form textarea":"checkBibcodeFormDisabled","enter .bibcode-form textarea":"submitBibcodeForm","click .bibcode-form button[type=submit]":"submitBibcodeForm"},onRender:function(e){this.$(".paper-form input:not(#pub-input), .bibcode-form textarea",this.$el).keyup(function(e){13===e.keyCode&&$(this).trigger("enter")}),this.$("#pub-input").autocomplete({minLength:1,autoFocus:!0,source:function(e,t){return t($.map(a,function(t){if(_.isString(e.term)){var n=e.term.toUpperCase(),i=t.value.toUpperCase(),a=t.label.toUpperCase();if(0===i.indexOf(n)||0===a.indexOf(n)||0===a.replace(/^THE\s/,"").indexOf(n))return t}}))}}).data("ui-autocomplete")._renderItem=function(e,t){var n=new RegExp("("+this.term+")","i"),i=t.label.replace(n,'<span class="ui-state-highlight">$1</span>'),a=$("<li/>").appendTo(e);return $("<a/>").html(i).appendTo(a),a}},checkPaperFormDisabled:function(){this.$("input:not(.parse-reference)").map(function(){return $(this).val()}).get().join("").match(/\w+/)?this.$(".paper-form button[type=submit]").prop("disabled",!1):this.$(".paper-form button[type=submit]").prop("disabled",!0)},checkBibcodeFormDisabled:function(){this.$(".bibcode-form textarea").val().match(/\w+/)?this.$(".bibcode-form button[type=submit]").prop("disabled",!1):this.$(".bibcode-form button[type=submit]").prop("disabled",!0)},submitPaperForm:function(e){this.$(".paper-form button[type=submit]").html('<i class="icon-loading"/>  Loading...');var t=this.$(".paper-form input:not(.parse-reference)").map(function(){var e=$(this);return e.val()?toReturn=e.data("term")+":"+e.val():toReturn=void 0,toReturn}).get();if(t=_.filter(t,function(e){if(e)return e}),_.isEmpty(t))return this.$(".paper-form button[type=submit]").html('<i class="fa fa-search"></i> Search'),this.checkPaperFormDisabled(),!1;this.trigger("submit",t.join(" ")),e.preventDefault()},submitBibcodeForm:function(e){e.preventDefault(),this.$(".bibcode-form button[type=submit]").html('<i class="icon-loading"/>  Loading...');var t=this.$(".bibcode-form textarea").val().split(/\s+/);if(t=_.filter(t,function(e){if(e)return e}),_.isEmpty(t))return this.$(".bibcode-form button[type=submit]").html('<i class="fa fa-search"></i> Search'),this.checkBibcodeFormDisabled(),!1;this.trigger("submit-bigquery",t)}});return FormWidget=e.extend({initialize:function(e){e=e||{},this.model=new s,this.view=new o({model:this.model}),this.listenTo(this.view,"submit",this.submitForm),this.listenTo(this.view,"submit-bigquery",this.submitBigQuery)},activate:function(e){this.setBeeHive(e)},submitForm:function(e){var n=new t({q:e,sort:["date desc"]});this.getPubSub().publish(this.getPubSub().START_SEARCH,n)},submitBigQuery:function(e){var n=new t({__bigquery:e,sort:["date desc"]});this.getPubSub().publish(this.getPubSub().START_SEARCH,n)},onShow:function(){var e=this.getBeeHive().getObject("User").isLoggedIn();this.model.set({loggedIn:e}),this.view.render(),this.view.$("input#pub-input").focus()}}),FormWidget}),define("hbs!js/widgets/list_of_things/templates/item-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" chosen "},3:function(e,t,n,i){return" checked "},5:function(e,t,n,i){var a;return'        <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/citations" title="citation count" class="citations-redirect-link">cited: '+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+"</a>\n"},7:function(e,t,n,i){var a;return'\n                <div class="letter-icon s-letter-icon">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.program(12,i,0),data:i}))?a:"")+'\n            </div>\n\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.program(17,i,0),data:i}))?a:"")+'\n            </div>\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.program(22,i,0),data:i}))?a:"")+"\n            </div>\n"},8:function(e,t,n,i){var a;return'\n                        <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.links:e)?a.text:a)?a[0]:a)?a.url:a,e))+'" target="_blank" rel="noopener" class="btn-link active-link s-active-link" aria-disabled="false">\n                            <i class="s-text-icon" aria-label="quick access to full text links"></i>\n                        </a>\n                        <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"each",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+"                        </ul>\n\n"},9:function(e,t,n,i){var a;return"                            <li><a "+(null!=(a=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'"\n                                target="_blank" rel="noopener">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},10:function(e,t,n,i){return' class="s-open-access"'},12:function(e,t,n,i){return'\n                    <div title="full text links (none)">\n                        <a href="#" class="btn-link disabled" aria-disabled="true" aria-label="full text links">\n                            <i class="s-text-icon" aria-hidden="true"></i>\n                        </a>\n                    </div>\n\n'},14:function(e,t,n,i){var a;return'\n                <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.links:e)?a.list:a)?a[0]:a)?a.url:a,e))+'" class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-list-icon" aria-label="quick links to lists of references, citations and more"></i>\n                </a>\n\n                <ul class="hidden list-unstyled list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"each",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?a:"")+"                </ul>\n\n"},15:function(e,t,n,i){return'                    <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},17:function(e,t,n,i){return'                <div title="references, citations (none)">\n                    <a href="#" class="btn-link disabled" aria-disabled="true" aria-label="quick links to lists of references, citations etc">\n                        <i class="s-list-icon" aria-hidden="true"></i>\n                    </a>\n                </div>\n\n\n'},19:function(e,t,n,i){var a;return'\n                <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.links:e)?a.data:a)?a[0]:a)?a.url:a,e))+'" target="_blank" rel="noopener" class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-data-icon" aria-label="quick links to data associated with this article"></i>\n                </a>\n\n                <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"each",hash:{},fn:this.program(20,i,0),inverse:this.noop,data:i}))?a:"")+"                </ul>\n\n"},20:function(e,t,n,i){var a;return"                    <li><a "+(null!=(a=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'" target="_blank" rel="noopener"\n                        >'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},22:function(e,t,n,i){return'                    <div title="data products (none)">\n                        <a href="#" class="btn-link disabled" aria-disabled="true" aria-label="quick links to data associated with this article">\n                            <i class="s-data-icon" aria-hidden="true"></i>\n                        </a>\n                    </div>\n\n'},24:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.encodedIdentifier:e,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.program(27,i,0),data:i}))?a:""},25:function(e,t,n,i){var a,r;return'                <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/abstract" class="abs-redirect-link">\n                    <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n                </a>\n"},27:function(e,t,n,i){var a,r;return'                <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n"},29:function(e,t,n,i){var a,r;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/abstract" class="abs-redirect-link">\n                <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n            </a>\n"},31:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.authorFormatted:e,{name:"if",hash:{},fn:this.program(32,i,0),inverse:this.program(37,i,0),data:i}))?a:""},32:function(e,t,n,i){var a;return'            <ul class="list-inline just-authors s-results-authors less-authors" aria-label="authors">\n'+(null!=(a=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(33,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(35,i,0),inverse:this.noop,data:i}))?a:"")+'            </ul>\n\n            <ul class="list-inline just-authors s-results-authors all-authors hidden" aria-label="authors">\n'+(null!=(a=t.each.call(e,null!=e?e.allAuthorFormatted:e,{name:"each",hash:{},fn:this.program(33,i,0),inverse:this.noop,data:i}))?a:"")+'                <li>\n                    <a href="#" id="show-less-authors">\n                        <em>show less</em>\n                    </a>\n                </li>\n            </ul>\n'},33:function(e,t,n,i){return'                    <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},35:function(e,t,n,i){var a;return'                <li>\n                    <a href="#" id="show-all-authors">\n                        <em>and '+this.escapeExpression("function"==typeof(a=null!=(a=t.extraAuthors||(null!=e?e.extraAuthors:e))?a:t.helperMissing)?a.call(e,{name:"extraAuthors",hash:{},data:i}):a)+" more</em>\n                    </a>\n                </li>\n"},37:function(e,t,n,i){return'                <span class="text-faded">no author information available</span>\n'},39:function(e,t,n,i){var a;return'<div class="row">\n    <div class="col-sm-10 col-sm-offset-1">\n        <div class="s-results-orcid-container">\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.pending:a,{name:"if",hash:{},fn:this.program(40,i,0),inverse:this.program(42,i,0),data:i}))?a:"")+" \x3c!--orcid.pending--\x3e\n    </div>\n\n</div>\n"},40:function(e,t,n,i){return'            <button class="btn btn-default btn-sm s-orcid-loading" aria-disabled="true">\n                <i class="fa fa-lg fa-spinner fa-pulse"></i> Working...\n            </button>\n'},42:function(e,t,n,i){var a;return"            \x3c!-- if provenance, it has been added by us or someone else--\x3e\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.provenance:a,{name:"if",hash:{},fn:this.program(43,i,0),inverse:this.program(57,i,0),data:i}))?a:"")+"\x3c!--orcid.provenance --\x3e\n            "},43:function(e,t,n,i){var a;return'\n            <div class="'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(44,i,0),inverse:this.program(46,i,0),data:i}))?a:"")+" s-orcid-alert s-orcid-provenance-"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.orcid:e)?a.provenance:a,e))+'" role="alert">\n                <div class="btn-group">\n                    <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown"\n                            aria-expanded="false" '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(48,i,0),inverse:this.noop,data:i}))?a:"")+'>\n                        <img src="../../styles/img/orcid-active.svg" alt="orcid logo active" class="s-orcid-img"/> Actions <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.orcid:e)?a.actions:a,{name:"each",hash:{},fn:this.program(50,i,0),inverse:this.noop,data:i}))?a:"")+"                        </li>\n                    </ul>\n                </div>\n\n                "+(null!=(a=t.if.call(e,null!=e?e.source_name:e,{name:"if",hash:{},fn:this.program(55,i,0),inverse:this.noop,data:i}))?a:"")+'\n                <span class="text-success s-orcid-success pull-right"> <i class="icon-success"></i>&nbsp;In ORCID&nbsp;</span>\n\n            </div>\n\n\n\n            '},44:function(e,t,n,i){return"alert-danger"},46:function(e,t,n,i){return"alert-success"},48:function(e,t,n,i){var a;return'title="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.orcid:e)?a.error:a,e))+'"'},50:function(e,t,n,i){var a;return'                        <li>\n\n                            <a class="orcid-action '+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'" data-action="'+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'"\n                               title="'+this.escapeExpression(this.lambda(null!=e?e.caption:e,e))+'">\n                                <i class="\n'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-update",{name:"compare",hash:{},fn:this.program(51,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-delete",{name:"compare",hash:{},fn:this.program(53,i,0),inverse:this.noop,data:i}))?a:"")+'                            "></i>\n                                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a>\n"},51:function(e,t,n,i){return"                            icon-reload-c\n"},53:function(e,t,n,i){return"                            icon-clear-c\n"},55:function(e,t,n,i){var a;return'<span class="s-orcid-source">('+this.escapeExpression("function"==typeof(a=null!=(a=t.source_name||(null!=e?e.source_name:e))?a:t.helperMissing)?a.call(e,{name:"source_name",hash:{},data:i}):a)+")</span>"},57:function(e,t,n,i){var a;return"\x3c!-- add this paper to ORCID--\x3e\n\n"+(null!=(a=t.if.call(e,null!=e?e.bibcode:e,{name:"if",hash:{},fn:this.program(58,i,0),inverse:this.program(63,i,0),data:i}))?a:"")+"\n\n            "},58:function(e,t,n,i){var a;return'            <button class="btn '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(59,i,0),inverse:this.program(61,i,0),data:i}))?a:"")+" btn-sm orcid-action "+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.orcid:e)?a.actions:a)?a.add:a)?a.action:a,e))+'"  data-action="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.orcid:e)?a.actions:a)?a.add:a)?a.action:a,e))+'" '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.orcid:e)?a.error:a,{name:"if",hash:{},fn:this.program(48,i,0),inverse:this.noop,data:i}))?a:"")+'>\n               <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title="'+this.escapeExpression(this.lambda(null!=(a=null!=(a=null!=(a=null!=e?e.orcid:e)?a.actions:a)?a.add:a)?a.caption:a,e))+'"/>\n                Claim in ORCID\n            </button>\n'},59:function(e,t,n,i){return"btn-danger"},61:function(e,t,n,i){return"btn-default"},63:function(e,t,n,i){return'            <div class="panel panel-default" style="box-shadow: none">\n                <div class="panel-body">\n                    <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title=""/>\n                    Record not known to ADS\n                </div>\n            </div>\n'},65:function(e,t,n,i){var a;return'        <div class="col-xs-10 col-xs-offset-1 s-more-info">\n'+(null!=(a=t.if.call(e,null!=e?e.highlights:e,{name:"if",hash:{},fn:this.program(66,i,0),inverse:this.noop,data:i}))?a:"")+"        </div>\n"},66:function(e,t,n,i){var a;return'                    <h4 class="sr-only">Search Highlights</h4>\n                    <ul aria-label="search snippets" class="s-search-snippets">\n'+(null!=(a=t.each.call(e,null!=e?e.highlights:e,{name:"each",hash:{},fn:this.program(67,i,0),inverse:this.noop,data:i}))?a:"")+"                    </ul>\n"},67:function(e,t,n,i){var a;return"                        <li>"+(null!=(a=this.lambda(e,e))?a:"")+"</li>\n"},69:function(e,t,n,i){var a;return'        <div class="col-xs-9 col-xs-offset-1 s-more-info">\n'+(null!=(a=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(70,i,0),inverse:this.noop,data:i}))?a:"")+"        </div>\n"},70:function(e,t,n,i){var a,r;return'                    <h4 aria-label="read full abstract below"><a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'">Abstract</a></h4>\n'+(null!=(a=t.if.call(e,null!=e?e.shortAbstract:e,{name:"if",hash:{},fn:this.program(71,i,0),inverse:this.program(73,i,0),data:i}))?a:"")},71:function(e,t,n,i){var a,r;return'\n                    <div class="short-abstract" aria-label="a truncated version of the abstract">\n                        '+(null!=(a="function"==typeof(r=null!=(r=t.shortAbstract||(null!=e?e.shortAbstract:e))?r:t.helperMissing)?r.call(e,{name:"shortAbstract",hash:{},data:i}):r)?a:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default show-full-abstract">more</button>\n                    </div>\n                    <div class="full-abstract hidden">\n                        '+(null!=(a="function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)?a:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default hide-full-abstract">less</button>\n                    </div>\n'},73:function(e,t,n,i){var a,r;return"                        \x3c!--the abstract is short enough to be shown all at once--\x3e\n                        "+(null!=(a="function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)?a:"")+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="col-sm-12 '+(null!=(a=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'">\n<div class="row s-top-row">\n    <div class="col-xs-1 s-checkbox-col s-top-row-col">\n        <label>\n            '+this.escapeExpression("function"==typeof(r=null!=(r=t.indexToShow||(null!=e?e.indexToShow:e))?r:t.helperMissing)?r.call(e,{name:"indexToShow",hash:{},data:i}):r)+'\n            <input type="checkbox" value='+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+' name="identifier" '+(null!=(a=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'>\n        </label>\n    </div>\n\n    <div class="hidden-xs hidden-sm col-md-3 s-top-row-col identifier s-identifier">\n        <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/abstract" aria-label="bibcode" class="abs-redirect-link">\n            '+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'\n        </a>\n    </div>\n    <div class="col-xs-2 col-md-2 col-md-offset-0 s-top-row-col" aria-label="date published">\n        '+this.escapeExpression("function"==typeof(r=null!=(r=t.formattedDate||(null!=e?e.formattedDate:e))?r:t.helperMissing)?r.call(e,{name:"formattedDate",hash:{},data:i}):r)+'\n    </div>\n    <div class="col-xs-3 col-sm-4 col-md-2 s-top-row-col">\n'+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'    </div>\n    <div class="col-xs-4 col-sm-4 pull-right">\n        <div class="s-results-links">\n\n'+(null!=(a=t.if.call(e,null!=e?e.links:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'      </div>\n    </div>\n\n</div>\n<div class="row">\n\n    <div class="col-xs-10 col-xs-offset-1">\n'+(null!=(a=t.if.call(e,null!=e?e.isOrcidWidget:e,{name:"if",hash:{},fn:this.program(24,i,0),inverse:this.program(29,i,0),data:i}))?a:"")+'    </div>\n</div>\n\n<div class="row">\n    <div class="col-xs-10 col-xs-offset-1">\n\n'+(null!=(a=t.unless.call(e,null!=e?e.isOrcidWidget:e,{name:"unless",hash:{},fn:this.program(31,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n    </div>\n\n</div>\n\n"+(null!=(a=t.if.call(e,null!=e?e.orcid:e,{name:"if",hash:{},fn:this.program(39,i,0),inverse:this.noop,data:i}))?a:"")+'\n    <div class="row highlight-row">\n'+(null!=(a=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(65,i,0),inverse:this.noop,data:i}))?a:"")+'    </div>\n\n    <div class="row abstract-row">\n'+(null!=(a=t.if.call(e,null!=e?e.showAbstract:e,{name:"if",hash:{},fn:this.program(69,i,0),inverse:this.noop,data:i}))?a:"")+"    </div>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/item-template",n),n}),define("hbs!js/widgets/list_of_things/templates/pagination-partial",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <i class="icon-loading"></i>&nbsp;Loading more papers...\n'},3:function(e,t,n,i){var a;return null!=(a=t.unless.call(e,null!=e?e.error:e,{name:"unless",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:""},4:function(e,t,n,i){var a;return'<div class="row">\n'+(null!=(a=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n"},5:function(e,t,n,i){var a;return'    <div class="col-sm-12 pagination-controls s-pagination-controls">\n        <div class="col-xs-5 per-page-container">\n'+(null!=(a=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+'        </div>\n        <div class="col-xs-6">\n            <nav>\n                <ul class="pager">\n                    <li class="'+(null!=(a=t.unless.call(e,null!=(a=null!=e?e.pageData:e)?a.previousPossible:a,{name:"unless",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'"><a href="#" class="page-control previous-page"><i class="fa fa-chevron-circle-left"></i> prev</a></li>\n                    <input type="text" value="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.pageData:e)?a.currentPage:a,e))+'" class="form-control page-control" style="display:inline-block;width:60px"> of '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.pageData:e)?a.totalPages:a,e))+'\n                    <li class="'+(null!=(a=t.unless.call(e,null!=(a=null!=e?e.pageData:e)?a.nextPossible:a,{name:"unless",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'"><a href="#" class="page-control next-page">next <i class="fa fa-chevron-circle-right"></i></a></li>\n                </ul>\n            </nav>\n\n        </div>\n    </div>\n'},6:function(e,t,n,i){var a;return'            Per Page:\n            <a href="#" class="btn btn-sm '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,25,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?a:"")+' per-page">25</a>\n            <a href="#" class="btn btn-sm  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,50,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?a:"")+' per-page">50</a>\n            <a href="#" class="btn btn-sm '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,100,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?a:"")+' per-page">100</a>\n            <a href="#" class="btn btn-sm '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,200,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?a:"")+' per-page">200</a>\n            <a href="#" class="btn btn-sm '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(a=null!=e?e.pageData:e)?a.perPage:a,500,{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.program(9,i,0),data:i}))?a:"")+' per-page">500</a>\n'},7:function(e,t,n,i){return" per-page--active "},9:function(e,t,n,i){return" btn-link "},11:function(e,t,n,i){return" disabled "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="row">\n    <div class="col-sm-12 page-loading" style="text-align:center">\n'+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"    </div>\n</div>\n"+(null!=(a=t.unless.call(e,null!=e?e.query:e,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/pagination-partial",n),t.registerPartial("js/widgets/list_of_things/templates/pagination-partial",n),n}),define("hbs!js/widgets/list_of_things/templates/results-container-template",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'    <div>\n        <h4 class="s-list-description">'+this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)+"</h4>\n    </div>\n"},3:function(e,t,n,i){var a,r;return'    <div>\n        <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n    </div>\n"},5:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.citation_discrepancy:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:""},6:function(e,t,n,i){var a;return'        <div>\n           <i class="fa fa-exclamation-triangle"></i>\n            This list is missing <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_discrepancy||(null!=e?e.citation_discrepancy:e))?a:t.helperMissing)?a.call(e,{name:"citation_discrepancy",hash:{},data:i}):a)+"</b> records, which could not be matched to papers in ADS.\n        </div>\n        <br>\n"},8:function(e,t,n,i){var a;return'        <div class="s-operator">\n            <a href="'+this.escapeExpression("function"==typeof(a=null!=(a=t.queryURL||(null!=e?e.queryURL:e))?a:t.helperMissing)?a.call(e,{name:"queryURL",hash:{},data:i}):a)+'" class="btn btn-sm btn-inverse btn-primary-faded"><i class="fa fa-search"></i> view this list in a search results page</a>\n         </div>\n'},10:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"         ",helpers:t,partials:n}))?a:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="s-list-controls">\n\n    <div class="s-results-border-bottom">\n\n        <div class="col-sm-1">\n        </div>\n\n        <div class="col-sm-6">\n        </div>\n\n        <div class="col-sm-4 sort-container">\n        </div>\n\n        <div class="col-sm-1"></div>\n\n</div>\n\n<div class="s-list-title">\n\n'+(null!=(a=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"\n    \x3c!--citation widget should show info if [citations] and citation_count don't match--\x3e\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.queryOperator:e,"citations",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.queryOperator:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+'\n</div>\n\n    <ul class="results-list  s-results-list list-unstyled s-display-block" aria-label="list of results"></ul>\n\n\n'+(null!=(a=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/results-container-template",n),n}),define("js/mixins/add_stable_index_to_collection",["underscore"],function(e){return{getPageStart:function(e,t,n){return n?Math.min(e*t,n):e*t},getPageEnd:function(e,t,n){var i=this.getPageStart(e,t)+t;return i>n?n:i},getPageVal:function(e,t){return Math.floor(e/t)},addPaginationToDocs:function(t,n){var i=e.isArray(n)?n[0]:parseInt(n);return e.each(t,function(e){e.resultsIndex=i,e.indexToShow=i+1,i+=1}),t}}}),define("js/widgets/list_of_things/model",["backbone","underscore","js/mixins/add_stable_index_to_collection"],function(e,t,n){var i=e.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,details:void 0,links_data:void 0,resultsIndex:void 0,visible:!1,actionsVisible:!0}},idAttribute:"resultsIndex"}),a=e.Collection.extend({initialize:function(e,t){this.numVisible=0,this.currentStartIndex=0,this.currentEndIndex=0,this.lastIndex=-1,this.lastMissingTrigger=null,t&&t.paginationModel&&(this.paginationModel=t.paginationModel,this.listenTo(this.paginationModel,"change:page",this._onPaginationChange),this.listenTo(this.paginationModel,"change:perPage",this._onPaginationChange))},model:i,numFound:void 0,comparator:"resultsIndex",_updateStartAndEndIndex:function(){var e=this.paginationModel.get("page"),t=this.paginationModel.get("perPage"),n=this.paginationModel.get("numFound");this.currentStartIndex=this.getPageStart(e,t),this.currentEndIndex=this.getPageEnd(e,t,n)},_onPaginationChange:function(){this._updateStartAndEndIndex(),this.trigger("pagination:change")},reset:function(){this.lastMissingTrigger=null,this.lastIndex=-1,e.Collection.prototype.reset.apply(this,arguments)},getStartIndex:function(){return this.currentStartIndex},getEndIndex:function(){return this.paginationModel.get("perPage")},_incrementLastIndex:function(){return this.lastIndex+=1,this.lastIndex},_prepareModel:function(t,n){return void 0===t.resultsIndex&&(t.resultsIndex=this._incrementLastIndex()),(t.title||t.bibcode||t.identifier)&&(t.emptyPlaceholder=!1),e.Collection.prototype._prepareModel.call(this,t,n)},getVisibleModels:function(){return t.filter(this.models,function(e){return e.attributes.visible})},updateIndexes:function(e,n,i){i=i||{};e=t.isNumber(e)?e:this.currentStartIndex,n=t.isNumber(n)?n:this.currentEndIndex+1;var a,r=0,s=null,o=0,l=[],c=null;if(this.each(function(i){a=i.attributes.resultsIndex,null!==c&&a!=c+1&&t.each(t.range(c+1,a),function(e){l.push(e)}),c=a,a>=e&&a<=n?(i.set("visible",!0),null===s&&(s=a),r+=1,o=a):i.set("visible",!1)}),r!==n-e+1&&t.each(t.range((c||e+l.length)+1,n+1),function(e){this.get(e)||l.push(e)},this),l.length){for(var u=0,d=l.length,h=0;h<l.length;h++){if(l[h]>n){d=h;break}l[h]<e&&(u=h+1)}l=l.slice(u,d),l=this._compressGaps(l),JSON.stringify(l)!=this.lastMissingTrigger&&(this.lastMissingTrigger=JSON.stringify(l),i.silent||this.trigger("show:missing",l))}return this.numVisible=r,this.currentStartIndex=s||0,this.currentEndIndex=o,r},_compressGaps:function(e){for(var t=e[0],n=t,i=e.length,a=[],r=0;r<i;r++){for(var s=r+1;s<i&&e[s]==t+(s-r);)n=e[s],s+=1;a.push({start:t,end:n}),r=s-1,s<i&&(t=n=e[s])}return a},showRange:function(e,t,n){if(n=n||{},e<0)throw new Error("Start cannot be negative");if(t<e)throw new Error("End cannot be smaller than start");return this.updateIndexes(e,t,n)},getNumVisible:function(){return this.numVisible},showMore:function(e){if(null===e)return this.updateIndexes(0,this.model.length);var t=this.getNumVisible();return this.updateIndexes(this.currentStartIndex,0==this.currentEndIndex?e-1:this.currentEndIndex+e)-t}});return t.extend(a.prototype,n),a}),define("hbs!js/widgets/list_of_things/templates/empty-view-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="s-empty-view-msg">\n  <div class="h4">\n    Sorry no results were found for <code>'+this.escapeExpression("function"==typeof(a=null!=(a=t.query||(null!=e?e.query:e))?a:t.helperMissing)?a.call(e,{name:"query",hash:{},data:i}):a)+'</code>\n  </div>\n  <ul>\n    <li>Try broadening your search</li>\n    <li>Disable any filters that may be applied</li>\n    <li><a href="#">Check out some examples</a></li>\n    <li><a href="https://adsabs.github.io/help/search/search-syntax" target="_blank" rel="noopener">Read our help pages</a></li>\n  </ul>\n  <span>\n    Not seeing something that should be here? Let us know!\n    <button class="btn btn-primary-faded results-feedback-button" data-toggle="modal" data-target="#feedback-modal">\n      <i class="fa fa-comment"></i>\n      Leave Feedback\n    </button>\n  </span>\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/empty-view-template",n),n}),define("hbs!js/widgets/list_of_things/templates/error-view-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="container-fluid">\n  <div class="row text-center">\n    <span class="fa-stack fa-lg text-danger">\n      <i class="fa fa-stack-2x fa-circle-o"></i>\n      <i class="fa fa-stack-1x fa-exclamation"></i>\n    </span>\n  </div>\n  <div class="row text-center">\n    <div class="h4">\n      Something Went Wrong\n    </div>\n    <div class="h4">\n      Please Retry Your Search\n    </div>\n  </div>\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/error-view-template",n),n}),define("hbs!js/widgets/list_of_things/templates/initial-view-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return"Requesting data..."},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/initial-view-template",n),n}),define("js/widgets/list_of_things/item_view",["marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","analytics","mathjax"],function(e,t,n,i,a,r,s,o){return e.ItemView.extend({tagName:"li",template:r,constructor:function(t){return t&&_.defaults(t,_.pick(this,["model","collectionEvents","modelEvents"])),_.bindAll(this,"resetToggle"),e.ItemView.prototype.constructor.apply(this,arguments)},render:function(){return this.model.get("visible")?e.ItemView.prototype.render.apply(this,arguments):(this.$el&&this.$el.empty(),this)},onRender:function(){o&&o.Hub.Queue(["Typeset",o.Hub,this.el])},events:{"change input[name=identifier]":"toggleSelect","focus .letter-icon":"showLinks","mouseenter .letter-icon":"showLinks","mouseleave .letter-icon":"hideLinks","focusout .letter-icon":"hideLinks","click .letter-icon a":"emitAnalyticsEvent","click #show-all-authors":"showAllAuthors","click #show-less-authors":"showLessAuthors","click .show-full-abstract":"showFullAbstract","click .hide-full-abstract":"hideFullAbstract","click .orcid-action":"orcidAction","click .abs-redirect-link":"onAbsLinkClick","click .citations-redirect-link":"onCitationsLinkClick"},modelEvents:{"change:visible":"render","change:showAbstract":"render","change:showHighlights":"render","change:orcid":"render","change:chosen":"render"},collectionEvents:{add:"render","change:visible":"render"},emitAnalyticsEvent:function(e){s("send","event","interaction","letter-link-followed",$(e.target).text())},onAbsLinkClick:function(e){var t=this.model.get("bibcode");s("send","event","interaction","abstract-link-followed",{target:"abstract",bibcode:t})},onCitationsLinkClick:function(e){var t=this.model.get("bibcode");s("send","event","interaction","citations-link-followed",{target:"citations",bibcode:t})},showAllAuthors:function(e){e.preventDefault(),this.$(".s-results-authors.less-authors").addClass("hidden"),this.$(".s-results-authors.all-authors").removeClass("hidden")},showLessAuthors:function(e){e.preventDefault(),this.$(".s-results-authors.less-authors").removeClass("hidden"),this.$(".s-results-authors.all-authors").addClass("hidden")},showFullAbstract:function(){this.$(".short-abstract").addClass("hidden"),this.$(".full-abstract").removeClass("hidden")},hideFullAbstract:function(){this.$(".short-abstract").removeClass("hidden"),this.$(".full-abstract").addClass("hidden")},toggleSelect:function(){var e=!this.model.get("chosen");this.trigger("toggleSelect",{selected:e,data:this.model.attributes}),this.model.set("chosen",e)},resetToggle:function(){this.setToggleTo(!1)},setToggleTo:function(e){var t=$("input[name=identifier]");e?(this.$el.addClass("chosen"),this.model.set("chosen",!0),t.prop("checked",!0)):(this.$el.removeClass("chosen"),this.model.set("chosen",!1),t.prop("checked",!1))},removeActiveQuickLinkState:function(e){e.find("i").removeClass("s-icon-draw-attention"),e.find(".link-details").addClass("hidden"),e.find("ul").attr("aria-expanded",!1)},addActiveQuickLinkState:function(e){e.find("i").addClass("s-icon-draw-attention"),e.find(".link-details").removeClass("hidden"),e.find("ul").attr("aria-expanded",!0)},deactivateOtherQuickLinks:function(e){var t=this.$(".letter-icon").filter(function(){if($(this).find("i").hasClass("s-icon-draw-attention"))return!0}).eq(0);t.length&&t[0]!==e[0]&&this.removeActiveQuickLinkState(t)},showLinks:function(e){var t=$(e.currentTarget);t.find(".active-link").length&&(this.deactivateOtherQuickLinks(t),this.addActiveQuickLinkState(t))},hideLinks:function(e){var t=$(e.currentTarget);this.removeActiveQuickLinkState(t)},orcidAction:function(e){if(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n={action:t.data("action")?t.data("action"):t.text().trim(),model:this.model,view:this,target:t};this.trigger("OrcidAction",n)}}})}),define("hbs!js/wraps/widget/loading/template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'  <div class="close-widget close-circle">\n    <a href="#"><i class="fa fa-times fa-lg"></i></a>\n  </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="loading-container">\n'+(null!=(a=t.unless.call(e,null!=e?e.hideCloseButton:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'  <div class="loading">\n    <div class="loading-icon-'+this.escapeExpression("function"==typeof(r=null!=(r=t.widgetLoadingSize||(null!=e?e.widgetLoadingSize:e))?r:t.helperMissing)?r.call(e,{name:"widgetLoadingSize",hash:{},data:i}):r)+' fa fa-spinner fa-spin"></div>\n    <div class="loading-text loading-text-'+this.escapeExpression("function"==typeof(r=null!=(r=t.widgetLoadingSize||(null!=e?e.widgetLoadingSize:e))?r:t.helperMissing)?r.call(e,{name:"widgetLoadingSize",hash:{},data:i}):r)+'">Loading...</div>\n  </div>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/widget/loading/template",n),n}),define("js/widgets/list_of_things/paginated_view",["marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/link_generator_mixin","js/mixins/add_stable_index_to_collection","hbs!js/widgets/list_of_things/templates/empty-view-template","hbs!js/widgets/list_of_things/templates/error-view-template","hbs!js/widgets/list_of_things/templates/initial-view-template","./item_view","analytics","mathjax","hbs!js/wraps/widget/loading/template"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g){var m=t.Model.extend({defaults:function(){return{mainResults:!1,title:void 0,showAbstract:"closed",showHighlights:!1,pagination:!0,start:0}}}),b=e.ItemView.extend({template:function(e){return e.query?c(e):e.error?u(e):g(_.extend(e,{widgetLoadingSize:"big",hideCloseButton:!0}))}});return e.CompositeView.extend({childView:h,emptyView:b,initialize:function(e){this.model=new m},serializeData:function(){var e=this.model.toJSON();return e.queryOperator&&(e.queryURL="#search/q="+e.queryOperator+"(",e.queryURL+=encodeURIComponent("bibcode:"+e.bibcode)+")",e.removeSelf&&(e.queryURL+=encodeURIComponent(" -bibcode:"+e.bibcode)),e.sortOrder&&(e.queryURL+="&sort="+encodeURIComponent(e.sortOrder))),e},onRender:function(){f&&f.Hub.Queue(["Typeset",f.Hub,this.el])},className:"list-of-things",alreadyRendered:!1,emptyViewOptions:function(e){var t=this.model.get("query"),n=this.model.get("error");return this.model.unset("error",{silent:!0}),_.isArray(t)?e.set("query",t[0]):_.has("query",t)?e.set("query",t.query[0]):n&&e.set("error",n),{model:e}},childViewContainer:".results-list",events:{"click .show-highlights":"toggleHighlights","click .show-abstract":"toggleAbstract","click .toggle-make-space":"toggleMakeSpace","click a.page-control":"changePageWithButton","keyup input.page-control":"tabOrEnterChangePageWithInput","click .per-page":"changePerPage"},toggleHighlights:function(){"open"==this.model.get("showHighlights")?this.model.set("showHighlights","closed"):"closed"==this.model.get("showHighlights")&&this.model.set("showHighlights","open")},toggleAbstract:function(){"open"==this.model.get("showAbstract")?this.model.set("showAbstract","closed"):"closed"==this.model.get("showAbstract")&&(this.model.set("showAbstract","open"),p("send","event","interaction","abstracts-toggled-on"))},toggleMakeSpace:function(){var e=!this.model.get("makeSpace");this.model.set("makeSpace",e),p("send","event","interaction","on")},modelEvents:{change:"render","change:showHighlights":"toggleChildrenHighlights","change:showAbstract":"toggleChildrenAbstracts"},collectionEvents:{reset:"resetViewModel"},template:s,resetViewModel:function(){var e=this.model.defaults();this.model.set({showAbstract:e.showAbstract,showHighlights:e.showHighlights})},toggleChildrenHighlights:function(){var e="open"===this.model.get("showHighlights");this.collection.each(function(t){t.set("showHighlights",e)})},toggleChildrenAbstracts:function(){var e="open"===this.model.get("showAbstract");this.collection.each(function(t){t.set("showAbstract",e)})},changePageWithButton:function(e){e.preventDefault();var t=$(e.currentTarget);if(!t.parent().hasClass("disabled")){var n=t.hasClass("next-page")?1:-1,i=this.model.get("page")+n;this.trigger("pagination:select",i),this.resultsWidget&&p("send","event","interaction","results-list-pagination",i)}},tabOrEnterChangePageWithInput:function(e){var t=parseInt($(e.target).val()-1);13!=e.keyCode&&9!=e.keyCode||this.trigger("pagination:select",t),this.resultsWidget&&p("send","event","interaction","results-list-pagination",t)},changePerPage:function(e){e.preventDefault();var t=parseInt($(e.target).text().trim());t!==this.model.get("perPage")&&this.trigger("pagination:changePerPage",t)}})}),define("js/widgets/list_of_things/widget",["marionette","backbone","utils","js/components/api_request","js/components/api_query","js/components/api_feedback","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/add_stable_index_to_collection","./model","./paginated_view"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=s.extend({initialize:function(e){e=e||{},_.defaults(e,_.pick(this,["view","collection","pagination","model","description","childView"])),this.pagination={pagination:!0,perPage:25,numFound:void 0,currentQuery:void 0,start:0,pageData:void 0},e.collection=e.collection||new u,e.view||(e.view=new d({collection:e.collection,model:e.model,childView:e.childView})),e.view.model.set(this.pagination,{silent:!0}),e.view.model.set({sortOrder:e.sortOrder,removeSelf:e.removeSelf,queryOperator:e.queryOperator,description:e.description},{silent:!0}),_.extend(this,{model:e.view.model,view:e.view}),this.hiddenCollection=new u,this.listenTo(this.hiddenCollection,"all",this.onAllInternalEvents),this.listenTo(this.view,"all",this.onAllInternalEvents),this.on("all",this.onAllInternalEvents),s.prototype.initialize.call(this,e)},activate:function(e){if(this.setBeeHive(e),_.bindAll(this,["updatePaginationPreferences"]),this.getPubSub().subscribe(this.getPubSub().USER_ANNOUNCEMENT,this.updatePaginationPreferences),this.getBeeHive().getObject("User")&&this.getBeeHive().getObject("User").getLocalStorage){var t=this.getBeeHive().getObject("User").getLocalStorage().perPage;t&&(this.pagination.perPage=t,this.model.set(this.pagination))}this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback)},onApiFeedback:function(e){e.error&&this.view.model.set("error",e.error)},updatePaginationPreferences:function(e,t){"user_info_change"==e&&t.perPage&&t.perPage!==this.pagination.perPage&&this.updatePagination({perPage:t.perPage})},_getCurrentQueryString:function(e){var t="",n=e||this.getBeeHive().getObject("AppStorage").getCurrentQuery();if(!_.isUndefined(n)&&(t=n.getApiQuery().get("q"),_.isEmpty(t)||t[0].indexOf("simbid")>-1))try{t=[n.get("responseHeader.params.__original_query")]}catch(e){t=""}return t},processResponse:function(e){var t=this.extractDocs(e),n=e.has("response.numFound")?e.get("response.numFound"):this.hiddenCollection.length,i=e.has("response.start")?e.get("response.start"):this.model.get("start"),a=this.getPaginationInfo(e,t);(t=this.processDocs(e,t,a))&&t.length?(this.hiddenCollection.add(t,{merge:!0}),a.showRange&&(this.model.set(a),this.hiddenCollection.showRange(a.showRange[0],a.showRange[1])),this.view.collection.reset(this.hiddenCollection.getVisibleModels()),this.view.model.set("query",!1)):this.view.model.set("query",this._getCurrentQueryString(e)),this.trigger("page-manager-event","widget-ready",{numFound:n});var r=this.model.has("perPage")&&this.model.get("perPage")===this.collection.length,s=this.model.has("pageData")&&!1===this.model.get("pageData").nextPossible;0===this.view.collection.length||r||s&&n<=i+t.length?this.model.set("loading",!1):this.model.set("loading",!0)},extractDocs:function(e){var t=e.get("response.docs");return t=_.map(t,function(e){return e.identifier=e.bibcode,e})},getPaginationInfo:function(e,t){var n=e.getApiQuery(),i=e.get("response.numFound")||0,a=this.model.get("perPage")||(n.has("rows")?n.get("rows")[0]:10),r=this.model.get("start")||0,s=c.getPageVal(r,a),o=[s*a,(s+1)*a-1];return n.has("__fetch_missing")?{start:r,showRange:o}:{numFound:i,perPage:a,start:r,page:s,showRange:o,pageData:this._getPaginationData(s,a,i),currentQuery:n}},_getPaginationData:function(e,t,n){return{perPage:t,totalPages:Math.ceil(n/t),currentPage:e+1,previousPossible:e>0,nextPossible:(e+1)*t<n}},processDocs:function(e,t,n){if(!e.has("response"))return[];var i=e.get("response").start||n.start||0;return t=c.addPaginationToDocs(t,i)},defaultQueryArguments:{fl:"id",start:0},updateLocalStorage:function(e){e.hasOwnProperty("perPage")&&_.contains([25,50,100,200,500],e.perPage)&&(this.getBeeHive().getObject("User").setLocalStorage({perPage:e.perPage}),console.log("set user's page preferences in localStorage: "+e.perPage))},updatePagination:function(e){var t=_.defaults(e,{silentIndexUpdate:!1,updateHash:!0}),i=this.model.get("pageData"),r=this.model.get("start"),s={},o=(this.model.get("currentQuery")||new a).get("p_");if(_.isNumber(t.numFound)&&(s.numFound=t.numFound),_.isNumber(t.perPage)&&(s.perPage=t.perPage,this.pagination.perPage=t.perPage),_.isArray(o)&&_.isUndefined(t.page))try{t.page=parseInt(o[0])}catch(e){}if(_.isNumber(t.page)){var l=i&&i.totalPages-1||1;t.page>l?s.page=l:t.page<0?s.page=0:s.page=t.page}else if(_.isEmpty(this.collection.models)&&_.isNumber(r)&&_.isNumber(t.perPage))s.page=c.getPageVal(r,t.perPage);else if(_.isNumber(r)&&_.isNumber(t.perPage)){var u=this.collection.models[0].get("resultsIndex");s.page=c.getPageVal(u,t.perPage)}var d=_.isNumber(s.page)?s.page:this.model.get("page"),h=_.isNumber(s.perPage)?s.perPage:this.model.get("perPage"),p=_.isNumber(s.numFound)?s.numFound:this.model.get("numFound");""+d!==(_.isArray(o)&&o[0])&&t.updateHash&&/search/.test(location.hash)&&n.qs("p_",location.hash)!==""+d?location.hash=n.updateHash("p_",d,location.hash):(s.start=this.getPageStart(d,h,p),s.pageData=this._getPaginationData(d,h,p),s.showRange=[d*h,d*h+h-1],this.model.set(s),this.view.render(),this.hiddenCollection.showRange(s.showRange[0],s.showRange[1],{silent:!!t.silentIndexUpdate}),this.collection.reset(this.hiddenCollection.getVisibleModels()),document.body.scrollTop=document.documentElement.scrollTop=0,$("#app-container").scrollTop(0))},onAllInternalEvents:function(e,t,n){try{var i=this.getPubSub()}catch(e){}if("pagination:changePerPage"===e)this.updateLocalStorage({perPage:t}),this.updatePagination({page:0,perPage:t});else{if("pagination:select"===e)return this.updatePagination({page:t});"show:missing"===e?_.each(t,function(e){var t=this.model.get("numFound"),n=e.start;this.model.get("perPage");if(!(n>=t)){var i=this.model.get("currentQuery").clone();i.set("__fetch_missing","true"),i.set("start",n),i.set("rows",25);var a=this.composeRequest(i);this.executeRequest(a)}},this):"childview:toggleSelect"==e&&i.publish(i.PAPER_SELECTION,n.data.identifier)}},executeRequest:function(e){this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,e)},reset:function(){this.collection.reset(),this.hiddenCollection.reset(),this.model.set(_.defaults({currentQuery:this.getCurrentQuery(),query:!1},this.pagination,this.model.defaults()))}});return _.extend(h.prototype,c),h}),define("hbs!js/widgets/abstract/templates/abstract_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'<a target="prev">prev</a>'},3:function(e,t,n,i){return' <a target="next">next</a>'},5:function(e,t,n,i){return'\n    <h2 class="s-abstract-title">Abstract Not Found</h2>\n    <div class="s-abstract-text">\n        No valid abstract selected for retrieval or abstract not yet indexed in ADS.\n    </div>\n'},7:function(e,t,n,i){var a,r;return'\n<h2 class="s-abstract-title">\n    '+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+'\n    <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.titleLink:e)?a.href:a,e))+'">'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.titleLink:e)?a.text:a,e))+"</a>\n</h2>\n\n\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.authorAff:e)?a.length:a,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")+'\n<div class="s-abstract-text">\n    <h4 class="sr-only">Abstract</h4>\n    <p>\n'+(null!=(a=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.program(27,i,0),data:i}))?a:"")+'    </p>\n</div>\n\n<br>\n<dl class="s-abstract-dl-horizontal">\n\n'+(null!=(a=t.if.call(e,null!=e?e.pub_raw:e,{name:"if",hash:{},fn:this.program(29,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.formattedDate:e,{name:"if",hash:{},fn:this.program(31,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.doi:e,{name:"if",hash:{},fn:this.program(33,i,0),inverse:this.noop,data:i}))?a:"")+"\n    <dt>Bibcode</dt>\n    <dd>"+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+' <i class="icon-help" data-toggle="popover" data-content="The bibcode is assigned by the ADS as a unique identifier for the paper."></i></dd>\n\n'+(null!=(a=t.if.call(e,null!=e?e.keyword:e,{name:"if",hash:{},fn:this.program(35,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.comment:e,{name:"if",hash:{},fn:this.program(41,i,0),inverse:this.noop,data:i}))?a:"")+'\n\n</dl>\n<br/>\n<a class="small pull-right text-faded" target="_blank" rel="noopener" href="http://adsabs.harvard.edu/adsfeedback/submit_abstract.php?bibcode='+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'" title="Provide feedback or suggest corrections">\n    <span class="fa-stack">\n        <i class="fa fa-comment-o fa-stack-2x"></i>\n        <i class="fa fa-exclamation fa-stack-1x"></i>\n    </span>\n    Feedback/Corrections?\n</a>\n\n'},8:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=e?e.hasAffiliation:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.hasMoreAuthors:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'\n<div id="authors-and-aff" class="s-authors-and-aff">\n    <ul class="list-inline">\n'+(null!=(a=t.each.call(e,null!=e?e.authorAff:e,{name:"each",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.hasMoreAuthors:e,{name:"if",hash:{},fn:this.program(18,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.each.call(e,null!=e?e.authorAffExtra:e,{name:"each",hash:{},fn:this.program(20,i,0),inverse:this.noop,data:i}))?a:"")+"    </ul>\n</div>\n"},9:function(e,t,n,i){return'<button class="btn btn-xs btn-default-flat s-toggle-aff" id="toggle-aff">Show affiliations</button>\n'},11:function(e,t,n,i){return'<button class="btn btn-xs btn-default-flat s-toggle-authors" id="toggle-more-authors">Show all authors</button>\n'},13:function(e,t,n,i){var a;return null!=(a=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.program(16,i,0),data:i}))?a:""},14:function(e,t,n,i){return'        <li class="author"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span></li>\n"},16:function(e,t,n,i){return'        <li class="author"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span>;</li>\n"},18:function(e,t,n,i){return'        <li class="author extra-dots">; <a data-target="more-authors" title="Show all authors">...</a></li>\n'},20:function(e,t,n,i){var a;return null!=(a=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.program(23,i,0),data:i}))?a:""},21:function(e,t,n,i){return'        <li class="author extra hide"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span></li>\n"},23:function(e,t,n,i){return'        <li class="author extra hide"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span>;</li>\n"},25:function(e,t,n,i){var a,r;return"        "+(null!=(a="function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)?a:"")+"\n"},27:function(e,t,n,i){return"        <i>No abstract</i>\n"},29:function(e,t,n,i){var a,r;return'    <dt>Publication</dt>\n    <dd>\n        <div id="article-publication">'+(null!=(a="function"==typeof(r=null!=(r=t.pub_raw||(null!=e?e.pub_raw:e))?r:t.helperMissing)?r.call(e,{name:"pub_raw",hash:{},data:i}):r)?a:"")+"</div>\n    </dd>\n"},31:function(e,t,n,i){var a;return"    <dt>Pub Date:</dt>\n    <dd>"+this.escapeExpression("function"==typeof(a=null!=(a=t.formattedDate||(null!=e?e.formattedDate:e))?a:t.helperMissing)?a.call(e,{name:"formattedDate",hash:{},data:i}):a)+"</dd>\n"},33:function(e,t,n,i){var a;return'    <dt>DOI:</dt>\n    <dd>\n        <span>\n            <a href="'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.doi:e)?a.href:a,e))+'" target="_blank" rel="noopener">'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.doi:e)?a.doi:a,e))+'</a>\n            <i class="fa fa-external-link"></i>\n        </span>\n    </dd>\n'},35:function(e,t,n,i){var a;return'    <div id="keywords">\n        <dt>Keywords</dt>\n        <dd>\n            <ul class="list-inline">\n'+(null!=(a=t.each.call(e,null!=e?e.keyword:e,{name:"each",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?a:"")+"            </ul>\n        </dd>\n    </div>\n"},36:function(e,t,n,i){var a;return null!=(a=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(37,i,0),inverse:this.program(39,i,0),data:i}))?a:""},37:function(e,t,n,i){var a;return"                <li>"+(null!=(a=this.lambda(e,e))?a:"")+"</li>\n"},39:function(e,t,n,i){var a;return"                <li>"+(null!=(a=this.lambda(e,e))?a:"")+";</li>\n"},41:function(e,t,n,i){var a;return'    <div id="comment">\n        <dt>Comments</dt>\n        <dd>\n            <ul class="list-unstyled">\n'+(null!=(a=t.each.call(e,null!=e?e.commentList:e,{name:"each",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.hasExtraComments:e,{name:"if",hash:{},fn:this.program(44,i,0),inverse:this.noop,data:i}))?a:"")+"            </ul>\n        </dd>\n    </div>\n"},42:function(e,t,n,i){var a;return"                    <li>"+(null!=(a=this.lambda(e,e))?a:"")+"</li>\n"},44:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.showAllComments:e,{name:"if",hash:{},fn:this.program(45,i,0),inverse:this.program(47,i,0),data:i}))?a:""},45:function(e,t,n,i){return'                    <li><a href="#" id="show-less-comments">show less</a></li>\n'},47:function(e,t,n,i){return'                    <li><a href="#" id="show-all-comments">show all</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\x3c!--<div id="article-navigation">'+(null!=(a=t.if.call(e,null!=e?e.hasPrev:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"|"+(null!=(a=t.if.call(e,null!=e?e.hasNext:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"</div>--\x3e\n\n"+(null!=(a=t.unless.call(e,null!=e?e.bibcode:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/abstract/templates/abstract_template",n),n}),define("js/mixins/papers_utils",["underscore","jquery-ui","jquery"],function(e,t,n){return{formatDate:function(t,i){if(i&&!e.isObject(i))throw new Error("format must be an object of string formats");var a,r,s,o=["day","month"];if(s=(i=e.defaults(i||{},{format:"yy/mm/dd",missing:{day:"yy/mm",month:"yy"},separator:"-",junk:"-00"})).format,r=new Date(t),e.isNaN(r.getYear())){for(var l=0,c=t,u=i.junk;c.indexOf(u)>-1;){c=c.substring(0,c.lastIndexOf(u));try{if(r=new Date(c),!e.isNaN(r.getYear())&&!(s=i.missing[o[l]]))throw new Error("format is missing: "+o[l])}catch(e){}l+=1}if(e.isNaN(r.getYear()))throw new Error("Error parsing input: "+t)}else{var d=i.separator;if(t.indexOf(d)>-1){var h=t.split(d);if(2==h.length?s=i.missing[o[0]]:1==h.length&&(s=i.missing[o[1]]),!s)throw new Error("format is missing: missing."+o[l])}}return a=new Date(r.getTime()+6e4*r.getTimezoneOffset()),n.datepicker.formatDate(s,a)},shortenAbstract:function(e,t){if(t=t||300,!(e.length<=t)){var n=e.slice(0,t).lastIndexOf(" ");return e.slice(0,n+1)+"..."}},prepareDocForViewing:function(t){var n;if(t.author&&t.author.length>3?(t.extraAuthors=t.author.length-3,n=t.author.slice(0,3)):t.author&&(n=t.author),t.author){var i=function(e,t,n){var i=n.length-1;return t===i||0===i?e:e+";"};t.authorFormatted=e.map(n,i),t.allAuthorFormatted=e.map(t.author,i)}return t.formattedDate=t.formattedDate||(t.pubdate?this.formatDate(t.pubdate):void 0),t.shortAbstract=t.abstract?this.shortenAbstract(t.abstract):void 0,t.details=t.details||{shortAbstract:t.shortAbstract,pub:t.pub,abstract:t.abstract},t.num_citations=t["[citations]"]?t["[citations]"].num_citations:void 0,t.identifier=t.bibcode,t.encodedIdentifier=e.isUndefined(t.identifier)?t.identifier:encodeURIComponent(t.identifier),(t.pubdate||t.shortAbstract)&&(t.popover=!0),this.model&&(t.orderNum=this.model.get("resultsIndex")+1),t}}}),define("js/widgets/abstract/widget",["marionette","backbone","jquery","underscore","cache","js/widgets/base/base_widget","hbs!js/widgets/abstract/templates/abstract_template","js/components/api_query","js/mixins/link_generator_mixin","js/mixins/papers_utils","mathjax","bootstrap"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=t.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,page:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,citation_count:void 0,titleLink:void 0}},parse:function(e,t){t=t||20;if(i.isArray(e.doi)&&i.isPlainObject(l)&&(e.doi={doi:e.doi,href:l.createUrlByType(e.bibcode,"doi",e.doi)}),e.aff=e.aff||[],e.aff.length?(e.hasAffiliation=i.without(e.aff,"-").length,e.authorAff=i.zip(e.author,e.aff)):e.author&&(e.hasAffiliation=!1,e.authorAff=i.zip(e.author,i.range(e.author.length))),e.page&&e.page.length&&(e.page=e.page[0]),e.authorAff&&(i.each(e.authorAff,function(t,n){e.authorAff[n][2]=encodeURIComponent('"'+t[0]+'"').replace(/%20/g,"+")}),e.authorAff.length>t&&(e.authorAffExtra=e.authorAff.slice(t,e.authorAff.length),e.authorAff=e.authorAff.slice(0,t)),e.hasMoreAuthors=e.authorAffExtra&&e.authorAffExtra.length),e.pubdate&&(e.formattedDate=c.formatDate(e.pubdate,{format:"MM d yy",missing:{day:"MM yy",month:"yy"}})),e.title&&e.title.length){e.title=e.title[0];var n=e.title.match(/<a.*href="(.*?)".*?>(.*)<\/a>/i);n&&(e.title=e.title.replace(n[0],"").trim(),e.titleLink={href:n[1],text:n[2]},e.titleLink.href.match(/^\/abs/)&&(e.titleLink.href="#"+e.titleLink.href.slice(1)))}if(e.comment){i.isArray(e.comment)||(e.comment=[e.comment]);var a=e.comment;try{e.comment=e.comment[0].split(";")}catch(t){e.comment=a}e.hasExtraComments=e.comment.length>3,e.commentList=i.first(e.comment,3)}return e}}),p=e.ItemView.extend({tagName:"article",className:"s-abstract-metadata",modelEvents:{change:"render"},template:s,events:{"click #show-all-comments":"showAllComments","click #show-less-comments":"showLessComments","click #toggle-aff":"toggleAffiliation","click #toggle-more-authors":"toggleMoreAuthors",'click a[data-target="more-authors"]':"toggleMoreAuthors",'click a[target="prev"]':"onClick",'click a[target="next"]':"onClick"},showAllComments:function(e){e.preventDefault();var t=this.model;t.set({commentList:t.get("comment"),showAllComments:!0})},showLessComments:function(e){e.preventDefault();var t=this.model;t.set({commentList:i.first(t.get("comment"),3),showAllComments:!1})},toggleMoreAuthors:function(e){e&&e.stopPropagation(),this.$(".author.extra").toggleClass("hide"),this.$(".author.extra-dots").toggleClass("hide"),this.$(".author.extra").hasClass("hide")?this.$("#toggle-more-authors").text("Show all authors"):this.$("#toggle-more-authors").text("Hide authors")},toggleAffiliation:function(e){e&&e.preventDefault(),this.$(".affiliation").toggleClass("hide"),this.$(".affiliation").hasClass("hide")?this.$("#toggle-aff").text("Show affiliations"):this.$("#toggle-aff").text("Hide affiliations")},onClick:function(e){e.preventDefault(),this.trigger(n(e.target).attr("target"))},onRender:function(){this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0}),u&&u.Hub.Queue(["Typeset",u.Hub,this.el]),document.title=n("<div>"+this.model.get("title")+"</div>").text(),document.body.scrollTop=document.documentElement.scrollTop=0,n("#app-container").scrollTop(0)}});return r.extend({initialize:function(e){e=e||{},this.model=e.data?new h(e.data,{parse:!0}):new h,this.view=new p({model:this.model}),this.listenTo(this.view,"all",this.onAllInternalEvents),r.prototype.initialize.apply(this,arguments),this._docs={},this.maxAuthors=20},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");i.bindAll(this,["onNewQuery","dispatchRequest","processResponse","onDisplayDocuments"]),t.subscribe(t.START_SEARCH,this.onNewQuery),t.subscribe(t.INVITING_REQUEST,this.dispatchRequest),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments)},defaultQueryArguments:{fl:"title,abstract,comment,bibcode,author,keyword,id,citation_count,[citations],pub,aff,volume,pubdate,doi,pub_raw,page",rows:40},mergeStashedDocs:function(e){i.each(e,function(e){this._docs[e.bibcode]||(this._docs[e.bibcode]=this.model.parse(e))},this)},onNewQuery:function(e){var t=e.toJSON(),n=i.pick(this.getCurrentQuery().toJSON(),i.keys(t));JSON.stringify(t)!=JSON.stringify(n)&&(this._docs={})},dispatchRequest:function(e){this.setCurrentQuery(e),r.prototype.dispatchRequest.apply(this,arguments)},displayBibcode:function(e){this.model.clear({silent:!0}),this.model.set(this._docs[e]),this._current=e;var t=this._docs[e]["[citations]"],n=t?t.num_citations:0;this.trigger("page-manager-event","broadcast-payload",{title:this._docs[e].title,bibcode:e,citation_discrepancy:this._docs[e].citation_count-n,citation_count:this._docs[e].citation_count})},onDisplayDocuments:function(e){var t;if(this.mergeStashedDocs(this.getBeeHive().getObject("DocStashController").getDocs()),(n=e.get("q")).length>0&&n[0].indexOf("bibcode:")>-1)var n=n[0].replace("bibcode:","");if(this._docs[n])this.displayBibcode(n);else{if(e.has("__show"))return;(t=e.clone()).set("__show",n),this.dispatchRequest(t)}},onAllInternalEvents:function(e){if(("next"==e||"prev"==e)&&this._current){var t=i.keys(this._docs),n=this.getPubSub(),a=i.indexOf(t,this._current);a>-1&&("next"==e&&a+1<t.length?n.publish(n.DISPLAY_DOCUMENTS,t[a+1]):a-1>0&&n.publish(n.DISPLAY_DOCUMENTS,t[a-1]))}},processResponse:function(e){var t,n,a=e.toJSON();a.response&&a.response.docs&&(i.each(a.response.docs,function(e){t=this.model.parse(e,this.maxAuthors),this._docs[t.bibcode]=t},this),e.has("responseHeader.params.__show")&&(n=e.get("responseHeader.params.__show"),this.displayBibcode(n))),this.trigger("page-manager-event","widget-ready",{numFound:e.get("response.numFound")})}})}),define("hbs!js/widgets/results/templates/container-template",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.showHighlights:e,"open",{name:"compare",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:""},2:function(e,t,n,i){return'                    <button class="btn  btn-primary  btn-sm show-highlights"> Hide highlights</button>\n'},4:function(e,t,n,i){return'                    <button class="btn btn-primary btn-sm btn-inverse show-highlights"> Show highlights</button>\n'},6:function(e,t,n,i){return'                <button class="btn show-abstract btn-sm btn-primary"> Hide abstracts</button>\n'},8:function(e,t,n,i){return'                <button class="btn show-abstract btn-sm btn-inverse btn-primary"> Show abstracts</button>\n'},10:function(e,t,n,i){return'                    <button class="btn btn-sm btn-primary toggle-make-space">Show Sidebars</button>\n'},12:function(e,t,n,i){return'                    <button class="btn btn-sm btn-inverse btn-primary toggle-make-space">Hide Sidebars</button>\n'},14:function(e,t,n,i){var a,r;return'    <div class="col-sm-12">\n        <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n    </div>\n"},16:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"        ",helpers:t,partials:n}))?a:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="s-results-widget results-widget">\n<div class="row s-list-controls">\n\n    <div class="s-results-border-bottom">\n\n        <div class="col-xs-1 s-checkbox-col">\n            <label for="#select-all-docs" class="sr-only">\n               select all on this page\n            </label>\n            <input title="select all on this page" type="checkbox" id="select-all-docs"/>\n        </div>\n\n        <div class="col-xs-6">\n\n\n            <div class="s-show-details-container">\n'+(null!=(a=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.showAbstract:e,"open",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.makeSpace:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.program(12,i,0),data:i}))?a:"")+'            </div>\n\n        </div>\n\n\n        <div class="col-xs-2 sort-container">\n\n        </div>\n\n        <div class="col-xs-3">\n\n        </div>\n\n    </div>\n\n</div>\n\n<div class="row">\n    <h2 class="sr-only">Search Results</h2>\n\n\n'+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.noop,data:i}))?a:"")+'    <ul class="col-sm-12 results-list  s-results-list list-unstyled s-display-block" aria-label="list of results">\n    </ul>\n\n</div>\n'+(null!=(a=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/results/templates/container-template",n),n}),define("js/modules/orcid/extension",["underscore","js/components/api_query","js/components/api_request","js/components/api_query_updater","js/components/api_targets","js/modules/orcid/work","js/components/api_feedback","js/mixins/dependon"],function(e,t,n,i,a,r,s){return function(s){var o=new i("OrcidExtension"),l=s.prototype.processDocs,c=s.prototype.activate,u=s.prototype.onAllInternalEvents;return s.prototype.activate=function(t){this.setBeeHive(t),c.apply(this,arguments);var n=t.hasService("PubSub")&&t.getService("PubSub");n.subscribe(n.CUSTOM_EVENT,e.bind(this.onCustomEvent))},s.prototype.onCustomEvent=function(t,n){var i=e.bind(function(t,n){var i=e.filter(this.collection.models,function(t){return e.contains(n,t.get("bibcode"))});e.forEach(i,e.bind(function(n){var i=e.map(n.get("orcid").actions,"action");if(e.contains(i,t)){var a=this.view.children.findByModel(n);a&&a.trigger("OrcidAction",{action:t,view:a,model:n})}},this))},this);switch(t){case"orcid-bulk-claim":i("orcid-add",n);break;case"orcid-bulk-update":i("orcid-update",n);break;case"orcid-bulk-delete":i("orcid-delete",n)}},s.prototype._getOrcidInfo=e.memoize(function(e){var t={actions:{},provenance:null};return e.isCreatedByOthers&&e.isCreatedByADS?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"},t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):e.isCreatedByOthers&&!e.isCreatedByADS?(e.isKnownToADS&&(t.actions.add={title:"add ADS version ORCID",caption:"ORCID already has a record for this article (we don't have rights to update it).",action:"orcid-add"}),t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):!e.isCreatedByOthers&&e.isCreatedByADS?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"}):t.actions.add={title:"add to ORCID",caption:"Add ADS version to ORCID",action:"orcid-add"},e.isCreatedByADS&&e.isCreatedByOthers?t.provenance="ads":e.isCreatedByADS?t.provenance="ads":e.isCreatedByOthers?t.provenance="others":t.provenance=null,t},function(e){return[e.isCreatedByADS,e.isCreatedByOthers,e.isKnownToADS,e.provenance]}),s.prototype._setDocsToPending=function(t,n){e.forEach(t,function(t){var i=!e.isBoolean(n)||n;t.orcid=e.extend({},t.orcid,{pending:i})})},s.prototype.addOrcidInfo=function(t){var n=this,i=!1,a=e.noop,r=this.getBeeHive().getService("OrcidApi");if(!r||!r.hasAccess())return t;var s=e.debounce(function(){e.forEach(n.hiddenCollection.models,function(t){var n=t.get("orcid");n.pending&&(n=e.extend({},n,{pending:!1,error:"Error while applying Orcid Data"}),t.set("orcid",n))})},100),o=(e.debounce(function(){var t=n._getOrcidInfo({});e.forEach(n.hiddenCollection.models,function(e){e.get("orcid")&&e.get("orcid").pending&&e.set("orcid",t)})},100),function t(i,a){e.forEach(e.rest(arguments),function(r,s){var o=i[s],l=n._getOrcidInfo(r);if(r.sourcedByADS&&e.isUndefined(o.source_name)&&(o.source_name="NASA Astrophysics Data System"),o.orcid=e.extend({},o.orcid,l,{pending:!1}),e.isUndefined(o.identifier))if(e.isString(r.bibcode))o.identifier=r.bibcode;else if(e.isArray(r.doi))o.identifier=r.doi[0];else if(e.isPlainObject(o._work)){var c=o._work.getExternalIdType();c=e.isArray(c)?c[0]:c,e.isString(c)&&(o.identifier=o._work.getExternalIds()[c])}var u=e.find(n.hiddenCollection.models,function(t){return e.isPlainObject(o._work)&&o._work===t.get("_work")||e.isString(o.bibcode)&&o.bibcode===t.get("bibcode")||e.isArray(o.doi)&&o.doi===t.get("doi")||!e.isUndefined(o.identifier)&&o.identifier===t.get("identifier")});if(u){var d,h;if(e.isPlainObject(o._work)){d=o._work.getSources();var p=o._work.getSourceOrcidIdHost(),f=o._work.getPath();e.isString(p)&&e.isString(f)&&(h="//"+p+"/"+f)}e.isUndefined(u.get("identifier"))&&n.orcidWidget&&u.set("identifier",o.identifier),u.set({orcid:l,source_name:e.isArray(d)?d.join("; "):u.get("source_name"),orcidWorkPath:h})}else a<60&&e.delay(e.bind(t,n,[o],a+1),500);e.isArray(r.children)&&e.forEach(r.children,function(t){var i=e.find(n.hiddenCollection.models,function(n){return e.isString(t)&&t===n.get("_work").getPutCode()});i&&n.removeModel(i)})})}),l=function(t){return i?e.defer(s):(i=!0,a(t))};return(a=function(t){var i=e.map(t,function(t){return r.getRecordInfo(t).done(function(i){i.sourcedByADS&&e.isUndefined(t.source_name)&&(t.source_name="NASA Astrophysics Data System"),t.orcid=e.extend({},t.orcid,n._getOrcidInfo(i),{pending:!1})})});n._setDocsToPending(t),$.when.apply($,i).then(e.partial(o,t),e.partial(l,t))})(t),t},s.prototype._paginationUpdate=function(){var t=this;e.forEach(this.hiddenCollection.models,function(n){var i=e.find(t.collection.models,function(e){return e.get("_work")===n.get("_work")});i&&i.get("orcid").pending&&i.set("orcid",n.get("orcid"))})},s.prototype._updateModelsWithOrcid=function(t,n){var i=e.filter(t||this.hiddenCollection.models,function(e){return!e.has("_work")&&(e.has("bibcode")||e.has("doi"))});e.isEmpty(i)?n<60&&e.delay(e.bind(self._updateModelsWithOrcid,self,null,n+1),500):this.getBeeHive().getService("OrcidApi").getUserProfile().done(function(t){var a=t.getWorks();e.forEach(i,function(t){var i=e.flatten(e.values(e.pick(t.attributes,["bibcode","doi","identifier"])));e.forEach(a,function(a){var r=e.flatten(e.values(a.getExternalIds()));e.intersection(i,r).length>0?t.set({source_name:a.getSources().join("; "),_work:a}):n<60&&e.delay(e.bind(self._updateModelsWithOrcid,self,[t],n+1),500)})})})},s.prototype.processDocs=function(t,n,i){n=l.apply(this,arguments);var a=this.getBeeHive().getObject("User");if(a&&a.isOrcidModeOn()||this.orcidWidget){var r=t.get("responseHeader.params"),s=parseInt(r.start)+parseInt(r.rows),o=this.addOrcidInfo(n,s);return i.numFound!==o.length&&e.extend(i,this.getPaginationInfo(t,n)),e.delay(e.bind(this._updateModelsWithOrcid,this),1e3),o}return n},s.prototype.mergeADSAndOrcidData=function(i){var r=this,s=$.Deferred(),l=r.getBeeHive().getService("OrcidApi"),c=function(t,n){var a=n.response&&n.response.docs&&n.response.docs[0],r=t.toADSFormat();r=e.isPlainObject(r)?r:{},a=e.isPlainObject(a)?a:{},i.set(e.extend({},i.attributes,r,a)),s.resolve(i)},u=function(){s.reject.apply(s,arguments)},d=function(){s.reject.apply(s,arguments)},h=function(s){var l=i.get("identifier")||s.pickIdentifier(["bibcode","doi"]);if(!l)throw Error("Unable to determine suitable identifier");var d=new t({q:"identifier:"+o.quoteIfNecessary(l),fl:"title,abstract,bibcode,author,pub,pubdate,doi,doctype"}),h=new n({query:d,target:a.SEARCH,options:{done:e.partial(c,s),fail:u}}),p=r.getPubSub();p.publish(p.EXECUTE_REQUEST,h)},p=i.get("_work");return p?l.getWork(p.getPutCode()).done(h).fail(d):this._findWorkByModel(i).done(function(e){l.getWork(e.getPutCode()).done(h).fail(d)}).fail(d),s.promise()},s.prototype._findWorkByModel=function(t,n){var i=$.Deferred(),a=this.getBeeHive().getService("OrcidApi"),r=e.pick(t.attributes,["bibcode","doi"]),s=e.clone(t.get("orcid")||{}),o=null;e.isUndefined(n)&&(o=a.getUserProfile());var l=function(n){var a=n.getWorks(),o=e.find(a,function(t){var n=t.getExternalIds(),i=e.any(r.doi,n.doi);return r.bibcode===n.bibcode||i});if(o)i.resolve(o);else{i.reject();var l="Could not find a matching ORCiD Record";console.error.apply(console,[l].concat(arguments)),t.set("orcid",e.extend(s,{pending:!1,error:l}))}};return e.isUndefined(n)?(o.done(l),o.fail(function(){i.reject.apply(i,arguments);var n="Error retrieving ORCiD profile";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(s,{pending:!1,error:n}))})):l(n),i.promise()},s.prototype.removeModel=function(t){var n=t.resultsIndex;this.hiddenCollection.remove(t);var i=this.hiddenCollection.models;e.forEach(e.rest(i,n),function(e){e.set("resultsIndex",e.get("resultsIndex")-1),e.set("indexToShow",e.get("indexToShow")-1)});var a=this.model.get("showRange"),r=e.range(a[0],a[1]+1),s=[];e.forEach(r,function(e){i[e]&&i[e].set&&(i[e].set("visible",!0),i[e].resultsIndex=e,i[e].set("resultsIndex",e),i[e].set("indexToShow",e+1),s.push(i[e]))}),this.hiddenCollection.reset(i),this.collection.reset(s),this.model.set("totalPapers",i.length)},s.prototype.onAllInternalEvents=function(t,n,i){if("childview:OrcidAction"===t){var a=this,s=i.action,o=this.getBeeHive().getService("OrcidApi"),l=e.clone(i.model.get("orcid")||{}),c=this.getPubSub();c.publish(c.CUSTOM_EVENT,"orcid-action",s);var d={"orcid-add":function(t){t.set("orcid",{pending:!0});var n,i=function(){a._findWorkByModel(t).done(function(e){t.set({orcid:a._getOrcidInfo({isCreatedByADS:!0,isCreatedByOthers:!1,isKnownToADS:!0,provenance:"ads"}),source_name:e.getSources().join("; ")}),a.trigger("orcidAction:"+s,t)})},c=r.adsToOrcid(t.attributes);if(c)n=c,o.addWork(n).done(i).fail(function(n,a,r){if("CONFLICT"===r)return i();var s="Failed to add entry, please try again";console.error.apply(console,[s].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:s}))});else{var u="There was a problem adding the record, try again";console.error.apply(console,[u].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:u}))}},"orcid-delete":function(t){t.set("orcid",{pending:!0});var n=function(){a.orcidWidget?a.removeModel(t):t.set("orcid",a._getOrcidInfo({})),a.trigger("orcidAction:"+s,t)},i=function(i){o.deleteWork(i.getPutCode()).done(n).fail(function(i,a,r){if("NOT FOUND"===r)return n();var s="Error deleting record, please try again";console.error.apply(console,[s].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:s}))})},r=t.get("_work");r?i(r):a._findWorkByModel(t).done(i)},"orcid-update":function(t){t.set("orcid",{pending:!0});var n=function(){var n="Error updating record, please try again";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:n}))};a.mergeADSAndOrcidData(t).done(function(t){var i=t.get("_work").getPutCode(),l=r.adsToOrcid(t.attributes,i);if(e.isNull(l))return n(l);o.updateWork(l).done(function(e){var n=new r(e);o.getRecordInfo(n.toADSFormat()).done(function(e){t.set("orcid",a._getOrcidInfo(e)),a.trigger("orcidAction:"+s,t)})}).fail(n),t.set(t.attributes,{silent:!0})}).fail(function(){var n="Failed to merge ORCiD and ADS data";console.error.apply(console,[n].concat(arguments)),t.set("orcid",e.extend(l,{pending:!1,error:n}))})},"orcid-login":function(){o.signIn()},"orcid-logout":function(){o.signOut()},"orcid-view":function(t){var n=t.get("orcidWorkPath");e.isString(n)&&window.open(n,"_blank").focus()}};d[s]&&d[s](i.model)}return u.apply(this,arguments)},s}}),define("js/widgets/results/widget",["js/widgets/list_of_things/widget","js/widgets/abstract/widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/formatter","hbs!js/widgets/results/templates/container-template","js/mixins/papers_utils","js/modules/orcid/extension","js/mixins/dependon","js/components/api_feedback"],function(e,t,n,i,a,r,s,o,l,c){var u=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.view.template=r,this.view.model.defaults=function(){return{mainResults:!0,title:void 0,showAbstract:"closed",makeSpace:!1,showHighlights:!1,pagination:!0}},this.model.set(this.model.defaults(),{silent:!0}),this.view.toggleAll=function(e){var t=e.target.checked?"add":"remove";this.trigger("toggle-all",t)},_.extend(this.view.events,{"click input#select-all-docs":"toggleAll"}),this.view.resultsWidget=!0,this.view.delegateEvents(),this.listenTo(this.collection,"reset",this.checkDetails),this.listenTo(this.view,"toggle-all",this.triggerBulkAction);var n=t.prototype.defaultQueryArguments.fl.split(","),i=this.defaultQueryArguments.fl.split(",");i=_.union(n,i),this.defaultQueryArguments.fl=i.join(","),this.minAuthorsPerResult=3,this.model.on("change:makeSpace",_.bind(this.onMakeSpace,this))},defaultQueryArguments:{hl:"true","hl.fl":"title,abstract,body,ack","hl.maxAnalyzedChars":"150000","hl.requireFieldMatch":"true","hl.usePhraseHighlighter":"true",fl:"title,abstract,bibcode,author,keyword,id,links_data,property,esources,data,citation_count,[citations],pub,aff,email,volume,pubdate,doi,doctype",rows:25,start:0},activate:function(t){e.prototype.activate.apply(this,[].slice.apply(arguments));var n=t.getService("PubSub");_.bindAll(this,"dispatchRequest","processResponse","onUserAnnouncement","onStoragePaperUpdate","onCustomEvent","onStartSearch"),n.subscribe(n.INVITING_REQUEST,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),n.subscribe(n.USER_ANNOUNCEMENT,this.onUserAnnouncement),n.subscribe(n.STORAGE_PAPER_UPDATE,this.onStoragePaperUpdate),n.subscribe(n.CUSTOM_EVENT,this.onCustomEvent),n.subscribe(n.START_SEARCH,this.onStartSearch)},_clearResults:function(){this.hiddenCollection.reset(),this.view.collection.reset()},onStartSearch:function(e){try{var t=this.getBeeHive(),n=t.getObject("AppStorage"),i=t.getService("HistoryManager"),a=n.getCurrentQuery().toJSON(),r=e.toJSON(),s=i.getCurrentNav()}catch(e){return}if(_.isEqual(a,r)){if(_.isArray(s)&&"ShowAbstract"===s[0]){clearInterval(this.focusInterval);var o=setInterval(function(){var e=$('a[href$="'+s[1].href+'"]');e&&(clearInterval(o),$("#app-container").animate({scrollTop:e.offset().top},"fast"))},100);setTimeout(function(){clearInterval(o)},1e4),this.focusInterval=o}}else this._clearResults()},onMakeSpace:function(){var e=this.getPubSub(),t=this.model.get("makeSpace")?"MAKE_SPACE":"UNMAKE_SPACE";e.publish(e.FEEDBACK,new c({code:c.CODES[t]}))},onUserAnnouncement:function(e,t){if("user_info_change"==e&&_.has(t,"isOrcidModeOn")){var n=this.hiddenCollection.toJSON(),i=_.map(n,function(e){return delete e.orcid,e});t.isOrcidModeOn&&this.addOrcidInfo(i),this.hiddenCollection.reset(i),this.view.collection.reset(this.hiddenCollection.getVisibleModels())}this.updateMinAuthorsFromUserData(),this.updateSidebarsFromUserData()},onCustomEvent:function(e){if("add-all-on-page"==e){var t=this.collection.pluck("bibcode"),n=this.getPubSub();n.publish(n.BULK_PAPER_SELECTION,t)}},dispatchRequest:function(t){this.reset(),this.setCurrentQuery(t),e.prototype.dispatchRequest.call(this,t)},customizeQuery:function(e){var t=e.clone();t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t));var n=t.get("q")[0];return n.match(/\W\*\W/)||t.set("hl.q",n),t},checkDetails:function(){for(var e=!1,t=0;t<this.collection.models.length;t++){if(this.collection.models[t].attributes.highlights){e=!0;break}}e?this.model.set("showHighlights","open"):this.model.set("showHighlights",!1)},getUserData:function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");return _.isPlainObject(t)?_.isFunction(t.getUserData)&&t.getUserData("USER_DATA"):{}}catch(e){return{}}},updateMinAuthorsFromUserData:function(){var e=this.getUserData(),t=_.has(e,"minAuthorsPerResult")?e.minAuthorsPerResult:this.minAuthorsPerResult;"ALL"===String(t).toUpperCase()?this.minAuthorsPerResult=Number.MAX_SAFE_INTEGER:"NONE"===String(t).toUpperCase()?this.minAuthorsPerResult=0:this.minAuthorsPerResult=Number(t)},updateSidebarsFromUserData:_.debounce(function(){var e=this.getUserData(),t=this.model.get("makeSpace")?"HIDE":"SHOW",n=(_.has(e,"defaultHideSidebars")?e.defaultHideSidebars:t).toUpperCase();t!==n&&(this.model.set("makeSpace","HIDE"===n),this.model.trigger("change:makeSpace"))},300),processDocs:function(e,t,i){var a=e.get("responseHeader.params").start||0,r=(t=n.addPaginationToDocs(t,a),e.has("highlighting")?e.get("highlighting"):{}),s=this,o=this.getBeeHive().getObject("User").getUserData("USER_DATA").link_server;this.updateMinAuthorsFromUserData(),this.updateSidebarsFromUserData();var l=null;this.hasBeeHive()&&this.getBeeHive().hasObject("AppStorage")&&(l=this.getBeeHive().getObject("AppStorage")),this.getBeeHive().getObject("DocStashController").stashDocs(t),t=_.map(t,function(e){e.link_server=o,e.identifier=e.bibcode,e.encodedIdentifier=_.isUndefined(e.identifier)?e.identifier:encodeURIComponent(e.identifier);var t,n,i={};_.keys(r).length&&(t=r[e.id],n=[],_.each(_.pairs(t),function(e){n=n.concat(e[1])}),i=1===n.length&&""===n[0].trim()?{}:{highlights:n});var a,c=s.minAuthorsPerResult;if(e.author&&e.author.length>c?(e.extraAuthors=e.author.length-c,a=e.author.slice(0,c)):e.author&&(a=e.author),e.author){var u=function(e,t,n){var i=n.length-1;return t===i||0===i?e:e+";"};e.authorFormatted=_.map(a,u),e.allAuthorFormatted=_.map(e.author,u)}return i.highlights&&i.highlights.length>0&&(e.highlights=i.highlights),e.formattedDate=e.pubdate?s.formatDate(e.pubdate,{format:"yy/mm",missing:{day:"yy/mm",month:"yy"}}):void 0,e.shortAbstract=e.abstract?s.shortenAbstract(e.abstract):void 0,l&&l.isPaperSelected(e.identifier)&&(e.chosen=!0),e});try{t=this.parseLinksData(t)}catch(e){}return t},onStoragePaperUpdate:function(){var e;this.hasBeeHive()&&this.getBeeHive().hasObject("AppStorage")?(e=this.getBeeHive().getObject("AppStorage"),this.collection.each(function(t){e.isPaperSelected(t.get("identifier"))?t.set("chosen",!0):t.set("chosen",!1)}),this.hiddenCollection.each(function(t){e.isPaperSelected(t.get("identifier"))?t.set("chosen",!0):t.set("chosen",!1)}),0==this.collection.where({chosen:!0}).length&&(this.view.$("input#select-all-docs")[0].checked=!1)):console.warn("AppStorage object disapperared!")},triggerBulkAction:function(e){var t=this.collection.pluck("bibcode");this.getPubSub().publish(this.getPubSub().BULK_PAPER_SELECTION,t,e)}});return _.extend(u.prototype,i),_.extend(u.prototype,a),_.extend(u.prototype,s,l.BeeHive),o(u)}),define("hbs!js/widgets/query_info/query_info_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'        &nbsp;&nbsp;<button class="btn btn-xs btn-default clear-selected"> <i class="fa fa-times"></i> clear all</button>\n'},3:function(e,t,n,i,a,r){var s,o;return'<div class="s-library-area">\n    <div class="s-library-add-title library-add-title"  type="button" data-toggle="collapse" data-target="#library-console" aria-expanded="false" aria-controls="collapseExample">\n        <i class="fa fa-book fa-lg"></i> Add papers to library &nbsp; <i class="fa fa-lg fa-caret-down"></i>\n    </div>\n    <div class="collapse '+(null!=(s=t.if.call(e,null!=e?e.libraryDrawerOpen:e,{name:"if",hash:{},fn:this.program(4,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'" id="library-console">\n\n'+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selected:e,0,{name:"compare",hash:{operator:">"},fn:this.program(6,i,0,a,r),inverse:this.program(9,i,0,a,r),data:i}))?s:"")+'\n\n        <div class="libraries-container">\n\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(11,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'\n            <label for="#create-new">create a new library </label>\n            <input id="create-new"\n                   class="form-control input-sm new-library-name s-display-inline"\n                   type="text"\n                   name="new-library-name"\n                   placeholder="New Library Name"\n                   value="'+this.escapeExpression("function"==typeof(o=null!=(o=t.newLibraryName||(null!=e?e.newLibraryName:e))?o:t.helperMissing)?o.call(e,{name:"newLibraryName",hash:{},data:i}):o)+'"\n                   style="max-width:166px;margin-bottom:10px;"/>\n            <button class="btn btn-sm btn-success submit-create-library"></i>submit</button>\n\n        </div>\n\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(15,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'\n        <div style="margin-top:6px" class="feedback s-feedback">\n\n'+(null!=(s=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(17,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n\n        </div>\n\n    </div>\n\n\n    \x3c!--end 'library area' if user is signed in--\x3e\n</div>\n"},4:function(e,t,n,i){return" in "},6:function(e,t,n,i){var a;return'        add\n        <select class="form-control input-sm s-all-vs-selected" name="all-vs-selected" id="all-vs-selected">\n            <option value="selected" '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedVsAll:e,"selected",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'> selected papers only </option>\n            <option value="all"  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedVsAll:e,"all",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+"> all results</option>\n        </select>\n"},7:function(e,t,n,i){return' selected="true"'},9:function(e,t,n,i){return'        add  <b>all results</b> <i class="icon-help" data-toggle="popover" data-content="All papers in your search results will be added, up to 1,000 records. To add only selected papers, click on the checkboxes next to the paper titles."></i>\n        from this query\n'},11:function(e,t,n,i,a,r){var s;return'            <div style="margin-top: 8px" class="">\n                <label for="#library-select">to an <b>existing library:</b></label>\n                <select id="library-select" name="library-select" class="form-control input-sm s-library-select">\n'+(null!=(s=t.each.call(e,null!=e?e.libraries:e,{name:"each",hash:{},fn:this.program(12,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'                </select>\n                <button class="btn btn-sm btn-success submit-add-to-library">submit</button>\n            </div>\n            <div style="margin:10px 0 4px 0">\n                OR\n            </div>\n'},12:function(e,t,n,i,a,r){var s;return'                    <option value="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.id:e,null!=r[1]?r[1].selectedLibrary:r[1],{name:"compare",hash:{},fn:this.program(13,i,0,a,r),inverse:this.noop,data:i}))?s:"")+">"+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</option>\n"},13:function(e,t,n,i){return' selected="true" '},15:function(e,t,n,i){return'          <div style="margin-top:10px">\n            <a href="#user/libraries">Go to my libraries</a>\n          </div>\n\n'},17:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.success:a,{name:"if",hash:{},fn:this.program(18,i,0),inverse:this.program(24,i,0),data:i}))?a:"")+"\n"},18:function(e,t,n,i){var a;return'\n              <div class="alert alert-success alert-dismissable" role="alert">\n                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.create:a,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.program(21,i,0),data:i}))?a:"")+"              </div>\n\n"},19:function(e,t,n,i){var a;return'                  <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.id:a,e))+'"> Library <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b></a> was successfully created and "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+" new records were added.\n"},21:function(e,t,n,i){var a;return"                  "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+' new records were added to  <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.id:a,e))+'"> library <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b></a>.\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.numAlreadyInLib:a,{name:"if",hash:{},fn:this.program(22,i,0),inverse:this.noop,data:i}))?a:"")},22:function(e,t,n,i){var a;return"                  ("+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numAlreadyInLib:a,e))+" were already in the library).\n"},24:function(e,t,n,i){var a;return'\n              <div class="alert alert-danger alert-dismissable" role="alert">\n                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.create:a,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.program(27,i,0),data:i}))?a:"")+"              </div>\n\n"},25:function(e,t,n,i){var a;return"                  <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b> was not created, error occured.\n                  <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n"},27:function(e,t,n,i){var a;return"                  Records were not added to <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>, error occurred.\n                  <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s,o;return'<div class="s-right-col-widget-container">\n    <div class="currently-selected">\n        <b>'+this.escapeExpression("function"==typeof(o=null!=(o=t.selected||(null!=e?e.selected:e))?o:t.helperMissing)?o.call(e,{name:"selected",hash:{},data:i}):o)+'</b> <span class="s-light-font">selected</span>\n'+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selected:e,0,{name:"compare",hash:{operator:">"},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"    </div>\n</div>\n\n"+(null!=(s=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(3,i,0,a,r),inverse:this.noop,data:i}))?s:"")},useData:!0,useDepths:!0});return t.registerPartial("js/widgets/query_info/query_info_template",n),n}),define("js/widgets/query_info/query_info_widget",["marionette","backbone","underscore","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/query_info/query_info_template","js/mixins/formatter","bootstrap","js/components/api_feedback"],function(e,t,n,i,a,r,s,o,l,c){var u=t.Model.extend({defaults:{selected:0,libraryDrawerOpen:!1,libraries:[],loggedIn:!1,feedback:void 0,newLibraryName:void 0,selectedLibrary:void 0}}),d=e.ItemView.extend({className:"query-info-widget s-query-info-widget",template:s,serializeData:function(){var e=this.model.toJSON();return e.selected=this.formatNum(e.selected),e},modelEvents:{"change:selected":"render","change:loggedIn":"render","change:libraries":"render","change:feedback":"render"},triggers:{"click .clear-selected":"clear-selected"},events:{"change #all-vs-selected":"recordAllVsSelected","change #library-select":"recordLibrarySelection","keyup .new-library-name":"recordNewLibraryName","click .library-add-title":"toggleLibraryDrawer","click .submit-add-to-library":"libraryAdd","click .submit-create-library":"libraryCreate"},recordLibrarySelection:function(e){this.model.set("selectedLibrary",$(e.currentTarget).val())},recordNewLibraryName:function(e){this.model.set("newLibraryName",$(e.currentTarget).val())},recordAllVsSelected:function(e){this.model.set("selectedVsAll",$(e.currentTarget).val())},libraryAdd:function(){this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse"></i>');var e={};e.libraryID=this.$("#library-select").val(),this.model.get("selected")?e.recordsToAdd=this.$("#all-vs-selected").val():e.recordsToAdd="all",this.trigger("library-add",e)},libraryCreate:function(){this.$(".submit-create-library").html('<i class="fa fa-spinner fa-pulse"></i>');var e={};this.model.get("selected")?e.recordsToAdd=this.$("#all-vs-selected").val():e.recordsToAdd="all",e.name=this.model.get("newLibraryName")||"",e.name=e.name.trim(),this.trigger("library-create",e)},toggleLibraryDrawer:function(){this.model.set("libraryDrawerOpen",!this.model.get("libraryDrawerOpen"),{silent:!0})},onRender:function(){this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0})}});return n.extend(d.prototype,o),r.extend({modelConstructor:u,viewConstructor:d,initialize:function(e){e=e||{},this.model=new u,this.view=new d({model:this.model,template:e.template}),r.prototype.initialize.call(this,e)},viewEvents:{"clear-selected":"clearSelected","library-add":"libraryAddSubmit","library-create":"libraryCreateSubmit"},activate:function(e){this.setBeeHive(e),n.bindAll(this);var t=this,i=this.getPubSub();if(i.subscribe(i.STORAGE_PAPER_UPDATE,this.onStoragePaperChange),i.subscribe(i.LIBRARY_CHANGE,this.processLibraryInfo),i.subscribe(i.USER_ANNOUNCEMENT,this.handleUserAnnouncement),this.getBeeHive().getObject("User").isLoggedIn()){this.model.set("loggedIn",!0);this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.processLibraryInfo(e)})}},handleUserAnnouncement:function(e,t){var n=this.getBeeHive().getObject("User");e==n.USER_SIGNED_IN?this.model.set("loggedIn",!0):e==n.USER_SIGNED_OUT&&this.model.set("loggedIn",!1)},onStoragePaperChange:function(e){this.model.set("selected",e)},processLibraryInfo:function(e){e.sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}),this.model.set("libraries",e)},clearSelected:function(){this.getBeeHive().getObject("AppStorage").clearSelectedPapers()},libraryAddSubmit:function(e){var t={},i=this;t.library=e.libraryID,this.abstractPage?t.bibcodes=[this._bibcode]:t.bibcodes=e.recordsToAdd;var a=n.findWhere(this.model.get("libraries"),{id:e.libraryID}).name;this.getBeeHive().getObject("LibraryController").addBibcodesToLib(t).done(function(t,n){var r=t.numBibcodesRequested-parseInt(t.number_added);i.model.set("feedback",{success:!0,name:a,id:e.libraryID,numRecords:t.number_added,numAlreadyInLib:r})}).fail(function(t){i.model.set("feedback",{success:!1,name:a,id:e.libraryID,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},libraryCreateSubmit:function(e){var t={},n=this;this.abstractPage?t.bibcodes=[this._bibcode]:t.bibcodes=e.recordsToAdd,t.name=e.name,this.getBeeHive().getObject("LibraryController").createLibAndAddBibcodes(t).done(function(t,i){n.model.set("newLibraryName",void 0),n.model.set("feedback",{create:!0,success:!0,name:e.name,id:t.id,numRecords:t.bibcode.length})}).fail(function(t){n.model.set("feedback",{success:!1,name:e.name,create:!0,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},clearFeedbackWithDelay:function(){var e=this;setTimeout(function(){e.model.unset("feedback")},3e4)},processResponse:function(e){var t=e.getApiQuery(),i=[];n.each(t.keys(),function(e){"fq"==e.substring(0,2)&&n.each(t.get(e),function(e){-1==e.indexOf("{!")&&i.push(e)})}),this.view.model.set("fq",i)}})}),define("hbs!js/widgets/api_query/templates/widget-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div id="api-query" class="well well-small">\n    <h5>Query Inspection</h5>\n    <form>\n        <input type="text" placeholder="Copy&Paste serialized query here" id="api-query-input" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.initialValue||(null!=e?e.initialValue:e))?a:t.helperMissing)?a.call(e,{name:"initialValue",hash:{},data:i}):a)+'"/>\n        <button id="api-query-load">Load</button>\n        <button id="api-query-add">Add</button>\n        <button id="api-query-run">Run</button>\n\n    <table id="api-query-values">\n\n    </table>\n\n    Result: <pre id="api-query-result"></pre>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/api_query/templates/widget-view",n),n}),define("hbs!js/widgets/api_query/templates/item-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<td class="key"><input type="text" name="key" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.key||(null!=e?e.key:e))?a:t.helperMissing)?a.call(e,{name:"key",hash:{},data:i}):a)+'"/></td>\n<td class="value"><input type="text" name="value" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.value||(null!=e?e.value:e))?a:t.helperMissing)?a.call(e,{name:"value",hash:{},data:i}):a)+'"/></td>\n<td> <a class="remove">remove</a></td>'},useData:!0});return t.registerPartial("js/widgets/api_query/templates/item-view",n),n}),define("js/widgets/api_query/widget",["underscore","jquery","backbone","marionette","js/components/api_query","js/components/pubsub_events","hbs!js/widgets/api_query/templates/widget-view","hbs!js/widgets/api_query/templates/item-view","js/mixins/dependon"],function(e,t,n,i,a,r,s,o,l){var c=n.Model.extend({}),u=n.Collection.extend({model:c}),d=i.ItemView.extend({tagName:"tr",template:o,events:{"click .remove":"removeItem","blur input[name=key]":"onChange","blur input[name=value]":"onChange"},onChange:function(n){var i=t(n.target),a=e.clone(this.model.attributes),r=t(n.target).val();"key"==i.attr("name")&&a.key!=r?this.trigger("key-changed",this.model,r):"value"==i.attr("name")&&a.value!=r&&this.trigger("value-changed",this.model,r)},removeItem:function(e){e.preventDefault(),this.trigger("remove-clicked",this.model)}}),h=i.CompositeView.extend({template:s,childView:d,childViewContainer:"#api-query-values",events:{"click button#api-query-load":"loadApiQuery","click button#api-query-add":"addNewItem","click button#api-query-run":"runApiQuery","submit form":"loadApiQuery"},addNewItem:function(e){e&&e.preventDefault(),this.trigger("add-new-item",this)},loadApiQuery:function(t){t&&t.preventDefault();var n=this.$el.find("input#api-query-input").val();n&&e.isString(n)&&n.trim().length>0&&this.trigger("load-api-query",n)},runApiQuery:function(t){t&&t.preventDefault();var n=new a;e.map(this.collection.models,function(e){var t=e.attributes;t.key&&n.set(t.key,t.value.split("|"))}),this.$el.find("#api-query-result").text(n.url()),this.trigger("run-api-query",n)},updateInputBox:function(e){this.$el.find("input#api-query-input").val(e)},removeKey:function(e){this.trigger("remove-key",e)}}),p=i.Controller.extend({initialize:function(e){return e&&e instanceof a||(e=new a),this.collection=new u(this.getData(e)),this.view=new h({collection:this.collection,model:new c({initialValue:e.url()||"q=planet"})}),this.listenTo(this.view,"all",this.onAll),this},render:function(){return this.view.render(),this.view},onLoad:function(e){this.collection?this.collection.reset(this.getData(e)):this.initialize(e)},onAll:function(){var e=arguments[0];"childview:remove-clicked"==e?arguments[2].destroy():"childview:key-changed"==e?arguments[2].set("key",arguments[3]):"childview:value-changed"==e?arguments[2].set("value",arguments[3]):"add-new-item"==e?arguments[1].collection.add({key:"",value:""}):"load-api-query"==e?this.onLoad(arguments[1]):"run-api-query"==e&&(this.view.updateInputBox(arguments[1].url()),this.onRun(arguments[1]))},getData:function(t){if(!t)throw Error("Wrong input!");return e.isString(t)&&(t=(new a).load(t)),e.map(t.pairs(),function(e){return{key:e[0],value:e[1].join("|")}})},activate:function(t){this.setBeeHive(t),this.getPubSub().subscribe("all",e.bind(this.onAllPubSub,this))},onAllPubSub:function(){var e=arguments[0];e!=r.START_SEARCH&&e!=r.INVITING_REQUEST||(console.log("[debug:ApiQueryWidget]",arguments[0]),this.view.updateInputBox(arguments[1].url()))},onRun:function(e){this.hasPubSub()&&this.getPubSub().publish(this.getPubSub().START_SEARCH,e)}});return e.extend(p.prototype,l.BeeHive),p}),define("es6!js/widgets/export/actions/index",["underscore","jquery","js/components/api_query","js/components/api_targets","filesaver"],function(e,t,n,i){var a={SET_TAB:"SET_TAB",SET_QUERY:"SET_QUERY",SET_FORMAT:"SET_FORMAT",SET_FORMATS:"SET_FORMATS",SET_CUSTOM_FORMAT:"SET_CUSTOM_FORMAT",SET_PROGRESS:"SET_PROGRESS",SET_COUNT:"SET_COUNT",SET_IGNORE:"SET_IGNORE",SET_HAS_ERROR:"SET_HAS_ERROR",SET_ERROR_MSG:"SET_ERROR_MSG",SET_MAX_COUNT:"SET_MAX_COUNT",SET_TOTAL_RECS:"SET_TOTAL_RECS",SET_SHOW_CLOSER:"SET_SHOW_CLOSER",SET_PAGE:"SET_PAGE",SET_BATCH_SIZE:"SET_BATCH_SIZE",TAKE_SNAPSHOT:"TAKE_SNAPSHOT",RESET:"RESET",HARD_RESET:"HARD_RESET",REQUEST_IDS:"REQUEST_IDS",RECEIVE_IDS:"RECEIVE_IDS",REQUEST_EXPORT:"REQUEST_EXPORT",RECEIVE_EXPORT:"RECEIVE_EXPORT",REQUEST_FAILED:"REQUEST_FAILED",REQUEST_CANCELLED:"REQUEST_CANCELLED",SET_ORIGIN:"SET_ORIGIN",setTab:function(e){return{type:a.SET_TAB,tab:e}},setFormat:function(e){return{type:a.SET_FORMAT,format:e}},setFormats:function(e){return{type:a.SET_FORMATS,formats:e}},setCustomFormat:function(e){return{type:a.SET_CUSTOM_FORMAT,format:e}},setProgress:function(e){return{type:a.SET_PROGRESS,progress:e}},setTotalRecs:function(e){return{type:a.SET_TOTAL_RECS,totalRecs:e}},setShowCloser:function(e){return{type:a.SET_SHOW_CLOSER,showCloser:e}},requestIds:function(){return{type:a.REQUEST_IDS}},receiveIds:function(e){return{type:a.RECEIVE_IDS,ids:e}},requestExport:function(){return{type:a.REQUEST_EXPORT}},receiveExport:function(e){return{type:a.RECEIVE_EXPORT,exports:e}},setBatchSize:function(e){return{type:a.SET_BATCH_SIZE,batchSize:e}},setQuery:function(e){return{type:a.SET_QUERY,query:e}},setCount:function(e){return{type:a.SET_COUNT,count:e}},setMaxCount:function(e){return{type:a.SET_MAX_COUNT,maxCount:e}},cancelRequest:function(){return{type:a.REQUEST_CANCELLED}},setIgnore:function(e){return{type:a.SET_IGNORE,ignore:e}},setHasError:function(e){return{type:a.SET_HAS_ERROR,hasError:e}},setErrorMsg:function(e){return{type:a.SET_ERROR_MSG,errorMsg:e}},setPage:function(e){return{type:a.SET_PAGE,page:e}},reset:function(){return{type:a.RESET}},hardReset:function(){return{type:a.HARD_RESET}},setOrigin:function(e){return{type:a.SET_ORIGIN,origin:e}},requestFailed:function(){return function(e){e((0,a.setHasError)(!0)),e({type:"REQUEST_FAILED"})}},findAndSetFormat:function(t){return function(n,i){var r=i().formats,s=e.find(r,{value:t});n(a.setFormat(s||r[0]))}},fetchUsingQuery:function(){return function(t,i,r){var s=i(),o=s.exports,l=s.main,c=r.composeRequest,u=a.requestIds,d=a.receiveIds,h=a.requestFailed,p=a.setTotalRecs,f=a.setHasError,g=new n(l.query);g.set({rows:o.count<o.batchSize?o.count:o.batchSize,fl:"bibcode",start:o.maxCount-o.batchSize}),t(f(!1)),t(u());var m=c(g),b=r._executeApiRequest(m);return b.then(function(n){var i=e.map(n.get("response.docs"),"bibcode");t(d(i)),t(p(n.get("response.numFound")))}),b.fail(function(){return t(h.apply(void 0,arguments))}),b}},fetchUsingIds:function(){return function(r,s,o){var l=a.requestExport,c=a.receiveExport,u=a.requestFailed,d=a.setIgnore,h=a.setHasError,p=o.composeRequest,f=s(),g=f.format,m=f.exports;r(h(!1)),r(l());var b=m.count<m.batchSize?m.count:m.batchSize,v=e.take(m.ids,b),y=new n;if(y.set("bibcode",v),"custom"===g.value&&m.customFormatString.length>0)y.set("format",m.customFormatString);else if("custom"===g.value&&m.customFormatString.length<=0)return t.Deferred().resolve().promise().then(function(){r(c(""))});var _=p(y);return _.set({target:i.EXPORT+g.value,options:{type:"POST",contentType:"application/json"}}),o._executeApiRequest(_).done(function(e){m.ignore||r(c(e.get("export"))),r(d(!1))}).fail(function(){return r(u.apply(void 0,arguments))})}},getNextBatch:function(){return function(e,t){var n=a.setMaxCount,i=a.setBatchSize,r=a.setCount,s=a.fetchUsingQuery,o=a.fetchUsingIds,l=t().exports,c=l.maxCount+l.batchSize;if(c>l.totalRecs){var u=l.totalRecs-l.maxCount,d=l.count<u?l.count:u;c=l.maxCount+u,e(i(u)),e(r(d))}e(n(c)),e(s()).done(function(){return e(o())})}},takeSnapshot:function(t){return function(t,n){var i=e.omit(n().exports,"snapshot");t({type:a.TAKE_SNAPSHOT,snapshot:i})}},closeComponent:function(){return function(e,t,n){e(a.hardReset()),n.closeWidget()}},downloadFile:function(){return function(e,t){var n=t(),i=new Blob([n.exports.output],{type:"text/plain;charset=utf-8"});saveAs(i,"export-"+n.format.value+"."+n.format.ext)}}};return a});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}define("es6!js/widgets/export/reducers/index",["underscore","js/components/api_targets","es6!../actions/index","js/widgets/config","redux"],function(e,t,n,i,a){var r=n.SET_QUERY,s=n.SET_FORMAT,o=n.SET_FORMATS,l=n.SET_CUSTOM_FORMAT,c=n.SET_PROGRESS,u=n.SET_COUNT,d=n.SET_PAGE,h=n.SET_IGNORE,p=n.SET_HAS_ERROR,f=n.SET_SHOW_CLOSER,g=n.SET_ERROR_MSG,m=n.SET_MAX_COUNT,b=n.SET_TOTAL_RECS,v=n.SET_BATCH_SIZE,y=n.REQUEST_IDS,_=n.RECEIVE_IDS,w=n.REQUEST_EXPORT,S=n.RECEIVE_EXPORT,E=n.REQUEST_FAILED,x=n.REQUEST_CANCELLED,A=n.TAKE_SNAPSHOT,P=n.SET_ORIGIN,C=n.RESET,k=n.HARD_RESET,R=e.map(i.export.formats,function(t,n){return e.extend(t,{id:String(n)})}),O=a.combineReducers({format:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{label:"BibTeX",value:"bibtex",id:"0"},t=arguments[1];switch(t.type){case s:return t.format;default:return e}},formats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments[1];switch(t.type){case o:return t.formats;default:return e}},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hasError:!1,errorMsg:"Sorry, something happened during the request. Please try again"},t=arguments[1];switch(t.type){case p:return _extends({},e,{hasError:t.hasError});case g:return _extends({},e,{errorMsg:t.errorMsg});default:return e}},exports:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!1,output:"",progress:0,ids:[],count:0,page:0,maxCount:t._limits.ExportWidget.default,batchSize:t._limits.ExportWidget.default,ignore:!1,totalRecs:0,customFormatString:"",snapshot:{}},n=arguments[1];switch(n.type){case y:return _extends({},e,{isFetching:!0,progress:0});case _:return _extends({},e,{isFetching:!1,progress:100,ids:n.ids});case b:return _extends({},e,{totalRecs:n.totalRecs});case w:return _extends({},e,{isFetching:!0,progress:0});case l:return _extends({},e,{customFormatString:n.format});case S:return _extends({},e,{isFetching:!1,progress:100,output:n.exports,ignore:!1});case E:return _extends({},e,{isFetching:!1,progress:0});case x:return _extends({},e,{ignore:!0,isFetching:!1,progress:0,output:""});case h:return _extends({},e,{ignore:n.ignore});case c:return _extends({},e,{progress:n.progress});case v:return _extends({},e,{batchSize:n.batchSize});case u:return _extends({},e,{count:n.count>e.maxCount?e.maxCount:n.count});case m:return _extends({},e,{maxCount:n.maxCount>e.totalRecs?e.totalRecs:n.maxCount});case d:return _extends({},e,{page:n.page});case A:return _extends({},e,{snapshot:n.snapshot});case C:return _extends({},e.snapshot,{output:"",snapshot:e.snapshot});default:return e}},main:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{query:{},showCloser:!0,showSlider:!0,origin:"results-page",showReset:!0,splitCols:!0,autoSubmit:!1},t=arguments[1];switch(t.type){case f:return _extends({},e,{showCloser:t.showCloser});case r:return _extends({},e,{query:t.query});case P:return _extends({},e,{showCloser:"results-page"===t.origin,showSlider:"results-page"===t.origin,splitCols:"results-page"===t.origin,showReset:"results-page"===t.origin,autoSubmit:"results-page"!==t.origin,origin:t.origin});default:return e}}});return function(e,t){return t.type===k&&(e=void 0),O(e,t)}}),define("es6!js/widgets/export/components/Closer.jsx",["react","react-prop-types"],function(e,t){var n=function(t){var n=t.onClick,i=function(e){e.preventDefault(),n()};return e.createElement("a",{href:"#",className:"pull-right",onClick:function(e){return i(e)}},e.createElement("i",{className:"fa fa-times fa-2x"}))};return n.propTypes={onClick:t.func.isRequired},n}),define("es6!js/widgets/export/components/Setup.jsx",["react","react-prop-types"],function(e,t){var n=function(t){var n=t.onApply,i=t.setFormat,a=t.disabled,r=t.onCancel,s=t.batchSize,o=t.hasMore,l=t.onReset,c=t.format,u=t.formats,d=t.count,h=t.setCount,p=(t.maxCount,t.onGetNext),f=t.totalRecs,g=t.showSlider,m=t.showReset,b=t.remaining,v=t.autoSubmit,y=t.customFormat,_=t.onCustomFormatChange;return e.createElement("div",null,e.createElement("div",{className:"row"},e.createElement("div",{className:"col-sm-10"},e.createElement("label",{htmlFor:"ex-dropdown"},"Select Export Format"),e.createElement("select",{className:"form-control",autoFocus:"true",id:"ex-dropdown",value:c.id,onChange:function(e){return i(e.target.value)},disabled:a},u.map(function(t){return e.createElement("option",{key:t.id,value:t.id,title:t.help},t.label)}))),a&&e.createElement("div",{className:"col-sm-2"},e.createElement("div",{className:"export-loading-icon fa fa-spinner fa-spin fa-2x"}))),"custom"===c.value&&e.createElement("div",{className:"row"},e.createElement("div",{className:"col-sm-10"},e.createElement("label",{htmlFor:"ex-custom-input"},"Enter Custom Format",e.createElement("span",{style:{marginLeft:5}},e.createElement("a",{title:"Get Help With ADS Custom Format Syntax",target:"_blank",rel:"noopener",href:"https://adsabs.github.io/help/actions/export"},e.createElement("i",{className:"fa fa-info-circle fa-invert"})))),e.createElement("input",{type:"text",className:"form-control",value:y,onChange:function(e){return _(e.target.value)}}))),g&&e.createElement("div",{className:"row"},e.createElement("div",{className:"col-sm-10"},e.createElement("label",{htmlFor:"ex-range"},"Limit to ",e.createElement("strong",null,d)," ",d>1?"records":"record"),e.createElement("input",{type:"range",id:"ex-range",min:"1",max:f<s?f:s,step:"1",value:d,disabled:a,onChange:function(e){return h(e.target.value)}}))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-sm-12 btn-toolbar"},(!v||"custom"===c.value)&&e.createElement("button",{className:"btn btn-primary",onClick:n,disabled:a},"Apply"),!a&&m&&e.createElement("button",{className:"btn btn-info",onClick:l},"Reset"),!a&&o&&e.createElement("button",{className:"btn btn-link",onClick:p},"Get Next ",b," Record(s)"),a&&(!v||"custom"===c.value)&&e.createElement("button",{className:"btn btn-warning",onClick:r},"Cancel"))))};return n.propTypes={setFormat:t.func.isRequired,format:t.shape({id:t.string,value:t.string,label:t.string}).isRequired,onApply:t.func.isRequired,onCancel:t.func.isRequired,formats:t.arrayOf(t.shape({id:t.string,value:t.string,label:t.string})).isRequired,disabled:t.bool.isRequired,count:t.string.isRequired,setCount:t.func.isRequired,maxCount:t.number.isRequired,onGetNext:t.func.isRequired,totalRecs:t.number.isRequired,onReset:t.func.isRequired,showSlider:t.bool.isRequired,showReset:t.bool.isRequired,autoSubmit:t.bool.isRequired},n}),define("es6!js/widgets/export/components/ClipboardBtn.jsx",["clipboard","react","react-prop-types"],function(e,t,n){var i=function(n){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,n.apply(this,arguments))}return _inherits(i,n),i.prototype.componentWillUnmount=function(){this.clipboard.destroy()},i.prototype.componentDidMount=function(){this.clipboard=new e(this.element),this.clipboard.on("success",this.props.onCopy)},i.prototype.render=function(){var e=this,n=this.props,i=n.disabled,a=n.target;return t.createElement("button",{className:"btn btn-default",disabled:i,ref:function(t){return e.element=t},"data-clipboard-target":a},t.createElement("i",{className:"fa fa-copy fa-fw"}),"Copy to Clipboard")},i}(t.Component);return i.propTypes={disabled:n.bool.isRequired,target:n.string.isRequired,onCopy:n.func.isRequired},i}),define("es6!js/widgets/export/components/Export.jsx",["react","react-prop-types","es6!./ClipboardBtn.jsx"],function(e,t,n){var i=function(t){var i=t.output,a=t.isFetching,r=t.progress,s=t.onDownloadFile,o=t.onCopy;return e.createElement("div",null,e.createElement("div",{className:"row"},e.createElement("div",{className:"form-group"},e.createElement("textarea",{className:"export-textarea form-control",readOnly:"true",value:i,disabled:a}))),a&&e.createElement("div",{className:"progress export-progress"},e.createElement("div",{className:"progress-bar",role:"progressbar","aria-valuenow":r,"aria-valuemin":"0","aria-valuemax":"100",style:{width:r+"%"}},e.createElement("span",{className:"sr-only"},r,"% Complete")),e.createElement("div",{className:"text-center"},"Loading...")),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-sm-12 btn-group"},e.createElement("button",{className:"btn btn-default",disabled:a||_.isEmpty(i),onClick:s},e.createElement("i",{className:"fa fa-download fa-fw"}),"Download to File"),e.createElement(n,{disabled:a||_.isEmpty(i),onCopy:o,target:".export-textarea"}))))};return i.propTypes={output:t.string.isRequired,isFetching:t.bool.isRequired,progress:t.number,onDownloadFile:t.func.isRequired,onCopy:t.func.isRequired},i}),define("es6!js/widgets/export/containers/App.jsx",["underscore","react","react-redux","react-prop-types","es6!../actions/index","es6!../components/Closer.jsx","es6!../components/Setup.jsx","es6!../components/Export.jsx"],function(e,t,n,i,a,r,s,o){var l=a.closeComponent,c=a.setFormat,u=a.getNextBatch,d=a.fetchUsingQuery,h=a.fetchUsingIds,p=a.setCount,f=a.cancelRequest,g=a.reset,m=a.downloadFile,b=function(n){function i(t){_classCallCheck(this,i);var a=_possibleConstructorReturn(this,n.call(this,t));e.bindAll(a,["handleCloseClick","handleApplyClick","handleFormatChange","handleCountChange","handleCancelClick","handleGetNextClick","handleResetClick","handleDownloadFileClick","onCopyText"]);var r=t.dispatch;return a.updateCount=e.debounce(function(e){r(p(parseInt(e)))},500),a.onCustomFormatChange=e.debounce(function(e){r({type:"SET_CUSTOM_FORMAT",format:e})},500),a.state={count:"0",showAlert:!1},a}return _inherits(i,n),i.prototype.handleDownloadFileClick=function(){this.props.dispatch(m())},i.prototype.onCopyText=function(){var t=this;this.setState({showAlert:!0,alertMsg:"Text Copied!"}),e.delay(function(){return t.setState({showAlert:!1})},5e3)},i.prototype.handleCloseClick=function(){this.props.dispatch(l())},i.prototype.handleCancelClick=function(){this.props.dispatch(f())},i.prototype.handleCountChange=function(e){var t=this;this.setState({count:e},function(){return t.updateCount(e)})},i.prototype.handleApplyClick=function(){var t=this.props,n=t.dispatch,i=t.ids,a=t.query;e.isEmpty(a)&&!e.isEmpty(i)?n(h()):n(d()).done(function(){return n(h())})},i.prototype.handleResetClick=function(){this.props.dispatch(g())},i.prototype.handleFormatChange=function(t){var n=this.props,i=n.dispatch,a=n.formats,r=n.autoSubmit,s=e.find(a,{id:t});i(c(s)),r&&"custom"!==s.value&&this.handleApplyClick()},i.prototype.handleGetNextClick=function(){(0,this.props.dispatch)(u())},i.prototype.componentWillReceiveProps=function(e){var t=e.totalRecs-e.maxCount;this.setState({count:""+e.count,hasMore:t>0,remaining:t>e.batchSize?e.batchSize:t})},i.prototype.render=function(){var e=this.props,n=e.format,i=e.formats,a=e.isFetching,l=e.output,c=e.batchSize,u=e.showCloser,d=e.showReset,h=e.progress,p=e.maxCount,f=e.hasError,g=e.errorMsg,m=e.totalRecs,b=e.showSlider,v=e.splitCols,y=e.autoSubmit,_=e.customFormat,w=this.state,S=w.count,E=w.hasMore,x=w.showAlert,A=w.alertMsg,P=w.remaining,C=p-c,k=0===C?1:C,R=Number(S)+C,O=m>1&&b;return t.createElement("div",{className:"container-fluid export-container"},t.createElement("span",null,u&&t.createElement(r,{onClick:this.handleCloseClick}),t.createElement("div",{className:"h4"},"Exporting record(s) ",t.createElement("strong",null,k)," to ",t.createElement("strong",null,R)," ",t.createElement("small",null,"(total: ",m,")"))),t.createElement("div",null,t.createElement("div",{className:v?"col-sm-6":"col-sm-12"},t.createElement(s,{format:n,formats:i,disabled:a,count:S,maxCount:p,totalRecs:m,batchSize:c,hasMore:E,showSlider:O,showReset:d,autoSubmit:y,remaining:P,customFormat:_,onCustomFormatChange:this.onCustomFormatChange,onReset:this.handleResetClick,onApply:this.handleApplyClick,onCancel:this.handleCancelClick,setFormat:this.handleFormatChange,onGetNext:this.handleGetNextClick,setCount:this.handleCountChange}),f&&t.createElement("div",{className:"row"},t.createElement("div",{className:"col-sm-10"},t.createElement("div",{className:"alert alert-danger"},g))),x&&t.createElement("div",{className:"row"},t.createElement("div",{className:"col-sm-10"},t.createElement("div",{className:"alert alert-info"},A)))),t.createElement("div",{className:v?"col-sm-6":"col-sm-12"},t.createElement(o,{output:l,isFetching:a,progress:h,onDownloadFile:this.handleDownloadFileClick,onCopy:this.onCopyText}))))},i}(t.Component);b.propTypes={dispatch:i.func.isRequired,format:i.shape({id:i.string,value:i.string,label:i.string}).isRequired,formats:i.arrayOf(i.shape({id:i.string,value:i.string,label:i.string})).isRequired,isFetching:i.bool.isRequired,output:i.string.isRequired,progress:i.number.isRequired,count:i.number.isRequired,maxCount:i.number.isRequired,hasError:i.bool.isRequired,errorMsg:i.string.isRequired,batchSize:i.number.isRequired,totalRecs:i.number.isRequired,showCloser:i.bool.isRequired,showSlider:i.bool.isRequired,splitCols:i.bool.isRequired,showReset:i.bool.isRequired,autoSubmit:i.bool.isRequired};return n.connect(function(e){return{format:e.format,formats:e.formats,output:e.exports.output,isFetching:e.exports.isFetching,progress:e.exports.progress,count:e.exports.count,maxCount:e.exports.maxCount,hasError:e.error.hasError,errorMsg:e.error.errorMsg,batchSize:e.exports.batchSize,totalRecs:e.exports.totalRecs,customFormat:e.exports.customFormat,showCloser:e.main.showCloser,showSlider:e.main.showSlider,autoSubmit:e.main.autoSubmit,splitCols:e.main.splitCols,showReset:e.main.showReset,ids:e.exports.ids,query:e.main.query}})(b)}),define("hbs!js/widgets/export/templates/classic_submit_form",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <input type="hidden" name="bibcode" value="'+this.escapeExpression(this.lambda(e,e))+'"/>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<form action="http://adsabs.harvard.edu/cgi-bin/nph-abs_connect" target="_blank" rel="noopener" method="post" class="hidden">\n    <input type="hidden" name="nr_to_return" value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.exportLimit||(null!=e?e.exportLimit:e))?r:t.helperMissing)?r.call(e,{name:"exportLimit",hash:{},data:i}):r)+'"/>\n'+(null!=(a=t.each.call(e,null!=e?e.bibcode:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</form>\n"},useData:!0});return t.registerPartial("js/widgets/export/templates/classic_submit_form",n),n}),define("es6!js/widgets/export/widget.jsx",["jquery","underscore","backbone","react","react-dom","redux","react-redux","redux-thunk","js/widgets/base/base_widget","es6!./reducers/index","es6!./actions/index","es6!./containers/App.jsx","js/components/api_query","js/components/api_targets","js/components/api_feedback","hbs!js/widgets/export/templates/classic_submit_form","js/widgets/config"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g,m){var b=n.View.extend({initialize:function(e){t.assign(this,e)},render:function(){return a.render(i.createElement(s.Provider,{store:this.store},i.createElement(d,null)),this.el),this},destroy:function(){a.unmountComponentAtNode(this.el)}});return l.extend({initialize:function(e){this.options=e||{};var t=r.applyMiddleware(o.default.withExtraArgument(this)),n=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||r.compose;this.store=r.createStore(c,n(t)),this.view=new b({store:this.store}),this.defaultFormat="BibTeX"},activate:function(e){this.setBeeHive(e);var n=this.getPubSub(),i=this.store.dispatch,a=u.setQuery;this.activateWidget(),n.subscribe(n.INVITING_REQUEST,function(e){return i(a(e.toJSON()))}),this.attachGeneralHandler(this.onApiFeedback),n.subscribe(n.USER_ANNOUNCEMENT,t.bind(this.getDefaultFormatFromUserData,this))},onApiFeedback:function(e){this.store.dispatch(u.requestFailed(e))},getUserData:function(){try{var e=t.isFunction(this.getBeeHive)&&this.getBeeHive(),n=t.isFunction(e.getObject)&&e.getObject("User");return t.isPlainObject(n)?t.isFunction(n.getUserData)&&n.getUserData("USER_DATA"):{}}catch(e){return{}}},getDefaultFormatFromUserData:function(){var e=this.getUserData(),n=t.has(e,"defaultExportFormat")?e.defaultExportFormat:this.defaultFormat;return t.find(m.export.formats,{label:n}).value},renderWidgetForCurrentQuery:function(e){var t=e.currentQuery,n=e.numFound,i=e.format,a=this.store.dispatch,r=u.fetchUsingQuery,s=u.fetchUsingIds,o=u.findAndSetFormat,l=u.hardReset,c=u.setCount,d=u.setQuery,h=u.setTotalRecs,p=u.takeSnapshot,f=u.setOrigin,g="default"===i||"other"===i?this.getDefaultFormatFromUserData():i;a(l()),a(f(this.componentParams&&this.componentParams.origin)),a(d(t.toJSON())),a(o(i)),a(c(n)),a(h(n)),"other"!==g?(a(p()),a(r()).then(function(){return a(s()).always(function(){return a(p())})})):a(p())},closeWidget:function(){var e=this.getPubSub();e.publish(e.NAVIGATE,"results-page")},_executeApiRequest:function(t){var n=e.Deferred(),i=this.getPubSub();return i.subscribeOnce(i.DELIVERING_RESPONSE,function(e){return n.resolve(e)}),i.publish(i.EXECUTE_REQUEST,t),n.promise()},renderWidgetForListOfBibcodes:function(e,t){var n=this.store.dispatch,i=u.receiveIds,a=u.findAndSetFormat,r=u.fetchUsingIds,s=u.hardReset,o=u.setCount,l=u.setTotalRecs,c=u.takeSnapshot,d=u.setOrigin,h="default"===t.format||"other"===t.format?this.getDefaultFormatFromUserData():t.format;n(s()),n(d(this.componentParams&&this.componentParams.origin)),n(i(e)),n(a(h.toLowerCase())),n(o(e.length)),n(l(e.length)),"other"!==t.format?n(r()).done(function(){return n(c())}):n(c())},processResponse:t.noop,openClassicExports:function(n){if(n.bibcodes){var i=e(g({bibcode:n.bibcodes,exportLimit:p._limits.ExportWidget.limit}));e("body").append(i),i.submit(),i.remove()}else{if(!n.currentQuery)throw new Error("can't export with no bibcodes or query");var a=n.currentQuery.clone();a.set("rows",p._limits.ExportWidget.limit),a.set("fl","bibcode");var r=this.composeRequest(a);this._executeApiRequest(r).done(function(n){var i=t.map(n.get("response.docs"),function(e){return e.bibcode}),a=e(g({bibcode:i,exportLimit:i.length}));e("body").append(a),a.submit(),a.remove()})}n.libid?this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{subView:"library",id:n.libid}):this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")}})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("immutable",t):e.Immutable=t()}(this,function(){"use strict";var e=Array.prototype.slice;function t(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function n(e){return s(e)?e:z(e)}function i(e){return o(e)?e:Q(e)}function a(e){return l(e)?e:W(e)}function r(e){return s(e)&&!c(e)?e:$(e)}function s(e){return!(!e||!e[d])}function o(e){return!(!e||!e[h])}function l(e){return!(!e||!e[p])}function c(e){return o(e)||l(e)}function u(e){return!(!e||!e[f])}t(i,n),t(a,n),t(r,n),n.isIterable=s,n.isKeyed=o,n.isIndexed=l,n.isAssociative=c,n.isOrdered=u,n.Keyed=i,n.Indexed=a,n.Set=r;var d="@@__IMMUTABLE_ITERABLE__@@",h="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",f="@@__IMMUTABLE_ORDERED__@@",g=5,m=1<<g,b=m-1,v={},y={value:!1},_={value:!1};function w(e){return e.value=!1,e}function S(e){e&&(e.value=!0)}function E(){}function x(e,t){t=t||0;for(var n=Math.max(0,e.length-t),i=new Array(n),a=0;a<n;a++)i[a]=e[a+t];return i}function A(e){return void 0===e.size&&(e.size=e.__iterate(C)),e.size}function P(e,t){if("number"!=typeof t){var n=t>>>0;if(""+n!==t||4294967295===n)return NaN;t=n}return t<0?A(e)+t:t}function C(){return!0}function k(e,t,n){return(0===e||void 0!==n&&e<=-n)&&(void 0===t||void 0!==n&&t>=n)}function R(e,t){return T(e,t,0)}function O(e,t){return T(e,t,t)}function T(e,t,n){return void 0===e?n:e<0?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}var I=0,D=1,M=2,j="function"==typeof Symbol&&Symbol.iterator,N="@@iterator",q=j||N;function L(e){this.next=e}function B(e,t,n,i){var a=0===e?t:1===e?n:[t,n];return i?i.value=a:i={value:a,done:!1},i}function F(){return{value:void 0,done:!0}}function J(e){return!!H(e)}function U(e){return e&&"function"==typeof e.next}function V(e){var t=H(e);return t&&t.call(e)}function H(e){var t=e&&(j&&e[j]||e[N]);if("function"==typeof t)return t}function G(e){return e&&"number"==typeof e.length}function z(e){return null===e||void 0===e?re():s(e)?e.toSeq():function(e){var t=le(e)||"object"==typeof e&&new te(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}(e)}function Q(e){return null===e||void 0===e?re().toKeyedSeq():s(e)?o(e)?e.toSeq():e.fromEntrySeq():se(e)}function W(e){return null===e||void 0===e?re():s(e)?o(e)?e.entrySeq():e.toIndexedSeq():oe(e)}function $(e){return(null===e||void 0===e?re():s(e)?o(e)?e.entrySeq():e:oe(e)).toSetSeq()}L.prototype.toString=function(){return"[Iterator]"},L.KEYS=I,L.VALUES=D,L.ENTRIES=M,L.prototype.inspect=L.prototype.toSource=function(){return this.toString()},L.prototype[q]=function(){return this},t(z,n),z.of=function(){return z(arguments)},z.prototype.toSeq=function(){return this},z.prototype.toString=function(){return this.__toString("Seq {","}")},z.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},z.prototype.__iterate=function(e,t){return ce(this,e,t,!0)},z.prototype.__iterator=function(e,t){return ue(this,e,t,!0)},t(Q,z),Q.prototype.toKeyedSeq=function(){return this},t(W,z),W.of=function(){return W(arguments)},W.prototype.toIndexedSeq=function(){return this},W.prototype.toString=function(){return this.__toString("Seq [","]")},W.prototype.__iterate=function(e,t){return ce(this,e,t,!1)},W.prototype.__iterator=function(e,t){return ue(this,e,t,!1)},t($,z),$.of=function(){return $(arguments)},$.prototype.toSetSeq=function(){return this},z.isSeq=ae,z.Keyed=Q,z.Set=$,z.Indexed=W;var K,Y,X,Z="@@__IMMUTABLE_SEQ__@@";function ee(e){this._array=e,this.size=e.length}function te(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function ne(e){this._iterable=e,this.size=e.length||e.size}function ie(e){this._iterator=e,this._iteratorCache=[]}function ae(e){return!(!e||!e[Z])}function re(){return K||(K=new ee([]))}function se(e){var t=Array.isArray(e)?new ee(e).fromEntrySeq():U(e)?new ie(e).fromEntrySeq():J(e)?new ne(e).fromEntrySeq():"object"==typeof e?new te(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function oe(e){var t=le(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function le(e){return G(e)?new ee(e):U(e)?new ie(e):J(e)?new ne(e):void 0}function ce(e,t,n,i){var a=e._cache;if(a){for(var r=a.length-1,s=0;s<=r;s++){var o=a[n?r-s:s];if(!1===t(o[1],i?o[0]:s,e))return s+1}return s}return e.__iterateUncached(t,n)}function ue(e,t,n,i){var a=e._cache;if(a){var r=a.length-1,s=0;return new L(function(){var e=a[n?r-s:s];return s++>r?{value:void 0,done:!0}:B(t,i?e[0]:s-1,e[1])})}return e.__iteratorUncached(t,n)}function de(e,t){return t?function e(t,n,i,a){if(Array.isArray(n))return t.call(a,i,W(n).map(function(i,a){return e(t,i,a,n)}));if(pe(n))return t.call(a,i,Q(n).map(function(i,a){return e(t,i,a,n)}));return n}(t,e,"",{"":e}):he(e)}function he(e){return Array.isArray(e)?W(e).map(he).toList():pe(e)?Q(e).map(he).toMap():e}function pe(e){return e&&(e.constructor===Object||void 0===e.constructor)}function fe(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!("function"!=typeof e.equals||"function"!=typeof t.equals||!e.equals(t))}function ge(e,t){if(e===t)return!0;if(!s(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||o(e)!==o(t)||l(e)!==l(t)||u(e)!==u(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!c(e);if(u(e)){var i=e.entries();return t.every(function(e,t){var a=i.next().value;return a&&fe(a[1],e)&&(n||fe(a[0],t))})&&i.next().done}var a=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{a=!0;var r=e;e=t,t=r}var d=!0,h=t.__iterate(function(t,i){if(n?!e.has(t):a?!fe(t,e.get(i,v)):!fe(e.get(i,v),t))return d=!1,!1});return d&&e.size===h}function me(e,t){if(!(this instanceof me))return new me(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(Y)return Y;Y=this}}function be(e,t){if(!e)throw new Error(t)}function ve(e,t,n){if(!(this instanceof ve))return new ve(e,t,n);if(be(0!==n,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),n=void 0===n?1:Math.abs(n),t<e&&(n=-n),this._start=e,this._end=t,this._step=n,this.size=Math.max(0,Math.ceil((t-e)/n-1)+1),0===this.size){if(X)return X;X=this}}function ye(){throw TypeError("Abstract")}function _e(){}function we(){}function Se(){}z.prototype[Z]=!0,t(ee,W),ee.prototype.get=function(e,t){return this.has(e)?this._array[P(this,e)]:t},ee.prototype.__iterate=function(e,t){for(var n=this._array,i=n.length-1,a=0;a<=i;a++)if(!1===e(n[t?i-a:a],a,this))return a+1;return a},ee.prototype.__iterator=function(e,t){var n=this._array,i=n.length-1,a=0;return new L(function(){return a>i?{value:void 0,done:!0}:B(e,a,n[t?i-a++:a++])})},t(te,Q),te.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},te.prototype.has=function(e){return this._object.hasOwnProperty(e)},te.prototype.__iterate=function(e,t){for(var n=this._object,i=this._keys,a=i.length-1,r=0;r<=a;r++){var s=i[t?a-r:r];if(!1===e(n[s],s,this))return r+1}return r},te.prototype.__iterator=function(e,t){var n=this._object,i=this._keys,a=i.length-1,r=0;return new L(function(){var s=i[t?a-r:r];return r++>a?{value:void 0,done:!0}:B(e,s,n[s])})},te.prototype[f]=!0,t(ne,W),ne.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=V(this._iterable),i=0;if(U(n))for(var a;!(a=n.next()).done&&!1!==e(a.value,i++,this););return i},ne.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=V(this._iterable);if(!U(n))return new L(F);var i=0;return new L(function(){var t=n.next();return t.done?t:B(e,i++,t.value)})},t(ie,W),ie.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var n,i=this._iterator,a=this._iteratorCache,r=0;r<a.length;)if(!1===e(a[r],r++,this))return r;for(;!(n=i.next()).done;){var s=n.value;if(a[r]=s,!1===e(s,r++,this))break}return r},ie.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,i=this._iteratorCache,a=0;return new L(function(){if(a>=i.length){var t=n.next();if(t.done)return t;i[a]=t.value}return B(e,a,i[a++])})},t(me,W),me.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},me.prototype.get=function(e,t){return this.has(e)?this._value:t},me.prototype.includes=function(e){return fe(this._value,e)},me.prototype.slice=function(e,t){var n=this.size;return k(e,t,n)?this:new me(this._value,O(t,n)-R(e,n))},me.prototype.reverse=function(){return this},me.prototype.indexOf=function(e){return fe(this._value,e)?0:-1},me.prototype.lastIndexOf=function(e){return fe(this._value,e)?this.size:-1},me.prototype.__iterate=function(e,t){for(var n=0;n<this.size;n++)if(!1===e(this._value,n,this))return n+1;return n},me.prototype.__iterator=function(e,t){var n=this,i=0;return new L(function(){return i<n.size?B(e,i++,n._value):{value:void 0,done:!0}})},me.prototype.equals=function(e){return e instanceof me?fe(this._value,e._value):ge(e)},t(ve,W),ve.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},ve.prototype.get=function(e,t){return this.has(e)?this._start+P(this,e)*this._step:t},ve.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},ve.prototype.slice=function(e,t){return k(e,t,this.size)?this:(e=R(e,this.size),(t=O(t,this.size))<=e?new ve(0,0):new ve(this.get(e,this._end),this.get(t,this._end),this._step))},ve.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},ve.prototype.lastIndexOf=function(e){return this.indexOf(e)},ve.prototype.__iterate=function(e,t){for(var n=this.size-1,i=this._step,a=t?this._start+n*i:this._start,r=0;r<=n;r++){if(!1===e(a,r,this))return r+1;a+=t?-i:i}return r},ve.prototype.__iterator=function(e,t){var n=this.size-1,i=this._step,a=t?this._start+n*i:this._start,r=0;return new L(function(){var s=a;return a+=t?-i:i,r>n?{value:void 0,done:!0}:B(e,r++,s)})},ve.prototype.equals=function(e){return e instanceof ve?this._start===e._start&&this._end===e._end&&this._step===e._step:ge(this,e)},t(ye,n),t(_e,ye),t(we,ye),t(Se,ye),ye.Keyed=_e,ye.Indexed=we,ye.Set=Se;var Ee="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var n=65535&(e|=0),i=65535&(t|=0);return n*i+((e>>>16)*i+n*(t>>>16)<<16>>>0)|0};function xe(e){return e>>>1&1073741824|3221225471&e}function Ae(e){if(!1===e||null===e||void 0===e)return 0;if("function"==typeof e.valueOf&&(!1===(e=e.valueOf())||null===e||void 0===e))return 0;if(!0===e)return 1;var t=typeof e;if("number"===t){if(e!=e||e===1/0)return 0;var n=0|e;for(n!==e&&(n^=4294967295*e);e>4294967295;)n^=e/=4294967295;return xe(n)}if("string"===t)return e.length>De?function(e){var t=Ne[e];void 0===t&&(t=Pe(e),je===Me&&(je=0,Ne={}),je++,Ne[e]=t);return t}(e):Pe(e);if("function"==typeof e.hashCode)return e.hashCode();if("object"===t)return function(e){var t;if(Oe&&void 0!==(t=Re.get(e)))return t;if(void 0!==(t=e[Ie]))return t;if(!ke){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Ie]))return t;if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}t=++Te,1073741824&Te&&(Te=0);if(Oe)Re.set(e,t);else{if(void 0!==Ce&&!1===Ce(e))throw new Error("Non-extensible objects are not allowed as keys.");if(ke)Object.defineProperty(e,Ie,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Ie]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Ie]=t}}return t}(e);if("function"==typeof e.toString)return Pe(e.toString());throw new Error("Value type "+t+" cannot be hashed.")}function Pe(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return xe(t)}var Ce=Object.isExtensible,ke=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}();var Re,Oe="function"==typeof WeakMap;Oe&&(Re=new WeakMap);var Te=0,Ie="__immutablehash__";"function"==typeof Symbol&&(Ie=Symbol(Ie));var De=16,Me=255,je=0,Ne={};function qe(e){be(e!==1/0,"Cannot perform this action with an infinite size.")}function Le(e){return null===e||void 0===e?Xe():Be(e)&&!u(e)?e:Xe().withMutations(function(t){var n=i(e);qe(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Be(e){return!(!e||!e[Je])}t(Le,_e),Le.of=function(){var t=e.call(arguments,0);return Xe().withMutations(function(e){for(var n=0;n<t.length;n+=2){if(n+1>=t.length)throw new Error("Missing value for key: "+t[n]);e.set(t[n],t[n+1])}})},Le.prototype.toString=function(){return this.__toString("Map {","}")},Le.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Le.prototype.set=function(e,t){return Ze(this,e,t)},Le.prototype.setIn=function(e,t){return this.updateIn(e,v,function(){return t})},Le.prototype.remove=function(e){return Ze(this,e,v)},Le.prototype.deleteIn=function(e){return this.updateIn(e,function(){return v})},Le.prototype.update=function(e,t,n){return 1===arguments.length?e(this):this.updateIn([e],t,n)},Le.prototype.updateIn=function(e,t,n){n||(n=t,t=void 0);var i=function e(t,n,i,a){var r=t===v;var s=n.next();if(s.done){var o=r?i:t,l=a(o);return l===o?t:l}be(r||t&&t.set,"invalid keyPath");var c=s.value;var u=r?v:t.get(c,v);var d=e(u,n,i,a);return d===u?t:d===v?t.remove(c):(r?Xe():t).set(c,d)}(this,nn(e),t,n);return i===v?void 0:i},Le.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Xe()},Le.prototype.merge=function(){return it(this,void 0,arguments)},Le.prototype.mergeWith=function(t){return it(this,t,e.call(arguments,1))},Le.prototype.mergeIn=function(t){var n=e.call(arguments,1);return this.updateIn(t,Xe(),function(e){return"function"==typeof e.merge?e.merge.apply(e,n):n[n.length-1]})},Le.prototype.mergeDeep=function(){return it(this,at,arguments)},Le.prototype.mergeDeepWith=function(t){var n=e.call(arguments,1);return it(this,rt(t),n)},Le.prototype.mergeDeepIn=function(t){var n=e.call(arguments,1);return this.updateIn(t,Xe(),function(e){return"function"==typeof e.mergeDeep?e.mergeDeep.apply(e,n):n[n.length-1]})},Le.prototype.sort=function(e){return Rt(Gt(this,e))},Le.prototype.sortBy=function(e,t){return Rt(Gt(this,t,e))},Le.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Le.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new E)},Le.prototype.asImmutable=function(){return this.__ensureOwner()},Le.prototype.wasAltered=function(){return this.__altered},Le.prototype.__iterator=function(e,t){return new We(this,e,t)},Le.prototype.__iterate=function(e,t){var n=this,i=0;return this._root&&this._root.iterate(function(t){return i++,e(t[1],t[0],n)},t),i},Le.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Ye(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Le.isMap=Be;var Fe,Je="@@__IMMUTABLE_MAP__@@",Ue=Le.prototype;function Ve(e,t){this.ownerID=e,this.entries=t}function He(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}function Ge(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}function ze(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}function Qe(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}function We(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&Ke(e._root)}function $e(e,t){return B(e,t[0],t[1])}function Ke(e,t){return{node:e,index:0,__prev:t}}function Ye(e,t,n,i){var a=Object.create(Ue);return a.size=e,a._root=t,a.__ownerID=n,a.__hash=i,a.__altered=!1,a}function Xe(){return Fe||(Fe=Ye(0))}function Ze(e,t,n){var i,a;if(e._root){var r=w(y),s=w(_);if(i=et(e._root,e.__ownerID,0,void 0,t,n,r,s),!s.value)return e;a=e.size+(r.value?n===v?-1:1:0)}else{if(n===v)return e;a=1,i=new Ve(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=a,e._root=i,e.__hash=void 0,e.__altered=!0,e):i?Ye(a,i):Xe()}function et(e,t,n,i,a,r,s,o){return e?e.update(t,n,i,a,r,s,o):r===v?e:(S(o),S(s),new Qe(t,i,[a,r]))}function tt(e){return e.constructor===Qe||e.constructor===ze}function nt(e,t,n,i,a){if(e.keyHash===i)return new ze(t,i,[e.entry,a]);var r,s=(0===n?e.keyHash:e.keyHash>>>n)&b,o=(0===n?i:i>>>n)&b;return new He(t,1<<s|1<<o,s===o?[nt(e,t,n+g,i,a)]:(r=new Qe(t,i,a),s<o?[e,r]:[r,e]))}function it(e,t,n){for(var a=[],r=0;r<n.length;r++){var o=n[r],l=i(o);s(o)||(l=l.map(function(e){return de(e)})),a.push(l)}return st(e,t,a)}function at(e,t,n){return e&&e.mergeDeep&&s(t)?e.mergeDeep(t):fe(e,t)?e:t}function rt(e){return function(t,n,i){if(t&&t.mergeDeepWith&&s(n))return t.mergeDeepWith(e,n);var a=e(t,n,i);return fe(t,a)?t:a}}function st(e,t,n){return 0===(n=n.filter(function(e){return 0!==e.size})).length?e:0!==e.size||e.__ownerID||1!==n.length?e.withMutations(function(e){for(var i=t?function(n,i){e.update(i,v,function(e){return e===v?n:t(e,n,i)})}:function(t,n){e.set(n,t)},a=0;a<n.length;a++)n[a].forEach(i)}):e.constructor(n[0])}function ot(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function lt(e,t,n,i){var a=i?e:x(e);return a[t]=n,a}Ue[Je]=!0,Ue.delete=Ue.remove,Ue.removeIn=Ue.deleteIn,Ve.prototype.get=function(e,t,n,i){for(var a=this.entries,r=0,s=a.length;r<s;r++)if(fe(n,a[r][0]))return a[r][1];return i},Ve.prototype.update=function(e,t,n,i,a,r,s){for(var o=a===v,l=this.entries,c=0,u=l.length;c<u&&!fe(i,l[c][0]);c++);var d=c<u;if(d?l[c][1]===a:o)return this;if(S(s),(o||!d)&&S(r),!o||1!==l.length){if(!d&&!o&&l.length>=ct)return function(e,t,n,i){e||(e=new E);for(var a=new Qe(e,Ae(n),[n,i]),r=0;r<t.length;r++){var s=t[r];a=a.update(e,0,void 0,s[0],s[1])}return a}(e,l,i,a);var h=e&&e===this.ownerID,p=h?l:x(l);return d?o?c===u-1?p.pop():p[c]=p.pop():p[c]=[i,a]:p.push([i,a]),h?(this.entries=p,this):new Ve(e,p)}},He.prototype.get=function(e,t,n,i){void 0===t&&(t=Ae(n));var a=1<<((0===e?t:t>>>e)&b),r=this.bitmap;return 0==(r&a)?i:this.nodes[ot(r&a-1)].get(e+g,t,n,i)},He.prototype.update=function(e,t,n,i,a,r,s){void 0===n&&(n=Ae(i));var o=(0===t?n:n>>>t)&b,l=1<<o,c=this.bitmap,u=0!=(c&l);if(!u&&a===v)return this;var d=ot(c&l-1),h=this.nodes,p=u?h[d]:void 0,f=et(p,e,t+g,n,i,a,r,s);if(f===p)return this;if(!u&&f&&h.length>=ut)return function(e,t,n,i,a){for(var r=0,s=new Array(m),o=0;0!==n;o++,n>>>=1)s[o]=1&n?t[r++]:void 0;return s[i]=a,new Ge(e,r+1,s)}(e,h,c,o,f);if(u&&!f&&2===h.length&&tt(h[1^d]))return h[1^d];if(u&&f&&1===h.length&&tt(f))return f;var y=e&&e===this.ownerID,_=u?f?c:c^l:c|l,w=u?f?lt(h,d,f,y):function(e,t,n){var i=e.length-1;if(n&&t===i)return e.pop(),e;for(var a=new Array(i),r=0,s=0;s<i;s++)s===t&&(r=1),a[s]=e[s+r];return a}(h,d,y):function(e,t,n,i){var a=e.length+1;if(i&&t+1===a)return e[t]=n,e;for(var r=new Array(a),s=0,o=0;o<a;o++)o===t?(r[o]=n,s=-1):r[o]=e[o+s];return r}(h,d,f,y);return y?(this.bitmap=_,this.nodes=w,this):new He(e,_,w)},Ge.prototype.get=function(e,t,n,i){void 0===t&&(t=Ae(n));var a=(0===e?t:t>>>e)&b,r=this.nodes[a];return r?r.get(e+g,t,n,i):i},Ge.prototype.update=function(e,t,n,i,a,r,s){void 0===n&&(n=Ae(i));var o=(0===t?n:n>>>t)&b,l=a===v,c=this.nodes,u=c[o];if(l&&!u)return this;var d=et(u,e,t+g,n,i,a,r,s);if(d===u)return this;var h=this.count;if(u){if(!d&&--h<dt)return function(e,t,n,i){for(var a=0,r=0,s=new Array(n),o=0,l=1,c=t.length;o<c;o++,l<<=1){var u=t[o];void 0!==u&&o!==i&&(a|=l,s[r++]=u)}return new He(e,a,s)}(e,c,h,o)}else h++;var p=e&&e===this.ownerID,f=lt(c,o,d,p);return p?(this.count=h,this.nodes=f,this):new Ge(e,h,f)},ze.prototype.get=function(e,t,n,i){for(var a=this.entries,r=0,s=a.length;r<s;r++)if(fe(n,a[r][0]))return a[r][1];return i},ze.prototype.update=function(e,t,n,i,a,r,s){void 0===n&&(n=Ae(i));var o=a===v;if(n!==this.keyHash)return o?this:(S(s),S(r),nt(this,e,t,n,[i,a]));for(var l=this.entries,c=0,u=l.length;c<u&&!fe(i,l[c][0]);c++);var d=c<u;if(d?l[c][1]===a:o)return this;if(S(s),(o||!d)&&S(r),o&&2===u)return new Qe(e,this.keyHash,l[1^c]);var h=e&&e===this.ownerID,p=h?l:x(l);return d?o?c===u-1?p.pop():p[c]=p.pop():p[c]=[i,a]:p.push([i,a]),h?(this.entries=p,this):new ze(e,this.keyHash,p)},Qe.prototype.get=function(e,t,n,i){return fe(n,this.entry[0])?this.entry[1]:i},Qe.prototype.update=function(e,t,n,i,a,r,s){var o=a===v,l=fe(i,this.entry[0]);return(l?a===this.entry[1]:o)?this:(S(s),o?void S(r):l?e&&e===this.ownerID?(this.entry[1]=a,this):new Qe(e,this.keyHash,[i,a]):(S(r),nt(this,e,t,Ae(i),[i,a])))},Ve.prototype.iterate=ze.prototype.iterate=function(e,t){for(var n=this.entries,i=0,a=n.length-1;i<=a;i++)if(!1===e(n[t?a-i:i]))return!1},He.prototype.iterate=Ge.prototype.iterate=function(e,t){for(var n=this.nodes,i=0,a=n.length-1;i<=a;i++){var r=n[t?a-i:i];if(r&&!1===r.iterate(e,t))return!1}},Qe.prototype.iterate=function(e,t){return e(this.entry)},t(We,L),We.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n,i=t.node,a=t.index++;if(i.entry){if(0===a)return $e(e,i.entry)}else if(i.entries){if(a<=(n=i.entries.length-1))return $e(e,i.entries[this._reverse?n-a:a])}else if(a<=(n=i.nodes.length-1)){var r=i.nodes[this._reverse?n-a:a];if(r){if(r.entry)return $e(e,r.entry);t=this._stack=Ke(r,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var ct=m/4,ut=m/2,dt=m/4;function ht(e){var t=St();if(null===e||void 0===e)return t;if(pt(e))return e;var n=a(e),i=n.size;return 0===i?t:(qe(i),i>0&&i<m?wt(0,i,g,null,new mt(n.toArray())):t.withMutations(function(e){e.setSize(i),n.forEach(function(t,n){return e.set(n,t)})}))}function pt(e){return!(!e||!e[ft])}t(ht,we),ht.of=function(){return this(arguments)},ht.prototype.toString=function(){return this.__toString("List [","]")},ht.prototype.get=function(e,t){if((e=P(this,e))>=0&&e<this.size){var n=At(this,e+=this._origin);return n&&n.array[e&b]}return t},ht.prototype.set=function(e,t){return function(e,t,n){if((t=P(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function(e){t<0?Pt(e,t).set(0,n):Pt(e,0,t+1).set(t,n)});t+=e._origin;var i=e._tail,a=e._root,r=w(_);t>=kt(e._capacity)?i=Et(i,e.__ownerID,0,t,n,r):a=Et(a,e.__ownerID,e._level,t,n,r);if(!r.value)return e;if(e.__ownerID)return e._root=a,e._tail=i,e.__hash=void 0,e.__altered=!0,e;return wt(e._origin,e._capacity,e._level,a,i)}(this,e,t)},ht.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},ht.prototype.insert=function(e,t){return this.splice(e,0,t)},ht.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=g,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):St()},ht.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){Pt(n,0,t+e.length);for(var i=0;i<e.length;i++)n.set(t+i,e[i])})},ht.prototype.pop=function(){return Pt(this,0,-1)},ht.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Pt(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},ht.prototype.shift=function(){return Pt(this,1)},ht.prototype.merge=function(){return Ct(this,void 0,arguments)},ht.prototype.mergeWith=function(t){return Ct(this,t,e.call(arguments,1))},ht.prototype.mergeDeep=function(){return Ct(this,at,arguments)},ht.prototype.mergeDeepWith=function(t){var n=e.call(arguments,1);return Ct(this,rt(t),n)},ht.prototype.setSize=function(e){return Pt(this,0,e)},ht.prototype.slice=function(e,t){var n=this.size;return k(e,t,n)?this:Pt(this,R(e,n),O(t,n))},ht.prototype.__iterator=function(e,t){var n=0,i=_t(this,t);return new L(function(){var t=i();return t===yt?{value:void 0,done:!0}:B(e,n++,t)})},ht.prototype.__iterate=function(e,t){for(var n,i=0,a=_t(this,t);(n=a())!==yt&&!1!==e(n,i++,this););return i},ht.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?wt(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},ht.isList=pt;var ft="@@__IMMUTABLE_LIST__@@",gt=ht.prototype;function mt(e,t){this.array=e,this.ownerID=t}gt[ft]=!0,gt.delete=gt.remove,gt.setIn=Ue.setIn,gt.deleteIn=gt.removeIn=Ue.removeIn,gt.update=Ue.update,gt.updateIn=Ue.updateIn,gt.mergeIn=Ue.mergeIn,gt.mergeDeepIn=Ue.mergeDeepIn,gt.withMutations=Ue.withMutations,gt.asMutable=Ue.asMutable,gt.asImmutable=Ue.asImmutable,gt.wasAltered=Ue.wasAltered,mt.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var i=n>>>t&b;if(i>=this.array.length)return new mt([],e);var a,r=0===i;if(t>0){var s=this.array[i];if((a=s&&s.removeBefore(e,t-g,n))===s&&r)return this}if(r&&!a)return this;var o=xt(this,e);if(!r)for(var l=0;l<i;l++)o.array[l]=void 0;return a&&(o.array[i]=a),o},mt.prototype.removeAfter=function(e,t,n){if(n===(t?1<<t:0)||0===this.array.length)return this;var i,a=n-1>>>t&b;if(a>=this.array.length)return this;if(t>0){var r=this.array[a];if((i=r&&r.removeAfter(e,t-g,n))===r&&a===this.array.length-1)return this}var s=xt(this,e);return s.array.splice(a+1),i&&(s.array[a]=i),s};var bt,vt,yt={};function _t(e,t){var n=e._origin,i=e._capacity,a=kt(i),r=e._tail;return s(e._root,e._level,0);function s(e,o,l){return 0===o?function(e,s){var o=s===a?r&&r.array:e&&e.array,l=s>n?0:n-s,c=i-s;c>m&&(c=m);return function(){if(l===c)return yt;var e=t?--c:l++;return o&&o[e]}}(e,l):function(e,a,r){var o,l=e&&e.array,c=r>n?0:n-r>>a,u=1+(i-r>>a);u>m&&(u=m);return function(){for(;;){if(o){var e=o();if(e!==yt)return e;o=null}if(c===u)return yt;var n=t?--u:c++;o=s(l&&l[n],a-g,r+(n<<a))}}}(e,o,l)}}function wt(e,t,n,i,a,r,s){var o=Object.create(gt);return o.size=t-e,o._origin=e,o._capacity=t,o._level=n,o._root=i,o._tail=a,o.__ownerID=r,o.__hash=s,o.__altered=!1,o}function St(){return bt||(bt=wt(0,0,g))}function Et(e,t,n,i,a,r){var s,o=i>>>n&b,l=e&&o<e.array.length;if(!l&&void 0===a)return e;if(n>0){var c=e&&e.array[o],u=Et(c,t,n-g,i,a,r);return u===c?e:((s=xt(e,t)).array[o]=u,s)}return l&&e.array[o]===a?e:(S(r),s=xt(e,t),void 0===a&&o===s.array.length-1?s.array.pop():s.array[o]=a,s)}function xt(e,t){return t&&e&&t===e.ownerID?e:new mt(e?e.array.slice():[],t)}function At(e,t){if(t>=kt(e._capacity))return e._tail;if(t<1<<e._level+g){for(var n=e._root,i=e._level;n&&i>0;)n=n.array[t>>>i&b],i-=g;return n}}function Pt(e,t,n){void 0!==t&&(t|=0),void 0!==n&&(n|=0);var i=e.__ownerID||new E,a=e._origin,r=e._capacity,s=a+t,o=void 0===n?r:n<0?r+n:a+n;if(s===a&&o===r)return e;if(s>=o)return e.clear();for(var l=e._level,c=e._root,u=0;s+u<0;)c=new mt(c&&c.array.length?[void 0,c]:[],i),u+=1<<(l+=g);u&&(s+=u,a+=u,o+=u,r+=u);for(var d=kt(r),h=kt(o);h>=1<<l+g;)c=new mt(c&&c.array.length?[c]:[],i),l+=g;var p=e._tail,f=h<d?At(e,o-1):h>d?new mt([],i):p;if(p&&h>d&&s<r&&p.array.length){for(var m=c=xt(c,i),v=l;v>g;v-=g){var y=d>>>v&b;m=m.array[y]=xt(m.array[y],i)}m.array[d>>>g&b]=p}if(o<r&&(f=f&&f.removeAfter(i,0,o)),s>=h)s-=h,o-=h,l=g,c=null,f=f&&f.removeBefore(i,0,s);else if(s>a||h<d){for(u=0;c;){var _=s>>>l&b;if(_!==h>>>l&b)break;_&&(u+=(1<<l)*_),l-=g,c=c.array[_]}c&&s>a&&(c=c.removeBefore(i,l,s-u)),c&&h<d&&(c=c.removeAfter(i,l,h-u)),u&&(s-=u,o-=u)}return e.__ownerID?(e.size=o-s,e._origin=s,e._capacity=o,e._level=l,e._root=c,e._tail=f,e.__hash=void 0,e.__altered=!0,e):wt(s,o,l,c,f)}function Ct(e,t,n){for(var i=[],r=0,o=0;o<n.length;o++){var l=n[o],c=a(l);c.size>r&&(r=c.size),s(l)||(c=c.map(function(e){return de(e)})),i.push(c)}return r>e.size&&(e=e.setSize(r)),st(e,t,i)}function kt(e){return e<m?0:e-1>>>g<<g}function Rt(e){return null===e||void 0===e?It():Ot(e)?e:It().withMutations(function(t){var n=i(e);qe(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Ot(e){return Be(e)&&u(e)}function Tt(e,t,n,i){var a=Object.create(Rt.prototype);return a.size=e?e.size:0,a._map=e,a._list=t,a.__ownerID=n,a.__hash=i,a}function It(){return vt||(vt=Tt(Xe(),St()))}function Dt(e,t,n){var i,a,r=e._map,s=e._list,o=r.get(t),l=void 0!==o;if(n===v){if(!l)return e;s.size>=m&&s.size>=2*r.size?(i=(a=s.filter(function(e,t){return void 0!==e&&o!==t})).toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(i.__ownerID=a.__ownerID=e.__ownerID)):(i=r.remove(t),a=o===s.size-1?s.pop():s.set(o,void 0))}else if(l){if(n===s.get(o)[1])return e;i=r,a=s.set(o,[t,n])}else i=r.set(t,s.size),a=s.set(s.size,[t,n]);return e.__ownerID?(e.size=i.size,e._map=i,e._list=a,e.__hash=void 0,e):Tt(i,a)}function Mt(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function jt(e){this._iter=e,this.size=e.size}function Nt(e){this._iter=e,this.size=e.size}function qt(e){this._iter=e,this.size=e.size}function Lt(e){var t=Zt(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=en,t.__iterateUncached=function(t,n){var i=this;return e.__iterate(function(e,n){return!1!==t(n,e,i)},n)},t.__iteratorUncached=function(t,n){if(t===M){var i=e.__iterator(t,n);return new L(function(){var e=i.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===D?I:D,n)},t}function Bt(e,t,n){var i=Zt(e);return i.size=e.size,i.has=function(t){return e.has(t)},i.get=function(i,a){var r=e.get(i,v);return r===v?a:t.call(n,r,i,e)},i.__iterateUncached=function(i,a){var r=this;return e.__iterate(function(e,a,s){return!1!==i(t.call(n,e,a,s),a,r)},a)},i.__iteratorUncached=function(i,a){var r=e.__iterator(M,a);return new L(function(){var a=r.next();if(a.done)return a;var s=a.value,o=s[0];return B(i,o,t.call(n,s[1],o,e),a)})},i}function Ft(e,t){var n=Zt(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=Lt(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,i){return e.get(t?n:-1-n,i)},n.has=function(n){return e.has(t?n:-1-n)},n.includes=function(t){return e.includes(t)},n.cacheResult=en,n.__iterate=function(t,n){var i=this;return e.__iterate(function(e,n){return t(e,n,i)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function Jt(e,t,n,i){var a=Zt(e);return i&&(a.has=function(i){var a=e.get(i,v);return a!==v&&!!t.call(n,a,i,e)},a.get=function(i,a){var r=e.get(i,v);return r!==v&&t.call(n,r,i,e)?r:a}),a.__iterateUncached=function(a,r){var s=this,o=0;return e.__iterate(function(e,r,l){if(t.call(n,e,r,l))return o++,a(e,i?r:o-1,s)},r),o},a.__iteratorUncached=function(a,r){var s=e.__iterator(M,r),o=0;return new L(function(){for(;;){var r=s.next();if(r.done)return r;var l=r.value,c=l[0],u=l[1];if(t.call(n,u,c,e))return B(a,i?c:o++,u,r)}})},a}function Ut(e,t,n,i){var a=e.size;if(void 0!==t&&(t|=0),void 0!==n&&(n===1/0?n=a:n|=0),k(t,n,a))return e;var r=R(t,a),s=O(n,a);if(r!=r||s!=s)return Ut(e.toSeq().cacheResult(),t,n,i);var o,l=s-r;l==l&&(o=l<0?0:l);var c=Zt(e);return c.size=0===o?o:e.size&&o||void 0,!i&&ae(e)&&o>=0&&(c.get=function(t,n){return(t=P(this,t))>=0&&t<o?e.get(t+r,n):n}),c.__iterateUncached=function(t,n){var a=this;if(0===o)return 0;if(n)return this.cacheResult().__iterate(t,n);var s=0,l=!0,c=0;return e.__iterate(function(e,n){if(!l||!(l=s++<r))return c++,!1!==t(e,i?n:c-1,a)&&c!==o}),c},c.__iteratorUncached=function(t,n){if(0!==o&&n)return this.cacheResult().__iterator(t,n);var a=0!==o&&e.__iterator(t,n),s=0,l=0;return new L(function(){for(;s++<r;)a.next();if(++l>o)return{value:void 0,done:!0};var e=a.next();return i||t===D?e:B(t,l-1,t===I?void 0:e.value[1],e)})},c}function Vt(e,t,n,i){var a=Zt(e);return a.__iterateUncached=function(a,r){var s=this;if(r)return this.cacheResult().__iterate(a,r);var o=!0,l=0;return e.__iterate(function(e,r,c){if(!o||!(o=t.call(n,e,r,c)))return l++,a(e,i?r:l-1,s)}),l},a.__iteratorUncached=function(a,r){var s=this;if(r)return this.cacheResult().__iterator(a,r);var o=e.__iterator(M,r),l=!0,c=0;return new L(function(){var e,r,u;do{if((e=o.next()).done)return i||a===D?e:B(a,c++,a===I?void 0:e.value[1],e);var d=e.value;r=d[0],u=d[1],l&&(l=t.call(n,u,r,s))}while(l);return a===M?e:B(a,r,u,e)})},a}function Ht(e,t,n){var i=Zt(e);return i.__iterateUncached=function(i,a){var r=0,o=!1;return function e(l,c){var u=this;l.__iterate(function(a,l){return(!t||c<t)&&s(a)?e(a,c+1):!1===i(a,n?l:r++,u)&&(o=!0),!o},a)}(e,0),r},i.__iteratorUncached=function(i,a){var r=e.__iterator(i,a),o=[],l=0;return new L(function(){for(;r;){var e=r.next();if(!1===e.done){var c=e.value;if(i===M&&(c=c[1]),t&&!(o.length<t)||!s(c))return n?e:B(i,l++,c,e);o.push(r),r=c.__iterator(i,a)}else r=o.pop()}return{value:void 0,done:!0}})},i}function Gt(e,t,n){t||(t=tn);var i=o(e),a=0,r=e.toSeq().map(function(t,i){return[i,t,a++,n?n(t,i,e):t]}).toArray();return r.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(i?function(e,t){r[t].length=2}:function(e,t){r[t]=e[1]}),i?Q(r):l(e)?W(r):$(r)}function zt(e,t,n){if(t||(t=tn),n){var i=e.toSeq().map(function(t,i){return[t,n(t,i,e)]}).reduce(function(e,n){return Qt(t,e[1],n[1])?n:e});return i&&i[0]}return e.reduce(function(e,n){return Qt(t,e,n)?n:e})}function Qt(e,t,n){var i=e(n,t);return 0===i&&n!==t&&(void 0===n||null===n||n!=n)||i>0}function Wt(e,t,i){var a=Zt(e);return a.size=new ee(i).map(function(e){return e.size}).min(),a.__iterate=function(e,t){for(var n,i=this.__iterator(D,t),a=0;!(n=i.next()).done&&!1!==e(n.value,a++,this););return a},a.__iteratorUncached=function(e,a){var r=i.map(function(e){return e=n(e),V(a?e.reverse():e)}),s=0,o=!1;return new L(function(){var n;return o||(n=r.map(function(e){return e.next()}),o=n.some(function(e){return e.done})),o?{value:void 0,done:!0}:B(e,s++,t.apply(null,n.map(function(e){return e.value})))})},a}function $t(e,t){return ae(e)?t:e.constructor(t)}function Kt(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Yt(e){return qe(e.size),A(e)}function Xt(e){return o(e)?i:l(e)?a:r}function Zt(e){return Object.create((o(e)?Q:l(e)?W:$).prototype)}function en(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):z.prototype.cacheResult.call(this)}function tn(e,t){return e>t?1:e<t?-1:0}function nn(e){var t=V(e);if(!t){if(!G(e))throw new TypeError("Expected iterable or array-like: "+e);t=V(n(e))}return t}function an(e,t){var n,i=function(r){if(r instanceof i)return r;if(!(this instanceof i))return new i(r);if(!n){n=!0;var s=Object.keys(e);!function(e,t){try{t.forEach(function(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){be(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}.bind(void 0,e))}catch(e){}}(a,s),a.size=s.length,a._name=t,a._keys=s,a._defaultValues=e}this._map=Le(r)},a=i.prototype=Object.create(rn);return a.constructor=i,i}t(Rt,Le),Rt.of=function(){return this(arguments)},Rt.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Rt.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},Rt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):It()},Rt.prototype.set=function(e,t){return Dt(this,e,t)},Rt.prototype.remove=function(e){return Dt(this,e,v)},Rt.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Rt.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},Rt.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},Rt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?Tt(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)},Rt.isOrderedMap=Ot,Rt.prototype[f]=!0,Rt.prototype.delete=Rt.prototype.remove,t(Mt,Q),Mt.prototype.get=function(e,t){return this._iter.get(e,t)},Mt.prototype.has=function(e){return this._iter.has(e)},Mt.prototype.valueSeq=function(){return this._iter.valueSeq()},Mt.prototype.reverse=function(){var e=this,t=Ft(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},Mt.prototype.map=function(e,t){var n=this,i=Bt(this,e,t);return this._useKeys||(i.valueSeq=function(){return n._iter.toSeq().map(e,t)}),i},Mt.prototype.__iterate=function(e,t){var n,i=this;return this._iter.__iterate(this._useKeys?function(t,n){return e(t,n,i)}:(n=t?Yt(this):0,function(a){return e(a,t?--n:n++,i)}),t)},Mt.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(D,t),i=t?Yt(this):0;return new L(function(){var a=n.next();return a.done?a:B(e,t?--i:i++,a.value,a)})},Mt.prototype[f]=!0,t(jt,W),jt.prototype.includes=function(e){return this._iter.includes(e)},jt.prototype.__iterate=function(e,t){var n=this,i=0;return this._iter.__iterate(function(t){return e(t,i++,n)},t)},jt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(D,t),i=0;return new L(function(){var t=n.next();return t.done?t:B(e,i++,t.value,t)})},t(Nt,$),Nt.prototype.has=function(e){return this._iter.includes(e)},Nt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},Nt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(D,t);return new L(function(){var t=n.next();return t.done?t:B(e,t.value,t.value,t)})},t(qt,Q),qt.prototype.entrySeq=function(){return this._iter.toSeq()},qt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){if(t){Kt(t);var i=s(t);return e(i?t.get(1):t[1],i?t.get(0):t[0],n)}},t)},qt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(D,t);return new L(function(){for(;;){var t=n.next();if(t.done)return t;var i=t.value;if(i){Kt(i);var a=s(i);return B(e,a?i.get(0):i[0],a?i.get(1):i[1],t)}}})},jt.prototype.cacheResult=Mt.prototype.cacheResult=Nt.prototype.cacheResult=qt.prototype.cacheResult=en,t(an,_e),an.prototype.toString=function(){return this.__toString(on(this)+" {","}")},an.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},an.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},an.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=sn(this,Xe()))},an.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+on(this));if(this._map&&!this._map.has(e)&&t===this._defaultValues[e])return this;var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:sn(this,n)},an.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:sn(this,t)},an.prototype.wasAltered=function(){return this._map.wasAltered()},an.prototype.__iterator=function(e,t){var n=this;return i(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},an.prototype.__iterate=function(e,t){var n=this;return i(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},an.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?sn(this,t,e):(this.__ownerID=e,this._map=t,this)};var rn=an.prototype;function sn(e,t,n){var i=Object.create(Object.getPrototypeOf(e));return i._map=t,i.__ownerID=n,i}function on(e){return e._name||e.constructor.name||"Record"}function ln(e){return null===e||void 0===e?gn():cn(e)&&!u(e)?e:gn().withMutations(function(t){var n=r(e);qe(n.size),n.forEach(function(e){return t.add(e)})})}function cn(e){return!(!e||!e[dn])}rn.delete=rn.remove,rn.deleteIn=rn.removeIn=Ue.removeIn,rn.merge=Ue.merge,rn.mergeWith=Ue.mergeWith,rn.mergeIn=Ue.mergeIn,rn.mergeDeep=Ue.mergeDeep,rn.mergeDeepWith=Ue.mergeDeepWith,rn.mergeDeepIn=Ue.mergeDeepIn,rn.setIn=Ue.setIn,rn.update=Ue.update,rn.updateIn=Ue.updateIn,rn.withMutations=Ue.withMutations,rn.asMutable=Ue.asMutable,rn.asImmutable=Ue.asImmutable,t(ln,Se),ln.of=function(){return this(arguments)},ln.fromKeys=function(e){return this(i(e).keySeq())},ln.prototype.toString=function(){return this.__toString("Set {","}")},ln.prototype.has=function(e){return this._map.has(e)},ln.prototype.add=function(e){return pn(this,this._map.set(e,!0))},ln.prototype.remove=function(e){return pn(this,this._map.remove(e))},ln.prototype.clear=function(){return pn(this,this._map.clear())},ln.prototype.union=function(){var t=e.call(arguments,0);return 0===(t=t.filter(function(e){return 0!==e.size})).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations(function(e){for(var n=0;n<t.length;n++)r(t[n]).forEach(function(t){return e.add(t)})}):this.constructor(t[0])},ln.prototype.intersect=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return r(e)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.every(function(e){return e.includes(n)})||e.remove(n)})})},ln.prototype.subtract=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return r(e)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.some(function(e){return e.includes(n)})&&e.remove(n)})})},ln.prototype.merge=function(){return this.union.apply(this,arguments)},ln.prototype.mergeWith=function(t){var n=e.call(arguments,1);return this.union.apply(this,n)},ln.prototype.sort=function(e){return mn(Gt(this,e))},ln.prototype.sortBy=function(e,t){return mn(Gt(this,t,e))},ln.prototype.wasAltered=function(){return this._map.wasAltered()},ln.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t,i){return e(i,i,n)},t)},ln.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},ln.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},ln.isSet=cn;var un,dn="@@__IMMUTABLE_SET__@@",hn=ln.prototype;function pn(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function fn(e,t){var n=Object.create(hn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function gn(){return un||(un=fn(Xe()))}function mn(e){return null===e||void 0===e?wn():bn(e)?e:wn().withMutations(function(t){var n=r(e);qe(n.size),n.forEach(function(e){return t.add(e)})})}function bn(e){return cn(e)&&u(e)}hn[dn]=!0,hn.delete=hn.remove,hn.mergeDeep=hn.merge,hn.mergeDeepWith=hn.mergeWith,hn.withMutations=Ue.withMutations,hn.asMutable=Ue.asMutable,hn.asImmutable=Ue.asImmutable,hn.__empty=gn,hn.__make=fn,t(mn,ln),mn.of=function(){return this(arguments)},mn.fromKeys=function(e){return this(i(e).keySeq())},mn.prototype.toString=function(){return this.__toString("OrderedSet {","}")},mn.isOrderedSet=bn;var vn,yn=mn.prototype;function _n(e,t){var n=Object.create(yn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function wn(){return vn||(vn=_n(It()))}function Sn(e){return null===e||void 0===e?kn():En(e)?e:kn().unshiftAll(e)}function En(e){return!(!e||!e[An])}yn[f]=!0,yn.__empty=wn,yn.__make=_n,t(Sn,we),Sn.of=function(){return this(arguments)},Sn.prototype.toString=function(){return this.__toString("Stack [","]")},Sn.prototype.get=function(e,t){var n=this._head;for(e=P(this,e);n&&e--;)n=n.next;return n?n.value:t},Sn.prototype.peek=function(){return this._head&&this._head.value},Sn.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Cn(e,t)},Sn.prototype.pushAll=function(e){if(0===(e=a(e)).size)return this;qe(e.size);var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):Cn(t,n)},Sn.prototype.pop=function(){return this.slice(1)},Sn.prototype.unshift=function(){return this.push.apply(this,arguments)},Sn.prototype.unshiftAll=function(e){return this.pushAll(e)},Sn.prototype.shift=function(){return this.pop.apply(this,arguments)},Sn.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):kn()},Sn.prototype.slice=function(e,t){if(k(e,t,this.size))return this;var n=R(e,this.size);if(O(t,this.size)!==this.size)return we.prototype.slice.call(this,e,t);for(var i=this.size-n,a=this._head;n--;)a=a.next;return this.__ownerID?(this.size=i,this._head=a,this.__hash=void 0,this.__altered=!0,this):Cn(i,a)},Sn.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Cn(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Sn.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var n=0,i=this._head;i&&!1!==e(i.value,n++,this);)i=i.next;return n},Sn.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var n=0,i=this._head;return new L(function(){if(i){var t=i.value;return i=i.next,B(e,n++,t)}return{value:void 0,done:!0}})},Sn.isStack=En;var xn,An="@@__IMMUTABLE_STACK__@@",Pn=Sn.prototype;function Cn(e,t,n,i){var a=Object.create(Pn);return a.size=e,a._head=t,a.__ownerID=n,a.__hash=i,a.__altered=!1,a}function kn(){return xn||(xn=Cn(0))}function Rn(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}Pn[An]=!0,Pn.withMutations=Ue.withMutations,Pn.asMutable=Ue.asMutable,Pn.asImmutable=Ue.asImmutable,Pn.wasAltered=Ue.wasAltered,n.Iterator=L,Rn(n,{toArray:function(){qe(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new jt(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new Mt(this,!0)},toMap:function(){return Le(this.toKeyedSeq())},toObject:function(){qe(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return Rt(this.toKeyedSeq())},toOrderedSet:function(){return mn(o(this)?this.valueSeq():this)},toSet:function(){return ln(o(this)?this.valueSeq():this)},toSetSeq:function(){return new Nt(this)},toSeq:function(){return l(this)?this.toIndexedSeq():o(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Sn(o(this)?this.valueSeq():this)},toList:function(){return ht(o(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){return $t(this,function(e,t){var n=o(e),a=[e].concat(t).map(function(e){return s(e)?n&&(e=i(e)):e=n?se(e):oe(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===a.length)return e;if(1===a.length){var r=a[0];if(r===e||n&&o(r)||l(e)&&l(r))return r}var c=new ee(a);return n?c=c.toKeyedSeq():l(e)||(c=c.toSetSeq()),(c=c.flatten(!0)).size=a.reduce(function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}},0),c}(this,e.call(arguments,0)))},includes:function(e){return this.some(function(t){return fe(t,e)})},entries:function(){return this.__iterator(M)},every:function(e,t){qe(this.size);var n=!0;return this.__iterate(function(i,a,r){if(!e.call(t,i,a,r))return n=!1,!1}),n},filter:function(e,t){return $t(this,Jt(this,e,t,!0))},find:function(e,t,n){var i=this.findEntry(e,t);return i?i[1]:n},forEach:function(e,t){return qe(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){qe(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate(function(i){n?n=!1:t+=e,t+=null!==i&&void 0!==i?i.toString():""}),t},keys:function(){return this.__iterator(I)},map:function(e,t){return $t(this,Bt(this,e,t))},reduce:function(e,t,n){var i,a;return qe(this.size),arguments.length<2?a=!0:i=t,this.__iterate(function(t,r,s){a?(a=!1,i=t):i=e.call(n,i,t,r,s)}),i},reduceRight:function(e,t,n){var i=this.toKeyedSeq().reverse();return i.reduce.apply(i,arguments)},reverse:function(){return $t(this,Ft(this,!0))},slice:function(e,t){return $t(this,Ut(this,e,t,!0))},some:function(e,t){return!this.every(Mn(e),t)},sort:function(e){return $t(this,Gt(this,e))},values:function(){return this.__iterator(D)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return A(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,n){var i=Le().asMutable();return e.__iterate(function(a,r){i.update(t.call(n,a,r,e),0,function(e){return e+1})}),i.asImmutable()}(this,e,t)},equals:function(e){return ge(this,e)},entrySeq:function(){var e=this;if(e._cache)return new ee(e._cache);var t=e.toSeq().map(Dn).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Mn(e),t)},findEntry:function(e,t,n){var i=n;return this.__iterate(function(n,a,r){if(e.call(t,n,a,r))return i=[a,n],!1}),i},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},findLastEntry:function(e,t,n){return this.toKeyedSeq().reverse().findEntry(e,t,n)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(){return this.find(C)},flatMap:function(e,t){return $t(this,function(e,t,n){var i=Xt(e);return e.toSeq().map(function(a,r){return i(t.call(n,a,r,e))}).flatten(!0)}(this,e,t))},flatten:function(e){return $t(this,Ht(this,e,!0))},fromEntrySeq:function(){return new qt(this)},get:function(e,t){return this.find(function(t,n){return fe(n,e)},void 0,t)},getIn:function(e,t){for(var n,i=this,a=nn(e);!(n=a.next()).done;){var r=n.value;if((i=i&&i.get?i.get(r,v):v)===v)return t}return i},groupBy:function(e,t){return function(e,t,n){var i=o(e),a=(u(e)?Rt():Le()).asMutable();e.__iterate(function(r,s){a.update(t.call(n,r,s,e),function(e){return(e=e||[]).push(i?[s,r]:r),e})});var r=Xt(e);return a.map(function(t){return $t(e,r(t))})}(this,e,t)},has:function(e){return this.get(e,v)!==v},hasIn:function(e){return this.getIn(e,v)!==v},isSubset:function(e){return e="function"==typeof e.includes?e:n(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return(e="function"==typeof e.isSubset?e:n(e)).isSubset(this)},keyOf:function(e){return this.findKey(function(t){return fe(t,e)})},keySeq:function(){return this.toSeq().map(In).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return zt(this,e)},maxBy:function(e,t){return zt(this,t,e)},min:function(e){return zt(this,e?jn(e):Ln)},minBy:function(e,t){return zt(this,t?jn(t):Ln,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return $t(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return $t(this,Vt(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Mn(e),t)},sortBy:function(e,t){return $t(this,Gt(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return $t(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return $t(this,function(e,t,n){var i=Zt(e);return i.__iterateUncached=function(i,a){var r=this;if(a)return this.cacheResult().__iterate(i,a);var s=0;return e.__iterate(function(e,a,o){return t.call(n,e,a,o)&&++s&&i(e,a,r)}),s},i.__iteratorUncached=function(i,a){var r=this;if(a)return this.cacheResult().__iterator(i,a);var s=e.__iterator(M,a),o=!0;return new L(function(){if(!o)return{value:void 0,done:!0};var e=s.next();if(e.done)return e;var a=e.value,l=a[0],c=a[1];return t.call(n,c,l,r)?i===M?e:B(i,l,c,e):(o=!1,{value:void 0,done:!0})})},i}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Mn(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0;var t=u(e),n=o(e),i=t?1:0;return function(e,t){return t=Ee(t,3432918353),t=Ee(t<<15|t>>>-15,461845907),t=Ee(t<<13|t>>>-13,5),t=Ee((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=xe((t=Ee(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(n?t?function(e,t){i=31*i+Bn(Ae(e),Ae(t))|0}:function(e,t){i=i+Bn(Ae(e),Ae(t))|0}:t?function(e){i=31*i+Ae(e)|0}:function(e){i=i+Ae(e)|0}),i)}(this))}});var On=n.prototype;On[d]=!0,On[q]=On.values,On.__toJS=On.toArray,On.__toStringMapper=Nn,On.inspect=On.toSource=function(){return this.toString()},On.chain=On.flatMap,On.contains=On.includes,Rn(i,{flip:function(){return $t(this,Lt(this))},mapEntries:function(e,t){var n=this,i=0;return $t(this,this.toSeq().map(function(a,r){return e.call(t,[r,a],i++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return $t(this,this.toSeq().flip().map(function(i,a){return e.call(t,i,a,n)}).flip())}});var Tn=i.prototype;function In(e,t){return t}function Dn(e,t){return[t,e]}function Mn(e){return function(){return!e.apply(this,arguments)}}function jn(e){return function(){return-e.apply(this,arguments)}}function Nn(e){return"string"==typeof e?JSON.stringify(e):String(e)}function qn(){return x(arguments)}function Ln(e,t){return e<t?1:e>t?-1:0}function Bn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}return Tn[h]=!0,Tn[q]=On.entries,Tn.__toJS=On.toObject,Tn.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+Nn(e)},Rn(a,{toKeyedSeq:function(){return new Mt(this,!1)},filter:function(e,t){return $t(this,Jt(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return void 0===t?-1:t},reverse:function(){return $t(this,Ft(this,!1))},slice:function(e,t){return $t(this,Ut(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(0|t,0),0===n||2===n&&!t)return this;e=R(e,e<0?this.count():this.size);var i=this.slice(0,e);return $t(this,1===n?i:i.concat(x(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.findLastEntry(e,t);return n?n[0]:-1},first:function(){return this.get(0)},flatten:function(e){return $t(this,Ht(this,e,!1))},get:function(e,t){return(e=P(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return(e=P(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return $t(this,function(e,t){var n=Zt(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,i){var a=this,r=0;return e.__iterate(function(e,i){return(!r||!1!==n(t,r++,a))&&!1!==n(e,r++,a)},i),r},n.__iteratorUncached=function(n,i){var a,r=e.__iterator(D,i),s=0;return new L(function(){return(!a||s%2)&&(a=r.next()).done?a:s%2?B(n,s++,t):B(n,s++,a.value,a)})},n}(this,e))},interleave:function(){var e=[this].concat(x(arguments)),t=Wt(this.toSeq(),W.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),$t(this,n)},keySeq:function(){return ve(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(e,t){return $t(this,Vt(this,e,t,!1))},zip:function(){return $t(this,Wt(this,qn,[this].concat(x(arguments))))},zipWith:function(e){var t=x(arguments);return t[0]=this,$t(this,Wt(this,e,t))}}),a.prototype[p]=!0,a.prototype[f]=!0,Rn(r,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),r.prototype.has=On.includes,r.prototype.contains=r.prototype.includes,Rn(Q,i.prototype),Rn(W,a.prototype),Rn($,r.prototype),Rn(_e,i.prototype),Rn(we,a.prototype),Rn(Se,r.prototype),{Iterable:n,Seq:z,Collection:ye,Map:Le,OrderedMap:Rt,List:ht,Stack:Sn,Set:ln,OrderedSet:mn,Record:an,Range:ve,Repeat:me,is:fe,fromJS:de}}),define("es6!js/widgets/sort/redux/modules/sort-app",["underscore","immutable"],function(e,t){var n=t.fromJS({options:[{id:"author_count",text:"Author Count",desc:"sort by number of authors"},{id:"bibcode",text:"Bibcode",desc:"sort by bibcode"},{id:"citation_count",text:"Citation Count",desc:"sort by number of citations"},{id:"citation_count_norm",text:"Normalized Citation Count",desc:"sort by number of normalized citations"},{id:"classic_factor",text:"Classic Factor",desc:"sort using classical score"},{id:"date",text:"Date",desc:"sort by publication date"},{id:"entry_date",text:"Entry Date",desc:"sort by date work entered the database"},{id:"read_count",text:"Read Count",desc:"sort by number of reads"},{id:"score",text:"Score",desc:"sort by the relative score"}],sort:{id:"date",text:"Date"},direction:"asc",query:null,locked:!1,lockTimer:null});return{setSort:function(t,n){return function(i,a,r){if(e.isString(t)){var s=a().get("SortApp").get("options");t=s.find(function(e){return e.get("id")===t})||s[0]}i({type:"SET_SORT",value:t}),!n&&r.onSortChange()}},setDirection:function(t,n){return function(i,a,r){if(e.isUndefined(t)){var s=a().get("SortApp").get("direction");t="asc"===s?"desc":"asc"}i({type:"SET_DIRECTION",value:t}),!n&&r.onSortChange()}},setQuery:function(e){return{type:"SET_QUERY",value:e}},setLocked:function(e){return function(t,n){var i=n().get("SortApp").get("lockTimer");i&&clearTimeout(i);var a=setTimeout(function(){return t({type:"SET_LOCKED",value:!1})},3e4);t({type:"SET_LOCKED",value:e,timer:a})}},initialState:n,reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments[1];switch(t.type){case"SET_SORT":return e.set("sort",t.value);case"SET_DIRECTION":return e.set("direction",t.value);case"SET_QUERY":return e.set("query",t.value);case"SET_LOCKED":return e.merge({locked:t.value,lockTimer:t.timer});default:return n}}}}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("redux-immutable",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).combineReducers=e()}}(function(){return function(){return function e(t,n,i){function a(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return a(t[s][1][e]||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}}()({1:[function(e,t,n){var i,a;i=this,a=function(){"use strict";var e=Array.prototype.slice;function t(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function n(e){return s(e)?e:z(e)}function i(e){return o(e)?e:Q(e)}function a(e){return l(e)?e:W(e)}function r(e){return s(e)&&!c(e)?e:$(e)}function s(e){return!(!e||!e[d])}function o(e){return!(!e||!e[h])}function l(e){return!(!e||!e[p])}function c(e){return o(e)||l(e)}function u(e){return!(!e||!e[f])}t(i,n),t(a,n),t(r,n),n.isIterable=s,n.isKeyed=o,n.isIndexed=l,n.isAssociative=c,n.isOrdered=u,n.Keyed=i,n.Indexed=a,n.Set=r;var d="@@__IMMUTABLE_ITERABLE__@@",h="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",f="@@__IMMUTABLE_ORDERED__@@",g=5,m=1<<g,b=m-1,v={},y={value:!1},_={value:!1};function w(e){return e.value=!1,e}function S(e){e&&(e.value=!0)}function E(){}function x(e,t){t=t||0;for(var n=Math.max(0,e.length-t),i=new Array(n),a=0;a<n;a++)i[a]=e[a+t];return i}function A(e){return void 0===e.size&&(e.size=e.__iterate(C)),e.size}function P(e,t){if("number"!=typeof t){var n=t>>>0;if(""+n!==t||4294967295===n)return NaN;t=n}return t<0?A(e)+t:t}function C(){return!0}function k(e,t,n){return(0===e||void 0!==n&&e<=-n)&&(void 0===t||void 0!==n&&t>=n)}function R(e,t){return T(e,t,0)}function O(e,t){return T(e,t,t)}function T(e,t,n){return void 0===e?n:e<0?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}var I=0,D=1,M=2,j="function"==typeof Symbol&&Symbol.iterator,N="@@iterator",q=j||N;function L(e){this.next=e}function B(e,t,n,i){var a=0===e?t:1===e?n:[t,n];return i?i.value=a:i={value:a,done:!1},i}function F(){return{value:void 0,done:!0}}function J(e){return!!H(e)}function U(e){return e&&"function"==typeof e.next}function V(e){var t=H(e);return t&&t.call(e)}function H(e){var t=e&&(j&&e[j]||e[N]);if("function"==typeof t)return t}function G(e){return e&&"number"==typeof e.length}function z(e){return null===e||void 0===e?re():s(e)?e.toSeq():function(e){var t=le(e)||"object"==typeof e&&new te(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}(e)}function Q(e){return null===e||void 0===e?re().toKeyedSeq():s(e)?o(e)?e.toSeq():e.fromEntrySeq():se(e)}function W(e){return null===e||void 0===e?re():s(e)?o(e)?e.entrySeq():e.toIndexedSeq():oe(e)}function $(e){return(null===e||void 0===e?re():s(e)?o(e)?e.entrySeq():e:oe(e)).toSetSeq()}L.prototype.toString=function(){return"[Iterator]"},L.KEYS=I,L.VALUES=D,L.ENTRIES=M,L.prototype.inspect=L.prototype.toSource=function(){return this.toString()},L.prototype[q]=function(){return this},t(z,n),z.of=function(){return z(arguments)},z.prototype.toSeq=function(){return this},z.prototype.toString=function(){return this.__toString("Seq {","}")},z.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},z.prototype.__iterate=function(e,t){return ce(this,e,t,!0)},z.prototype.__iterator=function(e,t){return ue(this,e,t,!0)},t(Q,z),Q.prototype.toKeyedSeq=function(){return this},t(W,z),W.of=function(){return W(arguments)},W.prototype.toIndexedSeq=function(){return this},W.prototype.toString=function(){return this.__toString("Seq [","]")},W.prototype.__iterate=function(e,t){return ce(this,e,t,!1)},W.prototype.__iterator=function(e,t){return ue(this,e,t,!1)},t($,z),$.of=function(){return $(arguments)},$.prototype.toSetSeq=function(){return this},z.isSeq=ae,z.Keyed=Q,z.Set=$,z.Indexed=W;var K,Y,X,Z="@@__IMMUTABLE_SEQ__@@";function ee(e){this._array=e,this.size=e.length}function te(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function ne(e){this._iterable=e,this.size=e.length||e.size}function ie(e){this._iterator=e,this._iteratorCache=[]}function ae(e){return!(!e||!e[Z])}function re(){return K||(K=new ee([]))}function se(e){var t=Array.isArray(e)?new ee(e).fromEntrySeq():U(e)?new ie(e).fromEntrySeq():J(e)?new ne(e).fromEntrySeq():"object"==typeof e?new te(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function oe(e){var t=le(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function le(e){return G(e)?new ee(e):U(e)?new ie(e):J(e)?new ne(e):void 0}function ce(e,t,n,i){var a=e._cache;if(a){for(var r=a.length-1,s=0;s<=r;s++){var o=a[n?r-s:s];if(!1===t(o[1],i?o[0]:s,e))return s+1}return s}return e.__iterateUncached(t,n)}function ue(e,t,n,i){var a=e._cache;if(a){var r=a.length-1,s=0;return new L(function(){var e=a[n?r-s:s];return s++>r?{value:void 0,done:!0}:B(t,i?e[0]:s-1,e[1])})}return e.__iteratorUncached(t,n)}function de(e,t){return t?function e(t,n,i,a){if(Array.isArray(n))return t.call(a,i,W(n).map(function(i,a){return e(t,i,a,n)}));if(pe(n))return t.call(a,i,Q(n).map(function(i,a){return e(t,i,a,n)}));return n}(t,e,"",{"":e}):he(e)}function he(e){return Array.isArray(e)?W(e).map(he).toList():pe(e)?Q(e).map(he).toMap():e}function pe(e){return e&&(e.constructor===Object||void 0===e.constructor)}function fe(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!("function"!=typeof e.equals||"function"!=typeof t.equals||!e.equals(t))}function ge(e,t){if(e===t)return!0;if(!s(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||o(e)!==o(t)||l(e)!==l(t)||u(e)!==u(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!c(e);if(u(e)){var i=e.entries();return t.every(function(e,t){var a=i.next().value;return a&&fe(a[1],e)&&(n||fe(a[0],t))})&&i.next().done}var a=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{a=!0;var r=e;e=t,t=r}var d=!0,h=t.__iterate(function(t,i){if(n?!e.has(t):a?!fe(t,e.get(i,v)):!fe(e.get(i,v),t))return d=!1,!1});return d&&e.size===h}function me(e,t){if(!(this instanceof me))return new me(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(Y)return Y;Y=this}}function be(e,t){if(!e)throw new Error(t)}function ve(e,t,n){if(!(this instanceof ve))return new ve(e,t,n);if(be(0!==n,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),n=void 0===n?1:Math.abs(n),t<e&&(n=-n),this._start=e,this._end=t,this._step=n,this.size=Math.max(0,Math.ceil((t-e)/n-1)+1),0===this.size){if(X)return X;X=this}}function ye(){throw TypeError("Abstract")}function _e(){}function we(){}function Se(){}z.prototype[Z]=!0,t(ee,W),ee.prototype.get=function(e,t){return this.has(e)?this._array[P(this,e)]:t},ee.prototype.__iterate=function(e,t){for(var n=this._array,i=n.length-1,a=0;a<=i;a++)if(!1===e(n[t?i-a:a],a,this))return a+1;return a},ee.prototype.__iterator=function(e,t){var n=this._array,i=n.length-1,a=0;return new L(function(){return a>i?{value:void 0,done:!0}:B(e,a,n[t?i-a++:a++])})},t(te,Q),te.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},te.prototype.has=function(e){return this._object.hasOwnProperty(e)},te.prototype.__iterate=function(e,t){for(var n=this._object,i=this._keys,a=i.length-1,r=0;r<=a;r++){var s=i[t?a-r:r];if(!1===e(n[s],s,this))return r+1}return r},te.prototype.__iterator=function(e,t){var n=this._object,i=this._keys,a=i.length-1,r=0;return new L(function(){var s=i[t?a-r:r];return r++>a?{value:void 0,done:!0}:B(e,s,n[s])})},te.prototype[f]=!0,t(ne,W),ne.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=V(this._iterable),i=0;if(U(n))for(var a;!(a=n.next()).done&&!1!==e(a.value,i++,this););return i},ne.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=V(this._iterable);if(!U(n))return new L(F);var i=0;return new L(function(){var t=n.next();return t.done?t:B(e,i++,t.value)})},t(ie,W),ie.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var n,i=this._iterator,a=this._iteratorCache,r=0;r<a.length;)if(!1===e(a[r],r++,this))return r;for(;!(n=i.next()).done;){var s=n.value;if(a[r]=s,!1===e(s,r++,this))break}return r},ie.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,i=this._iteratorCache,a=0;return new L(function(){if(a>=i.length){var t=n.next();if(t.done)return t;i[a]=t.value}return B(e,a,i[a++])})},t(me,W),me.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},me.prototype.get=function(e,t){return this.has(e)?this._value:t},me.prototype.includes=function(e){return fe(this._value,e)},me.prototype.slice=function(e,t){var n=this.size;return k(e,t,n)?this:new me(this._value,O(t,n)-R(e,n))},me.prototype.reverse=function(){return this},me.prototype.indexOf=function(e){return fe(this._value,e)?0:-1},me.prototype.lastIndexOf=function(e){return fe(this._value,e)?this.size:-1},me.prototype.__iterate=function(e,t){for(var n=0;n<this.size;n++)if(!1===e(this._value,n,this))return n+1;return n},me.prototype.__iterator=function(e,t){var n=this,i=0;return new L(function(){return i<n.size?B(e,i++,n._value):{value:void 0,done:!0}})},me.prototype.equals=function(e){return e instanceof me?fe(this._value,e._value):ge(e)},t(ve,W),ve.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},ve.prototype.get=function(e,t){return this.has(e)?this._start+P(this,e)*this._step:t},ve.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},ve.prototype.slice=function(e,t){return k(e,t,this.size)?this:(e=R(e,this.size),(t=O(t,this.size))<=e?new ve(0,0):new ve(this.get(e,this._end),this.get(t,this._end),this._step))},ve.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},ve.prototype.lastIndexOf=function(e){return this.indexOf(e)},ve.prototype.__iterate=function(e,t){for(var n=this.size-1,i=this._step,a=t?this._start+n*i:this._start,r=0;r<=n;r++){if(!1===e(a,r,this))return r+1;a+=t?-i:i}return r},ve.prototype.__iterator=function(e,t){var n=this.size-1,i=this._step,a=t?this._start+n*i:this._start,r=0;return new L(function(){var s=a;return a+=t?-i:i,r>n?{value:void 0,done:!0}:B(e,r++,s)})},ve.prototype.equals=function(e){return e instanceof ve?this._start===e._start&&this._end===e._end&&this._step===e._step:ge(this,e)},t(ye,n),t(_e,ye),t(we,ye),t(Se,ye),ye.Keyed=_e,ye.Indexed=we,ye.Set=Se;var Ee="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var n=65535&(e|=0),i=65535&(t|=0);return n*i+((e>>>16)*i+n*(t>>>16)<<16>>>0)|0};function xe(e){return e>>>1&1073741824|3221225471&e}function Ae(e){if(!1===e||null===e||void 0===e)return 0;if("function"==typeof e.valueOf&&(!1===(e=e.valueOf())||null===e||void 0===e))return 0;if(!0===e)return 1;var t=typeof e;if("number"===t){if(e!=e||e===1/0)return 0;var n=0|e;for(n!==e&&(n^=4294967295*e);e>4294967295;)n^=e/=4294967295;return xe(n)}if("string"===t)return e.length>De?function(e){var t=Ne[e];void 0===t&&(t=Pe(e),je===Me&&(je=0,Ne={}),je++,Ne[e]=t);return t}(e):Pe(e);if("function"==typeof e.hashCode)return e.hashCode();if("object"===t)return function(e){var t;if(Oe&&void 0!==(t=Re.get(e)))return t;if(void 0!==(t=e[Ie]))return t;if(!ke){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Ie]))return t;if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}t=++Te,1073741824&Te&&(Te=0);if(Oe)Re.set(e,t);else{if(void 0!==Ce&&!1===Ce(e))throw new Error("Non-extensible objects are not allowed as keys.");if(ke)Object.defineProperty(e,Ie,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Ie]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Ie]=t}}return t}(e);if("function"==typeof e.toString)return Pe(e.toString());throw new Error("Value type "+t+" cannot be hashed.")}function Pe(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return xe(t)}var Ce=Object.isExtensible,ke=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}();var Re,Oe="function"==typeof WeakMap;Oe&&(Re=new WeakMap);var Te=0,Ie="__immutablehash__";"function"==typeof Symbol&&(Ie=Symbol(Ie));var De=16,Me=255,je=0,Ne={};function qe(e){be(e!==1/0,"Cannot perform this action with an infinite size.")}function Le(e){return null===e||void 0===e?Xe():Be(e)&&!u(e)?e:Xe().withMutations(function(t){var n=i(e);qe(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Be(e){return!(!e||!e[Je])}t(Le,_e),Le.of=function(){var t=e.call(arguments,0);return Xe().withMutations(function(e){for(var n=0;n<t.length;n+=2){if(n+1>=t.length)throw new Error("Missing value for key: "+t[n]);e.set(t[n],t[n+1])}})},Le.prototype.toString=function(){return this.__toString("Map {","}")},Le.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Le.prototype.set=function(e,t){return Ze(this,e,t)},Le.prototype.setIn=function(e,t){return this.updateIn(e,v,function(){return t})},Le.prototype.remove=function(e){return Ze(this,e,v)},Le.prototype.deleteIn=function(e){return this.updateIn(e,function(){return v})},Le.prototype.update=function(e,t,n){return 1===arguments.length?e(this):this.updateIn([e],t,n)},Le.prototype.updateIn=function(e,t,n){n||(n=t,t=void 0);var i=function e(t,n,i,a){var r=t===v;var s=n.next();if(s.done){var o=r?i:t,l=a(o);return l===o?t:l}be(r||t&&t.set,"invalid keyPath");var c=s.value;var u=r?v:t.get(c,v);var d=e(u,n,i,a);return d===u?t:d===v?t.remove(c):(r?Xe():t).set(c,d)}(this,nn(e),t,n);return i===v?void 0:i},Le.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Xe()},Le.prototype.merge=function(){return it(this,void 0,arguments)},Le.prototype.mergeWith=function(t){return it(this,t,e.call(arguments,1))},Le.prototype.mergeIn=function(t){var n=e.call(arguments,1);return this.updateIn(t,Xe(),function(e){return"function"==typeof e.merge?e.merge.apply(e,n):n[n.length-1]})},Le.prototype.mergeDeep=function(){return it(this,at,arguments)},Le.prototype.mergeDeepWith=function(t){var n=e.call(arguments,1);return it(this,rt(t),n)},Le.prototype.mergeDeepIn=function(t){var n=e.call(arguments,1);return this.updateIn(t,Xe(),function(e){return"function"==typeof e.mergeDeep?e.mergeDeep.apply(e,n):n[n.length-1]})},Le.prototype.sort=function(e){return Rt(Gt(this,e))},Le.prototype.sortBy=function(e,t){return Rt(Gt(this,t,e))},Le.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Le.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new E)},Le.prototype.asImmutable=function(){return this.__ensureOwner()},Le.prototype.wasAltered=function(){return this.__altered},Le.prototype.__iterator=function(e,t){return new We(this,e,t)},Le.prototype.__iterate=function(e,t){var n=this,i=0;return this._root&&this._root.iterate(function(t){return i++,e(t[1],t[0],n)},t),i},Le.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Ye(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Le.isMap=Be;var Fe,Je="@@__IMMUTABLE_MAP__@@",Ue=Le.prototype;function Ve(e,t){this.ownerID=e,this.entries=t}function He(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}function Ge(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}function ze(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}function Qe(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}function We(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&Ke(e._root)}function $e(e,t){return B(e,t[0],t[1])}function Ke(e,t){return{node:e,index:0,__prev:t}}function Ye(e,t,n,i){var a=Object.create(Ue);return a.size=e,a._root=t,a.__ownerID=n,a.__hash=i,a.__altered=!1,a}function Xe(){return Fe||(Fe=Ye(0))}function Ze(e,t,n){var i,a;if(e._root){var r=w(y),s=w(_);if(i=et(e._root,e.__ownerID,0,void 0,t,n,r,s),!s.value)return e;a=e.size+(r.value?n===v?-1:1:0)}else{if(n===v)return e;a=1,i=new Ve(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=a,e._root=i,e.__hash=void 0,e.__altered=!0,e):i?Ye(a,i):Xe()}function et(e,t,n,i,a,r,s,o){return e?e.update(t,n,i,a,r,s,o):r===v?e:(S(o),S(s),new Qe(t,i,[a,r]))}function tt(e){return e.constructor===Qe||e.constructor===ze}function nt(e,t,n,i,a){if(e.keyHash===i)return new ze(t,i,[e.entry,a]);var r,s=(0===n?e.keyHash:e.keyHash>>>n)&b,o=(0===n?i:i>>>n)&b;return new He(t,1<<s|1<<o,s===o?[nt(e,t,n+g,i,a)]:(r=new Qe(t,i,a),s<o?[e,r]:[r,e]))}function it(e,t,n){for(var a=[],r=0;r<n.length;r++){var o=n[r],l=i(o);s(o)||(l=l.map(function(e){return de(e)})),a.push(l)}return st(e,t,a)}function at(e,t,n){return e&&e.mergeDeep&&s(t)?e.mergeDeep(t):fe(e,t)?e:t}function rt(e){return function(t,n,i){if(t&&t.mergeDeepWith&&s(n))return t.mergeDeepWith(e,n);var a=e(t,n,i);return fe(t,a)?t:a}}function st(e,t,n){return 0===(n=n.filter(function(e){return 0!==e.size})).length?e:0!==e.size||e.__ownerID||1!==n.length?e.withMutations(function(e){for(var i=t?function(n,i){e.update(i,v,function(e){return e===v?n:t(e,n,i)})}:function(t,n){e.set(n,t)},a=0;a<n.length;a++)n[a].forEach(i)}):e.constructor(n[0])}function ot(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function lt(e,t,n,i){var a=i?e:x(e);return a[t]=n,a}Ue[Je]=!0,Ue.delete=Ue.remove,Ue.removeIn=Ue.deleteIn,Ve.prototype.get=function(e,t,n,i){for(var a=this.entries,r=0,s=a.length;r<s;r++)if(fe(n,a[r][0]))return a[r][1];return i},Ve.prototype.update=function(e,t,n,i,a,r,s){for(var o=a===v,l=this.entries,c=0,u=l.length;c<u&&!fe(i,l[c][0]);c++);var d=c<u;if(d?l[c][1]===a:o)return this;if(S(s),(o||!d)&&S(r),!o||1!==l.length){if(!d&&!o&&l.length>=ct)return function(e,t,n,i){e||(e=new E);for(var a=new Qe(e,Ae(n),[n,i]),r=0;r<t.length;r++){var s=t[r];a=a.update(e,0,void 0,s[0],s[1])}return a}(e,l,i,a);var h=e&&e===this.ownerID,p=h?l:x(l);return d?o?c===u-1?p.pop():p[c]=p.pop():p[c]=[i,a]:p.push([i,a]),h?(this.entries=p,this):new Ve(e,p)}},He.prototype.get=function(e,t,n,i){void 0===t&&(t=Ae(n));var a=1<<((0===e?t:t>>>e)&b),r=this.bitmap;return 0==(r&a)?i:this.nodes[ot(r&a-1)].get(e+g,t,n,i)},He.prototype.update=function(e,t,n,i,a,r,s){void 0===n&&(n=Ae(i));var o=(0===t?n:n>>>t)&b,l=1<<o,c=this.bitmap,u=0!=(c&l);if(!u&&a===v)return this;var d=ot(c&l-1),h=this.nodes,p=u?h[d]:void 0,f=et(p,e,t+g,n,i,a,r,s);if(f===p)return this;if(!u&&f&&h.length>=ut)return function(e,t,n,i,a){for(var r=0,s=new Array(m),o=0;0!==n;o++,n>>>=1)s[o]=1&n?t[r++]:void 0;return s[i]=a,new Ge(e,r+1,s)}(e,h,c,o,f);if(u&&!f&&2===h.length&&tt(h[1^d]))return h[1^d];if(u&&f&&1===h.length&&tt(f))return f;var y=e&&e===this.ownerID,_=u?f?c:c^l:c|l,w=u?f?lt(h,d,f,y):function(e,t,n){var i=e.length-1;if(n&&t===i)return e.pop(),e;for(var a=new Array(i),r=0,s=0;s<i;s++)s===t&&(r=1),a[s]=e[s+r];return a}(h,d,y):function(e,t,n,i){var a=e.length+1;if(i&&t+1===a)return e[t]=n,e;for(var r=new Array(a),s=0,o=0;o<a;o++)o===t?(r[o]=n,s=-1):r[o]=e[o+s];return r}(h,d,f,y);return y?(this.bitmap=_,this.nodes=w,this):new He(e,_,w)},Ge.prototype.get=function(e,t,n,i){void 0===t&&(t=Ae(n));var a=(0===e?t:t>>>e)&b,r=this.nodes[a];return r?r.get(e+g,t,n,i):i},Ge.prototype.update=function(e,t,n,i,a,r,s){void 0===n&&(n=Ae(i));var o=(0===t?n:n>>>t)&b,l=a===v,c=this.nodes,u=c[o];if(l&&!u)return this;var d=et(u,e,t+g,n,i,a,r,s);if(d===u)return this;var h=this.count;if(u){if(!d&&--h<dt)return function(e,t,n,i){for(var a=0,r=0,s=new Array(n),o=0,l=1,c=t.length;o<c;o++,l<<=1){var u=t[o];void 0!==u&&o!==i&&(a|=l,s[r++]=u)}return new He(e,a,s)}(e,c,h,o)}else h++;var p=e&&e===this.ownerID,f=lt(c,o,d,p);return p?(this.count=h,this.nodes=f,this):new Ge(e,h,f)},ze.prototype.get=function(e,t,n,i){for(var a=this.entries,r=0,s=a.length;r<s;r++)if(fe(n,a[r][0]))return a[r][1];return i},ze.prototype.update=function(e,t,n,i,a,r,s){void 0===n&&(n=Ae(i));var o=a===v;if(n!==this.keyHash)return o?this:(S(s),S(r),nt(this,e,t,n,[i,a]));for(var l=this.entries,c=0,u=l.length;c<u&&!fe(i,l[c][0]);c++);var d=c<u;if(d?l[c][1]===a:o)return this;if(S(s),(o||!d)&&S(r),o&&2===u)return new Qe(e,this.keyHash,l[1^c]);var h=e&&e===this.ownerID,p=h?l:x(l);return d?o?c===u-1?p.pop():p[c]=p.pop():p[c]=[i,a]:p.push([i,a]),h?(this.entries=p,this):new ze(e,this.keyHash,p)},Qe.prototype.get=function(e,t,n,i){return fe(n,this.entry[0])?this.entry[1]:i},Qe.prototype.update=function(e,t,n,i,a,r,s){var o=a===v,l=fe(i,this.entry[0]);return(l?a===this.entry[1]:o)?this:(S(s),o?void S(r):l?e&&e===this.ownerID?(this.entry[1]=a,this):new Qe(e,this.keyHash,[i,a]):(S(r),nt(this,e,t,Ae(i),[i,a])))},Ve.prototype.iterate=ze.prototype.iterate=function(e,t){for(var n=this.entries,i=0,a=n.length-1;i<=a;i++)if(!1===e(n[t?a-i:i]))return!1},He.prototype.iterate=Ge.prototype.iterate=function(e,t){for(var n=this.nodes,i=0,a=n.length-1;i<=a;i++){var r=n[t?a-i:i];if(r&&!1===r.iterate(e,t))return!1}},Qe.prototype.iterate=function(e,t){return e(this.entry)},t(We,L),We.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n,i=t.node,a=t.index++;if(i.entry){if(0===a)return $e(e,i.entry)}else if(i.entries){if(a<=(n=i.entries.length-1))return $e(e,i.entries[this._reverse?n-a:a])}else if(a<=(n=i.nodes.length-1)){var r=i.nodes[this._reverse?n-a:a];if(r){if(r.entry)return $e(e,r.entry);t=this._stack=Ke(r,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var ct=m/4,ut=m/2,dt=m/4;function ht(e){var t=St();if(null===e||void 0===e)return t;if(pt(e))return e;var n=a(e),i=n.size;return 0===i?t:(qe(i),i>0&&i<m?wt(0,i,g,null,new mt(n.toArray())):t.withMutations(function(e){e.setSize(i),n.forEach(function(t,n){return e.set(n,t)})}))}function pt(e){return!(!e||!e[ft])}t(ht,we),ht.of=function(){return this(arguments)},ht.prototype.toString=function(){return this.__toString("List [","]")},ht.prototype.get=function(e,t){if((e=P(this,e))>=0&&e<this.size){var n=At(this,e+=this._origin);return n&&n.array[e&b]}return t},ht.prototype.set=function(e,t){return function(e,t,n){if((t=P(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function(e){t<0?Pt(e,t).set(0,n):Pt(e,0,t+1).set(t,n)});t+=e._origin;var i=e._tail,a=e._root,r=w(_);t>=kt(e._capacity)?i=Et(i,e.__ownerID,0,t,n,r):a=Et(a,e.__ownerID,e._level,t,n,r);if(!r.value)return e;if(e.__ownerID)return e._root=a,e._tail=i,e.__hash=void 0,e.__altered=!0,e;return wt(e._origin,e._capacity,e._level,a,i)}(this,e,t)},ht.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},ht.prototype.insert=function(e,t){return this.splice(e,0,t)},ht.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=g,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):St()},ht.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){Pt(n,0,t+e.length);for(var i=0;i<e.length;i++)n.set(t+i,e[i])})},ht.prototype.pop=function(){return Pt(this,0,-1)},ht.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Pt(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},ht.prototype.shift=function(){return Pt(this,1)},ht.prototype.merge=function(){return Ct(this,void 0,arguments)},ht.prototype.mergeWith=function(t){return Ct(this,t,e.call(arguments,1))},ht.prototype.mergeDeep=function(){return Ct(this,at,arguments)},ht.prototype.mergeDeepWith=function(t){var n=e.call(arguments,1);return Ct(this,rt(t),n)},ht.prototype.setSize=function(e){return Pt(this,0,e)},ht.prototype.slice=function(e,t){var n=this.size;return k(e,t,n)?this:Pt(this,R(e,n),O(t,n))},ht.prototype.__iterator=function(e,t){var n=0,i=_t(this,t);return new L(function(){var t=i();return t===yt?{value:void 0,done:!0}:B(e,n++,t)})},ht.prototype.__iterate=function(e,t){for(var n,i=0,a=_t(this,t);(n=a())!==yt&&!1!==e(n,i++,this););return i},ht.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?wt(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},ht.isList=pt;var ft="@@__IMMUTABLE_LIST__@@",gt=ht.prototype;function mt(e,t){this.array=e,this.ownerID=t}gt[ft]=!0,gt.delete=gt.remove,gt.setIn=Ue.setIn,gt.deleteIn=gt.removeIn=Ue.removeIn,gt.update=Ue.update,gt.updateIn=Ue.updateIn,gt.mergeIn=Ue.mergeIn,gt.mergeDeepIn=Ue.mergeDeepIn,gt.withMutations=Ue.withMutations,gt.asMutable=Ue.asMutable,gt.asImmutable=Ue.asImmutable,gt.wasAltered=Ue.wasAltered,mt.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var i=n>>>t&b;if(i>=this.array.length)return new mt([],e);var a,r=0===i;if(t>0){var s=this.array[i];if((a=s&&s.removeBefore(e,t-g,n))===s&&r)return this}if(r&&!a)return this;var o=xt(this,e);if(!r)for(var l=0;l<i;l++)o.array[l]=void 0;return a&&(o.array[i]=a),o},mt.prototype.removeAfter=function(e,t,n){if(n===(t?1<<t:0)||0===this.array.length)return this;var i,a=n-1>>>t&b;if(a>=this.array.length)return this;if(t>0){var r=this.array[a];if((i=r&&r.removeAfter(e,t-g,n))===r&&a===this.array.length-1)return this}var s=xt(this,e);return s.array.splice(a+1),i&&(s.array[a]=i),s};var bt,vt,yt={};function _t(e,t){var n=e._origin,i=e._capacity,a=kt(i),r=e._tail;return s(e._root,e._level,0);function s(e,o,l){return 0===o?function(e,s){var o=s===a?r&&r.array:e&&e.array,l=s>n?0:n-s,c=i-s;c>m&&(c=m);return function(){if(l===c)return yt;var e=t?--c:l++;return o&&o[e]}}(e,l):function(e,a,r){var o,l=e&&e.array,c=r>n?0:n-r>>a,u=1+(i-r>>a);u>m&&(u=m);return function(){for(;;){if(o){var e=o();if(e!==yt)return e;o=null}if(c===u)return yt;var n=t?--u:c++;o=s(l&&l[n],a-g,r+(n<<a))}}}(e,o,l)}}function wt(e,t,n,i,a,r,s){var o=Object.create(gt);return o.size=t-e,o._origin=e,o._capacity=t,o._level=n,o._root=i,o._tail=a,o.__ownerID=r,o.__hash=s,o.__altered=!1,o}function St(){return bt||(bt=wt(0,0,g))}function Et(e,t,n,i,a,r){var s,o=i>>>n&b,l=e&&o<e.array.length;if(!l&&void 0===a)return e;if(n>0){var c=e&&e.array[o],u=Et(c,t,n-g,i,a,r);return u===c?e:((s=xt(e,t)).array[o]=u,s)}return l&&e.array[o]===a?e:(S(r),s=xt(e,t),void 0===a&&o===s.array.length-1?s.array.pop():s.array[o]=a,s)}function xt(e,t){return t&&e&&t===e.ownerID?e:new mt(e?e.array.slice():[],t)}function At(e,t){if(t>=kt(e._capacity))return e._tail;if(t<1<<e._level+g){for(var n=e._root,i=e._level;n&&i>0;)n=n.array[t>>>i&b],i-=g;return n}}function Pt(e,t,n){void 0!==t&&(t|=0),void 0!==n&&(n|=0);var i=e.__ownerID||new E,a=e._origin,r=e._capacity,s=a+t,o=void 0===n?r:n<0?r+n:a+n;if(s===a&&o===r)return e;if(s>=o)return e.clear();for(var l=e._level,c=e._root,u=0;s+u<0;)c=new mt(c&&c.array.length?[void 0,c]:[],i),u+=1<<(l+=g);u&&(s+=u,a+=u,o+=u,r+=u);for(var d=kt(r),h=kt(o);h>=1<<l+g;)c=new mt(c&&c.array.length?[c]:[],i),l+=g;var p=e._tail,f=h<d?At(e,o-1):h>d?new mt([],i):p;if(p&&h>d&&s<r&&p.array.length){for(var m=c=xt(c,i),v=l;v>g;v-=g){var y=d>>>v&b;m=m.array[y]=xt(m.array[y],i)}m.array[d>>>g&b]=p}if(o<r&&(f=f&&f.removeAfter(i,0,o)),s>=h)s-=h,o-=h,l=g,c=null,f=f&&f.removeBefore(i,0,s);else if(s>a||h<d){for(u=0;c;){var _=s>>>l&b;if(_!==h>>>l&b)break;_&&(u+=(1<<l)*_),l-=g,c=c.array[_]}c&&s>a&&(c=c.removeBefore(i,l,s-u)),c&&h<d&&(c=c.removeAfter(i,l,h-u)),u&&(s-=u,o-=u)}return e.__ownerID?(e.size=o-s,e._origin=s,e._capacity=o,e._level=l,e._root=c,e._tail=f,e.__hash=void 0,e.__altered=!0,e):wt(s,o,l,c,f)}function Ct(e,t,n){for(var i=[],r=0,o=0;o<n.length;o++){var l=n[o],c=a(l);c.size>r&&(r=c.size),s(l)||(c=c.map(function(e){return de(e)})),i.push(c)}return r>e.size&&(e=e.setSize(r)),st(e,t,i)}function kt(e){return e<m?0:e-1>>>g<<g}function Rt(e){return null===e||void 0===e?It():Ot(e)?e:It().withMutations(function(t){var n=i(e);qe(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Ot(e){return Be(e)&&u(e)}function Tt(e,t,n,i){var a=Object.create(Rt.prototype);return a.size=e?e.size:0,a._map=e,a._list=t,a.__ownerID=n,a.__hash=i,a}function It(){return vt||(vt=Tt(Xe(),St()))}function Dt(e,t,n){var i,a,r=e._map,s=e._list,o=r.get(t),l=void 0!==o;if(n===v){if(!l)return e;s.size>=m&&s.size>=2*r.size?(i=(a=s.filter(function(e,t){return void 0!==e&&o!==t})).toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(i.__ownerID=a.__ownerID=e.__ownerID)):(i=r.remove(t),a=o===s.size-1?s.pop():s.set(o,void 0))}else if(l){if(n===s.get(o)[1])return e;i=r,a=s.set(o,[t,n])}else i=r.set(t,s.size),a=s.set(s.size,[t,n]);return e.__ownerID?(e.size=i.size,e._map=i,e._list=a,e.__hash=void 0,e):Tt(i,a)}function Mt(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function jt(e){this._iter=e,this.size=e.size}function Nt(e){this._iter=e,this.size=e.size}function qt(e){this._iter=e,this.size=e.size}function Lt(e){var t=Zt(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=en,t.__iterateUncached=function(t,n){var i=this;return e.__iterate(function(e,n){return!1!==t(n,e,i)},n)},t.__iteratorUncached=function(t,n){if(t===M){var i=e.__iterator(t,n);return new L(function(){var e=i.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===D?I:D,n)},t}function Bt(e,t,n){var i=Zt(e);return i.size=e.size,i.has=function(t){return e.has(t)},i.get=function(i,a){var r=e.get(i,v);return r===v?a:t.call(n,r,i,e)},i.__iterateUncached=function(i,a){var r=this;return e.__iterate(function(e,a,s){return!1!==i(t.call(n,e,a,s),a,r)},a)},i.__iteratorUncached=function(i,a){var r=e.__iterator(M,a);return new L(function(){var a=r.next();if(a.done)return a;var s=a.value,o=s[0];return B(i,o,t.call(n,s[1],o,e),a)})},i}function Ft(e,t){var n=Zt(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=Lt(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,i){return e.get(t?n:-1-n,i)},n.has=function(n){return e.has(t?n:-1-n)},n.includes=function(t){return e.includes(t)},n.cacheResult=en,n.__iterate=function(t,n){var i=this;return e.__iterate(function(e,n){return t(e,n,i)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function Jt(e,t,n,i){var a=Zt(e);return i&&(a.has=function(i){var a=e.get(i,v);return a!==v&&!!t.call(n,a,i,e)},a.get=function(i,a){var r=e.get(i,v);return r!==v&&t.call(n,r,i,e)?r:a}),a.__iterateUncached=function(a,r){var s=this,o=0;return e.__iterate(function(e,r,l){if(t.call(n,e,r,l))return o++,a(e,i?r:o-1,s)},r),o},a.__iteratorUncached=function(a,r){var s=e.__iterator(M,r),o=0;return new L(function(){for(;;){var r=s.next();if(r.done)return r;var l=r.value,c=l[0],u=l[1];if(t.call(n,u,c,e))return B(a,i?c:o++,u,r)}})},a}function Ut(e,t,n,i){var a=e.size;if(void 0!==t&&(t|=0),void 0!==n&&(n===1/0?n=a:n|=0),k(t,n,a))return e;var r=R(t,a),s=O(n,a);if(r!=r||s!=s)return Ut(e.toSeq().cacheResult(),t,n,i);var o,l=s-r;l==l&&(o=l<0?0:l);var c=Zt(e);return c.size=0===o?o:e.size&&o||void 0,!i&&ae(e)&&o>=0&&(c.get=function(t,n){return(t=P(this,t))>=0&&t<o?e.get(t+r,n):n}),c.__iterateUncached=function(t,n){var a=this;if(0===o)return 0;if(n)return this.cacheResult().__iterate(t,n);var s=0,l=!0,c=0;return e.__iterate(function(e,n){if(!l||!(l=s++<r))return c++,!1!==t(e,i?n:c-1,a)&&c!==o}),c},c.__iteratorUncached=function(t,n){if(0!==o&&n)return this.cacheResult().__iterator(t,n);var a=0!==o&&e.__iterator(t,n),s=0,l=0;return new L(function(){for(;s++<r;)a.next();if(++l>o)return{value:void 0,done:!0};var e=a.next();return i||t===D?e:B(t,l-1,t===I?void 0:e.value[1],e)})},c}function Vt(e,t,n,i){var a=Zt(e);return a.__iterateUncached=function(a,r){var s=this;if(r)return this.cacheResult().__iterate(a,r);var o=!0,l=0;return e.__iterate(function(e,r,c){if(!o||!(o=t.call(n,e,r,c)))return l++,a(e,i?r:l-1,s)}),l},a.__iteratorUncached=function(a,r){var s=this;if(r)return this.cacheResult().__iterator(a,r);var o=e.__iterator(M,r),l=!0,c=0;return new L(function(){var e,r,u;do{if((e=o.next()).done)return i||a===D?e:B(a,c++,a===I?void 0:e.value[1],e);var d=e.value;r=d[0],u=d[1],l&&(l=t.call(n,u,r,s))}while(l);return a===M?e:B(a,r,u,e)})},a}function Ht(e,t,n){var i=Zt(e);return i.__iterateUncached=function(i,a){var r=0,o=!1;return function e(l,c){var u=this;l.__iterate(function(a,l){return(!t||c<t)&&s(a)?e(a,c+1):!1===i(a,n?l:r++,u)&&(o=!0),!o},a)}(e,0),r},i.__iteratorUncached=function(i,a){var r=e.__iterator(i,a),o=[],l=0;return new L(function(){for(;r;){var e=r.next();if(!1===e.done){var c=e.value;if(i===M&&(c=c[1]),t&&!(o.length<t)||!s(c))return n?e:B(i,l++,c,e);o.push(r),r=c.__iterator(i,a)}else r=o.pop()}return{value:void 0,done:!0}})},i}function Gt(e,t,n){t||(t=tn);var i=o(e),a=0,r=e.toSeq().map(function(t,i){return[i,t,a++,n?n(t,i,e):t]}).toArray();return r.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(i?function(e,t){r[t].length=2}:function(e,t){r[t]=e[1]}),i?Q(r):l(e)?W(r):$(r)}function zt(e,t,n){if(t||(t=tn),n){var i=e.toSeq().map(function(t,i){return[t,n(t,i,e)]}).reduce(function(e,n){return Qt(t,e[1],n[1])?n:e});return i&&i[0]}return e.reduce(function(e,n){return Qt(t,e,n)?n:e})}function Qt(e,t,n){var i=e(n,t);return 0===i&&n!==t&&(void 0===n||null===n||n!=n)||i>0}function Wt(e,t,i){var a=Zt(e);return a.size=new ee(i).map(function(e){return e.size}).min(),a.__iterate=function(e,t){for(var n,i=this.__iterator(D,t),a=0;!(n=i.next()).done&&!1!==e(n.value,a++,this););return a},a.__iteratorUncached=function(e,a){var r=i.map(function(e){return e=n(e),V(a?e.reverse():e)}),s=0,o=!1;return new L(function(){var n;return o||(n=r.map(function(e){return e.next()}),o=n.some(function(e){return e.done})),o?{value:void 0,done:!0}:B(e,s++,t.apply(null,n.map(function(e){return e.value})))})},a}function $t(e,t){return ae(e)?t:e.constructor(t)}function Kt(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Yt(e){return qe(e.size),A(e)}function Xt(e){return o(e)?i:l(e)?a:r}function Zt(e){return Object.create((o(e)?Q:l(e)?W:$).prototype)}function en(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):z.prototype.cacheResult.call(this)}function tn(e,t){return e>t?1:e<t?-1:0}function nn(e){var t=V(e);if(!t){if(!G(e))throw new TypeError("Expected iterable or array-like: "+e);t=V(n(e))}return t}function an(e,t){var n,i=function(r){if(r instanceof i)return r;if(!(this instanceof i))return new i(r);if(!n){n=!0;var s=Object.keys(e);!function(e,t){try{t.forEach(function(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){be(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}.bind(void 0,e))}catch(e){}}(a,s),a.size=s.length,a._name=t,a._keys=s,a._defaultValues=e}this._map=Le(r)},a=i.prototype=Object.create(rn);return a.constructor=i,i}t(Rt,Le),Rt.of=function(){return this(arguments)},Rt.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Rt.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},Rt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):It()},Rt.prototype.set=function(e,t){return Dt(this,e,t)},Rt.prototype.remove=function(e){return Dt(this,e,v)},Rt.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Rt.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},Rt.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},Rt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?Tt(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)},Rt.isOrderedMap=Ot,Rt.prototype[f]=!0,Rt.prototype.delete=Rt.prototype.remove,t(Mt,Q),Mt.prototype.get=function(e,t){return this._iter.get(e,t)},Mt.prototype.has=function(e){return this._iter.has(e)},Mt.prototype.valueSeq=function(){return this._iter.valueSeq()},Mt.prototype.reverse=function(){var e=this,t=Ft(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},Mt.prototype.map=function(e,t){var n=this,i=Bt(this,e,t);return this._useKeys||(i.valueSeq=function(){return n._iter.toSeq().map(e,t)}),i},Mt.prototype.__iterate=function(e,t){var n,i=this;return this._iter.__iterate(this._useKeys?function(t,n){return e(t,n,i)}:(n=t?Yt(this):0,function(a){return e(a,t?--n:n++,i)}),t)},Mt.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(D,t),i=t?Yt(this):0;return new L(function(){var a=n.next();return a.done?a:B(e,t?--i:i++,a.value,a)})},Mt.prototype[f]=!0,t(jt,W),jt.prototype.includes=function(e){return this._iter.includes(e)},jt.prototype.__iterate=function(e,t){var n=this,i=0;return this._iter.__iterate(function(t){return e(t,i++,n)},t)},jt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(D,t),i=0;return new L(function(){var t=n.next();return t.done?t:B(e,i++,t.value,t)})},t(Nt,$),Nt.prototype.has=function(e){return this._iter.includes(e)},Nt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},Nt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(D,t);return new L(function(){var t=n.next();return t.done?t:B(e,t.value,t.value,t)})},t(qt,Q),qt.prototype.entrySeq=function(){return this._iter.toSeq()},qt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){if(t){Kt(t);var i=s(t);return e(i?t.get(1):t[1],i?t.get(0):t[0],n)}},t)},qt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(D,t);return new L(function(){for(;;){var t=n.next();if(t.done)return t;var i=t.value;if(i){Kt(i);var a=s(i);return B(e,a?i.get(0):i[0],a?i.get(1):i[1],t)}}})},jt.prototype.cacheResult=Mt.prototype.cacheResult=Nt.prototype.cacheResult=qt.prototype.cacheResult=en,t(an,_e),an.prototype.toString=function(){return this.__toString(on(this)+" {","}")},an.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},an.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},an.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=sn(this,Xe()))},an.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+on(this));if(this._map&&!this._map.has(e)&&t===this._defaultValues[e])return this;var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:sn(this,n)},an.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:sn(this,t)},an.prototype.wasAltered=function(){return this._map.wasAltered()},an.prototype.__iterator=function(e,t){var n=this;return i(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},an.prototype.__iterate=function(e,t){var n=this;return i(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},an.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?sn(this,t,e):(this.__ownerID=e,this._map=t,this)};var rn=an.prototype;function sn(e,t,n){var i=Object.create(Object.getPrototypeOf(e));return i._map=t,i.__ownerID=n,i}function on(e){return e._name||e.constructor.name||"Record"}function ln(e){return null===e||void 0===e?gn():cn(e)&&!u(e)?e:gn().withMutations(function(t){var n=r(e);qe(n.size),n.forEach(function(e){return t.add(e)})})}function cn(e){return!(!e||!e[dn])}rn.delete=rn.remove,rn.deleteIn=rn.removeIn=Ue.removeIn,rn.merge=Ue.merge,rn.mergeWith=Ue.mergeWith,rn.mergeIn=Ue.mergeIn,rn.mergeDeep=Ue.mergeDeep,rn.mergeDeepWith=Ue.mergeDeepWith,rn.mergeDeepIn=Ue.mergeDeepIn,rn.setIn=Ue.setIn,rn.update=Ue.update,rn.updateIn=Ue.updateIn,rn.withMutations=Ue.withMutations,rn.asMutable=Ue.asMutable,rn.asImmutable=Ue.asImmutable,t(ln,Se),ln.of=function(){return this(arguments)},ln.fromKeys=function(e){return this(i(e).keySeq())},ln.prototype.toString=function(){return this.__toString("Set {","}")},ln.prototype.has=function(e){return this._map.has(e)},ln.prototype.add=function(e){return pn(this,this._map.set(e,!0))},ln.prototype.remove=function(e){return pn(this,this._map.remove(e))},ln.prototype.clear=function(){return pn(this,this._map.clear())},ln.prototype.union=function(){var t=e.call(arguments,0);return 0===(t=t.filter(function(e){return 0!==e.size})).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations(function(e){for(var n=0;n<t.length;n++)r(t[n]).forEach(function(t){return e.add(t)})}):this.constructor(t[0])},ln.prototype.intersect=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return r(e)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.every(function(e){return e.includes(n)})||e.remove(n)})})},ln.prototype.subtract=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return r(e)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.some(function(e){return e.includes(n)})&&e.remove(n)})})},ln.prototype.merge=function(){return this.union.apply(this,arguments)},ln.prototype.mergeWith=function(t){var n=e.call(arguments,1);return this.union.apply(this,n)},ln.prototype.sort=function(e){return mn(Gt(this,e))},ln.prototype.sortBy=function(e,t){return mn(Gt(this,t,e))},ln.prototype.wasAltered=function(){return this._map.wasAltered()},ln.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t,i){return e(i,i,n)},t)},ln.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},ln.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},ln.isSet=cn;var un,dn="@@__IMMUTABLE_SET__@@",hn=ln.prototype;function pn(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function fn(e,t){var n=Object.create(hn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function gn(){return un||(un=fn(Xe()))}function mn(e){return null===e||void 0===e?wn():bn(e)?e:wn().withMutations(function(t){var n=r(e);qe(n.size),n.forEach(function(e){return t.add(e)})})}function bn(e){return cn(e)&&u(e)}hn[dn]=!0,hn.delete=hn.remove,hn.mergeDeep=hn.merge,hn.mergeDeepWith=hn.mergeWith,hn.withMutations=Ue.withMutations,hn.asMutable=Ue.asMutable,hn.asImmutable=Ue.asImmutable,hn.__empty=gn,hn.__make=fn,t(mn,ln),mn.of=function(){return this(arguments)},mn.fromKeys=function(e){return this(i(e).keySeq())},mn.prototype.toString=function(){return this.__toString("OrderedSet {","}")},mn.isOrderedSet=bn;var vn,yn=mn.prototype;function _n(e,t){var n=Object.create(yn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function wn(){return vn||(vn=_n(It()))}function Sn(e){return null===e||void 0===e?kn():En(e)?e:kn().unshiftAll(e)}function En(e){return!(!e||!e[An])}yn[f]=!0,yn.__empty=wn,yn.__make=_n,t(Sn,we),Sn.of=function(){return this(arguments)},Sn.prototype.toString=function(){return this.__toString("Stack [","]")},Sn.prototype.get=function(e,t){var n=this._head;for(e=P(this,e);n&&e--;)n=n.next;return n?n.value:t},Sn.prototype.peek=function(){return this._head&&this._head.value},Sn.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Cn(e,t)},Sn.prototype.pushAll=function(e){if(0===(e=a(e)).size)return this;qe(e.size);var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):Cn(t,n)},Sn.prototype.pop=function(){return this.slice(1)},Sn.prototype.unshift=function(){return this.push.apply(this,arguments)},Sn.prototype.unshiftAll=function(e){return this.pushAll(e)},Sn.prototype.shift=function(){return this.pop.apply(this,arguments)},Sn.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):kn()},Sn.prototype.slice=function(e,t){if(k(e,t,this.size))return this;var n=R(e,this.size);if(O(t,this.size)!==this.size)return we.prototype.slice.call(this,e,t);for(var i=this.size-n,a=this._head;n--;)a=a.next;return this.__ownerID?(this.size=i,this._head=a,this.__hash=void 0,this.__altered=!0,this):Cn(i,a)},Sn.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Cn(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Sn.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var n=0,i=this._head;i&&!1!==e(i.value,n++,this);)i=i.next;return n},Sn.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var n=0,i=this._head;return new L(function(){if(i){var t=i.value;return i=i.next,B(e,n++,t)}return{value:void 0,done:!0}})},Sn.isStack=En;var xn,An="@@__IMMUTABLE_STACK__@@",Pn=Sn.prototype;function Cn(e,t,n,i){var a=Object.create(Pn);return a.size=e,a._head=t,a.__ownerID=n,a.__hash=i,a.__altered=!1,a}function kn(){return xn||(xn=Cn(0))}function Rn(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}Pn[An]=!0,Pn.withMutations=Ue.withMutations,Pn.asMutable=Ue.asMutable,Pn.asImmutable=Ue.asImmutable,Pn.wasAltered=Ue.wasAltered,n.Iterator=L,Rn(n,{toArray:function(){qe(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new jt(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new Mt(this,!0)},toMap:function(){return Le(this.toKeyedSeq())},toObject:function(){qe(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return Rt(this.toKeyedSeq())},toOrderedSet:function(){return mn(o(this)?this.valueSeq():this)},toSet:function(){return ln(o(this)?this.valueSeq():this)},toSetSeq:function(){return new Nt(this)},toSeq:function(){return l(this)?this.toIndexedSeq():o(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Sn(o(this)?this.valueSeq():this)},toList:function(){return ht(o(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){return $t(this,function(e,t){var n=o(e),a=[e].concat(t).map(function(e){return s(e)?n&&(e=i(e)):e=n?se(e):oe(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===a.length)return e;if(1===a.length){var r=a[0];if(r===e||n&&o(r)||l(e)&&l(r))return r}var c=new ee(a);return n?c=c.toKeyedSeq():l(e)||(c=c.toSetSeq()),(c=c.flatten(!0)).size=a.reduce(function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}},0),c}(this,e.call(arguments,0)))},includes:function(e){return this.some(function(t){return fe(t,e)})},entries:function(){return this.__iterator(M)},every:function(e,t){qe(this.size);var n=!0;return this.__iterate(function(i,a,r){if(!e.call(t,i,a,r))return n=!1,!1}),n},filter:function(e,t){return $t(this,Jt(this,e,t,!0))},find:function(e,t,n){var i=this.findEntry(e,t);return i?i[1]:n},forEach:function(e,t){return qe(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){qe(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate(function(i){n?n=!1:t+=e,t+=null!==i&&void 0!==i?i.toString():""}),t},keys:function(){return this.__iterator(I)},map:function(e,t){return $t(this,Bt(this,e,t))},reduce:function(e,t,n){var i,a;return qe(this.size),arguments.length<2?a=!0:i=t,this.__iterate(function(t,r,s){a?(a=!1,i=t):i=e.call(n,i,t,r,s)}),i},reduceRight:function(e,t,n){var i=this.toKeyedSeq().reverse();return i.reduce.apply(i,arguments)},reverse:function(){return $t(this,Ft(this,!0))},slice:function(e,t){return $t(this,Ut(this,e,t,!0))},some:function(e,t){return!this.every(Mn(e),t)},sort:function(e){return $t(this,Gt(this,e))},values:function(){return this.__iterator(D)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return A(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,n){var i=Le().asMutable();return e.__iterate(function(a,r){i.update(t.call(n,a,r,e),0,function(e){return e+1})}),i.asImmutable()}(this,e,t)},equals:function(e){return ge(this,e)},entrySeq:function(){var e=this;if(e._cache)return new ee(e._cache);var t=e.toSeq().map(Dn).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Mn(e),t)},findEntry:function(e,t,n){var i=n;return this.__iterate(function(n,a,r){if(e.call(t,n,a,r))return i=[a,n],!1}),i},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},findLastEntry:function(e,t,n){return this.toKeyedSeq().reverse().findEntry(e,t,n)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(){return this.find(C)},flatMap:function(e,t){return $t(this,function(e,t,n){var i=Xt(e);return e.toSeq().map(function(a,r){return i(t.call(n,a,r,e))}).flatten(!0)}(this,e,t))},flatten:function(e){return $t(this,Ht(this,e,!0))},fromEntrySeq:function(){return new qt(this)},get:function(e,t){return this.find(function(t,n){return fe(n,e)},void 0,t)},getIn:function(e,t){for(var n,i=this,a=nn(e);!(n=a.next()).done;){var r=n.value;if((i=i&&i.get?i.get(r,v):v)===v)return t}return i},groupBy:function(e,t){return function(e,t,n){var i=o(e),a=(u(e)?Rt():Le()).asMutable();e.__iterate(function(r,s){a.update(t.call(n,r,s,e),function(e){return(e=e||[]).push(i?[s,r]:r),e})});var r=Xt(e);return a.map(function(t){return $t(e,r(t))})}(this,e,t)},has:function(e){return this.get(e,v)!==v},hasIn:function(e){return this.getIn(e,v)!==v},isSubset:function(e){return e="function"==typeof e.includes?e:n(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return(e="function"==typeof e.isSubset?e:n(e)).isSubset(this)},keyOf:function(e){return this.findKey(function(t){return fe(t,e)})},keySeq:function(){return this.toSeq().map(In).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return zt(this,e)},maxBy:function(e,t){return zt(this,t,e)},min:function(e){return zt(this,e?jn(e):Ln)},minBy:function(e,t){return zt(this,t?jn(t):Ln,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return $t(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return $t(this,Vt(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Mn(e),t)},sortBy:function(e,t){return $t(this,Gt(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return $t(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return $t(this,function(e,t,n){var i=Zt(e);return i.__iterateUncached=function(i,a){var r=this;if(a)return this.cacheResult().__iterate(i,a);var s=0;return e.__iterate(function(e,a,o){return t.call(n,e,a,o)&&++s&&i(e,a,r)}),s},i.__iteratorUncached=function(i,a){var r=this;if(a)return this.cacheResult().__iterator(i,a);var s=e.__iterator(M,a),o=!0;return new L(function(){if(!o)return{value:void 0,done:!0};var e=s.next();if(e.done)return e;var a=e.value,l=a[0],c=a[1];return t.call(n,c,l,r)?i===M?e:B(i,l,c,e):(o=!1,{value:void 0,done:!0})})},i}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Mn(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0;var t=u(e),n=o(e),i=t?1:0;return function(e,t){return t=Ee(t,3432918353),t=Ee(t<<15|t>>>-15,461845907),t=Ee(t<<13|t>>>-13,5),t=Ee((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=xe((t=Ee(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(n?t?function(e,t){i=31*i+Bn(Ae(e),Ae(t))|0}:function(e,t){i=i+Bn(Ae(e),Ae(t))|0}:t?function(e){i=31*i+Ae(e)|0}:function(e){i=i+Ae(e)|0}),i)}(this))}});var On=n.prototype;On[d]=!0,On[q]=On.values,On.__toJS=On.toArray,On.__toStringMapper=Nn,On.inspect=On.toSource=function(){return this.toString()},On.chain=On.flatMap,On.contains=On.includes,Rn(i,{flip:function(){return $t(this,Lt(this))},mapEntries:function(e,t){var n=this,i=0;return $t(this,this.toSeq().map(function(a,r){return e.call(t,[r,a],i++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return $t(this,this.toSeq().flip().map(function(i,a){return e.call(t,i,a,n)}).flip())}});var Tn=i.prototype;function In(e,t){return t}function Dn(e,t){return[t,e]}function Mn(e){return function(){return!e.apply(this,arguments)}}function jn(e){return function(){return-e.apply(this,arguments)}}function Nn(e){return"string"==typeof e?JSON.stringify(e):String(e)}function qn(){return x(arguments)}function Ln(e,t){return e<t?1:e>t?-1:0}function Bn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}return Tn[h]=!0,Tn[q]=On.entries,Tn.__toJS=On.toObject,Tn.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+Nn(e)},Rn(a,{toKeyedSeq:function(){return new Mt(this,!1)},filter:function(e,t){return $t(this,Jt(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return void 0===t?-1:t},reverse:function(){return $t(this,Ft(this,!1))},slice:function(e,t){return $t(this,Ut(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(0|t,0),0===n||2===n&&!t)return this;e=R(e,e<0?this.count():this.size);var i=this.slice(0,e);return $t(this,1===n?i:i.concat(x(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.findLastEntry(e,t);return n?n[0]:-1},first:function(){return this.get(0)},flatten:function(e){return $t(this,Ht(this,e,!1))},get:function(e,t){return(e=P(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return(e=P(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return $t(this,function(e,t){var n=Zt(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,i){var a=this,r=0;return e.__iterate(function(e,i){return(!r||!1!==n(t,r++,a))&&!1!==n(e,r++,a)},i),r},n.__iteratorUncached=function(n,i){var a,r=e.__iterator(D,i),s=0;return new L(function(){return(!a||s%2)&&(a=r.next()).done?a:s%2?B(n,s++,t):B(n,s++,a.value,a)})},n}(this,e))},interleave:function(){var e=[this].concat(x(arguments)),t=Wt(this.toSeq(),W.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),$t(this,n)},keySeq:function(){return ve(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(e,t){return $t(this,Vt(this,e,t,!1))},zip:function(){return $t(this,Wt(this,qn,[this].concat(x(arguments))))},zipWith:function(e){var t=x(arguments);return t[0]=this,$t(this,Wt(this,e,t))}}),a.prototype[p]=!0,a.prototype[f]=!0,Rn(r,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),r.prototype.has=On.includes,r.prototype.contains=r.prototype.includes,Rn(Q,i.prototype),Rn(W,a.prototype),Rn($,r.prototype),Rn(_e,i.prototype),Rn(we,a.prototype),Rn(Se,r.prototype),{Iterable:n,Seq:z,Collection:ye,Map:Le,OrderedMap:Rt,List:ht,Stack:Sn,Set:ln,OrderedSet:mn,Record:an,Range:ve,Repeat:me,is:fe,fromJS:de}},"object"==typeof n&&void 0!==t?t.exports=a():i.Immutable=a()},{}],2:[function(e,t,n){var i,a,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}}();var c,u=[],d=!1,h=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=l(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===o||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||d||l(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],3:[function(e,t,n){(function(i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,r=e("immutable"),s=(a=r)&&a.__esModule?a:{default:a},o=e("./utilities");n.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Map,n=Object.keys(e);return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t(),r=arguments[1];if("production"!==i.env.NODE_ENV){var s=(0,o.getUnexpectedInvocationParameterMessage)(a,e,r);s&&console.error(s)}return a.withMutations(function(t){n.forEach(function(n){var i=(0,e[n])(t.get(n),r);(0,o.validateNextState)(i,n,r),t.set(n,i)})})}},t.exports=n.default}).call(this,e("_process"))},{"./utilities":7,_process:2,immutable:1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.combineReducers=void 0;var i,a=e("./combineReducers"),r=(i=a)&&i.__esModule?i:{default:i};n.combineReducers=r.default},{"./combineReducers":3}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return e&&"@@redux/INIT"===e.type?"initialState argument passed to createStore":"previous state received by the reducer"},t.exports=n.default},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("immutable")),a=r(e("./getStateName"));function r(e){return e&&e.__esModule?e:{default:e}}n.default=function(e,t,n){var r=Object.keys(t);if(!r.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";var s=(0,a.default)(n);if(i.default.isImmutable?!i.default.isImmutable(e):!i.default.Iterable.isIterable(e))return"The "+s+' is of unexpected type. Expected argument to be an instance of Immutable.Collection or Immutable.Record with the following properties: "'+r.join('", "')+'".';var o=e.toSeq().keySeq().toArray().filter(function(e){return!t.hasOwnProperty(e)});return o.length>0?"Unexpected "+(1===o.length?"property":"properties")+' "'+o.join('", "')+'" found in '+s+'. Expected to find one of the known reducer property names instead: "'+r.join('", "')+'". Unexpected properties will be ignored.':null},t.exports=n.default},{"./getStateName":5,immutable:1}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateNextState=n.getUnexpectedInvocationParameterMessage=n.getStateName=void 0;var i=s(e("./getStateName")),a=s(e("./getUnexpectedInvocationParameterMessage")),r=s(e("./validateNextState"));function s(e){return e&&e.__esModule?e:{default:e}}n.getStateName=i.default,n.getUnexpectedInvocationParameterMessage=a.default,n.validateNextState=r.default},{"./getStateName":5,"./getUnexpectedInvocationParameterMessage":6,"./validateNextState":8}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){if(void 0===e)throw new Error('Reducer "'+t+'" returned undefined when handling "'+n.type+'" action. To ignore an action, you must explicitly return the previous state.')},t.exports=n.default},{}]},{},[4])(4)}),define("es6!js/widgets/sort/redux/configure-store",["redux","redux-thunk","es6!./modules/sort-app","redux-immutable"],function(e,t,n,i){var a=e.createStore,r=e.applyMiddleware,s=i.combineReducers;return function(i){var o=r(t.default.withExtraArgument(i)),l=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||e.compose,c=s({SortApp:n.reducer});return a(c,l(o))}}),define("es6!js/widgets/sort/components/sort-app.jsx",["react","react-prop-types"],function(e,t){var n=function(t){var n=t.setSort,i=t.setDirection,a=t.app,r=a.get("options"),s=a.get("sort"),o=a.get("direction"),l=a.get("locked");return e.createElement("div",{className:"btn-group"},e.createElement("button",{disabled:l,"aria-disabled":l,type:"button",className:"btn btn-default",onClick:i,title:"asc"===o?"Change sort direction to descending":"Change sort direction to ascending"},e.createElement("i",{className:"fa fa-sort-amount-"+o,"aria-hidden":"true"})),e.createElement("button",{style:{minWidth:100},disabled:l,"aria-disabled":l,type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown",title:"Select a sort option"},s.get("text")," ",e.createElement("span",{className:"caret","aria-hidden":"true"})),e.createElement("ul",{className:"dropdown-menu",role:"menu"},r.map(function(t){return e.createElement("li",{key:t.get("id")},e.createElement("a",{href:"#",title:t.get("desc"),onClick:function(e){return function(e,t){t.preventDefault(),n(e)}(t,e)}},t.get("text")))})))};return n.propTypes={app:t.object.isRequired,setSort:t.func.isRequired,setDirection:t.func.isRequired},n}),define("es6!js/widgets/sort/containers/sort-container",["underscore","react","redux","react-redux","es6!../redux/modules/sort-app","es6!../components/sort-app.jsx"],function(e,t,n,i,a,r){var s=a.setSort,o=a.setDirection;return i.connect(function(e){return{app:e.get("SortApp")}},function(e){return{setSort:function(t){return e(s(t))},setDirection:function(){return e(o())}}})(r)}),define("es6!js/widgets/sort/widget.jsx",["underscore","backbone","analytics","react","react-redux","react-dom","redux","es6!./redux/configure-store","es6!./redux/modules/sort-app","js/components/api_query","js/widgets/base/base_widget","js/components/api_feedback","es6!./containers/sort-container"],function(e,t,n,i,a,r,s,o,l,c,u,d,h){var p=t.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return r.render(i.createElement(a.Provider,{store:this.store},i.createElement(h,null)),this.el),this},destroy:function(){r.unmountComponentAtNode(this.el)}});return u.extend({initialize:function(){this.store=o(this),this.view=new p({store:this.store}),this.onSortChange=e.debounce(this.onSortChange,500),this.handleFeedback=e.bind(this.handleFeedback,this)},activate:function(e){this.setBeeHive(e),this.activateWidget();var t=this.getPubSub();t.subscribe(t.FEEDBACK,this.handleFeedback)},onSortChange:function(){var t=this.getPubSub(),i=this.store.getState().get("SortApp"),a=i.get("sort").get("id"),r=i.get("direction"),s=i.get("query"),o=a+" "+r;if(e.isNull(s)&&(s=this.getBeeHive().getObject("AppStorage").getCurrentQuery()),!e.isUndefined(s.sort)&&!e.isEmpty(s.sort)){var l=s.sort[0].split(/,\s?/).slice(1);l.unshift(o),o=l.join(", ")}s&&(s.sort=[o],t.publish(t.START_SEARCH,new c(s)),n("send","event","interaction","sort-applied",s.sort))},handleFeedback:function(e){var t=this.store.dispatch,n=l.setQuery,i=l.setSort,a=l.setDirection,r=l.setLocked;switch(e.code){case d.CODES.SEARCH_CYCLE_STARTED:var s=e&&e.query&&e.query.toJSON();if(s){var o=this.extractSort(s.sort[0]);t(n(s)),t(i(o.sort,!0)),t(a(o.direction,!0)),t(r(!0))}break;case d.CODES.SEARCH_CYCLE_PROGRESS:t(r(!0));break;case d.CODES.SEARCH_CYCLE_FAILED_TO_START:case d.CODES.SEARCH_CYCLE_FINISHED:t(r(!1))}},extractSort:function(e){var t=e.split(/,\s?/)[0]||"date desc";return{sort:(t=t.split(" "))[0],direction:t[1]}}})}),define("hbs!js/widgets/dropdown-menu/templates/dropdown",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return"pull-right"},3:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.selectedPapers:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:""},4:function(e,t,n,i){var a,r;return'                <div class="s-divider-bottom">\n                    <label><input class="papers" type="radio" '+(null!=(a=t.if.call(e,null!=e?e.onlySelected:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+' name="papers-'+this.escapeExpression("function"==typeof(r=null!=(r=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?r:t.helperMissing)?r.call(e,{name:"dropdownTitle",hash:{},data:i}):r)+'" value="selected"/> selected papers</label>\n                    <label><input class="papers" type="radio" '+(null!=(a=t.unless.call(e,null!=e?e.onlySelected:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+' name="papers-'+this.escapeExpression("function"==typeof(r=null!=(r=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?r:t.helperMissing)?r.call(e,{name:"dropdownTitle",hash:{},data:i}):r)+'" value="all"/> all papers</label>\n                </div>\n'},5:function(e,t,n,i){return" checked "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\x3c!-- Single button --\x3e\n    <button type="button" class="btn '+this.escapeExpression("function"==typeof(r=null!=(r=t.btnType||(null!=e?e.btnType:e))?r:t.helperMissing)?r.call(e,{name:"btnType",hash:{},data:i}):r)+' dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n       <i class="'+this.escapeExpression("function"==typeof(r=null!=(r=t.iconClass||(null!=e?e.iconClass:e))?r:t.helperMissing)?r.call(e,{name:"iconClass",hash:{},data:i}):r)+'"></i> <h2>'+this.escapeExpression("function"==typeof(r=null!=(r=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?r:t.helperMissing)?r.call(e,{name:"dropdownTitle",hash:{},data:i}):r)+'</h2> <span class="caret"></span>\n    </button>\n    <div class="dropdown-menu '+(null!=(a=t.if.call(e,null!=e?e.pullRight:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'" role="menu">\n'+(null!=(a=t.if.call(e,null!=e?e.selectedOption:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'        <ul class="link-container">\n        </ul>\n    </div>\n'},useData:!0});return t.registerPartial("js/widgets/dropdown-menu/templates/dropdown",n),n}),define("hbs!js/widgets/dropdown-menu/templates/dropdown-item",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<a href="'+this.escapeExpression(this.lambda(null!=e?e.href:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.description:e,e))+"</a>\n\n"},useData:!0});return t.registerPartial("js/widgets/dropdown-menu/templates/dropdown-item",n),n}),define("js/widgets/dropdown-menu/widget",["marionette","js/widgets/base/base_widget","hbs!js/widgets/dropdown-menu/templates/dropdown","hbs!js/widgets/dropdown-menu/templates/dropdown-item"],function(e,t,n,i){var a=Backbone.Model.extend({defaults:function(){return{selected:!1,href:void 0,description:void 0,navEvent:void 0}}}),r=Backbone.Collection.extend({initialize:function(e,t){this.on("change:selected",this.removeOtherSelected)},model:a,removeOtherSelected:function(e,t){!1!==t&&this.each(function(t){t!==e&&t.set("selected",!1)})}}),s=e.ItemView.extend({tagName:"li",events:{click:"setSelected"},setSelected:function(e){e.preventDefault(),this.model.set("selected",!0)},template:i}),o=Backbone.Model.extend({defaults:function(){return{selectedOption:!1,selectedPapers:!1,onlySelected:!0}}}),l=e.CompositeView.extend({initialize:function(e){e=e||{}},modelEvents:{"change:selectedOption":"render","change:selectedPapers":"render"},collectionEvents:{"change:selected":function(){this.$el.removeClass("open")}},className:"btn-group dropdown-widget s-dropdown-widget",childView:s,childViewContainer:".link-container",template:n,serializeData:function(){var t=this.model.toJSON();return t.btnType=e.getOption(this,"btnType")||"btn-default",t.dropdownTitle=e.getOption(this,"dropdownTitle"),t.iconClass=e.getOption(this,"iconClass"),t.pullRight=e.getOption(this,"rightAlign"),t},events:{"change input.papers":function(e){"all"==$(e.target).attr("value")?this.model.set("onlySelected",!1):this.model.set("onlySelected",!0)},"click .dropdown-menu label":function(e){e.stopPropagation()}}});return t.extend({initialize:function(e){if(this.options=_.defaults(e,{updateLinks:_.noop}),!this.options.links)throw new Error("Dropdown menu will be empty!");this.model=new o({selectedOption:this.options.selectedOption}),this.collection=new r(this.options.links),this.view=new l(_.extend({collection:this.collection,model:this.model},this.options)),this.listenTo(this.collection,"change:selected",this.emitNavigateEvent)},activate:function(e){_.bindAll(this),this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.STORAGE_PAPER_UPDATE,this.onStoragePaperChange),t.subscribe(t.USER_ANNOUNCEMENT,this.updateFromUserData),this.updateFromUserData()},getUserData:function(){try{var e=_.isFunction(this.getBeeHive)&&this.getBeeHive(),t=_.isFunction(e.getObject)&&e.getObject("User");return _.isPlainObject(t)?_.isFunction(t.getUserData)&&t.getUserData("USER_DATA"):{}}catch(e){return{}}},updateFromUserData:function(){var e=this.getUserData(),t=this.options.updateLinks(e,this.options.links)||this.options.links;this.options.links=t,this.collection.reset(t)},onStoragePaperChange:function(e){e?this.model.set("selectedPapers",!0):this.model.set("selectedPapers",!1)},emitNavigateEvent:function(e,t){var n=this.model.get("selectedOption")&&this.model.get("selectedPapers")&&this.model.get("onlySelected");if(t){var i=_.extend({onlySelected:n},e.get("params"));this.getPubSub().publish(this.getPubSub().NAVIGATE,e.get("navEvent"),i)}e.set("selected",!1)}})}),define("js/wraps/export_dropdown",["underscore","js/widgets/config","js/widgets/dropdown-menu/widget"],function(e,t,n){var i=[{description:"in BibTeX",navEvent:"export",params:{format:"bibtex"}},{description:"in AASTeX",navEvent:"export",params:{format:"aastex"}},{description:"in EndNote",navEvent:"export",params:{format:"endnote"}},{description:"in RIS",navEvent:"export",params:{format:"ris"}},{description:"in ADS Classic",navEvent:"export",params:{format:"classic"}},{description:"Author Affiliation",navEvent:"show-author-affiliation-tool"},{description:"Other Formats",navEvent:"export",params:{format:"other"}}];return function(){return new n({links:i,btnType:"btn-primary-faded",dropdownTitle:"Export",iconClass:"icon-export",rightAlign:!0,selectedOption:!0,updateLinks:function(n){var a=n.defaultExportFormat,r=e.find(t.export.formats,{label:a}).value;if(a){var s;e.forEach(i,function(e,t){if(e.params&&e.params.format&&e.params.format===r)return s=t,!1});var o=e.assign({},i[0],{description:"in "+a,params:e.assign({},i[0].params,{format:r})});return s?[o].concat(i.slice(1,s)).concat(i[0]).concat(i.slice(s+1)):[o].concat(i.slice(1))}return i}})}}),define("js/wraps/visualization_dropdown",["js/widgets/dropdown-menu/widget"],function(e){var t=[{description:"Citation Metrics",navEvent:"show-metrics"},{description:"Author Network",navEvent:"show-author-network"},{description:"Paper Network",navEvent:"show-paper-network"},{description:"Concept Cloud",navEvent:"show-concept-cloud"},{description:"Results Graph",navEvent:"show-bubble-chart"}];return function(){return new e({links:t,btnType:"btn-primary-faded",dropdownTitle:"Explore",iconClass:"icon-explore",rightAlign:!0,selectedOption:!0})}}),define("js/mixins/user_change_rows",["marionette","js/components/api_targets"],function(e,t){var n={};return n.Model=Backbone.Model.extend({initialize:function(e){if(this.on("change:numFound",this.updateMax),this.on("change:rows",this.updateCurrent),!e.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var n={rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0};_.extend(n,t._limits[e.widgetName]),this.defaults=function(){return n},this.set(this.defaults())},updateMax:function(){var e=_.min([this.get("limit"),this.get("numFound")]);this.set("max",e)},updateCurrent:function(){this.set("current",_.min([this.get("rows"),this.get("numFound")]))}}),n}),define("hbs!js/widgets/network_vis/templates/author-details-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <button class="btn btn-sm  btn-default filter-remove"><i class="s-filter-image"></i>remove from filter</button>\n'},3:function(e,t,n,i){return'            <button class="btn btn-sm btn-default filter-add"> <i class="s-filter-image"></i> add to filter</button>\n'},5:function(e,t,n,i){var a,r;return'        <li>\n            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'"  target="_blank" rel="noopener"><b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</b></a> "+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.numAuthors:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"        </li>\n"},6:function(e,t,n,i){var a;return"\n            <small> "+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+" citations</small>\n"},8:function(e,t,n,i){return"            <small>no citations</small>\n            "},10:function(e,t,n,i){var a;return"\n            <small>("+this.escapeExpression("function"==typeof(a=null!=(a=t.numAuthors||(null!=e?e.numAuthors:e))?a:t.helperMissing)?a.call(e,{name:"numAuthors",hash:{},data:i}):a)+" authors from this group)</small>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="author-detail-header">\n    <div style="border-bottom:4px solid '+this.escapeExpression("function"==typeof(r=null!=(r=t.groupColor||(null!=e?e.groupColor:e))?r:t.helperMissing)?r.call(e,{name:"groupColor",hash:{},data:i}):r)+'" >\n        <h4>'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+"</h4>\n"+(null!=(a=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"    </div>\n    <div>\n        Total Papers: "+this.escapeExpression("function"==typeof(r=null!=(r=t.total||(null!=e?e.total:e))?r:t.helperMissing)?r.call(e,{name:"total",hash:{},data:i}):r)+"\n        Most recent Paper: "+this.escapeExpression("function"==typeof(r=null!=(r=t.mostRecentYear||(null!=e?e.mostRecentYear:e))?r:t.helperMissing)?r.call(e,{name:"mostRecentYear",hash:{},data:i}):r)+'\n    </div>\n    <button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(r=null!=(r=t.dataQuery||(null!=e?e.dataQuery:e))?r:t.helperMissing)?r.call(e,{name:"dataQuery",hash:{},data:i}):r)+'">View author network for this author</button>\n\n\n</div>\n<div class="paper-description">\n<h5> Papers by this author </h5>\n    <ul class="list-unstyled">\n'+(null!=(a=t.each.call(e,null!=e?e.papers:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"    </ul>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/author-details-template",n),n}),define("hbs!js/widgets/network_vis/templates/container-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="container-fluid">\n<div class="row s-control-row">\n        <div class="col-sm-5">\n            <div class="network-metadata s-network-metadata"></div>\n        </div>\n        <div class="col-sm-6">\n            <div class="network-filter-container s-network-filter-container"></div>\n        </div>\n        <div class="col-sm-1">\n            <div class="s-large-close close-widget close">x</div>\n         </div>\n</div>\n     <div class="network-container s-network-container row">\n         <div class="col-md-7 graph-container">\n\n         </div>\n         <div class="col-md-5 details-container">\n\n             \x3c!--tabs--\x3e\n\n             <div role="tabpanel">\n\n                 \x3c!-- Nav tabs --\x3e\n                 <ul class="nav nav-tabs" role="tablist">\n                     <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Summary</a></li>\n                     <li role="presentation"><a href="#selected-item" aria-controls="profile" role="tab" data-toggle="tab">Detail </a></li>\n                 </ul>\n\n                 \x3c!-- Tab panes --\x3e\n                 <div class="tab-content">\n                     <div role="tabpanel" class="tab-pane active" id="home"></div>\n                     <div role="tabpanel" class="tab-pane" id="selected-item">\n                         <br/>\n                         <br/>\n                         <b>No item selected</b>\n                         <p> Click on a section in the visualization on the left to see the papers\n                         associated with an author or group of authors.</p>\n                     </div>\n\n                 </div>\n\n             </div>\n\n\n\n         </div>\n\n     </div>\n </div>\n'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/container-template",n),n}),define("hbs!js/widgets/network_vis/templates/filter-container-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return null!=(a=t.each.call(e,null!=e?e.limit:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:""},2:function(e,t,n,i){var a;return"            "+this.escapeExpression(this.lambda(e,e))+" "+(null!=(a=t.unless.call(e,i&&i.last,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"\n"},3:function(e,t,n,i){return" OR "},5:function(e,t,n,i){return'        select an author or group of authors in the visualization below and click the "add to filter" button\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div>\n    <b><i class="s-filter-image"></i> Filter current search:</b>\n    <button class="btn btn-default btn-xs clear-filter"> X clear</button>\n\n</div>\n<div class="s-filter-names-container ">\n'+(null!=(a=t.if.call(e,null!=e?e.limit:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(5,i,0),data:i}))?a:"")+'\n\n</div>\n\n\n<div class="s-filter-buttons-container">\n    <div>\n        <button class="btn btn-success apply-filter"> <i class="icon-go fa-lg"></i></button>\n    </div>\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/filter-container-template",n),n}),define("hbs!js/widgets/network_vis/templates/graph-container-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-network-control-panel">\n    <div class="detail-panel s-detail-panel">\n        <h4 style="display:inline-block">Size wedges based on:</h4>\n        <div class="btn-group network-sizes" data-toggle="buttons">\n        <label class="btn btn-primary active">\n            <input type="radio" name="mode" value="size" checked autocomplete="off"> Author Occurrences\n        </label>\n        <label class="btn btn-primary">\n            <input type="radio" name="mode" value="citation_count" autocomplete="off"> Paper Citations\n        </label>\n        <label class="btn btn-primary">\n            <input type="radio" name="mode" value="read_count" autocomplete="off"> Paper Downloads\n        </label>\n        </div>\n        <br/>\n        <label>\n            <input type="checkbox" name="show-link" value="true"> View Link Overlay\n        </label>\n    </div>\n</div>\n\n<div class="s-network-graph-div">\n    <svg id="network-viz-main-chart"\n         class="network-chart s-network-chart"\n         viewBox="0 0 900 900"\n         style="font-family:helvetica,arial,san-serif"\n    >\n    </svg>\n\n</div>\n\n\n\n\n\n\n\n'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/graph-container-template",n),n}),define("hbs!js/widgets/network_vis/templates/group-details-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <button class="btn btn-sm btn-default filter-remove"><i class="s-filter-image"></i>remove from filter</button>\n'},3:function(e,t,n,i){return'            <button class="btn btn-sm btn-default filter-add"> <i class="s-filter-image"></i> add to filter</button>\n'},5:function(e,t,n,i){var a,r;return'        <li>\n            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'" data-bypass="" target="_blank" rel="noopener"><b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</b></a> "+(null!=(a=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.numAuthors:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"\n        </li>\n"},6:function(e,t,n,i){var a;return"\n            <small> "+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+" citations</small> "},8:function(e,t,n,i){return"\n            <small>no citations</small> "},10:function(e,t,n,i){var a;return"\n            <small>("+this.escapeExpression("function"==typeof(a=null!=(a=t.numAuthors||(null!=e?e.numAuthors:e))?a:t.helperMissing)?a.call(e,{name:"numAuthors",hash:{},data:i}):a)+" authors from this group)</small> "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\n<div class="author-detail-header">\n    <div style="border-bottom:4px solid '+this.escapeExpression("function"==typeof(r=null!=(r=t.groupColor||(null!=e?e.groupColor:e))?r:t.helperMissing)?r.call(e,{name:"groupColor",hash:{},data:i}):r)+'">\n        <h4>Group '+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+'</h4>\n        <span class="pull-right">\n'+(null!=(a=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"        </span>\n    </div>\n    <small>Total papers: "+this.escapeExpression("function"==typeof(r=null!=(r=t.total||(null!=e?e.total:e))?r:t.helperMissing)?r.call(e,{name:"total",hash:{},data:i}):r)+"</small>\n    <small>Most recent: "+this.escapeExpression("function"==typeof(r=null!=(r=t.mostRecentYear||(null!=e?e.mostRecentYear:e))?r:t.helperMissing)?r.call(e,{name:"mostRecentYear",hash:{},data:i}):r)+'</small>\n</div>\n<div class="paper-description">\n\n    <ul class="list-unstyled">\n'+(null!=(a=t.each.call(e,null!=e?e.papers:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"    </ul>\n</div>\n\n"},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/group-details-template",n),n}),define("hbs!js/widgets/network_vis/templates/not-enough-data-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'    <button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+'">\n        <i class="fa fa-arrow-left"></i>\n        Go back to previous author network. ('+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+")\n    </button>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="col-xs-12">\n    <br>\n    <p>  The network grouping algorithm could not generate group data for your network.</p>\n    <p> This might be because the list of papers was too small or sparse to produce multiple meaningful groups.</p>\n    <p><a href="https://adsabs.github.io/help/actions/visualize">\n        Learn more about how ADS networks are created and how they can be used.\n    </a></p>\n\n'+(null!=(a=t.if.call(e,null!=e?e.cachedQuery:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</div>\n\n\n"},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/not-enough-data-template",n),n}),define("hbs!js/widgets/network_vis/templates/network_metadata",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'<form action="">\nChange to first <input type="text" class="network-rows s-network-rows form-control input-sm"/> papers (max is '+this.escapeExpression("function"==typeof(a=null!=(a=t.max||(null!=e?e.max:e))?a:t.helperMissing)?a.call(e,{name:"max",hash:{},data:i}):a)+').\n<button type="submit" class="submit-rows btn btn-sm btn-info"> Submit </button>\n</form>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return"<h4>Currently viewing data for "+this.escapeExpression("function"==typeof(r=null!=(r=t.current||(null!=e?e.current:e))?r:t.helperMissing)?r.call(e,{name:"current",hash:{},data:i}):r)+" papers.</h4><br/>\n"+(null!=(a=t.if.call(e,null!=e?e.max:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/network_metadata",n),n}),define("hbs!js/widgets/network_vis/templates/loading-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div><i class="icon-loading"></i> <p>Loading data...</p></div>\n\n'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/loading-template",n),n}),define("hbs!js/widgets/network_vis/templates/default-details-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'<h3><span class="s-light-font">Author Network</span></h3>\n\n<p>This network visualization finds groups of authors within your search results.\n    You can click on the segments to view the papers connected with a group or a particular author.\n</p>\n\n<h5>Group Activity Over Time (measured in papers published)</h5>\n <div class="time-series-container">\n <svg viewBox="0 0 960 500" id="network-viz-time-series"></svg>\n </div>\n\n<br/>\n<div>\n    <a href="http://adsabs.github.io/help/actions/visualize#author-network" target="_blank" rel="noopener">Learn more about the author network.</a>\n</div>\n\n\n'+(null!=(a=t.if.call(e,null!=e?e.cachedQuery:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+"\n\n\n\n</div>\n\n"},2:function(e,t,n,i){var a;return'<button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+'">\n    <i class="fa fa-arrow-left"></i>\n    Go back to previous author network ('+this.escapeExpression("function"==typeof(a=null!=(a=t.cachedQuery||(null!=e?e.cachedQuery:e))?a:t.helperMissing)?a.call(e,{name:"cachedQuery",hash:{},data:i}):a)+")\n</button>\n"},4:function(e,t,n,i){return"\x3c!--only show this for first time view of network--\x3e\n\n<p>If you are interested in seeing the author network for another author, you can do that directly\n    by clicking on the author in the ring visualization, then clicking the button at the top.</p>\n\n<p>You can zoom and drag the visualization to reposition it.</p>\n\n"},6:function(e,t,n,i){var a;return'<h3><span class="s-light-font">Paper Network for Query</span> '+this.escapeExpression("function"==typeof(a=null!=(a=t.currentQuery||(null!=e?e.currentQuery:e))?a:t.helperMissing)?a.call(e,{name:"currentQuery",hash:{},data:i}):a)+'</h3>\n\n<p>The segments of the visualization to the left represent groups of papers from your result set which cite similar papers. </p>\n\n<h5>Group Activity Over Time (measured in papers published)</h5>\n<div class="time-series-container">\n    <svg id="network-chart-main-visualization" viewBox="0 0 960 500"></svg>\n</div>\n\n<br/>\n<p>Click on a group to learn more about the papers within the group, as well as the papers cited by those papers.</p>\n<a href="http://adsabs.github.io/help/actions/visualize#paper-network" target="_blank" rel="noopener">Learn more about the paper network.</a>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.networkType:e,"author",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.networkType:e,"paper",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/default-details-template",n),n}),define("js/widgets/network_vis/network_widget",["marionette","d3","js/components/api_targets","js/mixins/user_change_rows","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","js/components/api_query_updater","hbs!js/widgets/network_vis/templates/author-details-template","hbs!js/widgets/network_vis/templates/container-template","hbs!js/widgets/network_vis/templates/filter-container-template","hbs!js/widgets/network_vis/templates/graph-container-template","hbs!js/widgets/network_vis/templates/group-details-template","hbs!js/widgets/network_vis/templates/not-enough-data-template","hbs!js/widgets/network_vis/templates/network_metadata","hbs!js/widgets/network_vis/templates/loading-template","hbs!js/widgets/network_vis/templates/default-details-template","bootstrap"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g,m){function b(e){return!isNaN(e)&&(0|(t=parseFloat(e)))===t;var t}var v=Backbone.Model.extend({defaults:{name:void 0},idAttribute:"name"}),y=Backbone.Collection.extend({model:v}),w=e.ItemView.extend({initialize:function(e){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"reset",this.render)},serializeData:function(){var e=this,t={};return t.limit=this.collection.pluck("name"),_.each(t.limit,function(n,i){b(n)&&"author"==e.options.networkType?t.limit[i]="at least one member of Group "+n:b(n)&&"paper"==e.options.networkType&&(t.limit[i]="Group "+n)}),t},template:u,childViewContainer:".dropdown-menu",events:{"click .apply-filter":"initiateFilter","click .clear-filter":"clearFilter"},initiateFilter:function(){this.trigger("filter:initiated")},clearFilter:function(){this.collection.reset()}}),S=e.ItemView.extend({template:m,serializeData:function(){return{currentQuery:e.getOption(this,"query"),networkType:e.getOption(this,"networkType"),cachedQuery:e.getOption(this,"cachedQuery")}},getData:function(){if("author"==e.getOption(this,"networkType")){var n=[];_.each(e.getOption(this,"graphData").root.children,function(e,i){var a=i;if(!(i>6)){var r=[];_.each(e.children,function(e,t){Array.prototype.push.apply(r,e.papers)}),r=_.uniq(r);var s=_.map(r,function(e){return parseInt(e.slice(0,4))});r=_.countBy(r,function(e){return e.slice(0,4)});var o=_.range.apply(void 0,t.extent(s)),l={};_.each(o,function(e){l[e]=0}),r=_.extend(l,r),r=_.map(r,function(e,t){return{year:parseInt(t),amount:e}}),n.push({name:a,values:r})}})}else if("paper"==e.getOption(this,"networkType")){var i=e.getOption(this,"graphData").summaryGraph,a=e.getOption(this,"graphData").fullGraph,r=(n=[],{}),s=_.pluck(i.nodes,"id"),o=_.pluck(i.nodes,"node_name");_.each(s,function(e,t){var n=[];_.each(a.nodes,function(t,i){t.group===e&&n.push(t.node_name)}),r[o[t]]=n}),_.each(r,function(e,i){if(!(i>6)){o=_.uniq(e);var a=_.map(o,function(e){return parseInt(e.slice(0,4))});o=_.countBy(o,function(e){return e.slice(0,4)});var r=_.range.apply(void 0,t.extent(a)),s={};_.each(r,function(e){s[e]=0});var o=_.extend(s,o);o=_.map(o,function(e,t){return{year:parseInt(t),amount:e}}),n.push({name:parseInt(i)-1,values:o})}})}return n},onRender:function(){var e=this.getData(),n=!0;if(_.each(e,function(e){1!==e.values.length&&(n=!1)}),n){var i=e[0].values[0].year;this.$(".time-series-container").html("Not enough data to show a graph: All papers are from the year "+i)}else{var a=[],r=[];_.each(e,function(e){_.each(e.values,function(e){a.push(e.year),r.push(e.amount)})}),a=_.uniq(a);var s=20,o=80,l=30,c=50,u=960-c-o,d=500-s-l,h=t.scale.linear().range([0,u]),p=t.scale.linear().range([d,0]),f=t.svg.axis().scale(h).orient("bottom").tickFormat(t.format("0f")).ticks(5);a.length<=10&&f.tickValues(a);var g=t.svg.axis().scale(p).tickFormat(t.format("d")).orient("left"),m=t.svg.line().interpolate("bundle").x(function(e){return h(e.year)}).y(function(e){return p(e.amount)}),b=t.select(this.$("svg")[0]).attr("width",u+c+o).attr("height",d+s+l).attr("style","font-family:helvetica,arial,san-serif").attr("id","network-viz-time-series").append("g").attr("transform","translate("+c+","+s+")"),v=t.scale.ordinal().domain([0,1,2,3,4,5,6]).range(["hsla(282, 80%, 52%, 1)","hsla(1, 80%, 51%, 1)","hsla(42, 97%, 48%, 1)","hsla(152, 80%, 40%, 1)","hsla(193, 80%, 48%, 1)","hsla(220, 80%, 56%, 1)","hsla(250, 69%, 47%, 1)"]);h.domain(t.extent(a)),p.domain([0,_.max(r)]),b.append("g").attr("class","axis").attr("transform","translate(0,"+d+")").call(f),b.append("g").attr("class","axis").call(g);var y=b.selectAll(".group").data(e).enter().append("g").attr("class","group");y.append("path").attr("class","line").attr("d",function(e){return m(e.values)}).style("stroke",function(e){return v(e.name)}),y.append("text").datum(function(e){return{name:e.name,value:e.values[e.values.length-1]}}).attr("transform",function(e){return"translate("+h(e.value.year)+","+p(e.value.amount)+")"}).attr("x",3).attr("dy",".35em").text(function(e){return e.name+1});n=_.filter(e,function(e){if(1==e.values.length)return!0});b.selectAll(".one-year").data(n).enter().append("circle").classed("one-year",!0).attr("r",5).attr("cx",function(e){return h(e.values[0].year)}).attr("cy",function(e){return p(e.values[0].amount)}).attr("fill",function(e){return v(e.name)})}}}),E=e.ItemView.extend({template:c,className:function(){return"network-widget s-network-widget "+e.getOption(this,"networkType")},serializeData:function(t){var n=e.getOption(this,"networkType");return{networkType:n=n[0].toUpperCase()+n.slice(1),helpText:e.getOption(this,"helpText")}},ui:{filterContainer:".network-filter-container",graphContainer:".graph-container",detailsContainerSelected:".details-container #selected-item",detailsContainerHome:".details-container #home"},events:{"click .load-author-network":"forwardNewQueryRequest","click button.limit":"addItem","click .submit-rows":"changeRows","click .close":"triggerClose","click .filter-remove":function(t){if("paper"==e.getOption(this,"networkType")){var n=this.graphModel.get("selectedEntity").__data__.data.node_name;e.getOption(this,"filterCollection").remove({id:n}),this.graphView.showSelectedEntity(this.graphModel.get("selectedEntity"))}else{n=this.graphModel.get("selectedEntity").__data__.name;e.getOption(this,"filterCollection").remove({id:n}),this.showDetailView(this.graphModel.get("selectedEntity"))}},"click .filter-add":function(t){if("paper"==e.getOption(this,"networkType")){var n=this.graphModel.get("selectedEntity").__data__.data.node_name;e.getOption(this,"filterCollection").add({name:n}),this.graphView.showSelectedEntity(this.graphModel.get("selectedEntity"))}else{var i=[],a=this.graphModel.get("selectedEntity").__data__;a.papers?i=a.papers:_.each(a.children,function(e){[].push.apply(i,e.papers)}),e.getOption(this,"filterCollection").add({name:a.name,papers:i}),this.showDetailView(this.graphModel.get("selectedEntity"))}}},triggerClose:function(){this.trigger("close")},forwardNewQueryRequest:function(e){this.ui.graphContainer.html(g()),this.trigger("new-network-requested",$(e.target).data("query"))},changeRows:function(e){e.preventDefault();var t=parseInt(this.$(".network-rows").val());this.$(".network-metadata").html(g),t&&this.model.set("userVal",_.min([this.model.get("max"),t]))},modelEvents:{"change:graphData":"render","change:max":"renderMetadata","change:current":"renderMetadata"},onRender:function(){var t,n;try{n=this.model.get("cachedQuery").get("q")[0]}catch(e){}return this.model.get("loading")?(this.$(".network-metadata").html(""),void this.$(".network-container").html(g())):!this.model.get("graphData")||_.isEmpty(this.model.get("graphData"))?(this.$(".network-metadata").html(""),void this.$(".network-container").html(p({cachedQuery:n}))):this.model.get("graphData").summaryGraph||this.model.get("graphData").root?(this.graphModel=new P({graphData:this.model.get("graphData")}),this.filterView=new w({collection:e.getOption(this,"filterCollection"),networkType:e.getOption(this,"networkType")}),this.listenTo(this.filterView,"filter:initiated",function(){this.trigger("filter:initiated")}),t=this.options.graphView?this.options.graphView:A,this.graphView=new t({model:this.graphModel,filterCollection:e.getOption(this,"filterCollection")}),this.graphView.on("show-detail-view",_.bind(this.showDetailView,this)),this.ui.filterContainer.append(this.filterView.render().el),this.ui.graphContainer.append(this.graphView.render().el),this.ui.detailsContainerHome.append(new S({graphData:this.model.get("graphData"),query:this.model.get("query"),networkType:e.getOption(this,"networkType"),cachedQuery:n}).render().el),this.$(".nav-tabs a[href='#home']").tab("show"),void this.renderMetadata()):(this.$(".network-metadata").html(""),void this.$(".network-container").html(p({cachedQuery:n})))},showDetailView:function(n){var i=n.__data__;(n=t.select(n)).select(".node-label").classed("selected-label",!0),n.select(".node-path").classed("selected-node",!0);var a,r=[],s={},o=[],c=this.model.get("graphData");if(i.children){a=i.children,_.each(a,function(e){Array.prototype.push.apply(r,e.papers)});f=_.sortBy(r,function(e){return e.slice(0,4)}).reverse()[0].slice(0,4);r=_.pairs(_.countBy(r));var u=_.chain(r).map(function(e){return e[1]}).sortBy(function(e){return e}).value(),d=_.chain(r).map(function(e){return e[1]/c.bibcode_dict[e[0]].authors.length}).sortBy(function(e){return e}).value(),p=_.chain(r).map(function(e){return c.bibcode_dict[e[0]].citation_count/c.bibcode_dict[e[0]].authors.length}).sortBy(function(e){return e}).value();r=_.sortBy(r,function(e){return(e[1]-u[0])/(u[u.length-1]-u[0])*(e[1]/c.bibcode_dict[e[0]].authors.length-d[0])/(d[d.length-1]-d[0])*(c.bibcode_dict[e[0]].citation_count/c.bibcode_dict[e[0]].authors.length-p[0])/(p[p.length-1]-p[0])}).reverse(),bibcodes=_.map(r,function(e){return e[0]}),o=_.map(bibcodes,function(e,t){var n={};return n.bibcode=e,n.title=c.bibcode_dict[e].title,n.citation_count=c.bibcode_dict[e].citation_count,n.numAuthors=r[t][1],n}),s.bibcodes=bibcodes,s.papers=o,s.groupColor=i.color,s.total=r.length,s.mostRecentYear=f,s.name=i.name,s.inFilter=!!e.getOption(this,"filterCollection").get(i.name),this.ui.detailsContainerSelected.empty().append(h(s))}else{o=_.map(i.papers,function(e){var t=c.bibcode_dict[e];return t.bibcode=e,_.isArray(t.title)&&(t.title=t.title[0]),t}),o=_.sortBy(o,function(e){return e.citation_count}).reverse();var f=_.chain(o).pluck("bibcode").sortBy(function(e){return e.slice(0,4)}).value().reverse()[0].slice(0,4);s.bibcodes=i.papers,s.mostRecentYear=f,s.papers=o,s.total=o.length,s.name=i.name,s.groupColor=i.parent.color,s.inFilter=!!e.getOption(this,"filterCollection").get(i.name),s.dataQuery='author:"'+i.name+'"',this.ui.detailsContainerSelected.empty().append(l(s))}this.$(".nav-tabs a[href='#selected-item']").tab("show")},renderMetadata:function(){var e={};e.max=this.model.get("max"),e.current=this.model.get("current"),this.$(".network-metadata").html(f(e))}}),x=i.Model.extend({initialize:function(e){e=e||{};if(this.on("newMetadata",function(){this.updateCurrent(),this.updateMax()}),!e.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var t={graphData:{},rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0,cachedQuery:void 0,loading:!0};_.extend(t,n._limits[e.widgetName]),this.defaults=function(){return t},this.set(this.defaults())}}),A=e.ItemView.extend({initialize:function(e){this.listenTo(e.filterCollection,"reset",this.showSelectedEntity)},template:d,events:{"change input[name=mode]":function(e){this.model.set("mode",e.target.value)},"change input[name=show-link]":function(e){this.model.set("linkLayer",e.target.checked)}},modelEvents:{"change:graphData":"renderGraph","change:selectedEntity":"showSelectedEntity","change:linkLayer":"changeLinkLayer","change:mode":"changeMode"},onRender:function(){this.model.get("graphData")&&this.renderGraph()},getConfig:function(){this.config={numberOfLabelsToShow:100,width:900,height:900,noGroupColor:"#a6a6a6"},this.config.radius=Math.min(this.config.width,this.config.height)/3},cachedVals:{partition:void 0,line:void 0,computeLabelPosition:void 0,svg:void 0,arc:void 0},renderGraph:function(){var e=this.model.get("graphData"),n=this;function i(e){var i=(e.x+e.x+e.dx)/2*180/Math.PI-90,a=parseInt(n.config.radius)+10,r=i>90?180:0;return r?t.select(this).attr("text-anchor","end"):t.select(this).attr("text-anchor","start"),"rotate("+i+")translate("+a+")rotate("+r+")"}this.cachedVals.svg=t.select(this.$("svg")[0]),this.getConfig(),this.customizeScales(e),this.cachedVals.computeLabelPosition=i;var a=n.cachedVals.svg.attr("width",n.config.width).attr("height",n.config.height).append("g").classed("network-g",!0),r=a.append("g").classed("real-container-of-stuff",!0),s=t.behavior.zoom().scaleExtent([.7,3]).on("zoom",function(){r.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")});a.call(s),a.on("dblclick.zoom",null),a.attr("transform","translate("+n.config.width/2+","+n.config.height/2.1+")");var o=t.layout.partition().value(function(e){return e.size}).size([2*Math.PI,n.config.radius*n.config.radius]).sort(function(e,t){return t.value-e.value});this.cachedVals.partition=o;var l=t.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return 1==e.depth?Math.sqrt(e.y)+40:Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});this.cachedVals.arc=l,r.append("circle").attr("r",n.config.radius).attr("fill","#fff").style("cursor","move");var c=r.selectAll("g").data(o.nodes(e.root)).enter().append("g").classed("node-containers",!0).each(function(e){e.sortVal=e.value}),u={};c.append("path").attr("d",l).classed("node-path",function(e){return 0!=e.depth}).style("cursor",function(e){if(0==e.depth)return"move"}).style("fill",function(e){if(0==e.depth)return"white";if(1==e.depth){var t=e.parent.children.indexOf(e);return t<7?(e.color=n.scales.color(t),u[e.name]=e.color,e.color):n.config.noGroupColor}return 2==e.depth?e.parent.color?e.parent.color:n.config.noGroupColor:void 0}).each(function(e){e.x0=e.x,e.dx0=e.dx});c.filter(function(e){return!e.children}).classed("author-node",!0).append("text").text(function(e){return e.name}).classed("node-label",!0).on("mouseover",function(e){if(n.model.get("linkLayer")){var i=e;t.selectAll(".link").filter(function(e){if(e[0]==i||e[e.length-1]==i)return!0}).classed("selected-link",!0),t.selectAll(".link").each(function(e){e[0]==i?t.selectAll(".node-label").filter(function(t){return t.name==e[e.length-1].name}).classed("linked-label",!0):e[e.length-1]==i&&t.selectAll(".node-label").filter(function(t){return t.name==e[0].name}).classed("linked-label",!0)})}}).on("mouseout",function(){t.selectAll(".link").classed("selected-link",!1),t.selectAll(".node-label").classed("linked-label",!1)}).attr("font-size",function(e){return n.scales.occurrencesFontScale(e.size)+"px"}).attr("transform",i),_.each(e.root.name,function(t,n){r.append("text").classed("s-connector-node",!0).attr("y",function(){return 25*n-25*e.root.name.length/2}).text(t.nodeName)}),c.on("click",function(e,t){0!=e.depth&&(n.model.get("linkLayer")||(n.model.get("selectedEntity")===this?n.model.set("selectedEntity",null):n.model.set("selectedEntity",this)))}),this.renderLinkLayer()},renderLinkLayer:function(){var e,n,i,a,r=this;svg=t.select(r.$(".real-container-of-stuff")[0]),tooltip=t.select(r.$(".d3-tooltip")[0]),bibDict=this.model.get("graphData").bibcode_dict,e=_.map(r.model.get("graphData").link_data,function(e){var t={};return t.source=svg.selectAll(".node-path").filter(function(t){return t.numberName==e[0]})[0][0].__data__,t.target=svg.selectAll(".node-path").filter(function(t){return t.numberName==e[1]})[0][0].__data__,t.weight=e[2],t}),n=t.layout.bundle(),i=t.svg.line.radial().interpolate("bundle").tension(.9).radius(function(e){return Math.sqrt(e.y+e.dy)}).angle(function(e){return(e.x+e.x+e.dx)/2}),this.cachedVals.line=i,(a=svg.append("g").classed("link-container",!0)).append("circle").attr("r",r.config.radius).classed("link-background",!0),a.selectAll(".link").data(n(e)).enter().append("path").attr("class","link").attr("d",function(e){return i(e)}).attr("stroke-width",function(t){var n=_.filter(e,function(e){return e.source==t[0]&&e.target==t[t.length-1]||e.target==t[0]&&e.source==t[t.length-1]})[0].weight;return r.scales.linkScale(n)})},customizeScales:function(e){this.scales={},this.scales.color=t.scale.ordinal().domain([0,1,2,3,4,5,6]).range(["hsla(282, 60%, 52%, 1)","hsla(349, 61%, 47%, 1)","hsla(26, 95%, 67%, 1)","hsla(152, 60%, 40%, 1)","hsla(193, 64%, 61%, 1)","hsla(220, 70%, 56%, 1)","hsla(250, 50%, 47%, 1)"]);var n=[],i=[],a=[];_.each(e.root.children,function(e){_.each(e.children,function(e){n.push(e.size),i.push(e.citation_count),a.push(e.read_count)})}),i=_.sortBy(i,function(e){return e}).reverse(),a=_.sortBy(a,function(e){return e}).reverse(),this.scales.citationLimit=i[this.config.numberOfLabelsToShow]||i[i.length-1],this.scales.readLimit=a[this.config.numberOfLabelsToShow]||a[a.length-1],this.scales.occurrencesFontScale=t.scale.log().domain([t.min(n),t.max(n)]).range([8,20]),this.scales.citationFontScale=t.scale.linear().domain([t.min(i),t.max(i)]).range([8,20]),this.scales.readFontScale=t.scale.linear().domain([t.min(a),t.max(a)]).range([8,20]);var r=_.map(e.link_data,function(e){return e[2]});this.scales.linkScale=t.scale.pow().exponent(8).domain([t.min(r),t.max(r)]).range([.5,3.5])},showSelectedEntity:function(){var e=this.model.get("selectedEntity"),t=this.$(".network-detail-area");this.cachedVals.svg.selectAll(".node-path").classed("selected-node",!1),this.cachedVals.svg.selectAll(".node-label").classed("selected-label",!1),t.empty(),e&&this.trigger("show-detail-view",e)},changeLinkLayer:function(e,n){n?(this.model.set("cachedEntity",this.model.get("selectedEntity")),this.model.set("selectedEntity",void 0),t.select(this.$(".link-container")[0]).style("display","block").selectAll(".link").call(function(e){3e3/e[0].length}).sort(function(e){return e.weight}).style("display","block")):(this.model.set("selectedEntity",this.model.get("cachedEntity")),t.select(this.$(".link-container")[0]).style("display","none"))},changeMode:function(e,n){var i=this;var a=i.cachedVals.svg.selectAll(".node-containers"),r=i.cachedVals.partition.sort(function(e,t){return t.sortVal-e.sortVal}).value(function(e){return e[n]}).nodes(i.model.get("graphData").root);a.data(r,function(e){return e.name}).selectAll("path").transition().duration(1500).attrTween("d",function(e){var n=t.interpolate({x:e.x0,dx:e.dx0},e);return function(t){var a=n(t);return e.x0=a.x,e.dx0=a.dx,i.cachedVals.arc(a)}}),a.selectAll("text").attr("opacity","0").attr("display",function(e){return"size"==n?"block":"citation_count"==n&&e.citation_count>i.scales.citationLimit?"block":"read_count"==n&&e.read_count>i.scales.readLimit?"block":"none"}).attr("font-size",function(e){return"size"==n?i.scales.occurrencesFontScale(e.size)+"px":"citation_count"==n?i.scales.citationFontScale(e.citation_count)+"px":"read_count"==n?i.scales.readFontScale(e.read_count)+"px":void 0}).attr("transform",i.cachedVals.computeLabelPosition).transition().duration(1500).attr("opacity",1),t.selectAll(".link").transition().duration(1500).attr("d",function(e){return i.cachedVals.line(e)})}}),P=Backbone.Model.extend({defaults:function(){return{graphData:{},selectedEntity:void 0,cachedEntity:void 0,query:void 0,linkLayer:!1,mode:"occurrences"}}});return s.extend({initialize:function(e){if(!e.endpoint)throw new Error("widget was not configured with an endpoint");e.broadcastFilteredQuery&&(this.broadcastFilteredQuery=e.broadcastFilteredQuery),this.model=new x({widgetName:e.widgetName||"AuthorNetwork"}),this.listenTo(this.model,"change:userVal",this.requestDifferentRows),this.filterCollection=new y,this.view=new E({graphView:e.graphView,model:this.model,filterCollection:this.filterCollection,networkType:e.networkType,helpText:e.helpText,graphMixin:e.graphMixin,showDetailGraphView:e.showDetailGraphView}),this.listenTo(this.view,"new-network-requested",this.requestDifferentQuery),this.listenTo(this.view,"filter:initiated",this.broadcastFilteredQuery),this.listenTo(this.view,"close",this.broadcastClose),this.widgetName="visualization_"+e.networkType,this.queryUpdater=new o(this.widgetName)},generateApiRequest:function(t){return new a({target:e.getOption(this,"endpoint"),query:new r({query:JSON.stringify(t.toJSON())}),options:{type:"POST",contentType:"application/json"}})},requestDifferentRows:function(e,t){var n=this.getCurrentQuery().clone();n.unlock(),n.set("rows",this.model.get("userVal")),n.unset("hl"),n.unset("hl.fl");var i=this.generateApiRequest(n);this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,i)},requestDifferentQuery:function(e){this.model.set("cachedQuery",this.getCurrentQuery());var t=new r;t.set("q",e),t.set("rows",this.model.get("default")),t.set("sort","date desc");var n=this.generateApiRequest(t);this.setCurrentQuery(t),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setOriginalQuery","processResponse");var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setOriginalQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setOriginalQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},setOriginalQuery:function(e){this.model.set("cachedQuery",void 0),this._originalQuery=e,this.setCurrentQuery(e)},getOriginalQuery:function(){return this._originalQuery},resetWidget:function(){this.view&&this.view.graphView&&(this.view.graphView.$el.empty(),this.view.graphView.stopListening()),this.filterCollection.reset(null,{silent:!0}),this.model.set(_.result(this.model,"defaults"),{silent:!0})},renderWidgetForListOfBibcodes:function(t){this.resetWidget(),this.model.set({graphData:{},loading:!0});var n=new a({target:e.getOption(this,"endpoint"),query:new r({bibcodes:t}),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)},renderWidgetForCurrentQuery:function(){this.resetWidget();var e=this.getCurrentQuery().clone();if(e.unlock(),e.get("__qid")){e.set("fl","bibcode"),e.set("rows","1000");var t=this.composeRequest(e);this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,t)}else{e.set("rows",this.model.get("default")),e.unset("hl"),e.unset("hl.fl");t=this.generateApiRequest(e);this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,t)}},processResponse:function(e){try{e.get("responseHeader.params.__qid");this.renderWidgetForListOfBibcodes(e.get("response").docs.map(function(e){return e.bibcode}))}catch(n){var t=e.toJSON();this.model.set({graphData:t.data,numFound:parseInt(t.msg.numFound),rows:parseInt(t.msg.rows),query:e.getApiQuery().get("q"),loading:!1}),this.model.trigger("newMetadata")}},broadcastFilteredQuery:function(){var e=_.flatten(this.filterCollection.pluck("papers")),t=this.getOriginalQuery().clone();t.unlock(),t.set("__bigquery",e),this.resetWidget(),this.getPubSub().publish(this.getPubSub().START_SEARCH,t)},broadcastClose:function(){this.resetWidget(),this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},testing:{detailView:S}})}),define("js/wraps/author_network",["js/widgets/network_vis/network_widget","js/components/api_targets"],function(e,t){var n={};return n.endpoint=t.SERVICE_AUTHOR_NETWORK,n.helpText="<p>The circular graph shows you the main author groups within your results.These groups are generated by a community detection algorithm, and their sizes represent the cumulative frequency of occurence in the result set of all their members. (In other words: people who co-author papers together appear in the same cluster.) Click on either a name or a group tolearn more about the papers by those particular authors. You can filter your current search resultsby clicking the 'add to filter' button in the detail view. </p>",n.networkType="author",function(){return new e(n)}}),define("hbs!js/wraps/templates/paper-network-data",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"\n        "+this.escapeExpression(this.lambda(e,e))+(null!=(a=t.unless.call(e,i&&i.last,{name:"unless",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"\n"},2:function(e,t,n,i){return", "},4:function(e,t,n,i){return'        <button class="btn btn-xs btn-default filter-remove"><i class="s-filter-image"></i>remove group from filter</button>\n'},6:function(e,t,n,i){return'        <button class="btn btn-xs btn-default filter-add"><i class="s-filter-image"></i> add group to filter</button>\n'},8:function(e,t,n,i){return"           <p><b>Top papers from this group include:</b> </p>\n"},10:function(e,t,n,i){return"           <p><b>Papers in this group: </b></p>\n"},12:function(e,t,n,i){return'               <li title="'+this.escapeExpression(this.lambda(null!=e?e.node_name:e,e))+'">\n                   <a href="#abs/'+this.escapeExpression(this.lambda(null!=e?e.node_name:e,e))+'" data-bypass target="_blank" rel="noopener"><b>'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</b></a>; <i>"+this.escapeExpression(this.lambda(null!=e?e.first_author:e,e))+"</i>\n                   ("+this.escapeExpression(this.lambda(null!=e?e.citation_count:e,e))+" citations)\n               </li>\n\n"},14:function(e,t,n,i){var a;return"\n               <li>\n"+(null!=(a=t.if.call(e,null!=e?e.inGroup:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.program(17,i,0),data:i}))?a:"")+'                   <a href="#abs/'+this.escapeExpression(this.lambda(null!=e?e.bibcode:e,e))+'" data-bypass target="_blank" rel="noopener">'+this.escapeExpression(this.lambda(null!=e?e.bibcode:e,e))+"</a> (cited by "+this.escapeExpression(this.lambda(null!=e?e.percent:e,e))+"% of papers\n                   in this group)\n               </li>\n\n"},15:function(e,t,n,i){return'                   <i class="fa fa-star-o"></i>\n'},17:function(e,t,n,i){return'                   <i class="fa fa-star-o no-show"></i>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div style="padding: 0 -15px">\n<div class="s-group-title clearfix" style="border-bottom: 6px solid '+this.escapeExpression("function"==typeof(r=null!=(r=t.borderColor||(null!=e?e.borderColor:e))?r:t.helperMissing)?r.call(e,{name:"borderColor",hash:{},data:i}):r)+';">\n\n    <h3>Group '+this.escapeExpression("function"==typeof(r=null!=(r=t.groupIdToShow||(null!=e?e.groupIdToShow:e))?r:t.helperMissing)?r.call(e,{name:"groupIdToShow",hash:{},data:i}):r)+':\n       <span class="s-light-font"> '+(null!=(a=t.each.call(e,null!=(a=null!=e?e.summaryData:e)?a.titleWords:a,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'        </span>\n    </h3>\n\n    <div class="pull-right">\n'+(null!=(a=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?a:"")+'    </div>\n\n</div>\n\n   <div class="s-group-content">\n\n       <p>This group consists of <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.summaryData:e)?a.paper_count:a,e))+"</b> papers, which have been cited, in total, <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.summaryData:e)?a.total_citations:a,e))+"</b>\n           times.</p>\n\n       <div>\n"+(null!=(a=t.if.call(e,null!=e?e.morePapers:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.program(10,i,0),data:i}))?a:"")+'           <ul class="list-unstyled s-top-papers">\n'+(null!=(a=t.each.call(e,null!=e?e.topNodes:e,{name:"each",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?a:"")+'           </ul>\n\n       </div>\n\n       <div>\n           <p><b> Papers highly referenced by papers in this group:</b> <br/>\n               (A <i class="fa fa-star-o"></i> indicates that this paper is also a member of Group '+this.escapeExpression("function"==typeof(r=null!=(r=t.groupIdToShow||(null!=e?e.groupIdToShow:e))?r:t.helperMissing)?r.call(e,{name:"groupIdToShow",hash:{},data:i}):r)+')</p>\n\n           <ul class="list-unstyled">\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.summaryData:e)?a.processedTopCommonReferences:a,{name:"each",hash:{},fn:this.program(14,i,0),inverse:this.noop,data:i}))?a:"")+"\n           </ul>\n           <small>(Click on a link above to view the paper's abstract page in ADS in a new tab)</small>\n       </div>\n\n\n\n   </div>\n\n</div>\n\n\n\n\n\n\n\n"},useData:!0});return t.registerPartial("js/wraps/templates/paper-network-data",n),n}),define("hbs!js/wraps/templates/paper-network-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-network-graph-div">\n    <div class="detail-panel s-detail-panel">\n        <h4 style="display:inline-block">Size wedges based on:</h4>\n        <div class="btn-group network-sizes" data-toggle="buttons">\n            <label class="btn btn-primary active">\n                <input type="radio" name="mode" value="paper_count" checked autocomplete="off"> Number of Papers\n            </label>\n            <label class="btn btn-primary">\n                <input type="radio" name="mode" value="total_citations" autocomplete="off"> Paper Citations\n            </label>\n            <label class="btn btn-primary">\n                <input type="radio" name="mode" value="total_reads" autocomplete="off"> Paper Downloads\n            </label>\n        </div>\n    </div>\n\n    <svg class="network-chart s-network-chart" width="400"\n         height="400" viewBox="0 0 300 300"\n         id="network-viz-main-chart"\n         style="font-family:helvetica,arial,san-serif"\n    >\n    </svg>\n</div>\n\n'},useData:!0});return t.registerPartial("js/wraps/templates/paper-network-container",n),n}),define("hbs!js/wraps/templates/paper-network-link-data",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'        <tr>\n            <td>\n                <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+'">'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+"</a>\n            </td>\n            <td>\n                "+this.escapeExpression("function"==typeof(a=null!=(a=t.percentOne||(null!=e?e.percentOne:e))?a:t.helperMissing)?a.call(e,{name:"percentOne",hash:{},data:i}):a)+"%\n            </td>\n            <td>\n                "+this.escapeExpression("function"==typeof(a=null!=(a=t.percentTwo||(null!=e?e.percentTwo:e))?a:t.helperMissing)?a.call(e,{name:"percentTwo",hash:{},data:i}):a)+"%\n            </td>\n        </tr>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="s-group-title s-paper-network-link-data-header">\n\n    <h3>References From Both <span style="color:'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.group1:e)?a.color:a,e))+'"> Group '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.group1:e)?a.name:a,e))+' </span> and <span\n            style="color:'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.group2:e)?a.color:a,e))+'"> Group '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.group2:e)?a.name:a,e))+' </span></h3>\n\n</div>\n\n<div class="s-group-content">\n    <p>These groups have <b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.referencesLength||(null!=e?e.referencesLength:e))?r:t.helperMissing)?r.call(e,{name:"referencesLength",hash:{},data:i}):r)+' </b> unique references in common</p>\n\n    <p></p>\n    <small>(Click on a link below to view the paper\'s abstract page in ADS in a new tab)</small>\n    </p>\n\n\n    <table class="table table-condensed">\n        <thead>\n        <tr>\n            <th>\n                Paper\n            </th>\n            <th>\n                Group '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.group1:e)?a.name:a,e))+"\n            </th>\n            <th>\n                Group "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.group2:e)?a.name:a,e))+"\n            </th>\n        </tr>\n        </thead>\n        <tbody>\n"+(null!=(a=t.each.call(e,null!=e?e.shared:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"        </tbody>\n    </table>\n\n\n</div>\n\n"},useData:!0});return t.registerPartial("js/wraps/templates/paper-network-link-data",n),n}),define("js/wraps/paper_network",["marionette","js/widgets/network_vis/network_widget","js/components/api_query_updater","hbs!js/wraps/templates/paper-network-data","hbs!js/wraps/templates/paper-network-container","hbs!js/widgets/network_vis/templates/not-enough-data-template","hbs!js/wraps/templates/paper-network-link-data","js/components/api_targets","bootstrap"],function(e,t,n,i,a,r,s,o,l){var c={};c.endpoint=o.SERVICE_PAPER_NETWORK,c.networkType="paper",c.helpText="<p>Papers are grouped by shared references, because  they are more likely to discuss similar topics.</p> <p>If your search returned a large enough set of papers, you will see two views: a <b>summary view</b>  with groups of tightly linked papers, and a <b>detail view</b>  that gives you more information about the group </p>";Backbone.Model.extend({defaults:function(){return{graphData:{},selectedEntity:void 0,cachedEntity:void 0,linkLayer:!1,mode:"occurrences"}}});return c.graphView=e.ItemView.extend({template:a,className:"graph-view",events:{"change input[name=mode]":function(e){this.model.set("mode",e.target.value)},"change input[name=show-link]":function(e){this.model.set("linkLayer",e.target.checked)},"click .filter-remove":function(t){var n=this.model.get("selectedEntity"),i=_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:n}).node_name;e.getOption(this,"filterCollection").remove({id:i}),this.showSelectedEntity()},"click .filter-add":function(t){var n=this.model.get("selectedEntity"),i=_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:n}).node_name;e.getOption(this,"filterCollection").add({name:i}),this.showSelectedEntity()}},modelEvents:{"change:graphData":"renderGraph","change:selectedEntity":"showSelectedEntity","change:mode":"changeMode"},onRender:function(){this.model.get("graphData")&&this.renderGraph()},getConfig:function(){this.config={width:300,height:300,noGroupColor:"hsl(0, 0%, 65%)"},this.config.radius=Math.min(this.config.width,this.config.height)/1.5,this.config.outerRadius=.33*Math.min(this.config.width,this.config.height),this.config.innerRadius=.21*Math.min(this.config.width,this.config.height)},generateCachedVals:function(){var e=this;this.cachedVals={line:void 0,bundle:void 0,svg:void 0,arc:void 0},this.cachedVals.bundle=d3.layout.bundle(),this.cachedVals.line=d3.svg.line.radial().interpolate("bundle").tension(.3).radius(function(t){return t.startAngle?e.config.innerRadius+10:0}).angle(function(e){return e.startAngle?(e.startAngle+e.endAngle)/2:0}),this.cachedVals.svg=d3.select(this.$("svg.network-chart")[0]).attr("width",e.config.width).attr("height",e.config.height).append("g").attr("transform","translate("+e.config.width/2+","+e.config.height/2+")"),this.cachedVals.arc=d3.svg.arc().innerRadius(e.config.innerRadius).outerRadius(e.config.outerRadius),this.cachedVals.pie=d3.layout.pie().value(function(e){return e.paper_count}).sort(function(e,t){return e.node_name-t.node_name}),e.cachedVals.groupTicks=function(e){return{angle:(e.startAngle+e.endAngle)/2,label:e.data.node_label,data:e}}},computeScales:function(){var e=this.model.get("graphData").summaryGraph;this.scales={};var t=_.map(e.links,function(e){if(e.source!==e.target)return e.weight});this.scales.tensionScale=d3.scale.linear().domain([d3.min(t),d3.max(t)]).range([0,1]),this.scales.linkScale=d3.scale.linear().domain([d3.min(t),d3.max(t)]).range([3,22]);var n=_.pluck(e.nodes,"paper_count");this.scales.initialFontScale=d3.scale.linear().domain([d3.min(n),d3.max(n)]).range([9,14]),this.scales.fill=d3.scale.ordinal().domain([1,2,3,4,5,6]).range(["hsl(282, 59%, 61%)","hsl(349, 54%, 57%)","hsl(26, 94%, 73%)","hsl(152, 40%, 52%)","hsl(193, 65%, 69%)","hsl(220, 70%, 65%)","hsl(250, 44%, 58%)"])},renderGraph:function(){this.getConfig(),this.computeScales(),this.generateCachedVals();var e=this.cachedVals.svg,t=this.model.get("graphData").summaryGraph,n=[],i=this;t||this.$el.html(r());var a=this.cachedVals.pie,s=this.cachedVals.arc,o=a(t.nodes);_.findWhere(o,{startAngle:0}).startAngle=.001,e.selectAll("rect").data(o).enter().append("rect").classed("node-path",!0),this.renderLinkLayer(),e.selectAll("rect").remove(),e.selectAll(".node-path").data(o).enter().append("path").classed("node-path",!0).attr("fill",function(e,t){return e.data.node_name>7?i.config.noGroupColor:i.scales.fill(e.data.node_name)}).attr("d",s).attr("id",function(e,t){return"vis-group-"+e.data.node_name}).on("mouseover",u("mouseenter")).on("mouseout",u("mouseleave")).on("click",function(e,t){e.data.id;i.model.set("selectedEntity",this)});var l=e.selectAll(".groupLabel").data(function(){return _.map(o,function(e,t){return i.cachedVals.groupTicks(e)})}).enter().append("g").each(function(e){n.push(e.data.value)}).classed("groupLabel",!0).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+1*i.config.outerRadius/1+",0)"});n=d3.sum(n);var c=l.append("g").attr("x",0).attr("dy",".5em").attr("transform",function(e,t){return"rotate("+-(180*e.angle/Math.PI-90)+")"}).classed("summary-label-container",!0).classed("hidden",function(e){if(e.data.value/n<.08)return!0}).selectAll("text").data(function(e,t){var n=_.pairs(e.label);return n=(n=_.sortBy(n,function(e){return-e[1]})).slice(0,5),_.map(n,function(t){return t[2]=e.data.data.id,t})}).enter().append("text").attr("x",0).classed("paper-network-labels",!0).attr("text-anchor","middle").attr("y",function(e,n,a){var r=_.findWhere(t.nodes,{id:e[2]}).paper_count;return n*i.scales.initialFontScale(r)-30}).attr("font-size",function(e,n,a){var r=_.findWhere(t.nodes,{id:e[2]}).paper_count;return i.scales.initialFontScale(r)+"px"}).text(function(e,t){return e[0]});function u(e){return function(t,n,a){"mouseenter"===e?t.data.node_name>7?d3.select(this).attr("fill",d3.hsl(i.config.noGroupColor).darker(.7)):d3.select(this).attr("fill",d3.hsl(i.scales.fill(t.data.node_name)).darker(.7)):t.data.node_name>7?d3.select(this).attr("fill",i.config.noGroupColor):d3.select(this).attr("fill",i.scales.fill(t.data.node_name))}}function d(e){return function(t,n,a){var r=d3.select(this.parentNode).data()[0].data.data.node_name,s=d3.selectAll(".node-path").filter(function(e){return e.data.node_name===r})[0][0];"mouseenter"===e?r>7?d3.select(s).attr("fill",d3.hsl(i.config.noGroupColor).darker(.7)):d3.select(s).attr("fill",d3.hsl(i.scales.fill(r)).darker(.7)):r>7?d3.select(s).attr("fill",d3.hsl(i.config.noGroupColor)):d3.select(s).attr("fill",i.scales.fill(r))}}c.on("mouseover",d("mouseenter")).on("mouseout",d("mouseleave")),c.on("click",function(e){var t=d3.select(this.parentNode).data()[0].data.data.node_name,n=i.$("#vis-group-"+t)[0];i.model.set("selectedEntity",n)})},parseLinks:function(e){var t=this.cachedVals.svg,n={name:"fake"};return e=_.chain(e).map(function(e){var i={};if(i.source=t.selectAll(".node-path").filter(function(t,n){return t.data.stable_index==e.source})[0][0].__data__,i.target=t.selectAll(".node-path").filter(function(t,n){return t.data.stable_index==e.target})[0][0].__data__,i.source!==i.target)return i.weight=e.weight,i.source.parent=n,i.target.parent=n,i}).filter(function(e){if(e)return!0}).value()},updateLinkLayer:function(){var e,t=this.cachedVals.svg,n=this.model.get("graphData").summaryGraph.links;n=this.parseLinks(n),e=this.cachedVals.line,t.selectAll(".link").data(this.cachedVals.bundle(n)).transition().duration(1e3).attr("d",function(t){return e(t)})},renderLinkLayer:function(){var e,t,n=this,i=this.cachedVals.svg,a=n.model.get("graphData").summaryGraph.links;a=this.parseLinks(a),e=this.cachedVals.line,(t=i.append("g").classed("link-container",!0)).append("circle").attr("r",n.config.radius).classed("link-background",!0),t.selectAll(".link").data(n.cachedVals.bundle(a)).enter().append("path").attr("class","link").attr("d",function(t){return e(t)}).attr("stroke-width",function(e){var t=_.findWhere(a,function(t){return t.source==e[0]&&t.target==e[e.length-1]||t.target==e[0]&&t.source==e[e.length-1]}).weight;return n.scales.linkScale(t)}).on("click",function(e){n.model.set("selectedEntity",[e[0],e[2]])})},showSelectedEntity:function(){var t,n={},a=this.model.get("selectedEntity");if(_.isArray(a)){var r,o,l,c,u,d,h=[];r=a[0].data.id,o=a[1].data.id,l=this.getAllLinks(r),c=this.getAllLinks(o),u=_.flatten(_.pluck(l,"overlap")),d=_.flatten(_.pluck(c,"overlap")),_.each(_.intersection(u,d),function(e){var t=_.filter(u,function(t){return t==e}).length/u.length,n=_.filter(d,function(t){return t==e}).length/d.length;h.push({name:e,percentOne:100*t,percentTwo:100*n})}),h=_.sortBy(h,function(e){return e.percentOne*e.percentTwo}).reverse(),n.shared=h,_.each(n.shared,function(e,t){n.shared[t].percentOne=n.shared[t].percentOne.toFixed(2),n.shared[t].percentTwo=n.shared[t].percentTwo.toFixed(2)}),n.group1={name:_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:r}).node_name},n.group1.color=n.group1.name<8?this.scales.fill(n.group1.name):this.config.noGroupColor,n.group2={name:_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:o}).node_name},n.group2.color=n.group1.name<8?this.scales.fill(n.group2.name):this.config.noGroupColor,n.referencesLength=n.shared.length,$(".details-container #selected-item").html(s(n))}else{a=a.__data__.data.id;var p=_.findWhere(this.model.get("graphData").summaryGraph.nodes,function(e){return e.id==a}),f=$.extend({},p);f.processedTopCommonReferences=[],f.titleWords=_.keys(p.node_label);var g=_.pluck(this.getAllNodes(a),"node_name");_.each(f.top_common_references,function(e,t){var n=!!_.contains(g,t);f.processedTopCommonReferences.push({bibcode:t,percent:(100*e).toFixed(0),inGroup:n})}),f.processedTopCommonReferences=_.sortBy(f.processedTopCommonReferences,function(e){return e[1]}).reverse();var m=this.getAllNodes(p.id);t=_.sortBy(m,function(e){return e.citation_count}).reverse(),n.morePapers=t.length>30,n.summaryData=f,n.inFilter=!!e.getOption(this,"filterCollection").get(p.node_name),n.topNodes=t.slice(0,30),n.groupIdToShow=p.node_name,n.borderColor=p.node_name<8?this.scales.fill(p.node_name):this.config.noGroupColor,n.backgroundColor=d3.hsl(n.borderColor).brighter(),$(".details-container #selected-item").html(i(n))}$(".nav-tabs a[href='#selected-item']").tab("show")},changeMode:function(){var e,t,n,i,a=this,r=this.cachedVals.pie,s=this.cachedVals.arc,o=this.cachedVals.svg,l=[],c=[],u=this.model.get("graphData").summaryGraph,d=this.model.get("mode");r.value(function(e){if("references"===d){var t=_.findWhere(u.links,function(t){if(t.source===e.stable_index&&t.target===e.stable_index)return!0});return l.push(t.weight),t.weight}return l.push(e[d]),e[d]}),t=r(u.nodes),e=d3.scale.linear().domain([d3.min(l),d3.max(l)]).range([7,17]),_.findWhere(t,{startAngle:0}).startAngle=.001,o.selectAll(".node-path").each(function(e){this.oldStartAngle=e.startAngle,this.oldEndAngle=e.endAngle}).data(t,function(e){return e.data.id}).transition().duration(1e3).attrTween("d",function(e,t){return t=d3.interpolate({startAngle:this.oldStartAngle,endAngle:this.oldEndAngle},e),function(e){var n=t(e);return this.startAngle=n.startAngle,this.endAngle=n.endAngle,s(n)}}),this.updateLinkLayer(),n=_.map(t,function(e){return c.push(e.value),a.cachedVals.groupTicks(e)}),c=d3.sum(c),i=o.selectAll(".groupLabel").data(n).transition().duration(1e3).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+a.config.outerRadius+",0)"}),o.selectAll(".summary-label-container").data(n).classed("hidden",function(e){if(e.data.value/c<.08)return!0}).transition().duration(1e3).attr("transform",function(e,t){return"rotate("+-(180*e.angle/Math.PI-90)+")"}),i.selectAll("text").attr("y",function(t,n,i){var a=this.parentNode.__data__.data.value;return n*e(a)-30}).attr("font-size",function(t,n,i){var a=this.parentNode.__data__.data.value;return e(a)+"px"})},getAllNodes:function(e){var t=this.model.get("graphData").fullGraph,n=[];return _.each(t.nodes,function(t,i){t.group===e&&n.push(t)}),n},getAllLinks:function(e){var t=this.model.get("graphData").fullGraph,n=[],i=[];return _.each(t.nodes,function(t,i){t.group===e&&n.push(i)}),_.each(t.links,function(e,t){-1===n.indexOf(e.source)&&-1===n.indexOf(e.target)||i.push(e)}),i}}),c.broadcastFilteredQuery=function(){var e=this.model.get("graphData"),t=this,n=[],i=this.getCurrentQuery().clone();this.filterCollection.each(function(i){var a=i.get("name"),r=_.findWhere(e.summaryGraph.nodes,{node_name:a}),s=t.view.graphView.getAllNodes(r.id);s=_.pluck(s,"node_name"),Array.prototype.push.apply(n,s)}),i.unlock(),i.set("__bigquery",n),this.resetWidget(),this.getPubSub().publish(this.getPubSub().START_SEARCH,i)},c.widgetName="PaperNetwork",function(){return new t(c)}}),define("hbs!js/widgets/wordcloud/templates/wordcloud-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<span class="s-large-close close-widget">x</span>\n\n\n<div class="col-sm-2" id="wordcloud-controlpanel">\n\n    <div>\n        This visualization shows you unique and frequent words from\n        a set of the top 100 search results.\n        <br/>\n        <b><a href="https://adsabs.github.io/help/actions/visualize#word-cloud" target="_blank" rel="noopener">\n            Learn more about the concept cloud</a></b>\n        <br/>\n        <br/>\n    </div>\n\n    <div class="s-vis-item-format clearfix"><span style="font-size:14px"> Recalculate Cloud</span><br/><br/>\n        <div id= "ticker">\n\n        </div>\n        <div id="word-choice">\n\n        </div>\n        <div class="s-wordcloud-tick-container">\n            <span style="display:inline-block;margin-left: 0%;">|</span>\n            <span style="display:inline-block;margin-left: 24%;">|</span>\n            <span style="display:inline-block;margin-left: 23%;">|</span>\n            <span style="display:inline-block;margin-left: 22%;">|</span>\n            <span style="display:block;float:right;">|</span>\n        </div>\n        <div class="s-wordcloud-slider-labels"><span class="pull-left">Unique</span><span class="pull-right">Frequent</span></div>\n\n    </div>\n    <div class="selected-word-list">\n\n    </div>\n</div>\n\n\n\n<div class="s-wordcloud-container col-sm-10" id="wordcloud-container">\n\n    <svg id="wordcloud-svg" viewBox="0 0 1000 600" class="s-wordcloud-svg">\n    </svg>\n\n</div>\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/wordcloud/templates/wordcloud-template",n),n}),define("hbs!js/widgets/wordcloud/templates/selected-list-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"\n"+(null!=(a=t.each.call(e,null!=e?e.selectedWords:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"\n"},2:function(e,t,n,i){return'\n        <li><span class="selected-word">'+this.escapeExpression(this.lambda(e,e))+'</span> <i class="close">&times;</i></li>\n\n'},4:function(e,t,n,i){return"\n    <li> Click on a term to add it to this list.</li>\n    <li> Click again on the term to remove it.</li>\n\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<h5> Selected Terms: </h5>\n<ul class="vis-select-list s-vis-select-list">\n\n'+(null!=(a=t.if.call(e,null!=e?e.selectedWords:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(4,i,0),data:i}))?a:"")+'\n\n</ul>\n\n<button class="btn btn-info apply-vis-facet">Apply Filter to Search</button>'},useData:!0});return t.registerPartial("js/widgets/wordcloud/templates/selected-list-template",n),n}),define("js/widgets/wordcloud/widget",["jquery","backbone","marionette","d3","js/components/api_request","js/widgets/base/base_widget","hbs!js/widgets/wordcloud/templates/wordcloud-template","hbs!js/widgets/wordcloud/templates/selected-list-template","js/components/api_targets","js/components/api_query_updater","js/components/api_query","js/components/api_feedback","jquery-ui","bootstrap","d3-cloud"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=t.Model.extend({initialize:function(){this.on("selected",function(e){this.add(e)}),this.on("unselected",function(e){this.remove(e)})},add:function(e){this.get("selectedWords").push(e),this.trigger("userChange:selectedWords",e)},remove:function(e){e=e.trim();var t=_.without(this.get("selectedWords"),e);this.set("selectedWords",t),this.trigger("userChange:selectedWords",e)},reset:function(){this.set("selectedWords",[])},defaults:{selectedWords:[]}}),p=t.View.extend({initialize:function(e){e=e||{},this.model=new h,this.listenTo(this.model,"userChange:selectedWords",this.render)},template:o,render:function(){return this.$el.html(this.template(this.model.toJSON())),this},events:{"click .close":"removeWord","click .apply-vis-facet":"submitFacet"},removeWord:function(t){var n=e(t.target).parent().find(".selected-word").text();this.model.remove(n)},submitFacet:function(){this.model.get("selectedWords").length&&this.trigger("submitFacet")}}),f=n.ItemView.extend({className:"s-wordcloud-widget clearfix",events:{"click .close-widget":"signalCloseWidget"},initialize:function(e){e=e||{},this.listView=e.listView,this.listenTo(this.model,"change:processedWordList",this.onProcessedWordChange),this.listenTo(this.listView.model,"userChange:selectedWords",this.toggleHighlight)},signalCloseWidget:function(){this.trigger("close-widget")},toggleHighlight:function(e){var t=e.trim();i.selectAll(this.$("text")).filter(function(){if(this.textContent.trim()==t){var e=i.select(this);e.classed("selected",!e.classed("selected"))}})},template:s,render:function(){return this.$el.html(s({helpText:"<p>This word cloud allows you to view interesting words from the titles and abstracts of your search results.</p><p> Move the slider towards <strong> Frequent</strong> to view a word cloud that is simply composed of the words that appeared most frequently in your results. (This word cloud is likely to feature generic terms like 'observations' prominently.) </p> <p>Move the slider towards <strong>Unique</strong> to see a word cloud that shows words that appeared in your results but which appear very rarely in the rest of the ADS corpus.</p><p>To facet your ADS search, select words from the word cloud and click the 'Apply Filter to Search' button.</p>"})),this.listView.setElement(this.$(".selected-word-list")).render(),this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0}),this},onProcessedWordChange:function(){this.model.get("processedWordList").length>0&&(this.$(".s-loading").length&&this.render(),this.buildSlider(),this.buildCloudLayout())},buildCloudLayout:function(){i.layout.cloud().size([1e3,600]).words(this.model.get("processedWordList")).padding(3).rotate(function(){return 0}).font("Arial").fontSize(function(e){return e.size}).on("end",_.bind(this.draw,this)).start()},buildSlider:function(){var e=this;this.$("#word-choice").slider({value:e.model.get("currentSliderVal"),min:1,max:5,step:1,slide:function(t,n){e.model.set({currentSliderVal:n.value})}})},draw:function(){var e=this,t=this.model.get("renderVals"),n=i.select(this.$("#wordcloud-svg")[0]),a=this.model.get("processedWordList");if(this.$("#words-group").length)r=i.select(this.$("#wordcloud-svg")[0]).select("#words-group");else{var r=n.append("g").attr("id","words-group").attr("width",1e3).attr("height",600).attr("transform",function(){return"translate(500 300)"});n[0][0].addEventListener("click",function(t){var n=t.target.classList;n.contains("s-wordcloud-text")&&(n.contains("selected")?e.listView.model.trigger("unselected",t.target.textContent):e.listView.model.trigger("selected",t.target.textContent))})}var s=r.selectAll("text").data(a,function(e){return e.text}),o=this.listView.model.get("selectedWords");s.enter().append("text").classed("s-wordcloud-text",!0).text(function(e){return e.text}).style("fill",function(e,n){return t.fill(e.origSize)}).classed("selected",function(e,t){if(_.contains(o,e.text))return!0}).attr("transform",function(e,t){return t<15?"translate("+[1e3*Math.random(),-300]+")":t<30?"translate("+[1e3*Math.random(),300]+")":t<45?"translate("+[-500,600*+Math.random()]+")":"translate("+[500,600*-Math.random()]+")"}),s.exit().style("opacity",0).remove();e=this;s.attr("font-size",function(e){return e.size}).style("fill",function(e,n){return t.fill(e.origSize)}).transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")"})}}),g=t.Model.extend({initialize:function(){this.on("change:tfidfData",this.buildWCDict),this.on("change:currentSliderVal",this.buildWCDict)},defaults:{tfidfData:void 0,currentSliderVal:3,processedWordList:[],renderVals:{fill:void 0,glowScale:void 0,blur:void 0},colorRange:["#80E6FF","#7575FF","#7575FF","#47008F"],sliderRange:{1:[1,0],2:[.75,.25],3:[.5,.5],4:[.25,.75],5:[0,1]}},reset:function(){this.set(this.defaults,{silent:!0})},buildWCDict:function(){var e,t,n,a,r,s,o,l,c,u,d,h,p;e=this.get("tfidfData"),t=_.size(e),n=_.reduce(_.map(_.values(e),function(e){return e.total_occurrences}),function(e,t){return e+t},0)/t,a=_.reduce(_.map(_.values(e),function(e){return e.idf?e.idf:0}),function(e,t){return e+t},0)/t,l=this.get("sliderRange"),c=this.get("currentSliderVal"),r=_.map(e,function(e,t){return u=e.total_occurrences/n,d=e.idf/a,[t,l[c][0]*d+l[c][1]*u||0]}),r=_.last(_.sortBy(r,function(e){return e[1]}),50),r=_.object(r),s=_.min(_.values(r)),o=_.max(_.values(r)),h=[],(p={}).fill=i.scale.log().domain([s,o]),p.fill.domain([0,.25,.5,.75,1].map(p.fill.invert)).range(this.get("colorRange")).clamp(!0);var f=i.scale.log().domain([s,o]).range([30,70]);for(var g in r)h.push({text:g,size:f(r[g]),select:!1,origSize:r[g]});this.set("renderVals",p),this.set("processedWordList",h)}});return r.extend({initialize:function(e){e=e||{},this.listView=new p,this.model=new g,this.view=new f({model:this.model,listView:this.listView}),this.max_rows=l._limits.ConceptCloud.limit,this.on("all",this.onAllInternalEvents),this.listenTo(this.listView,"all",this.onAllInternalEvents),this.listenTo(this.view,"close-widget",_.bind(this.closeWidget,this)),this.widgetName="wordcloud",this.queryUpdater=new c(this.widgetName)},activate:function(e){_.bindAll(this,"setCurrentQuery","processResponse"),this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},renderWidgetForCurrentQuery:function(){var e=this.getCurrentQuery(),t=this;if(e.get("__qid"))setTimeout(function(){t.getPubSub().publish(t.getPubSub().ALERT,new d({code:d.CODES.ALERT,msg:"The concept cloud endpoint cannot handle such a large query at this time",modal:!0}),1)});else{var i=new a({target:n.getOption(this,"endpoint")||l.SERVICE_WORDCLOUD,query:this.customizeQuery(e),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,i)}},renderWidgetForListOfBibcodes:function(e){e=e.slice(0,100);var t=new u;t.unlock(),t.set("q","bibcode:("+e.join(" OR ")+")"),t.set("rows",this.max_rows);var i=new a({target:n.getOption(this,"endpoint")||l.SERVICE_WORDCLOUD,query:new u({query:JSON.stringify(t.toJSON())}),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,i)},customizeQuery:function(e){var t=e.clone();t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t));var n=this.max_rows;return t.has("rows")&&(n=t.get("rows")[0]),t.set("rows",Math.min(n,this.max_rows)),t},processResponse:function(e){try{e.get("responseHeader.params.__qid");this.renderWidgetForListOfBibcodes(e.get("response").docs.map(function(e){return e.bibcode}))}catch(t){data=e.toJSON(),this.model.set("tfidfData",data)}},close:function(){this.listView.destroy(),this.view.destroy(),n.Controller.prototype.destroy.apply(this,arguments)},setCurrentQuery:function(){this.listView.model.reset(),this.model.reset(),r.prototype.setCurrentQuery.apply(this,arguments)},onAllInternalEvents:function(e){if("submitFacet"===e){var t,n;t=this.listView.model.get("selectedWords"),(n=(n=this.getCurrentQuery()).clone()).unlock();var i=this.queryUpdater,a=t.map(function(e){return i.quoteIfNecessary(e)}).join(" OR ");this._updateFq(n,a),this.getPubSub().publish(this.getPubSub().START_SEARCH,n)}},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},_updateFq:function(e,t){var n="fq_"+this.widgetName;e.unset(n),this.queryUpdater.updateQuery(e,n,"limit",t);var i="{!type=aqp v=$"+n+"}",a=e.get("fq");a?(-1==_.indexOf(a,i)&&a.push(i),e.set("fq",a)):e.set("fq",[i])}})}),define("hbs!js/widgets/bubble_chart/templates/container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-large-close close-widget close">x</div>\n<div class="s-bubble-label-container">\n    <div class="graph-select reads-vs-time active">\n        <img src="../../../styles/img/reads_vs_time.png" alt=""/>\n    </div>\n    <div class="graph-select citations-vs-time">\n        <img src="../../styles/img/citations_vs_time.png" alt=""/>\n    </div>\n    <div class="graph-select reads-vs-citations">\n            <img src="../../styles/img/reads_vs_citations.png" alt=""/>\n    </div>\n</div>\n\n<div class="s-bubble-graph-container bubble-graph-container">\n    <div class="d3-tooltip"></div>\n    <svg class="s-bubble-chart-svg bubble-chart-svg" viewBox="0 0 1160 550" preserveAspectRatio="xMinYMin meet"></svg>\n</div>\n\n<div class="controls s-controls">\n    <div>\n        <h6>What is the Paper Graph?</h6>\n        This graph allows you to view metrics for both the long-term influence (citation count)\n        and recent popularity (90 day read count) of the top 1500 papers from your search results.\n    </div>\n    <div>\n        <h6>Customize Graph</h6>\n        * Click on a journal name at right to limit papers (click again to return to the unfiltered view)<br/>\n        * Click on the y axis log/linear options <br/>\n        * Click below to swap y axis and bubble radius  <br/>\n        * Click on a paper bubble to outline it for tracking purposes throughout the three graphs\n    </div>\n    <div>\n        <h6>Filter Your Search</h6>\n        Select papers by dragging from left to right around bubbles to form a box, then click submit\n        <button class="btn btn-success submit disabled"> Submit <i class="icon-go"></i></button>\n    </div>\n</div>\n\n'},useData:!0});return t.registerPartial("js/widgets/bubble_chart/templates/container",n),n}),define("hbs!js/widgets/bubble_chart/templates/tooltip",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"<h5>"+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+"</h5>\n("+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+")</br>\nCitations: <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.citation_count||(null!=e?e.citation_count:e))?a:t.helperMissing)?a.call(e,{name:"citation_count",hash:{},data:i}):a)+"</b>,\nReads: <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.read_count||(null!=e?e.read_count:e))?a:t.helperMissing)?a.call(e,{name:"read_count",hash:{},data:i}):a)+"</b><br/>\n"},3:function(e,t,n,i){var a;return'<div class="pull-right">\n    <i><b>...and '+this.escapeExpression("function"==typeof(a=null!=(a=t.extra||(null!=e?e.extra:e))?a:t.helperMissing)?a.call(e,{name:"extra",hash:{},data:i}):a)+" more </b></i>\n</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.each.call(e,null!=e?e.bibs:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.extra:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/bubble_chart/templates/tooltip",n),n}),define("js/widgets/bubble_chart/widget",["d3","marionette","js/widgets/base/base_widget","js/components/api_request","hbs!js/widgets/bubble_chart/templates/container","hbs!js/widgets/bubble_chart/templates/tooltip","js/components/api_targets","js/components/api_query_updater","js/components/api_query"],function(e,t,n,i,a,r,s,o,l){var c=Backbone.Model.extend({initialize:function(e){this.on("change:solrData",this.modifyData)},modifyData:function(){var e,t;if(!_.isEmpty(this.get("solrData"))){var n=[];_.each(this.get("solrData"),function(e,t){try{e.pubdate=e.pubdate.replace(/(\D)00/g,function(e,t){return t+"01"}),e.date=new Date(e.pubdate),e.year=parseInt(e.bibcode.slice(0,4)),e.citation_count=e.citation_count?e.citation_count:0,e.read_count=e.read_count?e.read_count:0,e.title=e.title?e.title[0]:"",e.pub=e.bibcode.slice(4,9).replace(/\./g,""),n.push(e)}catch(t){console.warn(e,"didn't get added to bibcode list for some reason")}}),e=_.chain(n).pluck("pub").countBy(function(e){return e}).pairs().sortBy(function(e){return e[1]}).value().reverse();var i=0;_.each(e.slice(0,5),function(e){i+=e[1]}),i/n.length>=.25?(t=_.map(e,function(e){return e[0]}).slice(0,5),i/n.length<1&&t.push("other"),this.set("journalNames",t)):this.set("journalNames",[]),this.set("modifiedSolrData",n)}},reset:function(){this.set(this.defaults(),{silent:!0})},toggleTracked:function(e){var t=this.get("trackingBibs");_.contains(t,e)?this.set("trackingBibs",_.without(t,e)):(t.push(e),this.set("trackingBibs",t))},defaults:function(){return{solrData:{},modifiedSolrData:[],currentGraphData:{},yScale:"log",xScale:"linear",yLogPossible:!0,xLogPossible:!1,xValue:"date",yValue:"read_count",radius:"citation_count",journalNames:[],trackingBibs:[],selectedBibs:[],timeRange:"year",currentPub:void 0}}}),u=t.ItemView.extend({className:"bubble-chart s-bubble-chart",template:a,reset:function(){this.scales={},this.cache={}},modelEvents:{"change:modifiedSolrData":"render","change:currentPub":"rearrangeGraph","change:yScale":"rearrangeGraph","change:xScale":"rearrangeGraph","change:selectedBibs":"manageSubmitButton"},events:{"click .graph-select":function(e){var t=$(e.currentTarget);this.$(".graph-select").removeClass("active"),t.hasClass("reads-vs-time")?this.model.set({radius:"citation_count",xScale:"linear",xValue:"date",yValue:"read_count",yScale:"log"},{silent:!0}):t.hasClass("citations-vs-time")?this.model.set({radius:"read_count",xValue:"date",xScale:"linear",yValue:"citation_count",yScale:"log"},{silent:!0}):t.hasClass("reads-vs-citations")&&this.model.set({radius:"year",yValue:"read_count",xValue:"citation_count",xScale:"log"},{silent:!0}),this.rearrangeGraph(),t.addClass("active")},"click .submit":function(){this.trigger("filterBibs",this.model.get("selectedBibs"))},"click .close":function(){this.trigger("close-widget")}},getConfig:function(){this.config={},this.config.margin={left:80,bottom:40,right:20,top:60},this.config.height=500-(this.config.margin.top+this.config.margin.bottom),this.config.width=1e3-(this.config.margin.left+this.config.margin.right),this.config.animationLength=t.getOption(this,"testing")?0:500},cacheVals:function(){this.cache={},this.cache.svg=e.select(this.$("svg.bubble-chart-svg")[0]).append("g").attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")"),this.cache.realSvg=e.select(this.$("svg.bubble-chart-svg")[0]),this.cache.tooltip=e.select(this.$(".d3-tooltip")[0])},setScales:function(){this.scales={};var t,n,i,a=this.model.get("currentGraphData"),r=this,s=[];if(this.model.get("journalNames").length&&(this.scales.journalScale=e.scale.ordinal().domain(this.model.get("journalNames")).range(["hsla(282, 80%, 52%, 1)","hsla(1, 80%, 51%, 1)","hsla(152, 80%, 40%, 1)","hsla(193, 80%, 48%, 1)","hsla(220, 80%, 56%, 1)","hsla(0, 0%, 20%, 1)"])),"date"===r.model.get("xValue")){var o;if((t=e.extent(a,function(e){return e.date}))[1].getFullYear()-t[0].getFullYear()>2)this.model.set("timeRange","year"),(o=new Date(t[0])).setMonth(o.getMonth()-12),s.push(o),(o=new Date(t[1])).setMonth(o.getMonth()+12),s.push(o);else this.model.set("timeRange","month"),(o=new Date(t[0])).setMonth(o.getMonth()-1),s.push(o),(o=new Date(t[1])).setMonth(o.getMonth()+1),s.push(o);this.scales.xScale=e.time.scale().domain(s).range([0,r.config.width])}else"citation_count"==r.model.get("xValue")&&(i=e.extent(a,function(e){return e[r.model.get("xValue")]}),"log"===r.model.get("xScale")?this.scales.xScale=e.scale.log().domain(i).range([0,r.config.width]):this.scales.xScale=e.scale.linear().domain(i).range([0,r.config.width]));n=e.extent(a,function(e){return e[r.model.get("yValue")]}),"log"===this.model.get("yScale")?this.scales.yScale=e.scale.log().domain(n).range([r.config.height,0]):this.scales.yScale=e.scale.linear().domain(n).range([r.config.height,0]),"year"==r.model.get("radius")?this.scales.radiusScale=e.scale.linear().domain(e.extent(a,function(e){return e[r.model.get("radius")]})).range([2,14]):this.scales.radiusScale=e.scale.linear().domain(e.extent(a,function(e){return e[r.model.get("radius")]})).range([4,26])},finalProcess:function(){var t,n,i=this,a=this.model.get("modifiedSolrData");t=e.sum(_.pluck(a,i.model.get("yValue"))),n=e.sum(_.pluck(a,i.model.get("xValue"))),t?this.model.set("yLogPossible",!0):(this.model.set("yScale","linear",{silent:!0}),this.model.set("yLogPossible",!1)),n?this.model.set("xLogPossible",!0):(this.model.set("xScale","linear",{silent:!0}),this.model.set("xLogPossible",!1)),a=_.chain(a).filter(function(e){return"linear"===i.model.get("yScale")||(!!e[i.model.get("yValue")]||void 0)}).filter(function(e){return"linear"===i.model.get("xScale")||(!!e[i.model.get("xValue")]||void 0)}).sortBy(function(e){return-e[i.model.get("radius")]}).value(),this.model.set("currentGraphData",a),this.setScales()},resetSelection:function(){this.model.set("selectedBibs",[]),this.cache.svg.selectAll(".paper-circle.selected").classed("selected",!1),this.cache.svg.select("rect.selection").remove()},rearrangeGraph:function(){this.finalProcess(),this.resetSelection();var t,n,i,a,r,s=this.cache.svg,o=this.cache.realSvg,l=this.model.get("journalNames"),c=this;o.select("rect.selection").remove(),t=this.model.get("currentGraphData"),(a=c.model.get("currentPub"))&&(t=_.filter(t,function(e){return"other"===a?!_.contains(c.model.get("journalNames"),e.pub):e.pub===a})),n=e.svg.axis().scale(this.scales.yScale).orient("left").ticks(10).tickFormat(e.format("s")),r="date"===this.model.get("xValue")&&"year"==this.model.get("timeRange")?e.time.format("%Y"):"date"===this.model.get("xValue")&&"month"==this.model.get("timeRange")?e.time.format("%b-%Y"):e.format(""),xAxis=e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(r),s.select(".y-axis").transition().duration(c.config.animationLength).call(n),s.select(".x-axis").transition().duration(c.config.animationLength).call(xAxis),this.renderLabels(o.select(".y-label"),o.select(".x-label")),(i=s.selectAll(".paper-circle").data(t,function(e){return e.bibcode})).exit().remove(),i.transition().duration(c.config.animationLength).attr("r",function(e){return c.scales.radiusScale(e[c.model.get("radius")])+"px"}).attr("cy",function(e){return c.scales.yScale(e[c.model.get("yValue")])}).attr("cx",function(e){return c.scales.xScale(e[c.model.get("xValue")])}),i.enter().append("circle").classed("paper-circle",!0).classed("tracked",function(e){return!!_.contains(c.model.get("trackingBibs"),e.bibcode)}).attr("cx",function(e){return c.scales.xScale(e[c.model.get("xValue")])}).style("fill",function(e){if(l&&_.contains(l,e.pub))return c.scales.journalScale(e.pub)}).attr("cy",function(e){return c.scales.yScale(e[c.model.get("yValue")])}).attr("r",function(e){return c.scales.radiusScale(e[c.model.get("radius")])+"px"}),i.order()},onRender:function(){_.isEmpty(this.model.get("modifiedSolrData"))?this.$el.html("Not enough data to form the citations/reads graphs"):this.renderGraph()},renderLabels:function(e,t){var n=this;function i(e,t){e.append("circle").classed("scale-choice",!0).classed("log",!0).classed("selected",function(){if("log"===n.model.get(t))return!0}).attr("r","6px").attr("cx",200).attr("cy",-10),e.append("text").attr("x",210).attr("y",-5).text("log").classed("log",!0),e.append("circle").classed("scale-choice",!0).classed("linear",!0).classed("selected",function(){if("linear"===n.model.get(t))return!0}).attr("r","6px").attr("cx",250).attr("cy",-10),e.append("text").attr("x",260).attr("y",-5).text("linear")}e.selectAll("*").remove(),e.append("text").text(function(){return"citation_count"===n.model.get("yValue")?"Citation Count":"read_count"===n.model.get("yValue")?"90 Day Read Count":void 0}).classed("axis-title",!0),e.call(i,"yScale"),t.selectAll("*").remove(),t.append("text").text(function(){return"citation_count"===n.model.get("xValue")?"Citation Count":"date"===n.model.get("xValue")?"Date":void 0}).classed("axis-title",!0),"date"!==n.model.get("xValue")&&t.call(i,"xScale"),this.attachLogLinearEventListeners(),this.model.get("yLogPossible")||(e.selectAll(".scale-choice").classed("hidden",!0),e.selectAll("text.log").classed("hidden",!0)),this.model.get("xLogPossible")||(t.selectAll(".scale-choice").classed("hidden",!0),t.selectAll("text.log").classed("hidden",!0))},attachLogLinearEventListeners:function(){var t=this.cache.realSvg,n=this;_.each([{container:".y-label",scale:"yScale"},{container:".x-label",scale:"xScale"}],function(i){t.selectAll(i.container+" .scale-choice").on("click",function(t){e.selectAll(i.container+" .scale-choice").classed("selected",!1);var a=e.select(this);a.classed("linear")?(n.model.set(i.scale,"linear"),a.classed("selected",!0)):(n.model.set(i.scale,"log"),a.classed("selected",!0))},this)})},renderGraph:function(){this.getConfig(),this.cacheVals(),this.finalProcess();var t,n,i,a,s,o=this.cache.svg,l=this.cache.realSvg,c=this,u=c.model.get("journalNames"),d=!1;t=this.model.get("currentGraphData"),i="year"==this.model.get("timeRange")?e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(e.time.format("%Y")):e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(e.time.format("%b-%Y")),s=e.svg.axis().scale(this.scales.yScale).orient("left").tickFormat(e.format("s")),o.append("g").attr("class","x-axis").attr("transform","translate(0,"+c.config.height+")").call(i),o.append("g").attr("class","y-axis").call(s),a=l.append("g").attr("transform","translate(35, 400) rotate(-90)").classed("y-label",!0),n=l.append("g").attr("transform","translate("+c.config.width/2+","+(c.config.height+c.config.margin.top+c.config.margin.bottom+10)+")").classed("x-label",!0),this.renderLabels(a,n),o.selectAll(".paper-circle").data(t).enter().append("circle").classed("paper-circle",!0).attr("r",function(e){return c.scales.radiusScale(e.citation_count)+"px"}).attr("cx",function(e){return c.scales.xScale(e.date)}).attr("cy",function(e){return c.scales.yScale(e.read_count)}).style("fill",function(e){if(u&&_.contains(u,e.pub))return c.scales.journalScale(e.pub)});var h=l.append("g").classed("journal-name-key",!0).attr("transform","translate("+(c.config.width+c.config.margin.right+c.config.margin.left)+","+(c.config.height/2-c.config.margin.top)+")");h.selectAll("rect").data(u).enter().append("rect").attr("width",13).attr("height",13).attr("y",function(e,t){return 22*t}).attr("fill",function(e){return"other"===e?"hsla(0, 0%, 20%, 1)":c.scales.journalScale(e)}),h.selectAll("text").data(u).enter().append("text").attr("x",15).attr("y",function(e,t){return 22*t+10}).text(function(e){return e}).on("click",function(t){var n=e.select(this);1==n.classed("journal-selected")?(n.classed("journal-selected",!1),c.model.set("currentPub",void 0)):(l.selectAll(".journal-selected").classed("journal-selected",!1),n.classed("journal-selected",!0),c.model.set("currentPub",t))}),l.on("click.tracking",function(t,n){if(e.select(e.event.target).classed("paper-circle")){var i=e.event.target.__data__.bibcode;c.model.toggleTracked(i),_.contains(c.model.get("trackingBibs"),i)?e.select(e.event.target).classed("tracked",!0):e.select(e.event.target).classed("tracked",!1)}}),l.on("mouseover.tooltip",function(t){if(e.select(e.event.target).classed("paper-circle")&&!d){var n,i,a,s,o=c.model.get("yValue"),l=c.model.get("xValue"),u=c.model.get("radius"),h=e.mouse(this.parentElement)[0],p=e.mouse(this.parentElement)[1],f={},g=e.event.target.__data__;s=e.mouse(this.parentElement)[0]-c.config.margin.left>500?"right":"left",(n=e.selectAll(".paper-circle").filter(function(e){if(e[o]==g[o]&&e[l]==g[l])return!0}).sort(function(e,t){return t[u]-e[u]}).data()).length>3&&(f.extra=n.length-3,n=n.slice(0,3)),f.bibs=n,c.cache.tooltip.html(r(f)),c.cache.tooltip.style({visibility:"hidden",display:"block"}),i=e.select(".d3-tooltip")[0][0].clientHeight,a=e.max([2.5*parseInt(e.select(e.event.target).attr("r")),10]),"left"===s?c.cache.tooltip.style("left",h+a+"px").style("top",p-i/2+"px").style("visibility","visible"):c.cache.tooltip.style("left",h-a-240+"px").style("top",p-i/2+"px").style("visibility","visible")}}),l.on("mousemove.tooltip",function(t){e.event.target.classList.contains("paper-circle")||c.cache.tooltip.style({display:"none"})}),l.on("mousedown.select",function(){if(e.event.target===e.event.currentTarget){d=!0,o.selectAll(".paper-circle.selected").classed("selected",!1),l.select("rect.selection").remove();var t=e.mouse(this);l.append("rect").attr({rx:6,ry:6,class:"selection",x:t[0],y:t[1],width:0,height:0})}}).on("mousemove.select",function(){if(d){var t=l.select("rect.selection");if(!t.empty()){var n=e.mouse(this),i={x:parseInt(t.attr("x"),10),y:parseInt(t.attr("y"),10),width:parseInt(t.attr("width"),10),height:parseInt(t.attr("height"),10)},a={x:n[0]-i.x,y:n[1]-i.y};if(i.width=a.x,i.height=a.y,a.x<0||a.y<0)return;t.attr(i),l.selectAll(".paper-circle").each(function(t,n){var a=e.select(this),r=parseInt(a.attr("cx")),s=parseInt(a.attr("cy"));r+c.config.margin.left>=i.x&&r+c.config.margin.left<=i.x+i.width&&s+c.config.margin.top>=i.y&&s+c.config.margin.top<=i.y+i.height?a.classed("selected",!0):a.classed("selected",!1)})}}}).on("mouseup.select",function(){d=!1;var e=[];o.selectAll(".paper-circle.selected").each(function(t){"none"!==this.style.display&&e.push(t.bibcode)}),c.model.set("selectedBibs",e)})},manageSubmitButton:function(){0===this.model.get("selectedBibs").length?this.$(".submit").addClass("disabled"):this.$(".submit").removeClass("disabled")}});return n.extend({initialize:function(e){e=e||{},this.model=new c,this.view=new u({model:this.model,testing:e.testing}),this.listenTo(this.view,"filterBibs",this.onFilterBibs),this.listenTo(this.view,"close-widget",this.broadcastClose),this.widgetName="bubble_chart",this.queryUpdater=new o(this.widgetName)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},renderWidgetForListOfBibcodes:function(e){var t=new l;t.unlock(),t.set("q","bibcode:("+e.join(" OR ")+")"),t.set("rows",s._limits.BubbleChart.default),t.set("fl","title,bibcode,citation_count,read_count,pubdate");var n=new i({target:s.SEARCH,query:t});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,n)},renderWidgetForCurrentQuery:function(){var e=this.getCurrentQuery().clone();e.unlock(),e.set("rows",s._limits.BubbleChart.default),e.set("fl","title,bibcode,citation_count,read_count,pubdate"),e.unset("hl"),e.unset("hl.fl");var t=new i({target:s.SEARCH,query:e});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,t)},processResponse:function(e){this.model.reset(),this.view.reset(),this.model.set("solrData",e.get("response.docs"))},onFilterBibs:function(){var e=this.model.get("selectedBibs"),t=this.getCurrentQuery().clone();if(e.length){var n=this.queryUpdater,i="bibcode:("+e.map(function(e){return n.quoteIfNecessary(e)}).join(" OR ")+")";t.unlock(),this._updateFq(t,i),this.getPubSub().publish(this.getPubSub().START_SEARCH,t)}},_updateFq:function(e,t){var n="fq_"+this.widgetName;e.unset(n),this.queryUpdater.updateQuery(e,n,"limit",t);var i="{!type=aqp v=$"+n+"}",a=e.get("fq");a?(-1==_.indexOf(a,i)&&a.push(i),e.set("fq",a)):e.set("fq",[i])},broadcastClose:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")}})}),define("es6!js/widgets/author_affiliation_tool/models/authorAffiliation",["underscore"],function(e){return{create:function(t,n){var i={id:e.uniqueId(),selected:!0,author:t,affiliations:[],lastActiveDates:[]};return i.affiliations=n.map(function(t,n){return{id:e.uniqueId(),selected:0===n,name:t.affiliations.name,years:t.affiliations.years}}),i.lastActiveDates=n.map(function(t,n){return{id:e.uniqueId(),selected:0===n,date:t.affiliations.lastActiveDate}}),i}}}),define("es6!js/widgets/author_affiliation_tool/constants/actionNames",[],function(){return{fetchData:"FETCHING_DATA",setLoading:"SET_LOADING",setData:"SET_DATA",setYear:"SET_YEAR",setToggle:"SET_TOGGLE",setFormat:"SET_FORMAT",setCount:"SET_COUNT",setMessage:"SET_MESSAGE",setExporting:"SET_EXPORTING",setAuthor:"SET_AUTHOR",appReset:"APP_RESET",setShowReload:"SET_SHOW_RELOAD"}});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};define("es6!js/widgets/author_affiliation_tool/actions/index",["underscore","es6!../models/authorAffiliation","es6!../constants/actionNames","filesaver"],function(e,t,n){var i=function(e,t,n){return[].concat(e.slice(0,t),[n],e.slice(t+1))},a=e.memoize(function(e){return e.map(function(e,t){return _extends({},e,{selected:!0,affiliations:e.affiliations.map(function(e,t){return _extends({},e,{selected:0===t})}),lastActiveDates:e.lastActiveDates.map(function(e,t){return _extends({},e,{selected:0===t})})})})},function(){return 0}),r=e.memoize(function(e,t){return e.map(function(e){return _extends({},e,{selected:t,affiliations:e.affiliations.map(function(e){return _extends({},e,{selected:t})}),lastActiveDates:e.lastActiveDates.map(function(e,n){return _extends({},e,{selected:t&&0===n})})})})},function(e,t){return t}),s={appReset:function(){return function(e){return e({type:n.appReset})}},reset:function(){return function(e,t){var i=t().data;e({type:n.setData,value:a(i)})}},toggleAll:function(){return function(e,t){var i=t(),a=i.data,s=i.toggle;e({type:n.setData,value:r(a,s)}),e({type:n.setToggle})}},setAffiliationData:function(i){return function(a){i=e(i).groupBy("authorName").map(function(e,n){return t.create(n,e)}).value(),a({type:n.setData,value:i})}},closeWidget:function(){return function(e,t,n){n.closeWidget()}},showMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"success",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return function(r,s){0!==a&&e.delay(function(){r({type:n.setMessage,value:{show:!1}}),r({type:n.setShowReload,value:!1})},a),s().exporting||r({type:n.setShowReload,value:"danger"===t}),r({type:n.setMessage,value:{type:t,message:i,show:!0}})}},_reload:e.debounce(function(e,t){var n=e().ids;t.fetchAffiliationData(n)},500),reload:function(){return function(e,t,n){s._reload(t,n)}},updateYear:function(e){return function(t,i,a){var r=i();try{e=Number(e)}catch(t){e=r.year}t({type:n.setYear,value:e}),a.fetchAffiliationData(r.ids,e,r.author)}},updateAuthor:function(e){return function(t,i,a){var r=i();try{e=Number(e)}catch(t){e=r.author}t({type:n.setAuthor,value:e}),a.fetchAffiliationData(r.ids,r.year,e)}}};return s.toggleSelection=function(t,a){return function(r,s){var o=s().data,l=-1,c=-1,u=[],d=e.indexOf(o,t);a&&(l=e.indexOf(t.affiliations,a),c=e.indexOf(t.lastActiveDates,a)),u=l>=0?function(t,n,a,r,s){var o=i(t[a].affiliations,n,_extends({},s,{selected:!s.selected})),l=e.any(o,{selected:!0})||e.any(t[a].lastActiveDates,{selected:!0});return i(t,a,_extends({},r,{selected:l,affiliations:o}))}(o,l,d,t,a):c>=0?function(t,n,a,r,s){var o=e.findIndex(t[n].lastActiveDates,{selected:!0}),l=i(t[n].lastActiveDates,a,_extends({},r,{selected:!r.selected}));o>=0&&(l=i(l,o,_extends({},l[o],{selected:!1})));var c=e.any(l,{selected:!0})||e.any(t[n].affiliations,{selected:!0});return i(t,n,_extends({},s,{selected:c,lastActiveDates:l}))}(o,d,c,a,t):d>=0?function(e,t,n){return i(e,t,_extends({},n,{selected:!n.selected,affiliations:n.selected?e[t].affiliations.map(function(e){return _extends({},e,{selected:!1})}):e[t].affiliations,lastActiveDates:n.selected?e[t].lastActiveDates.map(function(e){return _extends({},e,{selected:!1})}):e[t].lastActiveDates}))}(o,d,t):o,r({type:n.setData,value:u})}},s.doExport=function(){return function(t,i,a){var r,o,l=i(),c=l.data,u=l.format,d=function(e){switch(/\[(.*)]/.exec(e)[1]){case"csv":return{ext:"csv",type:"text/csv"};case"excel":return{ext:"xls",type:"application/vnd.ms-excel"};case"browser":return{ext:"browser",type:"text/plain"};default:return{ext:"txt",type:"text/plain"}}}(u);t({type:n.setExporting,value:!0}),a.exportAffiliationData({selected:(r=c,o=[],e.forEach(r,function(t){var n=[];if(t.selected){var i=e.find(t.lastActiveDates,{selected:!0});i=i?i.date:" ";var a=e.filter(t.affiliations,{selected:!0});e.isEmpty(a)&&o.push([t.author," ",i].join("|")),e.forEach(a,function(e){e.selected&&(n.push(t.author),n.push(e.name),n.push(i),o.push(n.join("|")))})}}),o),format:u}).done(function(e){"browser"===d.ext?(e.text().then(function(e){return t=e,(n=window.open()).document.write(t),void n.focus();var t,n}),t(s.showMessage("info","If new tab doesn't appear, you will need to allow popups"))):(e.blob().then(function(e){return saveAs(e,"authorAffiliations."+d.ext)}),t(s.showMessage("success","Export Successful!")))}).fail(function(){s.showMessage("danger","Something happened with the request, please try again")}).always(function(){return t({type:n.setExporting,value:!1})}),s.showMessage("info","Exporting...")}},s}),define("es6!js/widgets/author_affiliation_tool/components/ExportFormatControl.jsx",["react"],function(e){return function(t){var n=t.formats,i=t.format,a=t.onChange;return e.createElement("select",{onChange:function(e){return a(e.target.value)},value:i,id:"export-format-control",className:"form-control",title:"Select a format"},n.map(function(t){return e.createElement("option",{key:t,value:t},t)}))}}),define("es6!js/widgets/author_affiliation_tool/components/SelectionButtons.jsx",["react"],function(e){return function(t){var n=t.onClick;return e.createElement("div",{className:"btn-toolbar pull-right"},e.createElement("button",{className:"btn btn-default",onClick:function(){return n("toggleall")}},"Toggle All"),e.createElement("button",{className:"btn btn-default",onClick:function(){return n("reset")}},"Reset"))}}),define("es6!js/widgets/author_affiliation_tool/components/LastActiveDateRow.jsx",["react"],function(e){return function(t){var n=t.date,i=t.selected,a=t.onChange;return e.createElement("div",{className:"col-xs-12"},e.createElement("label",{className:i?"":"auth-aff-label"},e.createElement("input",{checked:i,type:"radio",onChange:a})," ",n))}}),define("es6!js/widgets/author_affiliation_tool/components/AffiliationRow.jsx",["react"],function(e){return function(t){var n=t.years,i=t.name,a=t.selected,r=t.onChange;return e.createElement("div",null,e.createElement("div",{className:"col-xs-8"},e.createElement("label",{className:a?"":"auth-aff-label"},e.createElement("input",{type:"checkbox",checked:a,onChange:r})," ","-"===i?"(None)":i)),e.createElement("div",{className:"col-xs-4"+(a?" auth-aff-bold":"")},n.join(", ")))}});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function _objectDestructuringEmpty(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}define("es6!js/widgets/author_affiliation_tool/components/Row.jsx",["react","es6!../components/LastActiveDateRow.jsx","es6!../components/AffiliationRow.jsx"],function(e,t,n){return function(i){var a=i.onChange,r=i.data,s=r.author,o=r.selected,l=r.affiliations,c=r.lastActiveDates;return e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xs-2"},e.createElement("label",{className:o?"":"auth-aff-label"},e.createElement("input",{checked:o,type:"checkbox",onChange:function(){return a()}})," ",s)),e.createElement("div",{className:"col-xs-8"},l.map(function(t){return e.createElement(n,_extends({key:t.id,onChange:function(){return a(t)}},t))})),e.createElement("div",{className:"col-xs-2"},c.map(function(n){return e.createElement(t,_extends({key:n.id,onChange:function(){return a(n)}},n))})))}}),define("es6!js/widgets/author_affiliation_tool/components/Message.jsx",["react"],function(e){return function(t){var n=t.type,i=t.message,a=t.show;return e.createElement("div",{className:"col-xs-12"},a&&e.createElement("div",{className:"text-center alert alert-"+n},i))}}),define("es6!js/widgets/author_affiliation_tool/components/Loading.jsx",["react"],function(e){var t={icon:{fontSize:120},text:{fontSize:32}};return function(n){return _objectDestructuringEmpty(n),e.createElement("div",{className:"row text-center",role:"alert","aria-busy":!0},e.createElement("div",{className:"col-xs-12",style:t.icon},e.createElement("i",{className:"fa fa-spinner fa-spin"})),e.createElement("div",{className:"col-xs-12",style:t.text},"Loading..."))}}),define("es6!js/widgets/author_affiliation_tool/components/Closer.jsx",["react"],function(e){var t={position:"absolute",right:"5px"};return function(n){var i=n.onClick,a=function(e){e.preventDefault(),i()};return e.createElement("a",{href:"#",style:t,onClick:function(e){return a(e)}},e.createElement("i",{className:"fa fa-times fa-2x"}))}}),define("es6!js/widgets/author_affiliation_tool/containers/App.jsx",["underscore","react","redux","react-redux","es6!../actions/index","es6!../constants/actionNames","es6!../components/ExportFormatControl.jsx","es6!../components/SelectionButtons.jsx","es6!../components/Row.jsx","es6!../components/Message.jsx","es6!../components/Loading.jsx","es6!../components/Closer.jsx"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=function(n,i){return e.map(n,function(e){return"All"===e?t.createElement("option",{key:i,value:i},"All"):t.createElement("option",{key:e,value:e},e)})},p=a.toggleSelection,f=a.toggleAll,g=a.reset,m=a.doExport,b=a.closeWidget,v=a.updateYear,y=a.updateAuthor,_=(a.reload,function(n){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,n.call(this,e));return t.state={reloadSpin:!1},t}return _inherits(i,n),i.prototype.doExport=function(){(0,this.props.dispatch)(m())},i.prototype.onFormatSelection=function(e){(0,this.props.dispatch)({type:r.setFormat,value:e})},i.prototype.onSelectionClick=function(e){var t=this.props.dispatch;switch(e){case"toggleall":return t(f());case"reset":return t(g())}},i.prototype.doRefresh=function(){var e=this.props.dispatch;this.setState({reloadSpin:!0}),e(a.reload())},i.prototype.onCloseClick=function(){(0,this.props.dispatch)(b())},i.prototype.onCheckboxChange=function(e,t){(0,this.props.dispatch)(p(e,t))},i.prototype.onYearChange=function(e){(0,this.props.dispatch)(v(e))},i.prototype.onAuthorChange=function(e){(0,this.props.dispatch)(y(e))},i.prototype.componentWillReceiveProps=function(e){this.setState({reloadSpin:!1})},i.prototype.render=function(){var n=this,i=this.props,a=i.data,r=i.showReload,p=i.formats,f=i.format,g=i.message,m=i.loading,b=i.exporting,v=i.year,y=i.author,_=i.currentYear;return t.createElement("div",null,t.createElement(d,{onClick:function(){return n.onCloseClick()}}),t.createElement("div",{className:"container auth-aff-tool"},t.createElement("div",{className:"row",style:{marginTop:40}},!m&&t.createElement("div",null,t.createElement("h4",{className:"col-xs-12 col-sm-6",style:{marginTop:0}},"Viewing Affiliation Data For ",t.createElement("strong",null,a.length)," Authors",t.createElement("br",null),t.createElement("small",null,v!==_?"From "+(_-v)+" to "+_:"",v!==_&&0!==y&&" | ",0!==y?y+" authors from each work":"")),t.createElement("div",{className:"col-xs-12 col-sm-6"},t.createElement("div",{className:"col-xs-12 col-sm-offset-4 col-sm-8 no-padding-right"},t.createElement("div",{className:"col-xs-3 text-right",style:{marginTop:4}},t.createElement("label",{htmlFor:"max-author-select"},"Authors:")),t.createElement("div",{className:"col-xs-3 no-padding-right"},t.createElement("select",{id:"max-author-select",className:"form-control input-sm",title:"Select the number of authors from each article to be included (default is 3)",value:y,onChange:function(e){return n.onAuthorChange(e.target.value)}},h([1,2,3,4,5,10,"All"],0))),t.createElement("div",{className:"col-xs-3 text-right",style:{marginTop:4}},t.createElement("label",{htmlFor:"year-select"},"Years:")),t.createElement("div",{className:"col-xs-3 no-padding-right"},t.createElement("select",{id:"year-select",className:"form-control input-sm",title:"Select the number of years to include in the results (default is 4)",value:v,onChange:function(e){return n.onYearChange(e.target.value)}},h([1,2,3,4,5,10,"All"],0)))))),t.createElement(c,g)),m?t.createElement(u,null):t.createElement("div",null,t.createElement("div",{className:"row"},t.createElement("div",{className:"col-xs-12 col-sm-6"},t.createElement(s,{formats:p,format:f,onChange:function(e){return n.onFormatSelection(e)}})),t.createElement("div",{className:"col-xs-12 col-sm-2"},t.createElement("button",{className:"btn btn-primary",onClick:function(){return n.doExport()},disabled:!!b},b?t.createElement("i",{className:"fa fa-spinner fa-fw fa-spin"}):"Export")),t.createElement("div",{className:"col-xs-12 col-sm-4"},t.createElement(o,{onClick:function(e){return n.onSelectionClick(e)}}))),t.createElement("div",{className:"row well"},t.createElement("div",{className:"row auth-aff-heading"},t.createElement("div",{className:"col-xs-2"},"Author"),t.createElement("div",{className:"col-xs-8"},t.createElement("div",{className:"col-xs-8"},"Affiliations"),t.createElement("div",{className:"col-xs-4"},"Years")),t.createElement("div",{className:"col-xs-2"},"Last Active Date")),t.createElement("hr",{className:"hr"}),e.map(a,function(e,i){return t.createElement("div",{key:e.id},t.createElement(l,{data:e,onChange:function(t){return n.onCheckboxChange(e,t)}}),a.length-1>i&&t.createElement("hr",{className:"hr"}))}),!r&&e.isEmpty(a)&&t.createElement("div",{className:"text-center"},"No Results"),r&&t.createElement("div",{className:"text-center"},t.createElement("button",{onClick:function(){return n.doRefresh()},title:"Retry",className:"btn btn-default"},t.createElement("i",{className:"fa fa-refresh "+(this.state.reloadSpin?"fa-spin":"")})," Retry"))))))},i}(t.Component));return i.connect(function(e){return{data:e.data,formats:e.formats,format:e.format,message:e.message,loading:e.loading,exporting:e.exporting,currentYear:e.currentYear,year:e.year,author:e.author,showReload:e.showReload}})(_)});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}define("es6!js/widgets/author_affiliation_tool/reducers/index",["es6!../constants/actionNames","moment"],function(e,t){var n={data:[],formats:["| Lastname, Firstname | Affiliation | Last Active Date | [csv]","| Lastname | Firstname | Affiliation | Last Active Date | [csv]","| Lastname, Firstname | Affiliation | Last Active Date | [excel]","| Lastname | Firstname | Affiliation | Last Active Date | [excel]","Lastname, Firstname(Affiliation)Last Active Date[text]","Lastname, Firstname(Affiliation)Last Active Date[browser]"],format:"| Lastname, Firstname | Affiliation | Last Active Date | [csv]",toggle:!1,year:4,currentYear:Number((new t).year()),message:{type:"success",message:"",show:!1},loading:!1,exporting:!1,author:3,showReload:!1,ids:[]};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,i=arguments[1];switch(i.type){case e.setData:return _extends({},t,{data:i.value,loading:!1,message:_extends({},t.message,{show:!1})});case e.setToggle:return _extends({},t,{toggle:!t.toggle,message:_extends({},t.message,{show:!1})});case e.setFormat:return _extends({},t,{format:i.value,message:_extends({},t.message,{show:!1})});case e.setYear:return _extends({},t,{year:i.value,message:_extends({},t.message,{show:!1})});case e.setAuthor:return _extends({},t,{author:i.value,message:_extends({},t.message,{show:!1})});case e.fetchData:return _extends({},t,{loading:!0,ids:i.value,message:_extends({},t.message,{show:!1}),showReload:!1});case e.setMessage:return _extends({},t,{message:_extends({},t.message,i.value)});case e.setShowReload:return _extends({},t,{showReload:i.value});case e.setExporting:return _extends({},t,{exporting:i.value});case e.setLoading:return _extends({},t,{loading:i.value});case e.appReset:return n;default:return t}}}),define("es6!js/widgets/author_affiliation_tool/widget.jsx",["jquery","underscore","backbone","react","react-redux","react-dom","redux","redux-thunk","js/components/api_targets","js/components/api_query","js/components/api_request","js/widgets/base/base_widget","es6!./containers/App.jsx","es6!./constants/actionNames","es6!./actions/index","es6!./reducers/index"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g){var m=n.View.extend({initialize:function(e){t.assign(this,e)},render:function(){return r.render(i.createElement(a.Provider,{store:this.store},i.createElement(h,null)),this.el),this},destroy:function(){r.unmountComponentAtNode(this.el)}});return d.extend({initialize:function(){var e=s.applyMiddleware(o.default.withExtraArgument(this)),t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.compose;this.store=s.createStore(g,t(e)),this.view=new m({store:this.store})},activate:function(e){this.setBeeHive(e),this.activateWidget()},renderWidgetForCurrentQuery:function(e){var n=this,i=e.currentQuery,a=this.getPubSub();if(this.store.dispatch(f.appReset()),i){var r=i.clone();r.unlock(),r.set("rows",1e3),r.set("fl","bibcode");var s=this.composeRequest(r);s.set("options",{done:function(e){var i=t.map(e.response.docs,"bibcode");n.fetchAffiliationData(i)},fail:function(){return n.onError()},always:function(){n.store.dispatch({type:p.setLoading,value:!1})}}),a.publish(a.EXECUTE_REQUEST,s),this.store.dispatch({type:p.fetchData})}},renderWidgetForListOfBibcodes:function(e){return this.store.dispatch(f.appReset()),this.fetchAffiliationData(e)},fetchAffiliationData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=this.getPubSub(),s=e.Deferred();this.store.dispatch({type:p.fetchData,value:t});var o=new u({target:l.AUTHOR_AFFILIATION_SEARCH,query:new c({bibcode:t,numyears:i,maxauthor:a}),options:{type:"post",processData:!1,dataType:"json",contentType:"application/json",done:function(){return s.resolve.apply(s,arguments)},fail:function(){return s.reject.apply(s,arguments)},always:function(){return s.always.apply(s,arguments)}}});return s.done(function(e){try{e=JSON.parse(e).data,n.store.dispatch(f.setAffiliationData(e))}catch(e){console.error(e)}}),s.fail(function(){return n.onError()}),s.always(function(){return n.store.dispatch({type:p.setLoading,value:!1})}),r.publish(r.EXECUTE_REQUEST,o),s.promise()},exportAffiliationData:function(t){var n=this,i=this.getPubSub(),a=e.Deferred(),r=new u({target:l.AUTHOR_AFFILIATION_EXPORT,query:new c,options:{useFetch:!0,fetchOptions:{body:JSON.stringify(t),method:"POST",headers:{"Content-Type":"application/json"}},done:function(){return a.resolve.apply(a,arguments)},fail:function(){return a.reject.apply(a,arguments)},always:function(){return a.always.apply(a,arguments)}}});return a.fail(function(){return n.onError()}),a.always(function(){return n.store.dispatch({type:p.setLoading,value:!1})}),i.publish(i.EXECUTE_REQUEST,r),a.promise()},closeWidget:function(){var e=this.getPubSub();e.publish(e.NAVIGATE,"results-page")},onError:function(){(0,this.store.dispatch)(f.showMessage("danger","Something happened during the request, please try again",0))}})}),define("js/widgets/metrics/extractor_functions",[],function(){function e(e){return e.filter(function(e){return e.y>0}).length>0}var t={};function n(e,t){var n={};return _.each(t,function(t,i){e[i]?n[i]=t-e[i]:n[i]=t}),n}return t.plot_paperhist=function(t){var i,a=[],r=t.paperhist_data;return i=t.norm?[r["refereed publications normalized"],n(r["refereed publications normalized"],r["all publications normalized"])]:[r["refereed publications"],n(r["refereed publications"],r["all publications"])],_.each(i,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),a.push(n)}),[{key:"Refereed",values:a[0]},{key:"Non-refereed",values:a[1]}].filter(function(t,n){return e(t.values)})},t.plot_readshist=function(t){var i,a=[];return i=t.norm?[t.readshist_data["refereed reads normalized"],n(t.readshist_data["refereed reads normalized"],t.readshist_data["all reads normalized"])]:[t.readshist_data["refereed reads"],n(t.readshist_data["refereed reads"],t.readshist_data["all reads"])],_.each(i,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),a.push(n)}),[{key:"Refereed",values:a[0]},{key:"Non-refereed",values:a[1]}].filter(function(t,n){return e(t.values)})},t.plot_citshist=function(t){var n,i=[],a=t.citshist_data;return n=t.norm?[a["refereed to refereed normalized"],a["refereed to nonrefereed normalized"],a["nonrefereed to refereed normalized"],a["nonrefereed to nonrefereed normalized"]]:[a["refereed to refereed"],a["refereed to nonrefereed"],a["nonrefereed to refereed"],a["nonrefereed to nonrefereed"]],_.each(n,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),i.push(n)}),["Ref. citations to ref. papers","Ref. citations to non ref. papers","Non ref. citations to ref. papers","Non ref. citations to non ref. papers"].map(function(e,t){return{key:e,values:i[t]}}).filter(function(t,n){return e(t.values)})},t.plot_series=function(e){var t=e.series_data,n=[t.h,t.g,t.i10,t.tori,t.i100,t.read10],i=[];return _.each(n,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),i.push(n)}),i[5]=_.map(i[5],function(e){return{x:e.x,y:e.y/10}}),[{key:"h Index",values:i[0]},{key:"g Index",values:i[1]},{key:"i10 Index",values:i[2]},{key:"tori Index",values:i[3]},{key:"i100 Index",values:i[4]},{key:"read10 Index",values:i[5]}]},t}),define("hbs!js/widgets/metrics/templates/metrics_container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n    <div class="s-metrics-metadata">\n      <i class="icon-loading"/> Loading metrics...\n    </div>\n\n'},3:function(e,t,n,i){var a;return'\n    <div class="metrics-metadata s-metrics-metadata">\n\n      <p>\n          This metrics report is optimized for printing: just find the print command in your browser\'s toolbar.\n      </p>\n\n      <p>\n        Currently showing metrics for <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.numFound||(null!=e?e.numFound:e))?a:t.helperMissing)?a.call(e,{name:"numFound",hash:{},data:i}):a)+"</b> records.\n      </p>\n\n    </div>\n\n"},5:function(e,t,n,i){var a,r;return'            <div style="padding-left:4%">\n                <h4 class="s-list-description">Metrics for</h4>\n                <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n            </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\n<div class="metrics-container">\n    <div class="print-visible"><h2 style="font-weight: 800;text-align:center;">NASA/ADS Metrics Report </h2> </div>\n    <div class="print-visible" style="text-align:center">'+this.escapeExpression("function"==typeof(r=null!=(r=t.url||(null!=e?e.url:e))?r:t.helperMissing)?r.call(e,{name:"url",hash:{},data:i}):r)+'</div>\n\n    <span class="s-large-close close-widget">x</span>\n\n'+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"\n\n\n         \x3c!--used by widget when it is on the abstract page--\x3e\n"+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'    <div class="s-metrics-section" id="papers">\n        <div class="s-metrics-title">\n            <h3>Papers</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n    <div class="s-metrics-section" id="citations">\n        <div class="s-metrics-title">\n            <h3>Citations</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n    <div class="s-metrics-section" id="reads">\n        <div class="s-metrics-title">\n            <h3>Reads</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n    <div class="s-metrics-section" id="indices">\n        <div class="s-metrics-title">\n            <h3>Indices</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/metrics/templates/metrics_container",n),n}),define("hbs!js/widgets/metrics/templates/graph_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n<div>\n  <p>\n   <b>Currently showing a limited subset of data for this view. </b>\n  </p>\n  <p>\n    <button class="btn btn-primary-faded btn-sm show-all" style="margin: 10px">Click here to load the graph and\n   RIQ and Tori indices. <i>(This may take a few moments.)</i></button>\n\n  </p>\n</div>\n\n'},3:function(e,t,n,i){var a;return'<div class="graph-container s-graph-container">\n'+(null!=(a=t.if.call(e,null!=e?e.normalizedGraphData:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'    <div>\n      <form action="" class="stacked-form">\n      <label> stacked\n        <input type="radio" name="bar-arrangement" value="stacked" checked/>\n      </label>\n      <label> grouped\n        <input type="radio" name="bar-arrangement" value="grouped"/>\n      </label>\n      </form>\n      <div class="pull-right graph-key">\n      </div>\n      <div class="s-metrics-svg-container" style="padding-bottom: 58%">\n        <svg class="s-metrics-svg" viewbox="0 0 480 250" preserveAspectRatio="xMinYMin meet"></svg>\n      </div>\n    </div>\n</div>\n\n'},4:function(e,t,n,i){var a;return'    <div class="graph-tab s-graph-tab '+(null!=(a=t.unless.call(e,null!=e?e.normalizedGraphData:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.unless.call(e,null!=e?e.normalized:e,{name:"unless",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+' " data-tab="total">\n      Total</div>\n    <div class="graph-tab s-graph-tab '+(null!=(a=t.unless.call(e,null!=e?e.normalizedGraphData:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+" "+(null!=(a=t.if.call(e,null!=e?e.normalized:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+' " data-tab="normalized">\n      Normalized</div>\n'},5:function(e,t,n,i){return" no-show "},7:function(e,t,n,i){return"active"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=e?e.showingSimple:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/metrics/templates/graph_template",n),n}),define("hbs!js/widgets/metrics/templates/paper_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\n    <thead>\n    <tr>\n        <th>\n\n        </th>\n        <th>\n\n        </th>\n        <th>\n            Totals\n\n        </th>\n        <th>\n            Refereed\n\n        </th>\n\n    </tr>\n    </thead>\n\n    <tr>\n\n        <td>Number of papers</td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Number of Papers</b>" data-content="The total number of papers for which metrics were calculated. This may differ from total number of papers requested due to gaps in the metrics database. If you spot a discrepancy please let us know at adshelp@cfa.harvard.edu "></i>\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfPapers:e)?a[0]:a,e))+"\n        </td>\n        <td>\n            "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfPapers:e)?a[1]:a,e))+'\n        </td>\n\n    </tr>\n    <tr>\n        <td>Normalized paper count</td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Normalized Paper Count</b>" data-content="For a list of N papers (i=1,...N), where N<sub>auth</sub><sup>i</sup> is the number of authors for publication i, the normalized paper count is the sum over 1/N<sub>auth</sub><sup>i</sup>."></i>\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNormalizedPaperCount:e)?a[0]:a,e))+"\n        </td>\n        <td>\n            "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNormalizedPaperCount:e)?a[1]:a,e))+"\n        </td>\n\n    </tr>\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/paper_table",n),n}),define("hbs!js/widgets/metrics/templates/citations_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\n\n<thead>\n<tr>\n    <th>\n\n    </th>\n    <th>\n\n    </th>\n    <th class="hidden-abstract-page">\n        Totals\n\n    </th>\n    <th class="hidden-abstract-page">\n        Refereed\n\n    </th>\n\n</tr>\n</thead>\n\n<tr class="hidden-abstract-page">\n\n    <td>\n        Number of citing papers\n    </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Number of Citing Papers</b>" data-content="Number of unique papers citing the papers in the submitted list."></i>\n        &nbsp;\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfCitingPapers:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfCitingPapers:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> Total citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Total Citations</b>" data-content="The total number of times all papers in the list were cited."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalCitations:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Number of self-citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Number of Self-Citations</b>" data-content="The number of citing papers that were also in the list from which the metrics were computed."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfSelfCitations:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.numberOfSelfCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr class="hidden-abstract-page">\n    <td> Average citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Average Citations</b>" data-content="The total number of citations divided by the number of papers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageCitations:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Median citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Citations</b>" data-content="The median of the citation distribution."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianCitations:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> Normalized citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Normalized Citations</b>" data-content="For a list of N papers (i=1,...N), where N<sub>auth</sub><sup>i</sup> is the number of authors for publication i and C<sub>i</sub> the number of citations that this paper received, the normalized citation count for each article is C<sub>i</sub>/N<sub>auth</sub><sup>i</sup> ,and the \'normalized citations\' for this list of N papers is the sum of these N numbers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedCitations:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> Refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Refereed Citations</b>" data-content="Number of refereed citing papers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.refereedCitations:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.refereedCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Average refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Average Refereed Citations</b>" data-content="The average number of citations from refereed publications to all/refereed publications in the list."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageRefereedCitations:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageRefereedCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr class="hidden-abstract-page">\n    <td> Median refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Refereed Citations</b>" data-content="The average median of citations from refereed publications to all refereed publications in the list."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianRefereedCitations:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianRefereedCitations:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> Normalized refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Normalized Refereed Citations</b>" data-content="The normalized number of citations from refereed publications to all refereed publications in the list."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedRefereedCitations:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.normalizedRefereedCitations:e)?a[1]:a,e))+"\n    </td>\n\n</tr>\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/citations_table",n),n}),define("hbs!js/widgets/metrics/templates/indices_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\n\n<thead>\n<tr>\n    <th>\n\n    </th>\n    <th>\n\n    </th>\n    <th>\n        Totals\n\n    </th>\n    <th>\n        Refereed\n\n    </th>\n\n</tr>\n</thead>\n\n<tr>\n\n    <td>\n        h-index\n    </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>h-index</b>" data-content="The H-index is the largest number H such that H publications have at least H citations."></i>\n\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.hIndex:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.hIndex:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> m-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>m-index</b>" data-content="The m-index is defined as the h-index divided by number of years since the first published paper of the scientist (also called m-quotient)."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.mIndex:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.mIndex:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> g-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>g-index</b>" data-content="Given a set of articles ranked in decreasing order of the number of citations that they received, the g-index is the (unique) largest number such that the top g articles received (together) at least g<sup>2</sup> citations."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.gIndex:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.gIndex:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> i10-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>i10-index</b>" data-content="The i10-index is the number of publications with at least 10 citations."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i10Index:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i10Index:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> i100-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>i100-index</b>" data-content="The i100-index is the number of publications with at least 100 citations."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i100Index:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.i100Index:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> tori index  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>tori index</b>" data-content="The tori-index is calculated using the reference lists of the citing papers, where self-citations are removed. The contribution of each citing paper is then normalized by the number of remaining references in the citing papers and the number of authors in the cited paper."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.toriIndex:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.toriIndex:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> riq index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>riq index</b>" data-content="The riq-index equals the square root of the tori-index, divided by the time between the first and last publication. A multiplication with 1000 has been applied."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.riqIndex:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.riqIndex:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> read10-index  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Read10-index</b>" data-content="Read10 is the current readership rate for all an individual\'s papers published in the most recent ten years, normalized for number of authors."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.read10Index:e)?a[0]:a,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.read10Index:e)?a[1]:a,e))+"\n    </td>\n\n</tr>\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/indices_table",n),n}),define("hbs!js/widgets/metrics/templates/reads_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<thead>\n    <tr>\n        <th>\n\n        </th>\n        <th>\n\n        </th>\n        <th class="hidden-abstract-page">\n            Totals\n\n        </th>\n        <th class="hidden-abstract-page">\n            Refereed\n\n        </th>\n\n    </tr>\n    </thead>\n\n    <tr>\n\n        <td>\n            Total number of reads\n        </td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Total Number of Reads</b>" data-content="The total number of times all papers were read. For each paper, a read is counted if an ADS user runs a search in our system and then requests to either view the paper\\\'s full bibliographic record or download the fulltext."></i>\n\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfReads:e)?a[0]:a,e))+'\n        </td>\n        <td class="hidden-abstract-page">\n            '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfReads:e)?a[1]:a,e))+'\n        </td>\n\n    </tr>\n    <tr class="hidden-abstract-page">\n        <td> Average number of reads </td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Average Number of Reads</b>" data-content="The total number of reads divided by the number of papers."></i>\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfReads:e)?a[0]:a,e))+'\n        </td>\n        <td class="hidden-abstract-page">\n            '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfReads:e)?a[1]:a,e))+'\n        </td>\n\n    </tr>\n <tr class="hidden-abstract-page">\n    <td> Median number of reads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Number of Reads</b>" data-content="The median of the reads distribution."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfReads:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfReads:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> Total number of downloads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Total Number of Downloads</b>" data-content="The total number of times full text (article or e-print) was accessed."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfDownloads:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.totalNumberOfDownloads:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Average number of downloads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Average Number of Downloads</b>" data-content="The total number of downloads divided by the number of papers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfDownloads:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.averageNumberOfDownloads:e)?a[1]:a,e))+'\n    </td>\n\n</tr>\n\n<tr class="hidden-abstract-page">\n    <td> Median number of downloads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Number of Downloads</b>" data-content="The median of the downloads distribution."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfDownloads:e)?a[0]:a,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.medianNumberOfDownloads:e)?a[1]:a,e))+"\n    </td>\n\n</tr>\n\n\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/reads_table",n),n}),function(e,t){"function"==typeof define&&define.amd?define("js/widgets/metrics/d3-tip",["d3"],t):t(e.d3)}(this,function(e){return e.tip=function(){var t=function(){return"n"},n=function(){return[0,0]},i=function(){return" "},a=function(){var t=e.select(document.createElement("div"));return t.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),t.node()}(),r=null,s=null,o=null;function l(e){var t;r="svg"===(t=(t=e).node()).tagName.toLowerCase()?t:t.ownerSVGElement,s=r.createSVGPoint(),document.body.appendChild(a)}l.show=function(){var r=Array.prototype.slice.call(arguments);r[r.length-1]instanceof SVGElement&&(o=r.pop());var s,d=i.apply(this,r),h=n.apply(this,r),p=t.apply(this,r),f=e.select(a),g=u.length,m=document.documentElement.scrollTop||document.body.scrollTop,b=document.documentElement.scrollLeft||document.body.scrollLeft;for(f.html(d).style({opacity:1,"pointer-events":"all"});g--;)f.classed(u[g],!1);return s=c.get(p).apply(this),f.classed(p,!0).style({top:s.top+h[0]+m+"px",left:s.left+h[1]+b+"px"}),l},l.hide=function(){return e.select(a).style({opacity:0,"pointer-events":"none"}),l},l.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return e.select(a).attr(t);var i=Array.prototype.slice.call(arguments);return e.selection.prototype.attr.apply(e.select(a),i),l},l.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return e.select(a).style(t);var i=Array.prototype.slice.call(arguments);return e.selection.prototype.style.apply(e.select(a),i),l},l.direction=function(n){return arguments.length?(t=null==n?n:e.functor(n),l):t},l.offset=function(t){return arguments.length?(n=null==t?t:e.functor(t),l):n},l.html=function(t){return arguments.length?(i=null==t?t:e.functor(t),l):i};var c=e.map({n:function(){var e=d();return{top:e.n.y-a.offsetHeight,left:e.n.x-a.offsetWidth/2}},s:function(){var e=d();return{top:e.s.y,left:e.s.x-a.offsetWidth/2}},e:function(){var e=d();return{top:e.e.y-a.offsetHeight/2,left:e.e.x}},w:function(){var e=d();return{top:e.w.y-a.offsetHeight/2,left:e.w.x-a.offsetWidth}},nw:function(){var e=d();return{top:e.nw.y-a.offsetHeight,left:e.nw.x-a.offsetWidth}},ne:function(){var e=d();return{top:e.ne.y-a.offsetHeight,left:e.ne.x}},sw:function(){var e=d();return{top:e.sw.y,left:e.sw.x-a.offsetWidth}},se:function(){var e=d();return{top:e.se.y,left:e.e.x}}}),u=c.keys();function d(){var t=o||e.event.target,n={},i=t.getScreenCTM(),a=t.getBBox(),r=a.width,l=a.height,c=a.x,u=a.y;return s.x=c,s.y=u,n.nw=s.matrixTransform(i),s.x+=r,n.ne=s.matrixTransform(i),s.y+=l,n.se=s.matrixTransform(i),s.x-=r,n.sw=s.matrixTransform(i),s.y-=l/2,n.w=s.matrixTransform(i),s.x+=r,n.e=s.matrixTransform(i),s.x-=r/2,s.y-=l/2,n.n=s.matrixTransform(i),s.y+=l,n.s=s.matrixTransform(i),n}return l},e.tip}),define("js/widgets/metrics/widget",["underscore","marionette","d3","js/widgets/base/base_widget","./extractor_functions","js/components/api_response","js/components/json_response","js/components/api_request","js/components/api_query","js/mixins/dependon","hbs!js/widgets/metrics/templates/metrics_container","hbs!js/widgets/metrics/templates/graph_template","hbs!js/widgets/metrics/templates/paper_table","hbs!js/widgets/metrics/templates/citations_table","hbs!js/widgets/metrics/templates/indices_table","hbs!js/widgets/metrics/templates/reads_table","bootstrap","js/components/api_feedback","js/components/api_targets","./d3-tip"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,m,b,v,y,_){function w(e){if(!e)return e;var t=e.toString();return t.indexOf(".")>-1&&t.split(".")[1]?e.toFixed(1):e}var S=Backbone.Model.extend({defaults:function(){return{title:[],rows:[]}}}),E=t.ItemView.extend({className:"table table-hover s-metrics-table table-condensed",tagName:"table",onRender:function(){this.$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}}),x=Backbone.Model.extend({defaults:function(){return{graphData:void 0,normalizedGraphData:void 0,normalized:!1,graphType:"histogram",barArrangement:"stacked",yAxisLabel:"Papers"}}}),A=t.ItemView.extend({className:"graph-view s-graph-view",initialize:function(){this.initial=!0},modelEvents:{"change:normalized":"render"},ui:{svg:"svg"},events:{"click .graph-tab":"updateTabValue"},updateTabValue:function(e){"normalized"===$(e.currentTarget).data("tab")?this.model.set("normalized",!0):this.model.set("normalized",!1)},colors:["#5683e0","#7ab889","#ffb639","#ed5e5b","#ce5cff","#1c459b"],drawHistogram:function(){var t=this.model.get("normalized")?this.model.get("normalizedGraphData"):this.model.get("graphData"),i=t.length,a=n.layout.stack()(t.map(function(e){return e.values})),r=n.max(a,function(e){return n.max(e,function(e){return e.y})}),s=n.max(a,function(e){return n.max(e,function(e){return e.y0+e.y})}),o=n.select(this.$("svg")[0]),l=this,c=20,u=50,d=480-u-10,h=250-c-20,p=this.model.get("graphData")[0].values.map(function(e){return e.x}),f=n.scale.ordinal().domain(p).rangeRoundBands([0,d],.08),g=n.scale.linear().domain([0,s]).range([h,0]);this.$("svg").empty();var m=o.append("g").attr("transform","translate("+u+","+c+")").classed("graph-container-g",!0);o.selectAll("[data-legend]").data(e.map(t,"key")).enter().append("g").attr("data-legend",e.identity).attr("data-legend-color",function(e,t){return l.colors[t]}),setTimeout(function(){o.append("g").attr("class","legend").attr("transform","translate(70, 20)").attr("data-style-padding",7).style("font-size","12px").call(n.legend)},500),this.tip||(this.tip=n.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){var n=l.model.get("normalized")?"normalizedGraphData":"graphData";return l.model.get(n).map(function(n){return"<b>"+n.key+"</b>:&nbsp;"+e.findWhere(n.values,{x:t.x}).y.toFixed(2)}).join("<br/>")})),m.call(this.tip),m.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")"),m.append("g").attr("class","y axis").attr("transform","translate(0,0)"),m.append("text").attr("text-anchor","middle").attr("transform","translate(-40,"+h/2+")rotate(-90)").classed("graph-label",!0).text(this.model.get("yAxisLabel")),this.$("input[name=bar-arrangement]").on("change",function(e){"grouped"===this.value?(g.domain([0,r]),v.transition().duration(500).delay(function(e,t){return 10*t}).attr("x",function(e,t,n){return f(e.x)+f.rangeBand()/i*n}).attr("width",f.rangeBand()/i).transition().attr("y",function(e){return g(e.y)}).attr("height",function(e){return h-g(e.y)})):(g.domain([0,s]),v.transition().duration(500).delay(function(e,t){return 10*t}).attr("y",function(e){return g(e.y0+e.y)}).attr("height",function(e){return g(e.y0)-g(e.y0+e.y)}).transition().attr("x",function(e){return f(e.x)}).attr("width",f.rangeBand()))});var b,v=m.selectAll(".layer").data(a).enter().append("g").attr("class","layer").style("fill",function(e,t){return l.colors[t]}).selectAll("rect").data(function(e){return e}).enter().append("rect").attr("width",f.rangeBand()).attr("x",function(e){return f(e.x)}).on("mouseover",this.tip.show).on("mouseout",this.tip.hide);if(p.length>20){var y=Math.floor(p.length/5);b=p.filter(function(e){return e%y==0})}else b=p.length>8?p.filter(function(e){return e%2==0}):p;var _=n.svg.axis().scale(f).tickSize(0).tickValues(b).tickPadding(6).orient("bottom"),w=s>1?5:0,S=n.svg.axis().scale(g).tickSize(0).ticks(w).tickFormat(function(e){return e>1?n.format("s")(e):n.format(".1n")(e)}).orient("left");m.select(".x.axis").call(_),m.select(".y.axis").transition().call(S),m.selectAll("rect").transition().delay(function(e,t){return 10*t}).attr("y",function(e){return g(e.y0+e.y)}).attr("height",function(e){return g(e.y0)-g(e.y0+e.y)})},drawLineGraph:function(){var t=this;this.$(".stacked-form").remove();var i=n.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.key}),a=this.model.get("graphData");if(a){a.forEach(function(e){e.values.forEach(function(e){e.x=parseInt(e.x)})});var r=a[0].values.map(function(e){return e.x}),s=n.select(this.$("svg")[0]),o=20,l=50,c=480-l-80,u=250-o-30;if(g=s.append("g").attr("transform","translate("+l+","+o+")").attr("pointer-events","all"),1!==r.length){var d=n.scale.linear().domain(n.extent(r)).range([0,c]),h=n.scale.linear().range([u,0]);h.domain([0,n.max(e.flatten(a.map(function(e){return e.values.map(function(e){return e.y})})))]);var p,f,m,b,v,y,_,w,S,E,x=n.svg.axis().scale(d).tickSize(0).ticks(5).tickFormat(n.format()).tickPadding(6).orient("bottom"),A=n.svg.axis().scale(h).tickSize(0).ticks(5).tickFormat(function(e){return e>1?n.format("s")(e):n.format(".1n")(e)}).orient("left"),P=n.svg.line().x(function(e){return d(e.x)}).y(function(e){return h(e.y)});g.call(i),g.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")").call(x),g.append("g").attr("class","y axis").call(A),g.selectAll(".index").data(a).enter().append("g").attr("class","index").append("path").attr("class","line").attr("d",function(e){return P(e.values)}).style("stroke",function(e,n){return t.colors[n]}),p=e.reduce(a,function(e,t){return e[t.key]=t.values,e},{}),f=s.append("g").attr("pointer-events","all"),m=f.append("line").attr({"pointer-events":"none",x1:l,x2:l,y1:o,y2:u+o,stroke:"black","stroke-width":"1px"}),b=e.map(p,function(e,t){return{key:t,el:f.append("circle").attr({r:3,"stroke-width":"2px",fill:"none","pointer-events":"none"}),data:e}}),v=g.append("foreignObject").attr({class:"info-box",width:"200px",height:"100px",x:"100"}).style({opacity:.75,"font-size":"0.60em"}),y=e.memoize(function(e){if(e){var t="<table>";for(var n in t+="<tr><td><strong>Year:</strong></td><td>&nbsp;"+e.year+"</td></tr>",e.groups){var i=e.groups[n];t+="<tr>",t+='<td style="color:'+i.color+'"><strong>'+i.key+":</strong></td>",t+="<td>&nbsp;"+i.val.toFixed(5)+"</td>",t+="</tr>"}return t+="</table>"}},function(e){return e.year}),_=e.memoize(function(t){var i=n.bisector(function(e){return e.x}).left,a=[];return e.forEach(b,function(e){var n=e.data,r=i(n,t),s=n[r-1]||0,c=n[r]||n[n.length-1],u=t-s.x<c.x===t?s:c,p=d(u.x)+l,f=h(u.y)+o;a.push({dot:e,data:u,pos:{x:p,y:f}})},0),a}),w=e.memoize(function(t){return e.reduce(t,function(e,t){return e+t.pos.x},0)/t.length},function(e){return e[0].data.x}),S=function(e,n,i){var a=n.dot.el,r=n.data,s=n.pos;a.attr({visibility:null,transform:"translate("+s.x+","+s.y+")",stroke:t.colors[i]}),e.year=r.x,e.groups.push({key:n.dot.key,val:r.y,color:t.colors[i]})},E=e.debounce(function(){v.html(""),m.attr("visibility","hidden"),e.forEach(b,function(e){e.el.attr("visibility","hidden")})},300,{leading:!0}),g.append("rect").attr({x:-10,width:c+20,height:u,visibility:"hidden"}).on("mouseout",E).on("mousemove",function(){var t=n.mouse(this),i=_(d.invert(t[0]).toFixed(0)),a=w(i),r={year:0,groups:[]};e.forEach(i,e.partial(S,r)),v.html(y(r)),m.attr({x1:a,x2:a,visibility:null})}),s.selectAll("[data-legend]").data(e.map(a,"key")).enter().append("g").attr("data-legend",e.identity).attr("data-legend-color",function(e,n){return t.colors[n]}),setTimeout(function(){s.append("g").attr("class","legend").attr("transform","translate(70, 36)").attr("data-style-padding",7).style("font-size","12px").call(n.legend)},500)}else g.append("text").attr("x",10).attr("y",100).text("time period is less than a year, refer to table to the left for values")}},drawGraph:function(){var e=this.model.get("graphType");"histogram"===e?this.drawHistogram():"line"===e&&this.drawLineGraph()},template:d,onRender:function(){this.drawGraph()}}),P=Backbone.Model.extend({defaults:function(){return{widgetName:"Metrics"}}}),C=t.LayoutView.extend({template:u,events:{"click .close-widget":"signalCloseWidget","click .show-all":"signalShowAll"},signalCloseWidget:function(){$(".d3-tip").remove(),this.trigger("close-widget")},signalShowAll:function(){this.$(".show-all").html('<i class="icon-loading"/>&nbsp;&nbsp;'+this.$(".show-all").html()),this.trigger("show-all")},modelEvents:{change:"render"},regions:{papersGraph:"#papers .metrics-graph",papersTable:"#papers .metrics-table",citationsGraph:"#citations .metrics-graph",citationsTable:"#citations .metrics-table",indicesGraph:"#indices .metrics-graph",indicesTable:"#indices .metrics-table",readsGraph:"#reads .metrics-graph",readsTable:"#reads .metrics-table"}}),k=i.extend({viewEvents:{"close-widget":"closeWidget","show-all":"showAll"},initialize:function(e){e=e||{},this.containerModel=new P,this.view=new C({model:this.containerModel}),this.childViews={},t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.dataExtractor=a,this.GraphModel=x,this.GraphView=A},defaultQueryArguments:{fl:["bibcode"]},components:{TableModel:S,TableView:E,GraphView:A,GraphModel:x,ContainerView:C},activate:function(t){this.setBeeHive(t),e.bindAll(this,"setCurrentQuery","processMetrics","checkIfSimpleRequired");var n=t.getService("PubSub");n.subscribe(n.INVITING_REQUEST,this.setCurrentQuery),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback)},onApiFeedback:function(){this.closeWidget(),pubsub.publish(pubsub.ALERT,new v({code:0,msg:"Sorry Metrics are unavailable at this time, try again later",type:"danger"}))},closeWidget:function(){this.reset(),this.componentParams&&this.componentParams.allowRedirect&&this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},showAll:function(){this.getIndicators()},reset:function(){this.childViews={},e.each(this.view.regions,function(e,t){this.view[t].currentView&&this.view[t].currentView.destroy()},this),this.containerModel.clear({silent:!0})},createTableViews:function(e,t){var n=1===t?this.createTableDataForOnePaper(e):this.createTableData(e);this.childViews.papersTableView=new E({template:h,model:new S(n.paperModelData)}),this.childViews.readsTableView=new E({template:m,model:new S(n.readsModelData)}),this.childViews.citationsTableView=new E({model:new S(n.citationsModelData),template:p}),this.childViews.indicesTableView=new E({model:new S(n.indicesModelData),template:f})},createTableData:function(t){var n={},i={refereed:t["basic stats refereed"],total:t["basic stats"]},a={refereed:t["citation stats refereed"],total:t["citation stats"]},r={refereed:t["indicators refereed"],total:t.indicators};return n.paperModelData={totalNumberOfPapers:[i.total["number of papers"],i.refereed["number of papers"]],totalNormalizedPaperCount:[i.total["normalized paper count"],i.refereed["normalized paper count"]]},n.readsModelData={totalNumberOfReads:[i.total["total number of reads"],i.refereed["total number of reads"]],averageNumberOfReads:[i.total["average number of reads"],i.refereed["average number of reads"]],medianNumberOfReads:[i.total["median number of reads"],i.refereed["median number of reads"]],totalNumberOfDownloads:[i.total["total number of downloads"],i.refereed["total number of downloads"]],averageNumberOfDownloads:[i.total["average number of downloads"],i.refereed["average number of downloads"]],medianNumberOfDownloads:[i.total["median number of downloads"],i.total["median number of downloads"]]},n.citationsModelData={numberOfCitingPapers:[a.total["number of citing papers"],a.refereed["number of citing papers"]],totalCitations:[a.total["total number of citations"],a.refereed["total number of citations"]],numberOfSelfCitations:[a.total["number of self-citations"],a.refereed["number of self-citations"]],averageCitations:[a.total["average number of citations"],a.refereed["average number of citations"]],medianCitations:[a.total["median number of citations"],a.refereed["median number of citations"]],normalizedCitations:[a.total["normalized number of citations"],a.refereed["normalized number of citations"]],refereedCitations:[a.total["total number of refereed citations"],a.refereed["total number of refereed citations"]],averageRefereedCitations:[a.total["average number of refereed citations"],a.refereed["average number of refereed citations"]],medianRefereedCitations:[a.total["median number of refereed citations"],a.refereed["median number of refereed citations"]],normalizedRefereedCitations:[a.total["normalized number of refereed citations"],a.refereed["normalized number of refereed citations"]]},n.indicesModelData={hIndex:[r.total.h,r.refereed.h],mIndex:[r.total.m,r.refereed.m],gIndex:[r.total.g,r.refereed.g],i10Index:[r.total.i10,r.refereed.i10],i100Index:[r.total.i100,r.refereed.i100],toriIndex:[r.total.tori,r.refereed.tori],riqIndex:[r.total.riq,r.refereed.riq],read10Index:[r.total.read10,r.refereed.read10]},e.each(n,function(t,n){e.each(t,function(e,n){t[n]=[w(e[0]),w(e[1])]})}),n},createGraphViews:function(e){var t=e.histograms,n=new x;this.childViews.papersGraphView=new A({model:n}),this.childViews.papersGraphView.model.set("graphData",this.dataExtractor.plot_paperhist({norm:!1,paperhist_data:t.publications})),this.childViews.papersGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_paperhist({norm:!0,paperhist_data:t.publications}));var i=new x({yAxisLabel:"Citations"});this.childViews.citationsGraphView=new A({model:i}),this.childViews.citationsGraphView.model.set("graphData",this.dataExtractor.plot_citshist({norm:!1,citshist_data:t.citations})),this.childViews.citationsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_citshist({norm:!0,citshist_data:t.citations}));var a=new x;this.childViews.readsGraphView=new A({model:a}),this.childViews.readsGraphView.model.set("graphData",this.dataExtractor.plot_readshist({norm:!1,readshist_data:t.reads})),this.childViews.readsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_readshist({norm:!0,readshist_data:t.reads}));var r=new x({graphType:"line"});this.childViews.indicesGraphView=new A({model:r}),e["time series"]?this.childViews.indicesGraphView.model.set("graphData",this.dataExtractor.plot_series({series_data:e["time series"]})):this.childViews.indicesGraphView.model.set({showingSimple:!0})},insertViews:function(){this.view.render(),["papers","citations","indices","reads"].forEach(function(e){this.view[e+"Table"].show(this.childViews[e+"TableView"]),this.view[e+"Graph"].show(this.childViews[e+"GraphView"])},this)},insertViewsForOnePaper:function(e){this.view.render({title:this.containerModel.get("title")}),this.view.$("#indices").hide(),this.view.$("#papers").hide(),this.view.$(".metrics-metadata").hide(),this.hasReads(e)?(this.view.readsTable.show(this.childViews.readsTableView),this.view.readsGraph.show(this.childViews.readsGraphView)):this.view.$(this.view.readsTable.el).html("No reads found for this article."),this.hasCitations(e)?(this.view.citationsTable.show(this.childViews.citationsTableView),this.view.citationsGraph.show(this.childViews.citationsGraphView)):this.view.$(this.view.citationsTable.el).html("No citations found for this article."),this.view.$(".hidden-abstract-page").hide()},createGraphViewsForOnePaper:function(e){var t=e.histograms,n=new this.GraphModel;this.childViews.citationsGraphView=new this.GraphView({model:n}),this.childViews.citationsGraphView.model.set("graphData",this.dataExtractor.plot_citshist({norm:!1,citshist_data:t.citations})),this.childViews.citationsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_citshist({norm:!0,citshist_data:t.citations}));var i=new this.GraphModel;this.childViews.readsGraphView=new this.GraphView({model:i}),this.childViews.readsGraphView.model.set("graphData",this.dataExtractor.plot_readshist({norm:!1,readshist_data:t.reads})),this.childViews.readsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_readshist({norm:!0,readshist_data:t.reads}))},createTableDataForOnePaper:function(t){var n={},i={refereed:t["basic stats refereed"],total:t["basic stats"]},a={refereed:t["citation stats refereed"],total:t["citation stats"]};return n.readsModelData={totalNumberOfReads:[i.total["total number of reads"],i.refereed["total number of reads"]],averageNumberOfReads:[i.total["average number of reads"],i.refereed["average number of reads"]],medianNumberOfReads:[i.total["median number of reads"],i.refereed["median number of reads"]],totalNumberOfDownloads:[i.total["total number of downloads"],i.refereed["total number of downloads"]],averageNumberOfDownloads:[i.total["average number of downloads"],i.refereed["average number of downloads"]],medianNumberOfDownloads:[i.total["median number of downloads"],i.total["median number of downloads"]]},n.citationsModelData={numberOfCitingPapers:[a.total["number of citing papers"],a.refereed["number of citing papers"]],totalCitations:[a.total["total number of citations"],a.refereed["total number of citations"]],numberOfSelfCitations:[a.total["number of self-citations"],a.refereed["number of self-citations"]],averageCitations:[a.total["average number of citations"],a.refereed["average number of citations"]],medianCitations:[a.total["median number of citations"],a.refereed["median number of citations"]],normalizedCitations:[a.total["normalized number of citations"],a.refereed["normalized number of citations"]],refereedCitations:[a.total["total number of refereed citations"],a.refereed["total number of refereed citations"]],averageRefereedCitations:[a.total["average number of refereed citations"],a.refereed["average number of refereed citations"]],medianRefereedCitations:[a.total["median number of refereed citations"],a.refereed["median number of refereed citations"]],normalizedRefereedCitations:[a.total["normalized number of refereed citations"],a.refereed["normalized number of refereed citations"]]},e.each(n,function(t,n){e.each(t,function(e,n){t[n]=[w(e[0]),w(e[1])]})}),n},hasCitations:function(e){return e["citation stats"]["total number of citations"]>0},hasReads:function(e){return e["basic stats"]["total number of reads"]>0},renderWidgetForCurrentQuery:function(e){e=e||{},this.reset(),this.containerModel.set({url:window.location.href,loading:!0});var t=this.getCurrentQuery()||e.currentQuery;t=this.customizeQuery(t);var n=this,i=[],a=void 0,r=y._limits.Metrics.default;t.set("rows",1e3);var s=function(o){t.set({start:o}),this._executeSearch(t).done(function(t){i=i.concat(t.get("response.docs").map(function(e){return e.bibcode})),a=a||t.get("response").numFound,(o+=1e3)>=a||o>=r?(a>r&&void 0===e.simple&&(e.simple=!0),n.containerModel.set({numFound:a>r?r:a,bibcodes:i}),n.getMetrics(i,e)):s(o)})}.bind(this);s(0)},checkIfSimpleRequired:function(){if(!this._currentQuery)return(new $.Deferred).resolve(!1);var e=this._currentQuery.clone();return e.unlock(),e.set({stats:"true","stats.field":"citation_count",fl:"id"}),this._executeSearch(e).then(function(e){return e.get("stats.stats_fields.citation_count.sum")>5e4})},getIndicators:function(){var t=this.getPubSub(),n=new l({bibcodes:this.containerModel.get("bibcodes"),types:["indicators","timeseries"]}),i=new o({target:y.SERVICE_METRICS,query:n,options:{type:"POST",contentType:"application/json"}});function a(t){var n=t.toJSON();this.childViews.indicesGraphView.model.set({graphData:this.dataExtractor.plot_series({series_data:n["time series"]}),showingSimple:!1});var i={refereed:n["indicators refereed"],total:n.indicators},a={hIndex:[i.total.h,i.refereed.h],mIndex:[i.total.m,i.refereed.m],gIndex:[i.total.g,i.refereed.g],i10Index:[i.total.i10,i.refereed.i10],i100Index:[i.total.i100,i.refereed.i100],toriIndex:[i.total.tori,i.refereed.tori],riqIndex:[i.total.riq,i.refereed.riq],read10Index:[i.total.read10,i.refereed.read10]};e.each(a,function(e,t){a[t]=[w(e[0]),w(e[1])]}),this.childViews.indicesTableView.model.set(a),this.childViews.indicesTableView.render(),this.childViews.indicesGraphView.render()}a=a.bind(this),t.subscribeOnce(t.DELIVERING_RESPONSE,a),t.publish(t.EXECUTE_REQUEST,i)},getMetrics:function(e,t){t=t||{};var n=$.Deferred();function i(t){var i=this.getPubSub(),a=new l({bibcodes:e});t&&a.set({types:["simple"]});var r=new o({target:y.SERVICE_METRICS,query:a,options:{type:"POST",contentType:"application/json"}});function s(){try{this.processMetrics.apply(this,arguments),n.resolve()}catch(e){n.reject()}}s=s.bind(this),i.subscribeOnce(i.DELIVERING_RESPONSE,s),i.publish(i.EXECUTE_REQUEST,r)}return i=i.bind(this),void 0!==t.simple?i(t.simple):this.checkIfSimpleRequired().done(i),n.promise()},processMetrics:function(e){if(this.containerModel.set("loading",!1),(e=e.attributes?e.attributes:e).Error||500===e.status)throw this.closeWidget(),new Error("Metrics Service Error");1===e["basic stats"]["number of papers"]?(this.createTableViews(e,1),this.createGraphViewsForOnePaper(e),this.insertViewsForOnePaper(e)):(this.createTableViews(e),this.createGraphViews(e),this.insertViews(e))},_executeSearch:function(t){var n=this.getPubSub(),i=new o({target:y.SEARCH,query:t}),a=$.Deferred();return n.subscribeOnce(n.DELIVERING_RESPONSE,e.bind(function(e){a.resolve(e)}),this),n.publish(n.EXECUTE_REQUEST,i),a},renderWidgetForListOfBibcodes:function(e){this.reset(),this.containerModel.set({numFound:e.length,loading:!0}),this.getMetrics(e,{simple:!1})}});return e.extend(k.prototype,c.BeeHive),k}),define("hbs!js/widgets/citation_helper/templates/citation_helper_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.success:a,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?a:""},2:function(e,t,n,i){var a;return'<div class="ch-alert alert-success alert-dismissable" role="alert">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n    '+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+" records were added to library <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>\n</div>\n"},4:function(e,t,n,i){var a;return'<div class="ch-alert alert-danger alert-dismissable" role="alert">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n    No records were added to <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>: <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n</div>\n"},6:function(e,t,n,i){var a;return"<div class=\"citation-helper-metadata s-citation-helper-metadata\">\n\n<h4>Suggested Articles</h4>\n<p>These suggestions are based on a 'friends-of-friends' analysis of the citation network for the papers in the library (scores start at 2).</p>\n    <br>\n\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"owner",{name:"compare",hash:{operator:"=="},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+'</div>\n<br>\n<ul class="citation-helper-list-container-list-container s-citation-helper-list-container">\n\n'+(null!=(a=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+"\n</ul>\n\n"},7:function(e,t,n,i){return'    <div class="row"><div class="col-xs-6"><button class="btn btn-sm btn-success submit-add-to-library">Add selected papers to this library</button></div></div>\n'},9:function(e,t,n,i){var a;return'    <li class="citation-helper-item s-citation-helper-item">\n        <div class="col-sm-10">\n            <div class="row s-top-row">\n                <div class="col-xs-1 ch-selectbox-col s-top-row-col">\n                    <input type="checkbox" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'" name="identifier">\n                </div>\n                <div class="col=sm-3 col-xs-4 s-top-row-col">'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'</div>\n                <div class="col-sm-2 s-top-row-col"><b>score: '+this.escapeExpression("function"==typeof(a=null!=(a=t.score||(null!=e?e.score:e))?a:t.helperMissing)?a.call(e,{name:"score",hash:{},data:i}):a)+'</b></div>\n            </div>\n            <div class="row">\n                <div class="col-xs-10 col-xs-offset-1">\n                <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'">\n                    <h3 class="s-results-title">'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+'</h3>\n                </a>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-xs-10 col-xs-offset-1">\n                    <ul class="list-inline just-authors s-results-authors">\n                        <li class="article-author">\n                            '+this.escapeExpression("function"==typeof(a=null!=(a=t.author||(null!=e?e.author:e))?a:t.helperMissing)?a.call(e,{name:"author",hash:{},data:i}):a)+"\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </li>\n"},11:function(e,t,n,i){var a;return'    <div style="padding-left: 20px; padding-top: 50px;">\n        <div class="row s-message-control-row"><i>'+this.escapeExpression("function"==typeof(a=null!=(a=t.msg||(null!=e?e.msg:e))?a:t.helperMissing)?a.call(e,{name:"msg",hash:{},data:i}):a)+"</i></div>\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.items:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.msg:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>"},useData:!0});return t.registerPartial("js/widgets/citation_helper/templates/citation_helper_template",n),n}),define("js/widgets/citation_helper/widget",["marionette","js/widgets/base/base_widget","js/components/api_response","js/components/json_response","js/components/api_request","js/components/api_query","js/mixins/dependon","hbs!js/widgets/citation_helper/templates/citation_helper_template","bootstrap","js/components/api_feedback","js/components/api_targets","analytics"],function(e,t,n,i,a,r,s,o,l,c,u,d){var h=Backbone.Model.extend({defaults:{items:[],widgetName:"CitationHelper",libraryID:null,permission:null,libname:null}}),p=e.ItemView.extend({template:o,events:{"click .close-widget":"signalCloseWidget","click .submit-add-to-library":"libraryAdd"},modelEvents:{change:"render"},libraryAdd:function(){this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse"></i>');var e={};e.libraryID=this.model.get("libraryID"),e.libname=this.model.get("libname");var t=this.$("input:checked").map(function(){return this.value}).get();e.recordsToAdd=t,this.trigger("library-add",e)},signalCloseWidget:function(){this.trigger("close-widget")}}),f=t.extend({viewEvents:{"close-widget":"closeWidget","library-add":"libraryAddSubmit"},initialize:function(t){t=t||{},this.model=new h,this.view=new p({model:this.model}),e.bindEntityEvents(this,this.view,e.getOption(this,"viewEvents"))},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},libraryAddSubmit:function(e){var t={},n=this;t.library=e.libraryID,t.bibcodes=e.recordsToAdd,name=e.libname,this.getBeeHive().getObject("LibraryController").addBibcodesToLib(t).done(function(t,i){var a=t.numBibcodesRequested-parseInt(t.number_added);n.model.set("feedback",{success:!0,name:name,id:e.libraryID,numRecords:t.number_added,numAlreadyInLib:a})}).fail(function(t){n.model.set("feedback",{success:!1,name:name,id:e.libraryID,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},clearFeedbackWithDelay:function(){var e=this;setTimeout(function(){e.model.unset("feedback")},5e3)},getSuggestions:function(e){var t=$.Deferred(),n=this.getPubSub(),i=new a({target:u.SERVICE_CITATION_HELPER,query:new r({bibcodes:e}),options:{type:"POST",contentType:"application/json"}});return n.subscribeOnce(n.DELIVERING_RESPONSE,function(e){t.resolve(e.toJSON())}),n.publish(n.EXECUTE_REQUEST,i),t.promise()},processResponse:function(e){if(e instanceof n){var t=_.map(e.get("response.docs"),function(e){return e.bibcode});this.getSuggestions(t)}else e instanceof i&&this.processSuggestions(e)},processSuggestions:function(e){(e=e.attributes?e.attributes:e).Error&&"Unable to get results!"===e.Error||500==e.status?this.model.set("msg","Citation Helper did not find any suggestions."):this.model.set("items",e)},renderWidgetForCurrentQuery:function(){this.reset(),this.dispatchRequest(this.getCurrentQuery())},reset:function(){this.model.clear({silent:!0}).set("items",[],{silent:!0})},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},renderWidgetForListOfBibcodes:function(e,t){this.reset();var n=new a({target:u.SERVICE_CITATION_HELPER,query:new r({bibcodes:e}),options:{type:"POST",contentType:"application/json"}});this.model.set({libraryID:t.libid,permission:t.permission,libname:t.libname}),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)}});return _.extend(f.prototype,s.BeeHive),f}),define("hbs!js/modules/orcid/widget/templates/container-template",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return" (<b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.totalPapers||(null!=e?e.totalPapers:e))?a:t.helperMissing)?a.call(e,{name:"totalPapers",hash:{},data:i}):a)+"</b>) "},3:function(e,t,n,i){return'            <p><i class="icon-loading"></i> Loading ORCID data...</p>\n'},5:function(e,t,n,i){var a,r;return'        <div style="margin-bottom: 10px;">\n            <span style="width: 40%;">ORCID Username:&nbsp;<b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidUserName||(null!=e?e.orcidUserName:e))?r:t.helperMissing)?r.call(e,{name:"orcidUserName",hash:{},data:i}):r)+"</b></span>\n            &nbsp;&nbsp;&nbsp;\n            <span>ORCID ID:&nbsp;<b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidID||(null!=e?e.orcidID:e))?r:t.helperMissing)?r.call(e,{name:"orcidID",hash:{},data:i}):r)+'</b></span>\n        </div>\n\n         <p><i class="fa fa-info-circle"></i> To share this list of your ORCID papers:\n                    <ul>\n                      <li>\n                          Search for your ORCID ID in ADS (orcid:'+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidID||(null!=e?e.orcidID:e))?r:t.helperMissing)?r.call(e,{name:"orcidID",hash:{},data:i}):r)+')\n                      </li>\n                    <li>\n                        You can then share the url of your results:<br>  <a href="https://ui.adsabs.harvard.edu/#search/q=orcid%3A'+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidID||(null!=e?e.orcidID:e))?r:t.helperMissing)?r.call(e,{name:"orcidID",hash:{},data:i}):r)+'&sort=date+desc">https://ui.adsabs.harvard.edu/#search/q=orcid%3A'+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidID||(null!=e?e.orcidID:e))?r:t.helperMissing)?r.call(e,{name:"orcidID",hash:{},data:i}):r)+'&sort=date+desc</a>\n                    </li>\n                    <li>\n                        Please note that claims take up to 24 hours to be indexed in ADS.\n                    </li>\n\n                    </ul>\n          </p>\n          <p> <i class="fa fa-info-circle"></i>\n               To claim papers in ORCID and add to this list <br>\n              <div style="padding-left:5%;">\n'+(null!=(a=t.if.call(e,null!=e?e.orcidUserName:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+'            </div>\n\n           </p>\n        <br>\n        <p> <a href="#orcid-instructions"> <i class="fa fa-arrow-circle-o-right"></i> Learn more about using ORCID with ADS</a></p>\n        <br>\n\n'},6:function(e,t,n,i){return'                <button class="btn btn-sm btn-default search-author-name"><i class="fa fa-search"></i> click here to search your name in ADS</button>\n'},8:function(e,t,n,i){return"                search your name in ADS</button>\n"},10:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"            ",helpers:t,partials:n}))?a:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'\n<div class="row s-results-control-row-container">\n\n\n    <div class="col-sm-10 col-sm-offset-1" style="padding:0 9%" >\n        <h2>\n            My ORCID Papers '+(null!=(a=t.if.call(e,null!=e?e.totalPapers:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n        </h2>\n        \x3c!--loading user data--\x3e\n"+(null!=(a=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?a:"")+'\n    </div>\n</div>\n<div class="row s-darker-background">\n    <div class="col-sm-10 s-main-content-container" style="margin-top:20px;padding-top: 20px; float:none">\n        <div class="row">\n            <ul class="col-sm-12 results-list  s-results-list list-unstyled s-display-block" aria-label="list of results">\n            </ul>\n        </div>\n'+(null!=(a=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n    </div>\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/modules/orcid/widget/templates/container-template",n),n}),define("hbs!js/modules/orcid/widget/templates/empty-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="col-sm-10 col-sm-offset-1">\n    No papers retrieved from ORCID\n</div>'},useData:!0});return t.registerPartial("js/modules/orcid/widget/templates/empty-template",n),n}),define("js/modules/orcid/widget/widget",["underscore","js/widgets/list_of_things/widget","js/widgets/base/base_widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/formatter","hbs!js/modules/orcid/widget/templates/container-template","js/mixins/papers_utils","js/components/api_query","js/components/api_feedback","js/components/json_response","hbs!js/modules/orcid/widget/templates/empty-template","js/modules/orcid/extension"],function(e,t,n,i,a,r,s,o,l,c,u,d,h){return h(t.extend({initialize:function(n){t.prototype.initialize.apply(this,arguments);var i=this;this.view.getEmptyView=function(){return Marionette.ItemView.extend({template:d})},e.extend(this.view.events,{"click .search-author-name":function(){var e=this,t=this.model.get("orcidLastName")+", "+this.model.get("orcidFirstName"),n=i.getBeeHive().getService("OrcidApi"),a='author:"'+t+'"';n.getADSUserData().done(function(e){e&&e.nameVariations&&(e.nameVariations.push(t),a='author:("'+e.nameVariations.join('" OR "')+'")')}).always(function(){e.trigger("search-author-name",a)})}}),this.view.delegateEvents(),this.view.template=s,this.view.model.set({mainResults:!0},{silent:!0}),this.listenTo(this.collection,"reset",this.checkDetails),this.listenTo(this.view,"search-author-name",function(e){var t=this.getPubSub(),n=new l({q:e,sort:"date desc"});t.publish(t.START_SEARCH,n)})},orcidWidget:!0,activate:function(n){t.prototype.activate.apply(this,[].slice.apply(arguments)),e.bindAll(this,"processResponse"),this.on("orcidAction:delete",function(e){this.collection.remove(e)})},mergeDuplicateRecords:function(t){var n,i,a={},r=0;if(t?e.each(t,function(e){e._dupIdx=r++,(n=e.identifier)&&(n=n.toLowerCase(),a[n]?(a[n].push(e),i=!0):a[n]=[e])}):this.hiddenCollection.each(function(e){n=e.get("identifier"),e.attributes._dupIdx=r++,n&&(n=n.toLowerCase(),a[n]?(a[n].push(e.attributes),i=!0):a[n]=[e.attributes])}),i){var s={},o=[];e.each(a,function(t,n){if(t.length>1){var i=0;e.each(t,function(e,t){e.source_name&&"nasa ads"==e.source_name.toLowerCase()&&(i=t)});var a=t[i];t.splice(i,1),o.push(a._dupIdx),a.source_name=a.source_name||"",e.each(t,function(e){e.source_name&&(a.source_name+="; "+e.source_name),s[e._dupIdx]=!0})}});var l=function(t){var n=0;e.each(t,function(e){e.resultsIndex=n++,e.indexToShow=n})};if(t)(s=e.keys(s)).sort(function(e,t){return t-e}),e.each(s,function(e){t.splice(e,1)}),l(t);else{e.each(o,function(e){var t=this.hiddenCollection.models[e];t.set("source_name",t.attributes.source_name,{silent:!0})});var c=[];this.hiddenCollection.each(function(e){s[e.attributes._dupIdx]||c.push(e.attributes)}),l(c),this.hiddenCollection.reset(c),this.updatePagination({numFound:c.length})}}},processDocs:function(t,n){n=i.addPaginationToDocs(n,0);return e.each(n,function(e,t){e.isOrcidWidget=!0,n[t]=o.prepareDocForViewing(e)}),n},getPaginationInfo:function(e,t){var n=t.length,a=this.model.get("perPage")||10,r=e.getApiQuery()||new l({orcid:"author X"}),s=i.getPageVal(0,a);return{numFound:n,perPage:a,start:0,page:s,showRange:[s*a,(s+1)*a-1],pageData:this._getPaginationData(s,a,n),currentQuery:r}},onShow:function(){var e=this.getBeeHive().getService("OrcidApi"),t=this;if(e){if(!e.hasAccess())return;t.model.set("loading",!0);var n=e.getUserProfile();n.done(function(e){var n=new u(e.toADSFormat()),i=n.get("responseHeader.params"),a=i.firstName,r=i.lastName;t.model.set({orcidID:i.orcid,orcidUserName:a+" "+r,orcidFirstName:a,orcidLastName:r,totalPapers:n.get("response.numFound")||0,loading:!1}),n.setApiQuery(new l(i)),t.processResponse(n)}),n.fail(function(){t.model.set({loading:!1});var e=t.getPubSub();e.publish(e.ALERT,new c({title:"Something Went Wrong",msg:["We were unable to retrieve your profile from ORCiD","Please reload the page to try again","",'<button onclick="location.reload()" class="btn btn-primary" role="button">Reload</button>'].join("<br/>"),modal:!0,type:"warning"}))})}},update:function(t){if(t=t||{},this.hiddenCollection&&this.view.collection){this._originalCollection||(this._originalCollection=new this.hiddenCollection.constructor(this.hiddenCollection.models));var n=this._originalCollection,i=["ads","both","others",null];if(e.has(t,"filterBy")){var a=t.filterBy;for(var r in e.isArray(a)||(a=[a]),a)if(!e.contains(i,a[r]))throw Error("Unknown value for the filter: "+a[r]);n=new this.hiddenCollection.constructor(n.filter(function(t){if(t.attributes.orcid&&e.contains(a,t.attributes.orcid.provenance))return!0}))}if(e.has(t,"sortBy")&&t.sortBy){var s=0;n=new this.hiddenCollection.constructor(e.map(n.sortBy(t.sortBy),function(e){return e.attributes.resultsIndex=s++,e}))}this.hiddenCollection.reset(n.models),this.updatePagination({})}}}))}),define("es6!js/widgets/orcid-selector/redux/modules/orcid-selector-app",["immutable"],function(e){var t=e.fromJS({selected:[],mode:!1});return{updateSelected:function(e){return{type:"UPDATE_SELECTED",value:e}},updateMode:function(e){return{type:"UPDATE_MODE",value:e}},sendEvent:function(e){return function(t,n,i){var a=n().get("OrcidSelectorApp").get("selected");i.fireOrcidEvent(e,a)}},reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments[1];switch(n.type){case"UPDATE_SELECTED":return e.set("selected",n.value);case"UPDATE_MODE":return e.set("mode",n.value);default:return t}}}}),define("es6!js/widgets/orcid-selector/redux/configure-store",["redux","redux-thunk","es6!./modules/orcid-selector-app","redux-immutable"],function(e,t,n,i){var a=e.createStore,r=e.applyMiddleware,s=i.combineReducers;return function(i){var o=r(t.default.withExtraArgument(i)),l=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||e.compose,c=s({OrcidSelectorApp:n.reducer});return a(c,l(o))}}),define("es6!js/widgets/orcid-selector/components/orcid-selector-app.jsx",["react","react-prop-types"],function(e,t){var n={button:{width:"50%"},img:{marginBottom:7}},i={action:"",fire:function(){},showConfirm:!1},a=function(t){function a(e){_classCallCheck(this,a);var n=_possibleConstructorReturn(this,t.call(this,e));return n.state=i,n}return _inherits(a,t),a.prototype.onClaim=function(){this.setState({action:"claim",fire:this.props.onClaim,showConfirm:!0})},a.prototype.onDelete=function(){this.setState({action:"delete",fire:this.props.onDelete,showConfirm:!0})},a.prototype.onConfirm=function(e){var t=this.state.fire;this.setState(i,function(){return e&&t()})},a.prototype.componentWillReceiveProps=function(e){0===e.app.get("selected").length&&this.setState(i)},a.prototype.render=function(){var t=this,i=this.props.app.get("selected").length;return this.props.app.get("mode")?e.createElement("div",{className:"s-right-col-widget-container container-fluid"},e.createElement("div",{className:"row"},e.createElement("div",{className:"sr-only"},"Orcid Bulk Actions"),e.createElement("div",{className:"text-center"},e.createElement("img",{src:"../../styles/img/orcid-active.svg",alt:"orcid logo active",className:"s-orcid-img","aria-hidden":"true",style:n.img}),e.createElement("span",null,e.createElement("strong",null," Bulk Actions")))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xs-12"},e.createElement("div",{className:"btn-group btn-group-justified btn-group-sm",role:"group"},e.createElement("button",{type:"button",className:"btn btn-primary-faded "+(0===i?"disabled":""),title:"Claim all selected papers from Orcid",style:n.button,onClick:function(){return t.onClaim()}},"Claim"),e.createElement("button",{type:"button",className:"btn btn-danger "+(0===i?"disabled":""),title:"Delete all selected papers from Orcid",style:n.button,onClick:function(){return t.onDelete()}},"Delete")))),this.state.showConfirm&&e.createElement("div",{className:"row",style:{marginTop:5}},e.createElement("div",{className:"col-xs-12 text-center"},"Attempt to ",this.state.action," ",i," paper",i>1?"s":"","?"),e.createElement("div",{className:"col-xs-12",style:{marginTop:5}},e.createElement("div",{className:"btn-group btn-group-sm pull-right",role:"group"},e.createElement("button",{className:"btn btn-sm btn-success",title:this.state.action+" selected papers",onClick:function(){return t.onConfirm(!0)}},"Apply"),e.createElement("button",{title:"Cancel "+this.state.action+" selected papers",className:"btn btn-sm btn-danger",onClick:function(){return t.onConfirm(!1)}},"Cancel"))))):null},a}(e.Component);return a.propTypes={app:t.object.isRequired},a}),define("es6!js/widgets/orcid-selector/containers/orcid-selector-container",["underscore","react","redux","react-redux","es6!../redux/modules/orcid-selector-app","es6!../components/orcid-selector-app.jsx"],function(e,t,n,i,a,r){var s=a.sendEvent;return i.connect(function(e){return{app:e.get("OrcidSelectorApp")}},function(e){return{onClaim:function(){return e(s("orcid-bulk-claim"))},onDelete:function(){return e(s("orcid-bulk-delete"))},onUpdate:function(){return e(s("orcid-bulk-update"))}}})(r)}),define("es6!js/widgets/orcid-selector/widget.jsx",["underscore","backbone","react","react-redux","react-dom","redux","es6!./redux/configure-store","es6!./redux/modules/orcid-selector-app","js/components/api_query","js/widgets/base/base_widget","es6!./containers/orcid-selector-container"],function(e,t,n,i,a,r,s,o,l,c,u){var d=t.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return a.render(n.createElement(i.Provider,{store:this.store},n.createElement(u,null)),this.el),this},destroy:function(){a.unmountComponentAtNode(this.el)}});return c.extend({initialize:function(){this.store=s(this),this.view=new d({store:this.store})},activate:function(t){this.setBeeHive(t),this.activateWidget();var n=this.getPubSub(),i=t.hasObject("User")&&t.getObject("User").isOrcidModeOn();this.store.dispatch(o.updateMode(i)),n.subscribe(n.STORAGE_PAPER_UPDATE,e.bind(this.onStoragePaperChange,this)),n.subscribe(n.USER_ANNOUNCEMENT,e.bind(this.onUserAnnouncement,this))},onStoragePaperChange:function(){var e=this.getBeeHive().getObject("AppStorage").getSelectedPapers();this.store.dispatch(o.updateSelected(e))},onUserAnnouncement:function(t,n){e.has(n,"isOrcidModeOn")&&this.store.dispatch(o.updateMode(n.isOrcidModeOn))},fireOrcidEvent:function(e,t){var n=this.getPubSub();n.publish(n.CUSTOM_EVENT,e,t)}})}),define("js/wraps/author_facet",["underscore","js/widgets/facet/factory"],function(e,t){return function(n){return t.makeHierarchicalCheckboxFacet(e.extend({facetField:"author_facet_hier",facetTitle:"Authors",openByDefault:!0,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}},n))}}),define("js/wraps/bibgroup_facet",["underscore","js/widgets/facet/factory"],function(e,t){return function(){return t.makeBasicCheckboxFacet({facetField:"bibgroup_facet",facetTitle:"Bib Groups",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]},preprocessors:[function(t){return e.map(t,function(t){return t.value.indexOf("/")>-1?e.assign(t,{name:t.value}):t})}]})}}),define("js/wraps/bibstem_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"bibstem_facet",facetTitle:"Publications",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}})}}),define("js/wraps/data_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"data_facet",facetTitle:"Data",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/database_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"database",facetTitle:"Collections",openByDefault:!0,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/grants_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeHierarchicalCheckboxFacet({facetField:"grant_facet_hier",facetTitle:"Grants",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,a=this.queryUpdater.removeTmpEntry(n,"SelectedItems");if(a&&_.keys(a).length>0){a=_.values(a),_.each(a,function(e,t,n){n[t]='grant:"'+e.title+'"'}),n=n.clone();"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,"fq_grant","limit",a):"or"==e?this.queryUpdater.updateQuery(n,"fq_grant","expand",a):"exclude"==e&&(n.get("fq_grant")?this.queryUpdater.updateQuery(n,"fq_grant","exclude",a):(a.unshift("*:*"),this.queryUpdater.updateQuery(n,"fq_grant","exclude",a)));var r="{!type=aqp cache=false cost=150 v=$fq_grant}",s=n.get("fq");if(s)-1==_.indexOf(s,r)&&s.push(r),n.set("fq",s);else n.set("fq",[r]);n.unset("facet.prefix"),n.unset("facet"),this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:a}))}},n}}),define("js/wraps/keyword_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"keyword_facet",facetTitle:"Keywords",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/simbad_object_facet",["js/components/api_response","js/components/api_request","js/components/api_query","js/components/solr_response","js/widgets/facet/factory","js/components/api_targets","analytics","cache","underscore","js/widgets/facet/reducers"],function(e,t,n,i,a,r,s,o,l,c){return function(){var e=a.makeHierarchicalCheckboxFacet({facetField:"simbad_object_facet_hier",facetTitle:"SIMBAD Objects",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}});return e._dispatchRequest=function(e,t){var n=this.getPubSub(),i=this,a=this.getBeeHive();this.store.dispatch(this.actions.data_requested(e)),e?n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.translateSimbid(t,e)}):n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.store.dispatch(i.actions.data_received(t.toJSON(),e))});var r=this.getCurrentQuery();if(l.isUndefined(r)&&a.hasObject("AppStorage")){var s=a.getObject("AppStorage");l.isFunction(s.getCurrentQuery)&&(r=s.getCurrentQuery())}var o=this.customizeQuery(r);t=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;o.set("facet.offset",t),e&&o.set("facet.prefix",e.replace("0/","1/"));var c=this.composeRequest(o);n.publish(n.DELIVERING_REQUEST,c)},e._simbidCache={},e.translateSimbid=function(n,i){var a=this,s=n.toJSON().facet_counts.facet_fields.simbad_object_facet_hier.map(function(e,t){if(t%2==0)return e.split("/")[e.split("/").length-1]}).filter(function(e){if(e)return e});var o=new t({target:r.SERVICE_OBJECTS,options:{type:"POST",contentType:"application/json",data:JSON.stringify({identifiers:s}),done:function(t){var r=n.toJSON();r.facet_counts.facet_fields.simbad_object_facet_hier=r.facet_counts.facet_fields.simbad_object_facet_hier.map(function(n,i){if(i%2==0){var a=n.split("/"),r=a[a.length-1],s=a.slice(0,2).concat([t[r].canonical]).join("/");return e._simbidCache[s]=r,s}return n},this),a.store.dispatch(a.actions.data_received(r,i))}}}),l=this.getPubSub();l.publish(l.EXECUTE_REQUEST,o)},e.submitFilter=function(e){var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n,a=c.getActiveFacets(this.store.getState(),this.store.getState().state.selected),r=a.map(function(e){if(this._simbidCache[e])var t=e.split("/").slice(0,2).concat([this._simbidCache[e]]).join("/");else t=e;return n+':"'+t+'"'},this);"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",r):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",r):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",r):(r.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",r)));var o="{!type=aqp v=$"+i+"}",u=t.get("fq")||[];if(u.push(o),t.set("fq",l.unique(u)),"simbad_object_facet_hier"===n){var d=l.find(l.keys(t.toJSON()),function(e){return e.match(/fq_simbad_facet_hier/i)});if(d){var h=t.get(d)[0];t.set("filter_simbad_object_facet_hier_fq_simbad_object_facet_hier",[h].concat(a))}}t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),s("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:r}))},e}}),define("js/wraps/ned_object_facet",["js/components/api_response","js/components/api_request","js/components/api_query","js/components/solr_response","js/widgets/facet/factory","js/components/api_targets","analytics","cache","underscore","js/widgets/facet/reducers"],function(e,t,n,i,a,r,s,o,l,c){return function(){var e=a.makeHierarchicalCheckboxFacet({facetField:"ned_object_facet_hier",facetTitle:"NED Objects",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}});return e._dispatchRequest=function(e,t){var n=this.getPubSub(),i=this;this.store.dispatch(this.actions.data_requested(e)),e?n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.translateNedid(t,e)}):n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.store.dispatch(i.actions.data_received(t.toJSON(),e))});var a=this.getCurrentQuery();if(l.isUndefined(a)&&beehive.hasObject("AppStorage")){var r=beehive.getObject("AppStorage");l.isFunction(r.getCurrentQuery)&&(a=r.getCurrentQuery())}var s=this.customizeQuery(a);t=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;s.set("facet.offset",t),e&&s.set("facet.prefix",e.replace("0/","1/"));var o=this.composeRequest(s);n.publish(n.DELIVERING_REQUEST,o)},e._nedidCache={},e.translateNedid=function(n,i){var a=this,s=n.toJSON().facet_counts.facet_fields.ned_object_facet_hier.map(function(e,t){if(t%2==0)return e.split("/")[e.split("/").length-1]}).filter(function(e){if(e)return e});var o=new t({target:r.SERVICE_OBJECTS,options:{type:"POST",contentType:"application/json",data:JSON.stringify({source:"NED",identifiers:s}),done:function(t){var r=n.toJSON();r.facet_counts.facet_fields.ned_object_facet_hier=r.facet_counts.facet_fields.ned_object_facet_hier.map(function(n,i){if(i%2==0){var a=n.split("/"),r=a[a.length-1],s=a.slice(0,2).concat([t[r].canonical]).join("/");return e._nedidCache[s]=r,s}return n},this),a.store.dispatch(a.actions.data_received(r,i))}}}),l=this.getPubSub();l.publish(l.EXECUTE_REQUEST,o)},e.submitFilter=function(e){var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n,a=c.getActiveFacets(this.store.getState(),this.store.getState().state.selected),r=a.map(function(e){if(this._nedidCache[e])var t=e.split("/").slice(0,2).concat([this._nedidCache[e]]).join("/");else t=e;return n+':"'+t+'"'},this);"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",r):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",r):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",r):(r.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",r)));var o="{!type=aqp v=$"+i+"}",u=t.get("fq")||[];if(u.push(o),t.set("fq",l.unique(u)),"ned_object_facet_hier"===n){var d=t.get("filter_ned_object_facet_hier_fq_ned_object_facet_hier")[0];t.set("filter_ned_object_facet_hier_fq_ned_object_facet_hier",[d].concat(a))}t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),s("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:r}))},e}}),define("js/wraps/refereed_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeBasicCheckboxFacet({facetField:"property",facetTitle:"Refereed",openByDefault:!0,defaultQueryArguments:{"facet.query":"property:refereed"},preprocessors:function(e){return e.filter(function(e){return"notrefereed"===e.value||"refereed"===e.value}).map(function(e){return"notrefereed"===e.name&&(e.name="non-refereed"),e})},logicOptions:{single:["limit to","exclude"],multiple:["invalid choice"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,a=this.queryUpdater.removeTmpEntry(n,"SelectedItems"),r=this;if(a&&_.keys(a).length>0){a=_.values(a),_.each(a,function(e,t,n){n[t]="property:"+r.queryUpdater.escapeInclWhitespace(e.value)}),n=n.clone();var s="fq_"+this.facetField;"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,s,"limit",a):"or"==e?this.queryUpdater.updateQuery(n,s,"expand",a):"exclude"!=e&&"not"!=e||this.queryUpdater.updateQuery(n,s,"exclude",a);var o="{!type=aqp v=$"+s+"}",l=n.get("fq");if(l)-1==_.indexOf(l,o)&&l.push(o),n.set("fq",l);else n.set("fq",[o]);this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:a}))}},n}}),define("js/wraps/vizier_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"vizier_facet",facetTitle:"Vizier Tables",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("hbs!js/widgets/tabs/templates/tabs_inner",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<div class="tab-pane '+(null!=(a=t.if.call(e,null!=e?e.default:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'" id= '+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+">"+this.escapeExpression("function"==typeof(r=null!=(r=t.view||(null!=e?e.view:e))?r:t.helperMissing)?r.call(e,{name:"view",hash:{},data:i}):r)+"</div>\n"},useData:!0});return t.registerPartial("js/widgets/tabs/templates/tabs_inner",n),n}),define("hbs!js/widgets/tabs/templates/tabs_outer",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="tab-widget">\n    \x3c!-- Nav tabs --\x3e\n    <ul class="nav nav-tabs">\n    </ul>\n\n    \x3c!-- Tab panes --\x3e\n    <div class="tab-content">\n    </div>\n</div>'},useData:!0});return t.registerPartial("js/widgets/tabs/templates/tabs_outer",n),n}),define("hbs!js/widgets/tabs/templates/tabs_title",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<li class="'+(null!=(a=t.if.call(e,null!=e?e.default:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'"> <a href="#'+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+'" data-toggle="tab"> <h5>'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</h5></a></li>\n"},useData:!0});return t.registerPartial("js/widgets/tabs/templates/tabs_title",n),n}),define("js/widgets/tabs/tabs_widget",["underscore","marionette","bootstrap","hbs!js/widgets/tabs/templates/tabs_inner","hbs!js/widgets/tabs/templates/tabs_outer","hbs!js/widgets/tabs/templates/tabs_title"],function(e,t,n,i,a,r){return t.ItemView.extend({className:"s-tabs-widget",activate:function(t){var n,i=[];return e.each(this.widgets,function(e){e.activate(n=t.getHardenedInstance()),i.push({name:e.title,object:e,beehive:n})}),i},initialize:function(t){this.tabs=t.tabs||[],this.widgets=e.map(this.tabs,function(e,t){if(!e.widget)throw new Error('Missing "widget" for: '+e.title+" ["+t+"]");return e.default?e.widget.trigger("active"):e.widget.trigger("hidden"),e.widget}),this.on("active",this.onActive),this.on("hidden",this.onHidden)},render:function(){this.beforeRender&&this.beforeRender(),this.trigger("before:render",this);var t=$(a()),n=t.find("ul.nav"),s=t.find("div.tab-content");return e.each(this.tabs,function(e){n.append(r({id:e.id,title:e.title,default:e.default})),s.append(i({id:e.id,default:e.default}))},this),this.$el.html(t.html()),e.each(this.tabs,function(e){var t=this;this.$("#"+e.id).append(e.widget.getEl()),this.$('a[href="#'+e.id+'"]').on("show.bs.tab",function(){t.trigger("active",e)}).on("hide.bs.tab",function(){t.trigger("hidden",e)})},this),this.bindUIElements(),this.onRender&&this.onRender(),this.trigger("render",this),this},onDestroy:function(){e.each(this.tabs,function(e){e.widget.destroy?e.widget.destroy():e.widget.remove&&e.widget.remove()},this)},getEl:function(){return this.el&&this.$el.children().length?this.el:this.render().el},onActive:function(e){e.widget.trigger("active")},onHidden:function(e){e.widget.trigger("hidden")}})}),define("hbs!js/widgets/facet/graph-facet/templates/graph",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return"    "+this.escapeExpression("function"==typeof(a=null!=(a=t.statsDescription||(null!=e?e.statsDescription:e))?a:t.helperMissing)?a.call(e,{name:"statsDescription",hash:{},data:i}):a)+" : <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.statsCount||(null!=e?e.statsCount:e))?a:t.helperMissing)?a.call(e,{name:"statsCount",hash:{},data:i}):a)+"</b>\n    <hr/>\n"},3:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=e?e.error:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?a:"")+"\n"},4:function(e,t,n,i){return'    <div class="text-center">\n      <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>\n      Could not load graph.\n    </div>\n'},6:function(e,t,n,i){return'    <div class="text-center">\n      <i class="fa fa-spin fa-spinner fa-2x" aria-hidden="true"></i> Loading...\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="pull-right s-view-metrics-button-container"></div>\n'+(null!=(a=t.if.call(e,null!=e?e.statsCount:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'<div class="graph-legend"></div>\n'+(null!=(a=t.unless.call(e,null!=e?e.graphData:e,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+' <div class="s-svg-container">\n     <svg class="chart s-chart" viewBox="0 0 110 100" preserveAspectRatio="xMinYMin meet">\n     </svg>\n </div>\n\n<div style="position: relative;top: 30px;">\n    <div class="slider s-slider"></div>\n    <div class="graph-controls row">\n        <div class="slider-data col-sm-12">\n        </div>\n</div>\n\n\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/graph",n),n}),define("js/widgets/facet/graph-facet/base_graph",["marionette","d3","jquery","jquery-ui","hbs!js/widgets/facet/graph-facet/templates/graph"],function(e,t,n,i,a){return e.ItemView.extend({className:"graph-facet",initialize:function(e){this.yAxisTitle=e.yAxisTitle,this.xAxisTitle=e.xAxisTitle,this.graphTitle=e.graphTitle,this.pastTenseTitle=e.pastTenseTitle,this.id=this.graphTitle+"-graph",this.fullWidth=110,this.fullHeight=100,this.width=this.fullWidth-this.margin.left-this.margin.right,this.height=this.fullHeight-this.margin.top-this.margin.bottom,this.currentScale="linear",this.on("facet:active",this.pulseApplyButton)},bins:12,margin:{top:5,right:5,bottom:20,left:20},template:a,insertLegend:function(){this.$(".graph-legend").html(this.legendTemplate({yAxisTitle:this.yAxisTitle}))},events:{"click .apply":"submitFacet","blur input[type=text]":"triggerGraphChange"},modelEvents:{change:"render"},pulseApplyButton:function(){this.$(".apply").addClass("draw-attention-primary-faded"),setTimeout(function(){this.$(".apply").removeClass("draw-attention-primary-faded")},2e3)},onRender:function(){var e=this;if(this.model.get("graphData"))if(this.model.get("graphData").length<2)this.$el.html("Too little data to make a useful graph.");else{this.insertLegend(),this.buildGraph(),this.addSliderWindows(),this.buildSlider(),this.addToOnRender&&this.addToOnRender();var t=_.debounce(_.bind(this.triggerGraphChange,this),100);n('input[type="text"]',this.$el).on("keyup",function(n){t(),n&&13===n.which&&(e.triggerGraphChange.call(e,!0),e.submitFacet.call(e))})}}})}),define("hbs!js/widgets/facet/graph-facet/templates/year-graph-legend",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<span <span class="s-legend-color refereed"></span> refereed</span>&nbsp;&nbsp;\n<span> <span class="s-legend-color nonrefereed"></span> non refereed</span>\n'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/year-graph-legend",n),n}),define("js/widgets/facet/graph-facet/year_graph",["./base_graph","hbs!js/widgets/facet/graph-facet/templates/year-graph-legend","marionette","jquery-ui"],function(e,t,n,i){return e.extend({bins:10,margin:{top:5,right:0,bottom:20,left:10},id:"year-graph",legendTemplate:t,formatXAxisText:function(e){e.style("text-anchor","end").attr("dx","-.8em").attr("dy","-1.1em").attr("transform",function(e){return"rotate(-65)"})},buildGraph:function(){var e,t,i,a,r,s,o,l,c=this,u=d3.format("s");e=_.clone(this.model.get("graphData")),e=this.binData(e,this.bins),t=_.pluck(e,"x"),maxVal=d3.max(_.pluck(e,"y")),i=d3.scale.ordinal().domain(t).rangeRoundBands([0,this.width],.1),a=d3.scale.linear().domain([0,maxVal]).range([this.height,0]),r=d3.svg.axis().scale(i).orient("bottom"),s=d3.svg.axis().scale(a).ticks(5).orient("left").tickFormat(function(e){return e>=1&&e%1==0?u(e):""}),o=d3.select(this.el).select(".chart").attr("width",this.fullWidth).attr("height",this.fullHeight),this.innerChart=o.append("g").classed("inner-chart",!0).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),(l=this.innerChart.selectAll("g").data(e).enter().append("g").classed("bar",!0).attr("transform",function(e){return"translate("+i(e.x)+",0)"})).append("rect").classed("full-bar",!0).attr("y",function(e){return a(e.y)}).attr("height",function(e){return c.height-a(e.y)}).attr("width",function(e){return i.rangeBand()*e.width/c.binSize}),l.append("rect").classed("refereed",!0).attr("y",function(e){return a(e.refCount)}).attr("height",function(e){return c.height-a(e.refCount)}).attr("width",function(e){return i.rangeBand()*e.width/c.binSize}),this.innerChart.append("g").classed({axis:!0,"x-axis":!0}).attr("transform","translate(0,"+this.height+")").call(r).selectAll("text").call(this.formatXAxisText),this.innerChart.append("g").classed({axis:!0,"y-axis":!0}).call(s).selectAll("text").style("text-anchor","start"),this.innerChart.append("text").attr("class","s-label").attr("x",this.width/2-20).attr("y",212).text(n.getOption(this,"xAxisTitle")),this.innerChart.append("text").attr("class","s-label").attr("y",-40).attr("x",-this.height/2).attr("transform","rotate(-90)").text(n.getOption(this,"yAxisTitle"))},binData:function(e,t){var n,i,a,r,s,o;if(e.length<=t)return this.binSize=1,e=_.map(e,function(e,t){return{x:""+e.x,y:e.y,width:1,refCount:e.refCount}});n=void 0,a=Math.floor(e.length/t),this.binSize=a,(i=e.length%t)&&(t+=Math.floor(i/a),(i%=a)&&(n=i)),r=[],s=[],o=[];for(var l=0;l<t;l++)r.push(a);return n&&r.push(n),_.each(r,function(t,n){for(var i=0,a=0,r=[];t>=1;){var l=e[0];r.push(l.x),i+=l.y,a+=l.refCount,e.shift(),t-=1}s.push(r),o.push({totalCount:i,refCount:a})}),s=_.map(s,function(e,t){return e.length>1?{x:e[0]+"-"+e[e.length-1],width:e.length}:{x:e[0]+"",width:1}}),e=_.map(s,function(e,t){return{x:e.x,y:o[t].totalCount,refCount:o[t].refCount,width:e.width}})},graphChange:function(e,t){var n,i,a,r,s,o,l,c=this,u=(n=_.clone(this.model.get("graphData")))[0].x,d=n[n.length-1].x;e!==u||t!==d?this.trigger("facet:active"):this.trigger("facet:inactive"),n=_.filter(n,function(n,i){return n.x>=e&&n.x<=t}),n=this.binData(n,this.bins),!0===this.sizeSort&&(n=_.sortBy(n,function(e){return e.y})),a=_.pluck(n,"x"),maxVal=d3.max(_.pluck(n,"y")),i=d3.scale.ordinal().domain(a).rangeRoundBands([0,this.width],.1),r=d3.scale.linear().domain([0,maxVal]).range([this.height,0]),s=d3.svg.axis().scale(i).orient("bottom");var h=d3.format("s");o=d3.svg.axis().scale(r).orient("left").tickFormat(function(e){return e>=1&&e%1==0?h(e):""}),(l=this.innerChart.selectAll(".bar").data(n)).exit().remove();var p=l.enter().append("g").classed("bar",!0);p.append("rect").classed("full-bar",!0),p.append("rect").classed("refereed",!0);var f=a.length;l.transition(500).attr("transform",function(e){return"translate("+i(e.x)+",0)"}).delay(function(e,t){return 500*t/f}).select("rect").attr("y",function(e){return r(e.y)}).attr("height",function(e){return c.height-r(e.y)}).attr("width",function(e){return i.rangeBand()*e.width/c.binSize}),l.select(".refereed").transition(500).delay(function(e,t){return 500*t/f}).attr("y",function(e){return r(e.refCount)}).attr("height",function(e){return c.height-r(e.refCount)}).attr("width",function(e){return i.rangeBand()*e.width/c.binSize}),d3.select(this.el).select(".x-axis").call(s).selectAll("text").call(this.formatXAxisText),d3.select(this.el).select(".y-axis").transition().call(o).selectAll("text").style("text-anchor","start")},buildSlider:function(){var e=this,t=_.clone(this.model.get("graphData")),n=t[0].x,i=t[t.length-1].x;this.$(".slider").slider({range:!0,min:n,max:i,values:[n,i],stop:function(t,n){var i=n.values[0],a=n.values[1];e.graphChange(i,a)},slide:function(t,n){var i=n.values[0],a=n.values[1];e.$(".show-slider-data-first").val(i),e.$(".show-slider-data-second").val(a)}}),this.$(".show-slider-data-first").val(n),this.$(".show-slider-data-second").val(i)},addSliderWindows:function(){this.$(".slider-data").html('Limit results to papers from <br/> <input type="text" class="show-slider-data-first"></input> to <input type="text" class="show-slider-data-second"></input> <button class="apply btn btn-sm btn-primary-faded">Apply</button>')},triggerGraphChange:function(e){var t=_.clone(this.model.get("graphData"));if(_.isArray(t)){var n=t[0].x,i=t[t.length-1].x,a=this.$(".show-slider-data-first"),r=this.$(".show-slider-data-second"),s=a.val(),o=r.val();s=s<n?n:s,o=o>i?i:o,s=s>i?o:s,o=(o=o<n?s:o)<(s=s>o?o:s)?s:o,e&&(a.val(s),r.val(o)),this.$(".slider").slider("values",[s,o]),this.graphChange(s,o)}},submitFacet:function(){this.trigger("facet-applied",this.$(".slider").slider("values").join("-"))}})}),define("hbs!js/widgets/facet/graph-facet/templates/h-index-graph-legend",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'H-Index for results: <span id="h-index-container"> </span>\n<div class="ref-nonref hidden pull-right">\n    <div> <span class="s-legend-color refereed"></span> refereed</div>\n</div>\n    <div class="change-scale"> Y-axis:\n        <label>linear <input type="radio" name="'+this.escapeExpression("function"==typeof(a=null!=(a=t.yAxisTitle||(null!=e?e.yAxisTitle:e))?a:t.helperMissing)?a.call(e,{name:"yAxisTitle",hash:{},data:i}):a)+'-scale" value="linear" checked/></label>\n        <label>log <input type="radio" name="'+this.escapeExpression("function"==typeof(a=null!=(a=t.yAxisTitle||(null!=e?e.yAxisTitle:e))?a:t.helperMissing)?a.call(e,{name:"yAxisTitle",hash:{},data:i}):a)+'-scale" value="log"/></label>\n    </div>'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/h-index-graph-legend",n),n}),define("hbs!js/widgets/facet/graph-facet/templates/h-index-slider-window",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'Limit to top <input type="text" class="show-slider-data-first"> most '+this.escapeExpression("function"==typeof(a=null!=(a=t.pastTenseTitle||(null!=e?e.pastTenseTitle:e))?a:t.helperMissing)?a.call(e,{name:"pastTenseTitle",hash:{},data:i}):a)+'\n<button class="apply btn btn-sm btn-primary-faded pull-right">Apply</button>\n\n'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/h-index-slider-window",n),n}),define("js/widgets/facet/graph-facet/h_index_graph",["./base_graph","hbs!js/widgets/facet/graph-facet/templates/h-index-graph-legend","hbs!js/widgets/facet/graph-facet/templates/h-index-slider-window","marionette"],function(e,t,n,i){return e.extend({legendTemplate:t,xAxisClassName:"h-index-x-axis-title",addToOnRender:function(){this.hIndex&&this.$("#h-index-container").text(this.hIndex.x)},events:{"click .apply":"submitFacet","blur input[type=text]":"triggerGraphChange","change input[name*=scale]":"toggleScale"},buildGraph:function(){var e,t,n,a,r,s,o,l;e=_.clone(this.model.get("graphData")),this.hIndex=e[_.indexOf(e,_.findWhere(e,function(e){if(e.x>e.y)return!0}))-1],t=_.pluck(e,"x");var c=_.pluck(e,"y");maxVal=d3.max(c),minVal=d3.min(c);var u=[t[0]-1,t[t.length-1]+1];(n=d3.scale.linear().domain(u).range([0,this.width]),a=d3.scale.linear().domain([minVal-1,maxVal+1]).range([this.height,0]),r=d3.svg.axis().scale(n).orient("bottom"),standardFormatter=d3.format("s"),s=d3.svg.axis().scale(a).orient("left").tickFormat(function(e){return e>=1&&e%1==0?standardFormatter(e):""}),o=d3.select(this.el).select(".chart").attr("width",this.fullWidth).attr("height",this.fullHeight),this.innerChart=o.append("g").classed("inner-chart",!0).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.innerChart.append("g").classed({axis:!0,"x-axis":!0}).attr("transform","translate(0,"+this.height+")").call(r).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"}),this.innerChart.append("g").classed({axis:!0,"y-axis":!0}).call(s),e.length>=40)?(l=d3.svg.line().x(function(e){return n(e.x)}).y(function(e){return a(e.y)}),this.innerChart.append("path").datum(e).classed("line",!0).attr("d",l)):(this.$(".ref-nonref").removeClass("hidden"),this.innerChart.selectAll("circle").data(e).enter().append("circle").attr("class","dot").attr("r",2).classed("refereed",function(e){if(e.refereed)return!0}).attr("cx",function(e){return n(e.x)}).attr("cy",function(e){return a(e.y)}));this.hIndex&&(this.innerChart.append("line").classed({"h-index":!0,"h-index-1":!0}).attr("x1",n(this.hIndex.x)).attr("y1",a(minVal-1)).attr("x2",n(this.hIndex.x)).attr("y2",a(this.hIndex.y)),this.innerChart.append("line").classed({"h-index":!0,"h-index-2":!0}).attr("x1",n(t[0]-1)).attr("y1",a(this.hIndex.y)).attr("x2",n(this.hIndex.x)).attr("y2",a(this.hIndex.y))),this.innerChart.append("text").attr("class","s-label").attr("x",this.width/2-20).attr("y",180).text(i.getOption(this,"xAxisTitle")),this.innerChart.append("text").attr("class","s-label").attr("y",-40).attr("x",-this.height/2).attr("transform","rotate(-90)").text(i.getOption(this,"yAxisTitle"))},toggleScale:function(e){var t=$(e.target).attr("value");this.currentScale=t,this.graphChange()},graphChange:function(e){var t,n,i,a,r;e!==(t=_.clone(this.model.get("graphData")))[t.length-1].x?this.trigger("facet:active"):this.trigger("facet:inactive"),e?this.limitVal=e:this.limitVal||(this.limitVal=d3.max(_.pluck(t,"x"))),t=_.filter(t,function(e,t){return"log"===this.currentScale?e.x<=this.limitVal&&e.y>0:e.x<=this.limitVal},this);var s=_.pluck(t,"x"),o=_.pluck(t,"y");maxVal=d3.max(o),minVal=d3.min(o);var l=[s[0]-1,s[s.length-1]+1];if(n=d3.scale.linear().domain(l).range([0,this.width]),a=d3.svg.axis().scale(n).orient("bottom").tickFormat(d3.format("d")),"linear"===this.currentScale?i=d3.scale.linear().domain([minVal-1,maxVal+1]).range([this.height,0]):"log"===this.currentScale&&(i=d3.scale.log().domain([_.max([1,minVal-1]),maxVal+1]).range([this.height,0]).clamp(!0)),d3.select(this.el).select(".x-axis").call(a).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"}),standardFormatter=d3.format("s"),r=d3.svg.axis().scale(i).orient("left"),"log"===this.currentScale){var c=d3.format("s");r.tickFormat(function(e){var t=Math.log(e)/Math.log(10)+1e-6;return Math.abs(t-Math.floor(t))<.7?c(e):""})}else r=d3.svg.axis().scale(i).orient("left").tickFormat(function(e){return e>=1&&e%1==0?standardFormatter(e):""});if(d3.select(this.el).select(".y-axis").transition().call(r),this.hIndex&&(_.contains(t,this.hIndex)?this.innerChart.selectAll(".h-index").classed("hidden",!1):this.innerChart.selectAll(".h-index").classed("hidden",!0),this.innerChart.select(".h-index-1").transition().attr("x1",n(this.hIndex.x)).attr("x2",n(this.hIndex.x)).attr("y2",i(this.hIndex.y)),this.innerChart.select(".h-index-2").transition().attr("y1",i(this.hIndex.y)).attr("x2",n(this.hIndex.x)).attr("y2",i(this.hIndex.y))),t.length>=40)$(".ref-nonref").addClass("hidden"),line=d3.svg.line().x(function(e){return n(e.x)}).y(function(e){return i(e.y)}),this.innerChart.selectAll(".dot").classed("hidden",!0),this.innerChart.selectAll(".line").datum(t).attr("d",line).classed("hidden",!1);else{this.$(".ref-nonref").removeClass("hidden"),this.innerChart.selectAll(".line").classed("hidden",!0),this.innerChart.selectAll(".dot").classed("hidden",!1);var u=this.innerChart.selectAll("circle").data(t);u.exit().remove(),u.enter().append("circle").attr("class","dot").attr("r",2),u.classed("refereed",function(e){if(e.refereed)return!0}).attr("cx",function(e){return n(e.x)}).attr("cy",function(e){return i(e.y)})}},buildSlider:function(){var e=this,t=_.clone(this.model.get("graphData")),n=t[t.length-1].x,i=t[0].x;this.$(".slider").slider({max:n,min:i,value:n,stop:function(t,n){e.graphChange(n.value)},slide:function(t,n){e.$(".show-slider-data-first").val(n.value)}}),this.$(".show-slider-data-first").val(n)},addSliderWindows:function(){this.$(".slider-data").html(n({pastTenseTitle:this.pastTenseTitle}))},triggerGraphChange:function(e){var t=_.clone(this.model.get("graphData"));if(_.isArray(t)){var n=t[0].x,i=t[t.length-1].x,a=this.$(".show-slider-data-first"),r=a.val();r=(r=r<n?n:r)>i?i:r,e&&a.val(r),this.$(".slider").slider("value",r),this.graphChange(r)}},submitFacet:function(){var e=this.model.get("graphData")[this.$(".slider").slider("value")-1].y;this.trigger("facet-applied","["+e+" TO 9999999]")}})}),define("js/wraps/graph_tabs",["js/widgets/tabs/tabs_widget","js/widgets/facet/factory","js/widgets/facet/graph-facet/year_graph","js/widgets/facet/graph-facet/h_index_graph","js/mixins/formatter"],function(e,t,n,i,a){return function(){var r=t.makeGraphFacet({graphView:n,facetField:"year",defaultQueryArguments:{"facet.pivot":"property,year",facet:"true","facet.minCount":"1","facet.limit":"-1"},graphViewOptions:{yAxisTitle:"article count",xAxisTitle:"years"},processResponse:function(e){this.setCurrentQuery(e.getApiQuery());var t=e.get("facet_counts.facet_pivot.property,year");if(e.get("response.numFound")<2)this.model.set({graphData:[]});else{var n=_.findWhere(t,{value:"refereed"});n&&(n=n.pivot);var i,a,r=_.findWhere(t,{value:"notrefereed"});r&&(r=r.pivot),_.each(n,function(e){var t=parseInt(e.value);void 0===i?i=t:t>i&&(i=t),void 0===a?a=t:parseInt(e.value)<a&&(a=parseInt(e.value))}),_.each(r,function(e){var t=parseInt(e.value);void 0===i?i=t:t>i&&(i=t),void 0===a?a=t:parseInt(e.value)<a&&(a=parseInt(e.value))});var s=_.range(a,i+1),o=[];_.each(s,function(e){var t=e+"",i=_.filter(n,function(e){return e.value===t})[0];i=i?i.count:0;var a=_.filter(r,function(e){return e.value===t})[0];a=a?a.count:0,o.push({x:e,y:i+a,refCount:i})}),o.length<2?this.model.set({graphData:[]}):this.model.set({graphData:o})}}}),s=t.makeGraphFacet({graphView:i,facetField:"citation_count",defaultQueryArguments:{"facet.pivot":"property,citation_count",facet:"true","facet.limit":"-1",stats:"true","stats.field":"citation_count"},graphViewOptions:{yAxisTitle:"citations",xAxisTitle:"number of records",pastTenseTitle:"cited"},processResponse:function(e){this.setCurrentQuery(e.getApiQuery());var t=e.get("facet_counts.facet_pivot.property,citation_count");if(e.get("response.numFound")<2)this.model.set({graphData:[]});else{var n=_.findWhere(t,{value:"refereed"});n&&(n=n.pivot);var i=_.findWhere(t,{value:"notrefereed"});i&&(i=i.pivot);var r,s=[];if(_.each(n,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){s.push({refereed:!0,x:void 0,y:t})})}),_.each(i,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){s.push({refereed:!1,x:void 0,y:t})})}),s.length<2)this.model.set({graphData:[]});else s=s.sort(function(e,t){return t.y-e.y}),s=_.first(s,2e3),s=_.map(s,function(e,t){return e.x=t+1,e}),e.toJSON().stats&&(r=a.formatNum(e.get("stats.stats_fields.citation_count.sum"))),this.model.set({graphData:s,statsCount:r,statsDescription:"total number of citations"})}}}),o=t.makeGraphFacet({graphView:i,facetField:"read_count",defaultQueryArguments:{"facet.pivot":"property,read_count",facet:"true","facet.limit":"-1",stats:"true","stats.field":"read_count"},graphViewOptions:{yAxisTitle:"recent reads",xAxisTitle:"number of records",pastTenseTitle:"read"},processResponse:function(e){this.setCurrentQuery(e.getApiQuery());var t=e.get("facet_counts.facet_pivot.property,read_count");if(e.get("response.numFound")<2)this.model.set({graphData:[]});else{var n=_.findWhere(t,{value:"refereed"});n&&(n=n.pivot);var i=_.findWhere(t,{value:"notrefereed"});i&&(i=i.pivot);var r=[];if(_.each(n,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){r.push({refereed:!0,x:void 0,y:t})})}),_.each(i,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){r.push({refereed:!1,x:void 0,y:t})})}),r.length<2)this.model.set({graphData:[]});else{if(r=r.sort(function(e,t){return t.y-e.y}),r=_.first(r,2e3),r=_.map(r,function(e,t){return e.x=t+1,e}),e.toJSON().stats)var s=a.formatNum(e.get("stats.stats_fields.read_count.sum"));this.model.set({graphData:r,statsCount:s,statsDescription:"total recent (90 day) reads"})}}}}),l=new e({tabs:[{title:"Years",widget:r,id:"year-facet",default:!0},{title:"Citations",widget:s,id:"citations-facet"},{title:"Reads",widget:o,id:"reads-facet"}]});return l.yearGraphWidget=r,l.citationGraphWidget=s,l.readsGraphWidget=o,l}}),define("hbs!js/widgets/footer/footer",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<footer>\n  <div class="__footer_wrapper">\n    <div class="__footer_brand">\n      &copy; The SAO/NASA Astrophysics Data System\n      <div class="__footer_brand_extra">\n        <p>\n          <i class="fa fa-envelope"></i> adshelp[at]cfa.harvard.edu\n        </p>\n        <p>\n          The ADS is operated by the Smithsonian Astrophysical Observatory under NASA Cooperative Agreement <em>NNX16AC86A</em>\n        </p>\n      </div>\n      <div class="__footer_brand_logos">\n        <a href="http://www.nasa.gov" target="_blank" rel="noopener">\n          <img src="styles/img/nasa.svg" alt="NASA logo">\n        </a>\n        <a href="http://www.si.edu" target="_blank" rel="noopener">\n          <img class="smithsonian" src="styles/img/smithsonian.svg" alt="Smithsonian logo">\n        </a>\n        <a href="https://www.cfa.harvard.edu/" target="_blank" rel="noopener">\n          <img src="styles/img/cfa.png" title="Harvard Center for Astrophysics logo">\n        </a>\n      </div>\n    </div>\n    <div class="__footer_list">\n      <div class="__footer_list_title">\n        Resources\n      </div>\n      <ul class="__footer_links">\n        <li>\n          <a href="//ui.adsabs.harvard.edu/about/" target="_blank" rel="noopener">\n            <i class="fa fa-question-circle"></i> About ADS\n          </a>\n        </li>\n        <li>\n          <a href="//adsabs.github.io/help/" target="_blank" rel="noopener">\n            <i class="fa fa-info-circle"></i> ADS Help\n          </a>\n        </li>\n        <li>\n          <a href="//ui.adsabs.harvard.edu/about/careers/" target="_blank" rel="noopener">\n            <i class="fa fa-group"></i> Careers@ADS\n          </a>\n        </li>\n      </ul>\n    </div>\n    <div class="__footer_list">\n      <div class="__footer_list_title">\n        Social\n      </div>\n      <ul class="__footer_links">\n        <li>\n          <a href="//twitter.com/adsabs" target="_blank" rel="noopener">\n            <i class="fa fa-twitter"></i> @adsabs\n          </a>\n        </li>\n        <li>\n          <a href="//adsabs.github.io/blog/" target="_blank" rel="noopener">\n            <i class="fa fa-newspaper-o"></i> ADS Blog\n          </a>\n        </li>\n      </ul>\n    </div>\n    <div class="__footer_list">\n      <div class="__footer_list_title">\n        Project\n      </div>\n      <ul class="__footer_links">\n        <li>\n          <a href="https://adsisdownorjustme.herokuapp.com/" target="_blank" rel="noopener">Is ADS down? (or is it just me...)</a>\n        </li>\n        <li>\n          <a href="http://adsabs.harvard.edu/mirrors.html" target="_blank" rel="noopener">ADS Mirrors</a>\n        </li>\n        <li>\n          <a href="http://www.si.edu" target="_blank" rel="noopener">Smithsonian Institution</a>\n        </li>\n        <li>\n          <a href="http://www.si.edu/Privacy" target="_blank" rel="noopener">Smithsonian Privacy Notice</a>\n        </li>\n        <li>\n          <a href="http://www.si.edu/Termsofuse" target="_blank" rel="noopener">Smithsonian Terms of Use</a>\n        </li>\n        <li>\n          <a href="http://www.cfa.harvard.edu/sao" target="_blank" rel="noopener">Smithsonian Astrophysical Observatory</a>\n        </li>\n        <li>\n          <a href="http://www.nasa.gov" target="_blank" rel="noopener">NASA</a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</footer>\n'},useData:!0});return t.registerPartial("js/widgets/footer/footer",n),n}),define("js/widgets/footer/widget",["marionette","hbs!js/widgets/footer/footer"],function(e,t){return e.ItemView.extend({template:t,className:"footer s-footer"})}),define("js/wraps/pubtype_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeHierarchicalCheckboxFacet({facetField:"doctype_facet_hier",facetTitle:"Publication Type",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,a=this.queryUpdater.removeTmpEntry(n,"SelectedItems");if(a&&_.keys(a).length>0){a=_.values(a),_.each(a,function(e,t,n){n[t]='doctype:"'+e.title+'"'}),n=n.clone();"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,"fq_doctype","limit",a):"or"==e?this.queryUpdater.updateQuery(n,"fq_doctype","expand",a):"exclude"==e&&(n.get("fq_doctype")?this.queryUpdater.updateQuery(n,"fq_doctype","exclude",a):(a.unshift("*:*"),this.queryUpdater.updateQuery(n,"fq_doctype","exclude",a)));var r="{!type=aqp cache=false cost=150 v=$fq_doctype}",s=n.get("fq");if(s)-1==_.indexOf(s,r)&&s.push(r),n.set("fq",s);else n.set("fq",[r]);n.unset("facet.prefix"),n.unset("facet"),this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:a}))}},n}}),define("hbs!js/widgets/graphics/templates/grid",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a,r;return'    <div class="s-grid-title">\n        <h4 class="s-list-description">Graphics from</h4>\n        <h2 class="s-article-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h2>\n    </div>\n"},3:function(e,t,n,i){var a,r;return'\n<div class="s-grid-container">\n    <p><i>'+(null!=(a="function"==typeof(r=null!=(r=t.linkSentence||(null!=e?e.linkSentence:e))?r:t.helperMissing)?r.call(e,{name:"linkSentence",hash:{},data:i}):r)?a:"")+"</i></p>\n"+(null!=(a=t.each.call(e,null!=e?e.graphics:e,{name:"each",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n\n"},4:function(e,t,n,i){var a,r;return'    <a href="'+this.escapeExpression(this.lambda(null!=e?e.highres:e,e))+'" target="_blank" rel="noopener">\n        <div class="grid-cell">\n'+(null!=(a=t.if.call(e,null!=e?e.interactive:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'            <figure>\n                <img src="'+this.escapeExpression(this.lambda(null!=e?e.thumbnail:e,e))+'" alt="'+this.escapeExpression("function"==typeof(r=null!=(r=t.key||i&&i.key)?r:t.helperMissing)?r.call(e,{name:"key",hash:{},data:i}):r)+'" class="grid-cell__image"/>\n            </figure>\n            <figcaption>\n                '+this.escapeExpression("function"==typeof(r=null!=(r=t.key||i&&i.key)?r:t.helperMissing)?r.call(e,{name:"key",hash:{},data:i}):r)+"\n            </figcaption>\n        </div>\n    </a>\n\n"},5:function(e,t,n,i){return'            <div class="graphics_ribbon--interactive">\n                <span>INTERACTIVE</span>\n            </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.if.call(e,null!=e?e.graphics:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/graphics/templates/grid",n),n}),define("hbs!js/widgets/graphics/templates/sidebar",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'\n  <div class="s-right-col-widget-container">\n    <div class="graphics-container s-graphics-container">\n      <h4 class="s-right-col-widget-title">Graphics</h4>\n      <div class="grid-cell">\n        <img src="'+this.escapeExpression("function"==typeof(a=null!=(a=t.sampleGraphic||(null!=e?e.sampleGraphic:e))?a:t.helperMissing)?a.call(e,{name:"sampleGraphic",hash:{},data:i}):a)+'" alt="figure from paper" class="grid-cell__image" />\n        <p><i>Click to view more</i></p>\n      </div>\n    </div>\n  </div>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.sampleGraphic:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:""},useData:!0});return t.registerPartial("js/widgets/graphics/templates/sidebar",n),n}),define("js/widgets/graphics/widget",["marionette","js/widgets/base/base_widget","js/components/api_request","js/components/api_response","js/components/api_query","hbs!js/widgets/graphics/templates/grid","hbs!js/widgets/graphics/templates/sidebar","js/components/api_targets"],function(e,t,n,i,a,r,s,o){var l=Backbone.Model.extend({defaults:function(){return{graphics:void 0,title:void 0,linkSentence:void 0}}}),c=e.ItemView.extend({template:r,className:"s-graphics-grid",modelEvents:{change:"render"}}),u=e.ItemView.extend({template:s,className:"s-graphics-sidebar graphics-sidebar",modelEvents:{"change:graphics":"render"},triggers:{"click .graphics-container":"showGraphicsGrid"},serializeData:function(){var e=this.model.toJSON().graphics;return e?{sampleGraphic:e[_.keys(e)[0]].thumbnail}:{sampleGraphic:void 0}}});return t.extend({initialize:function(e){e=e||{},this.model=new l,this.view=!0===e.sidebar?new u({model:this.model}):new c({model:this.model}),t.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["processResponse","onDisplayDocuments"]),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},onDisplayDocuments:function(e){var t=e.get("q"),n=this;t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this.loadBibcodeData(t).done(function(){n.trigger("page-manager-event","widget-ready",{isActive:!0,widget:n})}))},loadBibcodeData:function(t){if(t===this._bibcode)return this.deferredObject=$.Deferred(),this.deferredObject.resolve(this.model),this.deferredObject.promise();this._bibcode=t,this.deferredObject=$.Deferred();var i=new n({target:o.GRAPHICS+"/"+this._bibcode,query:new a});if(this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,i),!e.getOption(this,"sidebar")){var r=this.getCurrentQuery().clone();r.unlock(),r.set("q","bibcode:"+t),r.set("fl","title");i=new n({target:o.SEARCH,query:r});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,i)}return this.deferredObject.promise()},processResponse:function(e){if(e instanceof i){var t=e.get("response.docs[0]['title']");t=t&&t.length?t[0]:"",this.model.set("title",t)}else{if(e.toJSON().Error){this.model.clear();var n=e.get("Error");return this.deferredObject.reject(n)}var a={};_.each(e.get("figures"),function(e){a[e.figure_label]=e.images[0],"interactive"===e.figure_type&&(a[e.figure_label].interactive=!0)},this),this.model.set({graphics:a,linkSentence:e.get("header")})}this.deferredObject&&this.model.get("title")&&this.model.get("graphics")&&this.deferredObject.resolve()},viewEvents:{showGraphicsGrid:"triggerShowGrid"},triggerShowGrid:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"ShowGraphics",{href:"/abs/"+this._bibcode+"/graphics"})}})}),define("js/wraps/sidebar-graphics-widget",["js/widgets/graphics/widget"],function(e){var t={sidebar:!0};return function(){return new e(t)}}),define("js/widgets/list_of_things/details_widget",["./widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/papers_utils"],function(e,t,n,i){var a=e.extend({defaultQueryArguments:{fl:"title,bibcode,author,keyword,pub,aff,volume,year,[citations],property,pubdate,abstract,esources,data",rows:25,start:0},initialize:function(t){e.prototype.initialize.call(this,t),this.on("page-manager-message",function(e,t){"broadcast-payload"===e&&this.ingestBroadcastedPayload(t)}),this.listenTo(this.model,"change:bibcode",function(){this.reset()})},activate:function(t){e.prototype.activate.apply(this,[].slice.apply(arguments));var n=t.getService("PubSub");_.bindAll(this,"dispatchRequest","processResponse"),n.subscribe(n.DISPLAY_DOCUMENTS,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse)},ingestBroadcastedPayload:function(e){var t=this;setTimeout(function(){t.model.set("title",e.title)},100)},dispatchRequest:function(t){try{var n=t.get("q")[0].match(/bibcode:(.*)/)[1]}catch(e){return void console.error("was unable to parse the bibcode!")}this.model.set("bibcode",n),e.prototype.dispatchRequest.apply(this,arguments)},customizeQuery:function(){var t=e.prototype.customizeQuery.apply(this,arguments);if(Marionette.getOption(this,"sortOrder")&&t.set("sort",Marionette.getOption(this,"sortOrder")),this.model.get("queryOperator")){var n=this.model.get("queryOperator")+"("+t.get("q").join(" ")+")";"trending"===this.model.get("queryOperator")&&(n+="-"+t.get("q")[0])}else n=t.get("q");return t.set("q",n),t},extractValueFromQuery:function(e,t,n){if(e.has(t))for(var i=e.get(t),a=0;a<i.length;a++){if(i[a].indexOf(n+":")>-1)return i[a].replace(new RegExp(n+":","g"),"").replace(/\\?\"/g,"")}},processDocs:function(e,n,i){var a=this,r=e.get("response").start||i.start||0;_.each(n,function(e,t){n[t]=a.prepareDocForViewing(e)});try{n=this.parseLinksData(n)}catch(e){}return t.addPaginationToDocs(n,r)}});return _.extend(a.prototype,n),_.extend(a.prototype,i),a}),define("js/wraps/references",["js/widgets/list_of_things/details_widget"],function(e){return function(){return new e({queryOperator:"references",sortOrder:"first_author asc",description:"Papers referenced by",operator:!0})}}),define("js/wraps/citations",["js/widgets/list_of_things/details_widget"],function(e){return function(){return new e({queryOperator:"citations",sortOrder:"date desc",description:"Papers which cite",operator:!0})}}),define("js/wraps/coreads",["js/widgets/list_of_things/details_widget"],function(e){return function(){return new e({queryOperator:"trending",description:"Papers also read by those who read",operator:!0,sortOrder:"date desc",removeSelf:!0})}}),define("hbs!js/widgets/meta_tags/template/metatags",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'<meta name="og:description" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.abstract||(null!=e?e.abstract:e))?a:t.helperMissing)?a.call(e,{name:"abstract",hash:{},data:i}):a)+'" data-highwire="true">\n<meta name="twitter:description" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.abstract||(null!=e?e.abstract:e))?a:t.helperMissing)?a.call(e,{name:"abstract",hash:{},data:i}):a)+'" data-highwire="true">\n'},3:function(e,t,n,i){return'<meta name="citation_author" content="'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+'" data-highwire="true">\n<meta xmlns="http://www.w3.org/1999/xhtml" name="citation_author_institution" content="'+this.escapeExpression(this.lambda(null!=e?e.aff:e,e))+'" data-highwire="true">\n'},5:function(e,t,n,i){var a;return'<meta name="citation_firstpage" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.page||(null!=e?e.page:e))?a:t.helperMissing)?a.call(e,{name:"page",hash:{},data:i}):a)+'" data-highwire="true">\n'},7:function(e,t,n,i){var a;return'<meta name="citation_publication_date" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.pubdate||(null!=e?e.pubdate:e))?a:t.helperMissing)?a.call(e,{name:"pubdate",hash:{},data:i}):a)+'" data-highwire="true">\n'},9:function(e,t,n,i){var a;return'<meta name="citation_journal_title" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.pub||(null!=e?e.pub:e))?a:t.helperMissing)?a.call(e,{name:"pub",hash:{},data:i}):a)+'" data-highwire="true">\n'},11:function(e,t,n,i){var a;return'<meta name="citation_volume" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.volume||(null!=e?e.volume:e))?a:t.helperMissing)?a.call(e,{name:"volume",hash:{},data:i}):a)+'" data-highwire="true">\n'},13:function(e,t,n,i){var a;return'<meta name="citation_issue" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.issue||(null!=e?e.issue:e))?a:t.helperMissing)?a.call(e,{name:"issue",hash:{},data:i}):a)+'" data-highwire="true">\n'},15:function(e,t,n,i){var a;return'<meta name="citation_doi" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.doi||(null!=e?e.doi:e))?a:t.helperMissing)?a.call(e,{name:"doi",hash:{},data:i}):a)+'" data-highwire="true">\n'},17:function(e,t,n,i){var a;return'<meta name="citation_issn" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.issn||(null!=e?e.issn:e))?a:t.helperMissing)?a.call(e,{name:"issn",hash:{},data:i}):a)+'" data-highwire="true">\n'},19:function(e,t,n,i){return'<meta name="citation_keywords" content="'+this.escapeExpression(this.lambda(e,e))+'" data-highwire="true">\n'},21:function(e,t,n,i){var a;return'<meta name="citation_pdf_url" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.pdfUrl||(null!=e?e.pdfUrl:e))?a:t.helperMissing)?a.call(e,{name:"pdfUrl",hash:{},data:i}):a)+'" data-highwire="true">\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'<meta name="og:type" content="article" data-highwire="true">\n<meta name="twitter:card" content="summary" data-highwire="true">\n\n<meta name="citation_title" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'" data-highwire="true">\n<meta name="og:title" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'" data-highwire="true">\n<meta name="twitter:title" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'" data-highwire="true">\n\n<meta name="og:url" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.url||(null!=e?e.url:e))?r:t.helperMissing)?r.call(e,{name:"url",hash:{},data:i}):r)+'" data-highwire="true">\n<meta name="twitter:url" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.url||(null!=e?e.url:e))?r:t.helperMissing)?r.call(e,{name:"url",hash:{},data:i}):r)+'" data-highwire="true">\n<meta name="citation_abstract_html_url" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.url||(null!=e?e.url:e))?r:t.helperMissing)?r.call(e,{name:"url",hash:{},data:i}):r)+'" data-highwire="true">\n\n<meta name="og:image" content="https://ui.adsabs.harvard.edu/styles/img/transparent_logo.svg" data-highwire="true">\n<meta name="twitter:image" content="https://ui.adsabs.harvard.edu/styles/img/transparent_logo.svg" data-highwire="true">\n\n'+(null!=(a=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.each.call(e,null!=e?e.author:e,{name:"each",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.page:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.pubdate:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.pub:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.volume:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.issue:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.doi:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.issn:e,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.each.call(e,null!=e?e.keyword:e,{name:"each",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.pdfUrl:e,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.noop,data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/meta_tags/template/metatags",n),n}),define("js/widgets/meta_tags/widget",["jquery","backbone","underscore","js/widgets/base/base_widget","hbs!js/widgets/meta_tags/template/metatags","js/mixins/link_generator_mixin"],function(e,t,n,i,a,r){var s=t.View.extend({destroy:function(){this.remove()}}),o=i.extend({initialize:function(e){this.options=e||{},this.view=new s},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");n.bindAll(this,["onDisplayDocuments","processResponse"]),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments)},processResponse:function(e){var t=e.get("response.docs[0]");this.updateMetaTags(t)},getCachedDoc:function(e){var t=this.defaultQueryArguments.fl.split(","),i=this.getBeeHive().getObject("DocStashController").getDocs().filter(function(t){return t.bibcode===e});if(i.length){var a={issn:void 0,isbn:void 0};i.unshift(a),i=n.merge.apply(n,i);for(var r=Object.keys(i),s=0;s<t.length;s++)if(-1===r.indexOf(t[s]))return null;return i}return null},onDisplayDocuments:function(e){var t=e.get("q");t&&/bibcode:/.test(t[0])&&(t=t[0].replace(/bibcode:/,""));var n=this.getCachedDoc(t);if(n)return this.updateMetaTags(n);this.dispatchRequest(e.clone())},updateMetaTags:function(i){i.url=t.history.location.href;var r={};try{r=this.parseResourcesData(i)}catch(e){}if(n.isArray(r.fullTextSources)&&r.fullTextSources.length>0){var s=n.find(r.fullTextSources,function(e){return/PDF/.test(e.name)});s&&(i.pdfUrl=s.url)}n.isArray(i.doi)&&i.doi.length>0&&(i.doi=i.doi[0]),i.aff&&i.author&&(i.author=n.map(i.author,function(e,t){return{name:e,aff:i.aff[t]}})),e("head").append(function(){return e(a(i)).filter(function(){var t=e(this).attr("name");return!t||!e('head>meta[name="'+t+'"]').length})}),this.emitDOMEvents()},emitDOMEvents:function(){n.forEach(["ZoteroItemUpdated","ADSPageLoaded"],function(e){window.document.dispatchEvent(new Event(e),{bubbles:!0,cancelable:!0})})},defaultQueryArguments:{fl:"links_data,[citations],keyword,property,first_author,year,issn,isbn,title,aff,abstract,bibcode,pub,volume,author,issue,pubdate,doi,page,esources,data",rows:1}});return n.extend(o.prototype,r),o}),define("js/wraps/table_of_contents",["underscore","js/widgets/list_of_things/details_widget"],function(e,t){var n=t.extend({customizeQuery:function(n){var i=this.extractValueFromQuery(n,"q","bibcode");if(i){var a=t.prototype.customizeQuery.apply(this,arguments);return"E"==i[13]?a.set("q","bibcode:"+e.first(i,14).join("")+"*"):a.set("q","bibcode:"+e.first(i,13).join("")+"*"),this.sortOrder&&a.set("sort",this.sortOrder),this.queryOperator&&a.set("q",this.queryOperator+"("+a.get("q").join(" ")+")"),a}}});return function(){return new n({description:"Papers in the same volume as"})}});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};define("es6!js/widgets/resources/redux/modules/api",[],function(){var e={QUERY_PROVIDED:"[api] QUERY_PROVIDED",RECEIVED_RESPONSE:"[api] RECEIVED_RESPONSE",CURRENT_QUERY_UPDATED:"[api] CURRENT_QUERY_UPDATED",FETCH_DATA:"[api] FETCH_DATA",FETCHING_DATA:"[api] FETCHING_DATA",SET_LINK_SERVER:"[api] SET_LINK_SERVER",SEND_ANALYTICS:"[api] SEND_ANALYTICS"},t={linkServer:null};return{reducer:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments[1];switch(i.type){case e.SET_LINK_SERVER:return _extends({},n,{linkServer:i.result});default:return n}},initialState:t,actions:e,displayDocuments:function(t){return{type:e.QUERY_PROVIDED,result:t}},processResponse:function(t){return{type:e.RECEIVED_RESPONSE,result:t}},setLinkServer:function(t){return{type:e.SET_LINK_SERVER,result:t}}}});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};define("es6!js/widgets/resources/redux/modules/ui",[],function(){var e={LINK_CLICKED:"[ui] LINK_CLICKED",SET_LOADING:"[ui] SET_LOADING",SET_HAS_ERROR:"[ui] SET_HAS_ERROR",SET_NO_RESULTS:"[ui] SET_NO_RESULTS",SET_FULL_TEXT_SOURCES:"[ui] SET_FULL_TEXT_SOURCES",SET_DATA_PRODUCTS:"[ui] SET_DATA_PRODUCTS"},t={loading:!0,hasError:!1,noResults:!1,fullTextSources:[],dataProducts:[]};return{reducer:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments[1];switch(i.type){case e.SET_LOADING:return _extends({},n,{loading:i.result});case e.SET_NO_RESULTS:return _extends({},n,{noResults:i.result});case e.SET_FULL_TEXT_SOURCES:return _extends({},n,{fullTextSources:i.result});case e.SET_DATA_PRODUCTS:return _extends({},n,{dataProducts:i.result});case e.SET_HAS_ERROR:return _extends({},t,{hasError:i.result,noResults:!0,loading:!1});default:return n}},initialState:t,actions:e,handleLinkClick:function(t){return{type:e.LINK_CLICKED,result:t}},setError:function(t){return{type:e.SET_HAS_ERROR,result:t}}}}),define("es6!js/widgets/resources/redux/middleware/api",["underscore","es6!../modules/api","es6!../modules/ui"],function(e,t,n){var i=t.actions,a=i.QUERY_PROVIDED,r=i.RECEIVED_RESPONSE,s=i.CURRENT_QUERY_UPDATED,o=i.FETCH_DATA,l=i.FETCHING_DATA,c=i.SEND_ANALYTICS,u=n.actions,d=u.SET_LOADING,h=u.SET_NO_RESULTS,p=u.SET_HAS_ERROR,f=u.SET_FULL_TEXT_SOURCES,g=u.SET_DATA_PRODUCTS;u.LINK_CLICKED;return function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return function(t){return n.map(function(n){return e.partial(n,t)})}}(function(t,n){var i=n.dispatch;return function(n){return function(r){if(n(r),r.type===a){var l=r.result;if(i({type:d,result:!0}),i({type:s,result:l}),e.isPlainObject(l)){var c=l.q;e.isArray(c)&&c.length>0?/^bibcode:/.test(c[0])?(c=c[0].split(":")[1],i({type:o,result:c}),t.trigger("page-manager-event","widget-ready",{isActive:!0})):i({type:p,result:"unable to parse bibcode from query"}):i({type:p,result:"did not receive a bibcode in query"})}else i({type:p,result:"query is not a plain object"})}}}},function(t,n){var i=n.dispatch,a=n.getState;return function(n){return function(s){if(n(s),s.type===r){var o=a().api.linkServer,l=s.result;if(e.isPlainObject(l)){var c=l.response&&l.response.docs;if(e.isArray(c)&&c.length>0){e.isString(o)&&(c[0].link_server=o);var u=void 0;try{u=t.parseResourcesData(c[0])}catch(e){return i({type:p,result:"unable to parse resource data"})}if(u.fullTextSources.length>0){var m=(b=u.fullTextSources,v=["PDF","HTML","SCAN"],e(b).sortBy(function(e){return v.indexOf(e.type)}).groupBy("shortName").value());i({type:f,result:m})}u.dataProducts.length>0&&i({type:g,result:u.dataProducts}),0===u.dataProducts.length&&0===u.fullTextSources.length&&i({type:h,result:!0}),i({type:d,result:!1})}else i({type:p,result:"did not receive docs"})}else i({type:p,result:"did not receive docs"})}var b,v}}},function(e,t){var n=t.dispatch;return function(t){return function(i){if(t(i),i.type===o){var a={q:"bibcode:"+i.result};n({type:l,result:a}),n({type:d,result:!0}),e.dispatchRequest(a)}}}},function(e,t){t.dispatch,t.getState;return function(t){return function(n){t(n),n.type===c&&e.emitAnalytics(n.result)}}})}),define("es6!js/widgets/resources/redux/middleware/ui",["es6!../modules/api","es6!../modules/ui"],function(e,t){var n=t.actions.LINK_CLICKED,i=e.actions.SEND_ANALYTICS;return[function(e){var t=e.dispatch;return function(e){return function(a){e(a),a.type===n&&t({type:i,result:a.result.name})}}}]}),define("es6!js/widgets/resources/redux/configure-store",["redux","es6!./modules/api","es6!./modules/ui","es6!./middleware/api","es6!./middleware/ui"],function(e,t,n,i,a){var r=e.createStore,s=e.applyMiddleware,o=e.combineReducers;return function(l){var c=s.apply(e,[].concat(a,i(l))),u=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||e.compose,d=o({api:t.reducer,ui:n.reducer});return r(d,u(c))}}),define("es6!js/widgets/resources/components/app.jsx",["underscore","react","react-prop-types"],function(e,t,n){var i=function(){return t.createElement("h3",{className:"s-right-col-widget-title"},"No Sources Found")},a=function(){return t.createElement("div",{className:"text-center text-muted"},t.createElement("i",{className:"fa fa-spinner fa-spin fa-2x","aria-hidden":"true"}),t.createElement("span",{className:"sr-only"},"Loading"))},r=function(n){var i=n.items,a=n.onClick;return t.createElement("div",{className:"resources__full__list"},t.createElement("div",{className:"resources__header__row"},t.createElement("i",{className:"fa fa-file-text-o","aria-hidden":"true"}),t.createElement("div",{className:"resources__header__title"},"full text sources")),e.map(i,function(n,i){return t.createElement("div",{className:"resources__content",key:i},t.createElement("div",{className:"resources__content__title"},i),t.createElement("div",{className:"resources__content__links"},e.map(n,function(e,i){return t.createElement("span",null,t.createElement("a",{href:e.url,target:"_blank",rel:"noopener",onClick:function(){return a(e)},title:e.description+" "+(e.open?"OPEN ACCESS":"SIGN IN REQUIRED"),className:"resources__content__link "+(e.open?"unlock":"")},"PDF"===e.type&&t.createElement("i",{className:"fa fa-file-pdf-o","aria-hidden":"true"}),"HTML"===e.type&&t.createElement("i",{className:"fa fa-file-text","aria-hidden":"true"}),"SCAN"===e.type&&t.createElement("i",{className:"fa fa-file-image-o","aria-hidden":"true"}),"INSTITUTION"===e.type&&t.createElement("i",{className:"fa fa-university","aria-hidden":"true"})),i<n.length-1&&t.createElement("div",{className:"resources__content__link__separator"},"|"))})))}))};r.propTypes={items:n.array,onClick:n.func},r.defaultProps={items:[],onClick:function(){}};var s=function(n){var i=n.items,a=n.onClick;return t.createElement("div",{className:"resources__data__list"},t.createElement("div",{className:"resources__header__row"},t.createElement("i",{className:"fa fa-database"}),t.createElement("div",{className:"resources__header__title"},"data products")),t.createElement("div",{className:"resources__content"},e.map(i,function(e){return t.createElement("a",{href:e.url,target:"_blank",rel:"noopener",onClick:function(){return a(e)},title:e.description,className:"resources__content__link"},e.name," (",e.count,")")})))};s.propTypes={items:n.array,onClick:n.func},s.defaultProps={items:[],onClick:function(){}};var o=function(n){return t.createElement("div",{className:"s-right-col-widget-container",style:{padding:10}},n.loading&&t.createElement(a,null),n.noResults&&!n.loading&&t.createElement(i,null),!n.loading&&!n.hasError&&t.createElement("div",{className:"resources__container"},!e.isEmpty(n.fullTextSources)&&t.createElement(r,{items:n.fullTextSources,onClick:n.onLinkClick}),!e.isEmpty(n.dataProducts)&&t.createElement(s,{items:n.dataProducts,onClick:n.onLinkClick})))};return o.propTypes={loading:n.bool,noResults:n.bool,fullTextSources:n.array,dataProducts:n.array,onLinkClick:n.func,hasError:n.string},o.defaultProps={loading:!1,noResults:!1,fullTextSources:[],dataProducts:[],onLinkClick:function(){},hasError:null},o}),define("es6!js/widgets/resources/containers/app",["underscore","react-redux","es6!../redux/modules/ui","es6!../components/app.jsx"],function(e,t,n,i){var a=n.handleLinkClick;n.handleResetClick;return t.connect(function(e){return{loading:e.ui.loading,noResults:e.ui.noResults,hasError:e.ui.hasError,fullTextSources:e.ui.fullTextSources,dataProducts:e.ui.dataProducts}},function(e){return{onLinkClick:function(t){return e(a(t))}}})(i)}),define("es6!js/widgets/resources/widget.jsx",["underscore","backbone","react","react-dom","react-redux","analytics","js/components/api_query","js/widgets/base/base_widget","js/mixins/link_generator_mixin","es6!./redux/configure-store","es6!./redux/modules/api","es6!./redux/modules/ui","es6!./containers/app"],function(e,t,n,i,a,r,s,o,l,c,u,d,h){var p=t.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return i.render(n.createElement(a.Provider,{store:this.store},n.createElement(h,null)),this.el),this},destroy:function(){i.unmountComponentAtNode(this.el)}}),f=o.extend({initialize:function(){this.store=c(this),this.view=new p({store:this.store})},defaultQueryArguments:{fl:"bibcode,data,doctype,doi,esources,first_author,genre,isbn,issn,issue,page,property,pub,title,volume,year,links_data"},activate:function(t){var n=this.store.dispatch;this.setBeeHive(t),this.activateWidget();var i=this.getPubSub();i.subscribe(i.DISPLAY_DOCUMENTS,function(t){t&&e.isFunction(t.toJSON)?n(u.displayDocuments(t.toJSON())):n(d.setError("did not receive query"))}),i.subscribe(i.DELIVERING_RESPONSE,function(t){t&&e.isFunction(t.toJSON)?n(u.processResponse(t.toJSON())):n(d.setError("did not receive response from server"))}),this.attachGeneralHandler(this.onApiFeedback),this._updateLinkServer()},_updateLinkServer:function(){var t=this.store.dispatch,n=this.getBeeHive();if(e.isPlainObject(n)){var i=n.getObject("User");if(e.isPlainObject(i)&&i.getUserData){var a=i.getUserData();e.isString(a.link_server)&&t(u.setLinkServer(a.link_server))}}},dispatchRequest:function(e){var t=new s(e);o.prototype.dispatchRequest.call(this,t)},emitAnalytics:function(e){r("send","event","interaction","full-text-link-followed",e)},onApiFeedback:function(t){var n=this.store.dispatch;e.isPlainObject(t.error)&&n(d.setError(t.error))}});return e.extend(f.prototype,l),f});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};define("es6!js/widgets/associated/redux/modules/api",[],function(){var e={CURRENT_QUERY_UPDATED:"[api] CURRENT_QUERY_UPDATED",FETCH_DATA:"[api] FETCH_DATA",FETCHING_DATA:"[api] FETCHING_DATA",QUERY_PROVIDED:"[api] QUERY_PROVIDED",RECEIVED_RESPONSE:"[api] RECEIVED_RESPONSE",SEND_ANALYTICS:"[api] SEND_ANALYTICS",SET_BIBCODE:"[api] SET_BIBCODE"},t={bibcode:null};return{reducer:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments[1];switch(i.type){case e.SET_BIBCODE:return _extends({},n,{bibcode:i.result});default:return n}},initialState:t,actions:e,displayDocuments:function(t){return{type:e.QUERY_PROVIDED,result:t}},processResponse:function(t){return{type:e.RECEIVED_RESPONSE,result:t}}}});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}define("es6!js/widgets/associated/redux/modules/ui",[],function(){var e={LINK_CLICKED:"[ui] LINK_CLICKED",SET_LOADING:"[ui] SET_LOADING",SET_ITEMS:"[ui] SET_ITEMS",SET_HAS_ERROR:"[ui] SET_HAS_ERROR"},t={loading:!0,items:[],hasError:!1};return{reducer:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments[1];switch(i.type){case e.SET_LOADING:return _extends({},n,{loading:i.result});case e.SET_ITEMS:return _extends({},n,{items:i.result});case e.SET_HAS_ERROR:return _extends({},n,{hasError:i.result,loading:!1});default:return n}},initialState:t,actions:e,handleLinkClick:function(t){return{type:e.LINK_CLICKED,result:t}},setError:function(t){return{type:e.SET_HAS_ERROR,result:t}}}}),define("es6!js/widgets/associated/redux/middleware/api",["underscore","es6!../modules/api","es6!../modules/ui"],function(e,t,n){var i=t.actions,a=i.QUERY_PROVIDED,r=i.RECEIVED_RESPONSE,s=i.CURRENT_QUERY_UPDATED,o=i.FETCH_DATA,l=i.FETCHING_DATA,c=i.SEND_ANALYTICS,u=i.SET_BIBCODE,d=n.actions,h=d.SET_LOADING,p=d.SET_HAS_ERROR,f=d.SET_ITEMS,g=function(t,n){return e.map(t,function(t){var i=function(e){try{return decodeURIComponent(e.slice(e.indexOf(":")+1))}catch(t){return e}}(t.url);return{rawUrl:t.url,url:i,circular:i.indexOf(n)>-1,name:t.title,id:e.uniqueId()}})};return function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return function(t){return n.map(function(n){return e.partial(n,t)})}}(function(t,n){var i=n.dispatch;return function(t){return function(n){if(t(n),n.type===a){var r=n.result;if(i({type:h,result:!0}),i({type:s,result:r}),e.isPlainObject(r)){var l=r.q;e.isArray(l)&&l.length>0?/^bibcode:/.test(l[0])?(l=l[0].split(":")[1],i({type:u,result:l}),i({type:o,result:l})):i({type:p,result:"unable to parse bibcode from query"}):i({type:p,result:"did not receive a bibcode in query"})}else i({type:p,result:"query is not a plain object"})}}}},function(t,n){var i=n.dispatch,a=n.getState;return function(t){return function(n){if(t(n),n.type===r){var s=n.result,o=a().api.bibcode;if(e.isPlainObject(s)){var l=s.links&&s.links.records;e.isArray(l)&&l.length>0?(i({type:h,result:!1}),i({type:f,result:g(l,o)})):i({type:p,result:"did not receive docs"})}else i({type:p,result:"did not receive docs"})}}}},function(e,t){var n=t.dispatch;return function(t){return function(i){if(t(i),i.type===o){var a={q:"bibcode:"+i.result};n({type:l,result:a}),n({type:h,result:!0}),e.dispatchRequest(a)}}}},function(e,t){t.dispatch,t.getState;return function(t){return function(n){t(n),n.type===c&&e.emitAnalytics(n.result)}}})}),define("es6!js/widgets/associated/redux/middleware/ui",["es6!../modules/api","es6!../modules/ui"],function(e,t){var n=t.actions.LINK_CLICKED,i=e.actions.SEND_ANALYTICS;return[function(e){var t=e.dispatch;return function(e){return function(a){e(a),a.type===n&&t({type:i,result:a.result})}}}]}),define("es6!js/widgets/associated/redux/configure-store",["redux","es6!./modules/api","es6!./modules/ui","es6!./middleware/api","es6!./middleware/ui"],function(e,t,n,i,a){var r=e.createStore,s=e.applyMiddleware,o=e.combineReducers;return function(l){var c=s.apply(e,[].concat(a,i(l))),u=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||e.compose,d=o({api:t.reducer,ui:n.reducer});return r(d,u(c))}}),define("es6!js/widgets/associated/components/app.jsx",["underscore","react","react-prop-types"],function(e,t,n){var i={title:{fontSize:"1.1em",color:"#335baf",textTransform:"uppercase"},list:{listStyleType:"none",marginLeft:"-10px",padding:"0"},link:{fontSize:"1em"},icon:{fontSize:"1.4em","padding-right":"5px"}},a=function(e){var n=e.children;return t.createElement("div",{style:i.title},t.createElement("i",{className:"fa fa-folder-open",style:i.icon}),n)},r=function(e){var n=e.items,a=e.onClick;return t.createElement("ul",{style:i.list},n.map(function(e){return t.createElement("li",{key:e.id,style:i.link},e.circular?e.name:t.createElement("a",{href:e.url,onClick:function(t){return a(e)}},e.name))}))},s=function(e){var n=e.children;return t.createElement("div",{className:"s-right-col-widget-container",style:{padding:10}},n)},o=function(e){var n=e.onClick;return t.createElement("button",{className:"btn btn-default btn-xs",onClick:function(e){return n()}},"Show All")},l=function(e){function n(t){_classCallCheck(this,n);var i=_possibleConstructorReturn(this,e.call(this,t));return i.state={showAllBtn:!1,items:[]},i}return _inherits(n,e),n.prototype.onShowAll=function(){this.setState({showAllBtn:!1,items:this.props.items})},n.prototype.componentWillReceiveProps=function(e){e.items.length>4?this.setState({items:e.items.slice(0,4),showAllBtn:!0}):this.setState({items:e.items})},n.prototype.render=function(){var e=this,n=this.props,i=(n.loading,n.handleLinkClick),l=(n.hasError,this.state),c=l.items,u=l.showAllBtn;return c.length>0?t.createElement(s,null,t.createElement(a,null,"Associated Works (",this.props.items.length,")"),t.createElement(r,{items:c,onClick:i}),u&&t.createElement(o,{onClick:function(t){return e.onShowAll()}})):null},n}(t.Component);return l.propTypes={hasError:n.bool,items:n.array,loading:n.bool,handleLinkClick:n.func},l.defaultProps={hasError:!1,items:[],loading:!1,handleLinkClick:function(){}},l}),define("es6!js/widgets/associated/containers/app",["underscore","react-redux","es6!../redux/modules/ui","es6!../components/app.jsx"],function(e,t,n,i){var a=n.handleLinkClick;return t.connect(function(e){return{loading:e.ui.loading,items:e.ui.items,hasError:e.ui.hasError}},function(e){return{handleLinkClick:function(t){return e(a(t))}}})(i)}),define("es6!js/widgets/associated/widget.jsx",["underscore","backbone","react","react-dom","react-redux","analytics","js/components/api_query","js/components/api_request","js/components/api_targets","js/widgets/base/base_widget","es6!./redux/configure-store","es6!./redux/modules/api","es6!./redux/modules/ui","es6!./containers/app"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p){var f=t.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return i.render(n.createElement(a.Provider,{store:this.store},n.createElement(p,null)),this.el),this},destroy:function(){i.unmountComponentAtNode(this.el)}});return c.extend({initialize:function(){this.store=u(this),this.view=new f({store:this.store})},defaultQueryArguments:{},activate:function(t){var n=this.store.dispatch;this.setBeeHive(t),this.activateWidget(),this.attachGeneralHandler(this.onApiFeedback);var i=this.getPubSub();i.subscribe(i.DISPLAY_DOCUMENTS,function(t){t&&e.isFunction(t.toJSON)?n(d.displayDocuments(t.toJSON())):n(h.setError("did not receive query"))}),i.subscribe(i.DELIVERING_RESPONSE,function(t){t&&e.isFunction(t.toJSON)?n(d.processResponse(t.toJSON())):n(h.setError("did not receive response from server"))})},dispatchRequest:function(e){var t=new s(e);c.prototype.dispatchRequest.call(this,t)},composeRequest:function(e){var t=this.store.getState().api.bibcode;return new o({target:l.RESOLVER+"/"+t+"/associated",query:new s})},emitAnalytics:function(e){r("send","event","interaction","associated-link-followed",{target:"associated",url:e.rawUrl})},onApiFeedback:function(t){var n=this.store.dispatch;e.isPlainObject(t.error)&&n(h.setError(t.error))}})}),define("hbs!js/widgets/recommender/templates/recommender_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'<div class="s-right-col-widget-container">\n\n<div>\n    <i class="icon-help pull-right" style="margin-top:7px" data-toggle="popover" data-placement="left" data-content="These recommendations are based on a number of factors, including text similarity, citations, and co-readership information. This feature is still in beta." data-container=".recommender-widget"></i>\n    <h4 class="s-right-col-widget-title">Suggested Articles</h4>\n</div>\n\n\n<ul class="list-unstyled">\n\n'+(null!=(a=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'    <button class="btn btn-xs btn-default button-toggle">more</button>\n</ul>\n\n'},2:function(e,t,n,i){var a;return null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,i&&i.index,0,{name:"compare",hash:{operator:"<="},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:""},3:function(e,t,n,i){var a;return'        <div>\n            <li>\n                <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'">'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+' (<i class="s-author">'+this.escapeExpression("function"==typeof(a=null!=(a=t.author||(null!=e?e.author:e))?a:t.helperMissing)?a.call(e,{name:"author",hash:{},data:i}):a)+"</i>)</a>;\n            </li>\n        </div>\n"},5:function(e,t,n,i){var a;return null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,i&&i.index,0,{name:"compare",hash:{operator:">"},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:""},6:function(e,t,n,i){var a;return'        <div class="hidden additional-papers">\n            <li>\n                <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'">'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+' (<i class="s-author">'+this.escapeExpression("function"==typeof(a=null!=(a=t.author||(null!=e?e.author:e))?a:t.helperMissing)?a.call(e,{name:"author",hash:{},data:i}):a)+"</i>)</a>;\n            </li>\n        </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return(null!=(a=t.if.call(e,null!=e?e.items:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"</div>"},useData:!0});return t.registerPartial("js/widgets/recommender/templates/recommender_template",n),n}),define("js/widgets/recommender/widget",["marionette","js/components/api_query","js/components/api_targets","js/components/api_request","js/widgets/base/base_widget","hbs!js/widgets/recommender/templates/recommender_template","bootstrap","analytics"],function(e,t,n,i,a,r,s){var o=e.ItemView.extend({initialize:function(){this.listenTo(this.collection,"reset",this.render)},template:r,events:{"click .button-toggle":"toggleList","click a":"emitAnalyticsEvent"},emitAnalyticsEvent:function(e){s("send","event","interaction","suggested-article-link-followed")},toggleList:function(){this.$(".additional-papers").toggleClass("hidden"),this.$(".additional-papers").hasClass("hidden")?this.$(".button-toggle").text("more"):this.$(".button-toggle").text("less")},onRender:function(){this.$(".icon-help").popover({trigger:"hover"})},className:"recommender-widget s-recommender-widget"});return a.extend({initialize:function(){this.collection=new Backbone.Collection,this.view=new o({collection:this.collection})},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["processResponse","onDisplayDocuments"]),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},onDisplayDocuments:function(e){var t=e.get("q");t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this.loadBibcodeData(t))},loadBibcodeData:function(e){if(e===this._bibcode)this.trigger("page-manager-event","widget-ready",{isActive:!0});else{this.collection.reset(),this._bibcode=e;var t=n.RECOMMENDER+"/"+e,a=new i({target:t});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,a)}},processResponse:function(e){(e=e.toJSON()).recommendations?(this.collection.reset(e.recommendations),this.trigger("page-manager-event","widget-ready",{isActive:!0})):e.Error&&e.Error}})}),define("js/wraps/paper_metrics",["js/widgets/metrics/widget","js/components/api_feedback"],function(e,t){return e.extend({initialize:function(t){this.on("page-manager-message",function(e,t){"broadcast-payload"===e&&this.ingestBroadcastedPayload(t)}),e.prototype.initialize.apply(this,arguments)},ingestBroadcastedPayload:function(e){var t=e.bibcode,n=this;this.containerModel.set("title",e.title),this.getMetrics([t]).done(function(){n.trigger("page-manager-event","widget-ready",{isActive:!0,widget:n}),n._waiting&&(n.onShow(),n._waiting=!1)}).fail(function(){n.trigger("page-manager-event","widget-ready",{isActive:!1,widget:n}),n.destroy()})},onShow:function(){var e=this.containerModel.get("data");e?(this.createTableViews(e,1),this.createGraphViewsForOnePaper(e),this.insertViewsForOnePaper(e)):this._waiting=!0}})}),define("js/wraps/paper_export",["es6!js/widgets/export/widget.jsx","js/components/api_query","js/components/json_response"],function(e,t,n){return e.extend({initialize:function(t){this.on("page-manager-message",function(e,t){"broadcast-payload"===e&&this.ingestBroadcastedPayload(t)}),e.prototype.initialize.call(this,t)},activate:function(t){this.setBeeHive(t),_.bindAll(this,"setCurrentQuery","processResponse");var n=this.getPubSub();n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),e.prototype.activate.call(this,t)},ingestBroadcastedPayload:function(e){e.bibcode&&(this.bibcode=e.bibcode)},setSubView:function(e){this.renderWidgetForListOfBibcodes([this.bibcode],{format:e})}})}),define("hbs!js/wraps/abstract_page_library_add/template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i,a,r){var s,o;return'<div class="s-library-area">\n    <div class="s-library-add-title library-add-title"  type="button" data-toggle="collapse" data-target="#library-console" aria-expanded="false" aria-controls="collapseExample">\n        <i class="fa fa-book fa-lg"></i> Add paper to a library &nbsp; <i class="fa fa-lg fa-caret-down"></i>\n    </div>\n    <div class="collapse '+(null!=(s=t.if.call(e,null!=e?e.libraryDrawerOpen:e,{name:"if",hash:{},fn:this.program(2,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'" id="library-console">\n\n        <div class="libraries-container">\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(4,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'\n            <label for="#create-new">create a new library </label>\n            <input id="#create-new" class="form-control input-sm new-library-name s-display-inline" type="text" name="new-library-name" placeholder="New Library Name" value="'+this.escapeExpression("function"==typeof(o=null!=(o=t.newLibraryName||(null!=e?e.newLibraryName:e))?o:t.helperMissing)?o.call(e,{name:"newLibraryName",hash:{},data:i}):o)+'" style="max-width:188px"/>\n            <button class="btn btn-sm btn-success submit-create-library"></i>submit</button>\n\n        </div>\n\n        <div style="margin-top:6px" class="feedback s-feedback">\n\n        </div>\n\n    </div>\n\n'+(null!=(s=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(8,i,0,a,r),inverse:this.noop,data:i}))?s:"")+"\n    \x3c!--end 'library area' if user is signed in--\x3e\n</div>\n"},2:function(e,t,n,i){return" in "},4:function(e,t,n,i,a,r){var s;return'            <div style="margin-top: 8px" class="">\n                <label for="#library-select">add to an existing library:</label>\n                <select id="library-select" name="library-select" class="form-control input-sm s-library-select">\n'+(null!=(s=t.each.call(e,null!=e?e.libraries:e,{name:"each",hash:{},fn:this.program(5,i,0,a,r),inverse:this.noop,data:i}))?s:"")+'                </select>\n                <button class="btn btn-sm btn-success submit-add-to-library">submit</button>\n            </div>\n            <div style="margin:10px 0 4px 0">\n                OR\n            </div>\n'},5:function(e,t,n,i,a,r){var s;return'                    <option value="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.id:e,null!=r[1]?r[1].selectedLibrary:r[1],{name:"compare",hash:{},fn:this.program(6,i,0,a,r),inverse:this.noop,data:i}))?s:"")+">"+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</option>\n"},6:function(e,t,n,i){return' selected="true" '},8:function(e,t,n,i){var a;return"\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.success:a,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.program(15,i,0),data:i}))?a:"")+"\n"},9:function(e,t,n,i){var a;return'\n    <div class="alert alert-success alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.create:a,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.program(12,i,0),data:i}))?a:"")+"    </div>\n\n"},10:function(e,t,n,i){var a;return'        <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.id:a,e))+'"> Library <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b></a> was successfully created and "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+" new record was added.\n"},12:function(e,t,n,i){var a;return"        "+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numRecords:a,e))+' new record was added to  <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.id:a,e))+'"> library <b>'+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b></a>.\n"+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.numAlreadyInLib:a,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?a:"")},13:function(e,t,n,i){var a;return"        ("+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.numAlreadyInLib:a,e))+" was already in the library).\n"},15:function(e,t,n,i){var a;return'\n    <div class="alert alert-danger alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.feedback:e)?a.create:a,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.program(18,i,0),data:i}))?a:"")+"    </div>\n\n"},16:function(e,t,n,i){var a;return"        <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b> was not created, error occured.\n        <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n"},18:function(e,t,n,i){var a;return"        Record was not added to <b>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.name:a,e))+"</b>, error occurred.\n        <em>"+this.escapeExpression(this.lambda(null!=(a=null!=e?e.feedback:e)?a.error:a,e))+"</em>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,a,r){var s;return null!=(s=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0,a,r),inverse:this.noop,data:i}))?s:""},useData:!0,useDepths:!0});return t.registerPartial("js/wraps/abstract_page_library_add/template",n),n}),define("js/wraps/abstract_page_library_add/widget",["js/widgets/query_info/query_info_widget","js/widgets/base/base_widget","hbs!js/wraps/abstract_page_library_add/template"],function(e,t,n){return e.extend({abstractPage:!0,initialize:function(e){e=e||{},this.model=new this.modelConstructor,this.view=new this.viewConstructor({model:this.model,template:n}),t.prototype.initialize.call(this,e)},activate:function(e){this.setBeeHive(e),_.bindAll(this);var t=this,n=this.getPubSub();if(n.subscribe(n.LIBRARY_CHANGE,this.processLibraryInfo),n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),n.subscribe(n.DISPLAY_DOCUMENTS,this.onDisplayDocuments),this.getBeeHive().getObject("User").isLoggedIn()){this.model.set("loggedIn",!0);this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.processLibraryInfo(e)})}},onDisplayDocuments:function(e){var t=e.get("q");t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this._bibcode=t)}})}),define("hbs!js/widgets/library_individual/templates/library-header",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a,r;return"\n"+(null!=(a=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+'\n    <div class="s-library-title">\n        <h2>'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+'</h2>\n    </div>\n    <div class="s-library-description">\n        <p>\n            '+this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)+'\n        </p>\n    </div>\n\n    \x3c!-- library info/admin drawer--\x3e\n    <div class="s-library-info">\n        <div class="col-sm-3"><h5>Number of Papers:</h5>'+this.escapeExpression("function"==typeof(r=null!=(r=t.num_documents||(null!=e?e.num_documents:e))?r:t.helperMissing)?r.call(e,{name:"num_documents",hash:{},data:i}):r)+'</div>\n        <div class="col-sm-3"><h5>Date Created:</h5><span>'+this.escapeExpression("function"==typeof(r=null!=(r=t.date_created||(null!=e?e.date_created:e))?r:t.helperMissing)?r.call(e,{name:"date_created",hash:{},data:i}):r)+'</span></div>\n        <div class="col-sm-3"> <h5>Date Last Modified:</h5>'+this.escapeExpression("function"==typeof(r=null!=(r=t.date_last_modified||(null!=e?e.date_last_modified:e))?r:t.helperMissing)?r.call(e,{name:"date_last_modified",hash:{},data:i}):r)+"</div>\n    </div>\n\n    \x3c!-- tabs --\x3e\n"+(null!=(a=t.if.call(e,null!=e?e.noDocuments:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.program(13,i,0),data:i}))?a:"")+"\n\n"},2:function(e,t,n,i){var a;return'    <div class="pull-right" style="position:relative;z-index:1">\n\n'+(null!=(a=t.if.call(e,null!=e?e.largeLibrary:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?a:"")+"    </div>\n"},3:function(e,t,n,i){return'            <button\n                    class="btn btn-default bigquery-export"\n                    data-placement="bottom"\n                    title="large libraries can take some time to export"\n                    data-toggle="tooltip"\n            >\n                <i class="icon-loading" style="display:none"></i>\n                <i class="fa fa-arrow-right"></i> View library in search results page\n            </button>\n'},5:function(e,t,n,i){var a;return null!=(a=t.if.call(e,null!=e?e.noDocuments:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:""},6:function(e,t,n,i){return'            <div title="Add some papers to this library to gain this option">\n                <button class="btn btn-default bigquery-export disabled" disabled>\n                    <i class="icon-loading" style="display:none"></i>\n                    <i class="fa fa-arrow-right"></i> View library in search results page\n                </button>\n            </div>\n'},8:function(e,t,n,i){return'            <button class="btn btn-default bigquery-export">\n                <i class="icon-loading" style="display:none"></i>\n                <i class="fa fa-arrow-right"></i> View library in search results page\n            </button>\n        '},10:function(e,t,n,i){var a;return'        \x3c!-- tab navigation works for only library page and optionally admin --\x3e\n        <ul class="s-library-nav-tabs">\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="icon-export"></i> Export</li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"><i class="icon-explore"></i> Metrics </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="fa fa-eye"></i> Visualize </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},11:function(e,t,n,i){return" active "},13:function(e,t,n,i){var a;return'        <ul class="s-library-nav-tabs" style="position:relative;top:40px;">\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n            <li class="tab s-tab dropdown '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"export",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <a data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="icon-export"></i> Export\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </a>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="export-bibtex">BibTeX</li>\n                    <li data-tab="export-aastex">AASTeX</li>\n                    <li data-tab="export-endnote">EndNote</li>\n                    <li data-tab="export-ris">RIS</li>\n                    <li data-tab="export-classic">ADS Classic</li>\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"metrics",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="metrics"><i class="icon-explore"></i> Metrics </li>\n            <li class="tab s-tab dropdown  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"visualization",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <div data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="fa fa-eye"></i> Visualize\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </div>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="visualization-AuthorNetwork">Author Network</li>\n                    <li data-tab="visualization-PaperNetwork">Paper Network</li>\n                    <li data-tab="visualization-ConceptCloud">Concept Cloud <small>(currently limited to first 100 records)</small></li>\n                    \x3c!--<li data-tab="visualization-BubbleChart">Bubble Chart</li>--\x3e\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"citation_helper",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="citation_helper"><i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},15:function(e,t,n,i){var a,r;return"\x3c!-- not public --\x3e\n\n"+(null!=(a=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.program(21,i,0),data:i}))?a:"")+'\n    \x3c!-- library info/admin drawer--\x3e\n\n    <div class="s-library-info">\n        <div class="col-sm-3"><h5>Number of Papers:</h5>'+this.escapeExpression("function"==typeof(r=null!=(r=t.num_documents||(null!=e?e.num_documents:e))?r:t.helperMissing)?r.call(e,{name:"num_documents",hash:{},data:i}):r)+'</div>\n        <div class="col-sm-3"><h5>Date Created:</h5><span>'+this.escapeExpression("function"==typeof(r=null!=(r=t.date_created||(null!=e?e.date_created:e))?r:t.helperMissing)?r.call(e,{name:"date_created",hash:{},data:i}):r)+'</span></div>\n        <div class="col-sm-3"> <h5>Date Last Modified:</h5>'+this.escapeExpression("function"==typeof(r=null!=(r=t.date_last_modified||(null!=e?e.date_last_modified:e))?r:t.helperMissing)?r.call(e,{name:"date_last_modified",hash:{},data:i}):r)+'</div>\n        <div class="col-sm-3"><h5>Owner:</h5>'+this.escapeExpression("function"==typeof(r=null!=(r=t.owner||(null!=e?e.owner:e))?r:t.helperMissing)?r.call(e,{name:"owner",hash:{},data:i}):r)+"</div>\n        <br/>\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"read",{name:"compare",hash:{},fn:this.program(26,i,0),inverse:this.program(28,i,0),data:i}))?a:"")+"\n    </div>\n\n    \x3c!-- tabs --\x3e\n"+(null!=(a=t.if.call(e,null!=e?e.noDocuments:e,{name:"if",hash:{},fn:this.program(35,i,0),inverse:this.program(38,i,0),data:i}))?a:"")+"\n\n"},16:function(e,t,n,i){var a,r;return'    <div class="pull-right" style="position:relative;z-index:1">\n\n'+(null!=(a=t.if.call(e,null!=e?e.largeLibrary:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?a:"")+'\n    </div>\n    <div class="editable-item">\n        <h2>'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+' <button class="btn btn-link toggle-form" data-field="name">edit</button></h2>\n        <form class="hidden" data-field="name">\n            <label  class="sr-only" for="#edit-library-title"> Change title </label>\n            <input class="form-control" type="text" id="edit-library-title" value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+'" maxlength="50"/>\n            <button class="btn btn-small btn-success" type="submit"><i class="fa fa-check"></i> submit</button>\n            <button class="btn btn-small btn-default" type="reset"> cancel</button>\n        </form>\n    </div>\n    <div class="editable-item">\n        <span>\n            <b>description</b>\n            <button class="btn btn-link toggle-form" data-field="description">edit</button>\n        </span>\n        <p>\n           '+(null!=(a=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.program(19,i,0),data:i}))?a:"")+'\n        </p>\n        <form class="hidden" data-field="description">\n            <label class="sr-only" for="#edit-library-description"> Change description </label>\n            <textarea class="form-control" id="edit-library-description" maxlength="200">'+this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)+'</textarea>\n            <button class="btn btn-small btn-success" type="submit"><i class="fa fa-check"></i> submit</button>\n            <button class="btn btn-small btn-default" type="reset">cancel</button>\n        </form>\n    </div>\n\n'},17:function(e,t,n,i){var a;return this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)},19:function(e,t,n,i){return"(none) "},21:function(e,t,n,i){var a,r;return'\n    <div class="s-library-title">\n        <h2>'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+'</h2>\n    </div>\n    <div class="s-library-description">\n        <p>\n'+(null!=(a=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(22,i,0),inverse:this.program(24,i,0),data:i}))?a:"")+"        </p>\n    </div>\n\n"},22:function(e,t,n,i){var a;return"            "+this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)+"\n"},24:function(e,t,n,i){return"            (none)\n"},26:function(e,t,n,i){return'        <br/>\n        <p><i class="fa fa-cog"></i> You can <b>read</b> this library, but cannot alter it in any way. </p>\n\n'},28:function(e,t,n,i){var a,r;return'\n            <button class="btn btn-default"  type="button" data-toggle="collapse" data-target="#library-actions" aria-expanded="false" aria-controls="#library-actions">\n                <i class="fa fa-cog"></i> View editing options (You have <b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.permission||(null!=e?e.permission:e))?r:t.helperMissing)?r.call(e,{name:"permission",hash:{},data:i}):r)+'</b> privileges)\n            </button>\n            <div class="collapse" id="library-actions" style="padding-top: 15px">\n'+(null!=(a=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(29,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"read",{name:"compare",hash:{operator:"!=="},fn:this.program(31,i,0),inverse:this.noop,data:i}))?a:"")+"\n"+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"owner",{name:"compare",hash:{},fn:this.program(33,i,0),inverse:this.noop,data:i}))?a:"")+"            </div>\n\n"},29:function(e,t,n,i){return"                <p>\n                    To <b>change the title or description</b>  of the library, click on the edit links above.\n                </p>\n"},31:function(e,t,n,i){return'                <p>\n                    To <b>add papers</b> to this library, perform a search in ADS and look for the  "add to libraries" button on the right.\n                </p>\n                <p>\n                    To <b>remove papers</b> from this library, click on the red "x" buttons next to each paper in the library list.\n                </p>\n'},33:function(e,t,n,i){return'                <p>\n                    To <b>make this library public</b>, click on the "Manage Access" tab below.\n                </p>\n                <p> To <b>delete</b>  this library, click on the button that follows.\n                    Once you click this button, the library will be deleted forever!\n                </p>\n                <button class="btn btn-danger btn-sm delete-library"><i class="fa fa-times"></i> Delete this library</button>\n'},35:function(e,t,n,i){var a;return'        \x3c!-- tab navigation works for only library page and optionally admin --\x3e\n        <ul class="s-library-nav-tabs">\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n'+(null!=(a=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?a:"")+'\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="icon-export"></i> Export</li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"><i class="icon-explore"></i> Metrics </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="fa fa-eye"></i> Visualize </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"><i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},36:function(e,t,n,i){var a;return'            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"admin",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="admin"><i class="fa fa-key"></i> Manage Access</li>\n'},38:function(e,t,n,i){var a;return'        \x3c!-- extended tab navigation should work --\x3e\n        <ul class="s-library-nav-tabs">\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n'+(null!=(a=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?a:"")+'            <li class="tab s-tab dropdown '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"export",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <a  data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="icon-export"></i> Export\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </a>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="export-bibtex">BibTeX</li>\n                    <li data-tab="export-aastex">AASTeX</li>\n                    <li data-tab="export-endnote">EndNote</li>\n                    <li data-tab="export-ris">RIS</li>\n                    <li data-tab="export-classic">ADS Classic</li>\n                    <li data-tab="export-authoraff">Author Affiliation</li>\n                    <li data-tab="export-default">Other Formats</li>\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"metrics",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="metrics"><i class="icon-explore"></i> Metrics </li>\n            <li class="tab s-tab dropdown  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"visualization",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'">\n                <div data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="fa fa-eye"></i> Visualize\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </div>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="visualization-AuthorNetwork">Author Network</li>\n                    <li data-tab="visualization-PaperNetwork">Paper Network</li>\n                    <li data-tab="visualization-ConceptCloud">Concept Cloud <small>(currently limited to first 100 records)</small></li>\n                    \x3c!--<li data-tab="visualization-BubbleChart">Bubble Chart</li>--\x3e\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"citation_helper",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-tab="citation_helper"><i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\x3c!--duplicating some stuff here in the interests of simplicity, maybe that's not ideal?--\x3e\n\n"+(null!=(a=t.if.call(e,null!=e?e.publicView:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(15,i,0),data:i}))?a:"")},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/library-header",n),n}),define("js/widgets/library_individual/views/library_header",["marionette","hbs!js/widgets/library_individual/templates/library-header","moment","bootstrap"],function(e,t,n,i){var a=Backbone.Model.extend({initialize:function(e,t){t=t||{},this.on("change:permission",this.checkEditPermission)},defaults:function(){return{active:"library",date_created:void 0,date_last_modified:void 0,description:void 0,id:void 0,name:void 0,num_documents:0,num_users:0,permission:"read",owner:void 0,public:!1,currentEditField:void 0}},checkEditPermission:function(){"admin"==this.get("permission")||"owner"==this.get("permission")?this.set("edit",!0):this.set("edit",!1)}}),r=e.ItemView.extend({template:t,events:{"click .editable-item .toggle-form":"showForm","click .editable-item .btn-success":"submitEdit","click .editable-item .btn-default":"cancelEdit","click li[data-tab]:not(.active)":"triggerSubviewNavigate","click .delete-library":"triggerDeleteLibrary","click .bigquery-export":"triggerStartSearch"},modelEvents:{change:"render"},onRender:function(){this.$('[data-toggle="tooltip"]').tooltip()},formatDate:function(e){return n.utc(e).local().format("MMM D YYYY, h:mma")},serializeData:function(){var e=this.model.toJSON();return e.date_last_modified=this.formatDate(e.date_last_modified),e.date_created=this.formatDate(e.date_created),this.model.get("num_documents")>=2e3&&(e.largeLibrary=!0),0===this.model.get("num_documents")&&(e.noDocuments=!0),e},showForm:function(e){this.currentEditField=$(e.target).data("field");var t='form[data-field="'+this.currentEditField+'"]';$(t).removeClass("hidden")},submitEdit:function(e){e.preventDefault();var t='form[data-field="'+this.currentEditField+'"]',n=$(t).find("input, textarea").val(),i={};if(0===n.length||n===this.model.get(this.currentEditField))return this.cancelEdit(e);i[this.currentEditField]=n,this.trigger("updateVal",i),$(e.target).html('<i class="fa fa-spinner fa-pulse"></i>')},cancelEdit:function(e){e.preventDefault();var t=$(e.currentTarget).parent();t.find("input").val(this.model.get("name")),t.find("textarea").val(this.model.get("description")),t.addClass("hidden")},triggerSubviewNavigate:function(e){var t,n,i=$(e.currentTarget).data("tab");i.indexOf("-")>-1?(t=i.split("-")[0],n=i.split("-")[1]):t=i,this.trigger("navigate",t,n)},triggerDeleteLibrary:function(){this.trigger("delete-library")},triggerStartSearch:function(){this.$(".bigquery-export i").css("display","none"),this.$(".bigquery-export .icon-loading").css("display","inline-block"),this.trigger("start-search")}});return r.Model=a,r}),define("hbs!js/widgets/library_individual/templates/manage-permissions-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n\n<div class="public-container">\n\n</div>\n\n<h3>Library Collaborators</h3>\n<div class="permissions-list-container s-permissions-list-container">\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/manage-permissions-container",n),n}),define("hbs!js/widgets/library_individual/templates/make-public",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'\n    <h3><i class="fa fa-lg fa-unlock"></i> This Library is Public</h3>\n\n    <div class="s-permissions-list-container">\n\n        <p><b>Public libraries</b> are available for all to read.</p>\n        <p><b>Private libraries</b> are visible to only you and any collaborators.</p>\n\n         <p> The public address of this library is <a target="_blank" rel="noopener" href="/#/public-libraries/'+this.escapeExpression("function"==typeof(a=null!=(a=t.id||(null!=e?e.id:e))?a:t.helperMissing)?a.call(e,{name:"id",hash:{},data:i}):a)+'">'+this.escapeExpression("function"==typeof(a=null!=(a=t.host||(null!=e?e.host:e))?a:t.helperMissing)?a.call(e,{name:"host",hash:{},data:i}):a)+"/#/public-libraries/"+this.escapeExpression("function"==typeof(a=null!=(a=t.id||(null!=e?e.id:e))?a:t.helperMissing)?a.call(e,{name:"id",hash:{},data:i}):a)+'</a></p>\n         <p><button class="btn btn-danger btn-inverted public-button make-private"><i class="fa fa-lg fa-lock"></i> Make this library private. </button></p>\n\n    </div>\n\n'},3:function(e,t,n,i){return'\n        <h3> <i class="fa fa-lg fa-lock"></i> This Library is Private</h3>\n\n        <div class="s-permissions-list-container">\n\n            <p><b>Public libraries</b> are available for all to read.</p>\n            <p><b>Private libraries</b> are visible to only you and any collaborators.</p>\n\n            <p>\n              <button class="btn btn-success btn-inverted  public-button make-public"><i class="fa fa-lg fa-unlock"></i> Make this library public. </button>\n            </p>\n    </div>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"\n\n"+(null!=(a=t.if.call(e,null!=e?e.public:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"\n\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/make-public",n),n}),define("js/widgets/library_individual/views/manage_permissions",["marionette","hbs!js/widgets/library_individual/templates/manage-permissions-container","hbs!js/widgets/library_individual/templates/make-public","bootstrap"],function(e,t,n,i){var a=Backbone.Model.extend({});Backbone.Collection.extend({model:a});return e.ItemView.extend({className:"library-admin-view",initialize:function(e){this.model.set("host",window.location.host)},events:{"click .public-button":"togglePublicState"},togglePublicState:function(e){var t=$(e.target).hasClass("make-public");this.trigger("update-public-status",t)},modelEvents:{"change:public":"render"},template:t,onRender:function(){this.$(".public-container").html(n(this.model.toJSON()))}})}),define("hbs!js/widgets/library_individual/templates/layout-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="header s-header"></div>\n\n<div class="main s-main"></div>'},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/layout-container",n),n}),define("hbs!js/widgets/library_individual/templates/loading-library",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="loading-library">\n    <h3> <i class="fa fa-spinner fa-pulse"></i> Loading Library...</h3>\n</div>'},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/loading-library",n),n}),define("js/widgets/library_individual/widget",["marionette","js/components/api_query","js/widgets/base/base_widget","./views/library_header","./views/manage_permissions","hbs!js/widgets/library_individual/templates/layout-container","hbs!js/widgets/library_individual/templates/loading-library"],function(e,t,n,i,a,r,s){var o=e.ItemView.extend({template:s}),l=e.LayoutView.extend({className:"library-widget s-library-widget",template:r,regions:{header:".header",main:".main"}}),c=Backbone.Model.extend({defaults:function(){return{id:void 0,subView:void 0,publicView:!1}}});return n.extend({initialize:function(e){e=e||{},this.view=new l,this.model=new c,this.view.render(),this.headerModel=new i.Model,this.headerView=new i({model:this.headerModel}),this.view.header.show(this.headerView)},activate:function(e){this.setBeeHive(e),_.bindAll(this);var t=e.getService("PubSub");t.subscribe(t.LIBRARY_CHANGE,this.onLibraryChange),this.headerView.on("all",this.handleHeaderEvents,this)},onLibraryChange:function(e,t){"change"==t.ev&&t.id==this.model.get("id")&&this.updateSubView()},updateHeader:function(){var e=function(e){var t=this.getBeeHive().getObject("User").isLoggedIn();this.headerModel.set(_.extend(e,{active:this.model.get("subView"),publicView:this.model.get("publicView"),loggedIn:t}))}.bind(this);this.getBeeHive().getObject("LibraryController").getLibraryMetadata(this.model.get("id")).done(e)},updateSubView:function(){this.view.main.empty();var e=this.model.get("id"),t=this.model.get("subView");if(e&&t)if(this.view.main.show(new o),this.updateHeader(),["library","export","authoraff","metrics","visualization","citation_helper"].indexOf(t)>-1)this.view.main.empty();else{if("admin"!==t)throw new Error("don't recognize that subview: ",t);var n=new a({model:this.headerModel});n.on("all",this.handleAdminEvents,this),this.view.main.show(n)}else console.warn("library widget's updateSubView called without requisite library id and view name in model")},setSubView:function(e){e&&(e=_.extend({subView:"library",publicView:!1},e),this.model.set(e)),this.updateSubView()},handleAdminEvents:function(e,t,n){var i=this;switch(e){case"update-public-status":var a={public:t},r=this.model.get("id");this.getBeeHive().getObject("LibraryController").updateLibraryMetadata(r,a).done(function(e,t){i.headerModel.set("public",e.public)}).fail(function(){})}},handleHeaderEvents:function(e,n,i){var a=this,r=this.model.get("id"),s=this.getBeeHive().getService("PubSub"),o=this.getBeeHive().getObject("LibraryController");switch(e){case"updateVal":o.updateLibraryMetadata(r,n).done(function(e){a.headerModel.set(e)});break;case"navigate":this.model.set("subView",n);var l={id:r,publicView:this.model.get("publicView"),subView:n};if(_.contains(["export","metrics","visualization","citation_helper"],l.subView)){switch(n){case"export":l.widgetName="ExportWidget",l.additional={format:i,libid:r};break;case"visualization":l.widgetName=i,l.additional={};break;case"metrics":l.widgetName="Metrics",l.additional={};break;case"citation_helper":l.widgetName="CitationHelper",l.additional={libid:r,permission:this.headerModel.get("permission"),libname:this.headerModel.get("name")}}s.publish(s.NAVIGATE,"library-"+n,l)}else"library"===l.subView?s.publish(s.NAVIGATE,"IndividualLibraryWidget",l):"admin"===l.subView&&s.publish(s.NAVIGATE,"LibraryAdminView",l);break;case"delete-library":o.deleteLibrary(r,this.headerModel.get("name"));break;case"start-search":o.getLibraryBibcodes(this.model.get("id")).done(function(e){var n=new t({__bigquery:e,__bigquerySource:"Library: "+a.headerModel.get("name"),sort:"date desc"});s.publish(s.START_SEARCH,n)})}}})}),define("hbs!js/widgets/libraries_all/templates/libraries-list-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" s-sort-active "},3:function(e,t,n,i){var a;return"  "+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.order:e,"asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?a:"")},4:function(e,t,n,i){return" asc "},6:function(e,t,n,i){return" desc "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<h2>All ADS Libraries</h2>\n\n<table class="libraries-list-container table table-hover table-responsive">\n    <thead>\n    <tr>\n        <th>\n            \x3c!--page num --\x3e\n        </th>\n        <th>\n           \x3c!--public/private status--\x3e\n        </th>\n        <th> Library\n            <button title="sort by library name" class="btn btn-xs '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"name",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' btn-default" data-sort=\'{"sort":"name","type":"string"}\'><i class="fa fa-lg fa-sort"></i>'+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"name",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'</button>\n        </th>\n        <th> Papers\n            <button title="sort by number of papers"  class="btn btn-xs '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"num_documents",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' btn-default" data-sort=\'{"sort":"num_documents","type":"int"}\' ><i class="fa fa-lg fa-sort"></i> '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"num_documents",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'</button>\n        </th>\n        <th> Permission\n            <button title="sort by permission status (admin --\x3e read only)" class="btn btn-xs '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"permission",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' btn-default" data-sort=\'{"sort":"permission","type":"permission"}\'><i class="fa fa-lg fa-sort"></i> '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"permission",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'</button>\n        </th>\n        <th> Last Modified\n            <button title="sort by last modified" class="btn btn-xs '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date_last_modified",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+' btn-default" data-sort=\'{"sort":"date_last_modified","type":"date"}\'><i class="fa fa-lg fa-sort"></i> '+(null!=(a=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date_last_modified",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"</button>\n        </th>\n    </tr>\n    </thead>\n\n    <tbody></tbody>\n</table>\n"},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/libraries-list-container",n),n}),define("hbs!js/widgets/libraries_all/templates/library-item",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <i class="fa fa-lg fa-unlock" title="this library is public"></i>\n'},3:function(e,t,n,i){return'    <i class="fa fa-lg fa-lock text-light" title="this library is private"></i>\n'},5:function(e,t,n,i){var a;return'<p class="library-description">'+this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)+"</p> "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return"\n\n<td>\n    "+this.escapeExpression("function"==typeof(r=null!=(r=t.libNum||(null!=e?e.libNum:e))?r:t.helperMissing)?r.call(e,{name:"libNum",hash:{},data:i}):r)+"\n</td>\n<td>\n"+(null!=(a=t.if.call(e,null!=e?e.public:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+'</td>\n\n<td>\n\n    <a href="#user/libraries/'+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+'"><h3 class="s-library-title">'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+"</h3></a>\n    "+(null!=(a=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"\n\n</td>\n\n<td>"+this.escapeExpression("function"==typeof(r=null!=(r=t.num_documents||(null!=e?e.num_documents:e))?r:t.helperMissing)?r.call(e,{name:"num_documents",hash:{},data:i}):r)+"</td>\n\n<td>"+this.escapeExpression("function"==typeof(r=null!=(r=t.permission||(null!=e?e.permission:e))?r:t.helperMissing)?r.call(e,{name:"permission",hash:{},data:i}):r)+"</td>\n\n<td>"+this.escapeExpression("function"==typeof(r=null!=(r=t.date_last_modified||(null!=e?e.date_last_modified:e))?r:t.helperMissing)?r.call(e,{name:"date_last_modified",hash:{},data:i}):r)+"</td>\n"},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/library-item",n),n}),define("hbs!js/widgets/libraries_all/templates/no-libraries",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<br/>\n<br/>\n<p>\n    <b>You don\'t have any libraries yet!</b>\n</p>\n<p>\n    <a href="/#/">Search ADS</a> to find papers that you want to add.\n</p>\n\n<br/>\n<br/>'},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/no-libraries",n),n}),define("hbs!js/widgets/libraries_all/templates/loading-libraries",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<h3> <i class="fa fa-spinner fa-pulse"></i> Loading Libraries...</h3>'},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/loading-libraries",n),n}),define("js/widgets/libraries_all/views/view_all_libraries",["marionette","hbs!js/widgets/libraries_all/templates/libraries-list-container","hbs!js/widgets/libraries_all/templates/library-item","hbs!js/widgets/libraries_all/templates/no-libraries","hbs!js/widgets/libraries_all/templates/loading-libraries","moment"],function(e,t,n,i,a,r){var s=e.ItemView.extend({formatDate:function(e){return r.utc(e).local().format("MMM D YYYY, h:mma")},serializeData:function(){var t=this.model.toJSON();return t.libNum=e.getOption(this,"libNum"),t.date_last_modified=this.formatDate(t.date_last_modified),t},template:n,tagName:"tr",triggers:{click:"navigateToLibrary"}});return e.CompositeView.extend({initialize:function(e){e=e||{}},template:t,childViewContainer:".libraries-list-container tbody",childView:s,childViewOptions:function(e,t){return{libNum:t+1}},childEvents:{navigateToLibrary:"triggerNavigate"},events:{"click thead button":"sortCollection"},modelEvents:{change:function(){this.collection.sort(),this.render()}},collectionEvents:{reset:function(){this.collection.sort(),this.render()}},triggerNavigate:function(e){this.trigger("navigate:library",e.model.get("id"))},sortCollection:function(e){var t=$(e.currentTarget).data("sort"),n=t.sort,i=n!==this.model.get("sort")?"asc":"asc"==this.model.get("order")?"desc":"asc";this.model.set({sort:n,type:t.type,order:i})},render:function(){return this.collection.length?e.CompositeView.prototype.render.apply(this,arguments):(this.$el.html(i()),this)}})}),define("js/widgets/libraries_all/widget",["marionette","js/widgets/base/base_widget","./views/view_all_libraries"],function(e,t,n){var i=Backbone.Model.extend({defaults:function(){return{name:void 0,description:void 0,id:void 0,permission:void 0,num_papers:0,date_created:void 0,date_last_modified:void 0}}}),a=Backbone.Model.extend({defaults:{sort:"name",order:"asc",type:"string"}}),r=Backbone.Collection.extend({initialize:function(e,t){this.containerModel=new a,this.options=t},model:i,comparator:function(e,t){var n=this.containerModel.get("sort"),i=this.containerModel.get("type"),a=this.containerModel.get("order");if("string"==i)return"asc"==a?e.get(n).localeCompare(t.get(n)):-e.get(n).localeCompare(t.get(n));if("date"==i)return"asc"==a?new Date(e.get(n))-new Date(t.get(n)):new Date(t.get(n))-new Date(e.get(n));if("permission"==i){var r=["read","write","admin","owner"];return"asc"==a?r.indexOf(e.get(n))-r.indexOf(t.get(n)):r.indexOf(t.get(n))-r.indexOf(e.get(n))}return"int"==i?"asc"==a?e.get(n)-t.get(n):t.get(n)-e.get(n):void 0}}),s=e.LayoutView.extend({className:"all-libraries-widget s-all-libraries-widget",template:function(){return'<div class="all-libraries-container"></div>'},regions:{container:".all-libraries-container"}});return t.extend({initialize:function(e){this.view=new s,this.libraryCollection=new r},activate:function(e){var t=this;this.setBeeHive(e),_.bindAll(this),this.getPubSub().subscribe(this.getPubSub().LIBRARY_CHANGE,this.updateCollection),this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.libraryCollection.reset(e)})},updateCollection:function(e){this.libraryCollection.reset(e)},setSubView:function(e){switch(e.view){case"libraries":var t=new n({collection:this.libraryCollection,model:this.libraryCollection.containerModel});t.on("all",this.handleSubViewEvents),this.view.container.show(t)}},handleSubViewEvents:function(e,t,n){switch(e){case"navigate:library":this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{subView:"library",id:t})}}})}),define("hbs!js/widgets/library_list/templates/library-container",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){return'        <h3 class="record-deleted"><i class="icon-success"/> Record successfully deleted</h3>\n'},3:function(e,t,n,i){return'      <div id="sort-container"></div>\n'},5:function(e,t,n,i){var a;return null!=(a=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"    ",helpers:t,partials:n}))?a:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return'<div class="s-library-actions">\n'+(null!=(a=t.if.call(e,null!=e?e.itemDeleted:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.hasRecords:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+'</div>\n<hr/>\n\n<ul class="library-list-container s-library-list-container">\n</ul>\n\n'+(null!=(a=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+"\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/library_list/templates/library-container",n),n}),define("hbs!js/widgets/library_list/templates/library-item-edit",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var a;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'/citations">cited: '+this.escapeExpression("function"==typeof(a=null!=(a=t.num_citations||(null!=e?e.num_citations:e))?a:t.helperMissing)?a.call(e,{name:"num_citations",hash:{},data:i}):a)+"</a>\n"},3:function(e,t,n,i){var a;return'                <div class="letter-icon s-letter-icon">\n\n                    <button class="btn-link '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'"\n                            aria-disabled="'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?a:"")+'">\n                        <i class="s-text-icon" aria-label="quick access to full text links"></i>\n                    </button>\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?a:"")+'                </div>\n                <div class="letter-icon s-letter-icon">\n\n                    <button class="btn-link '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'"\n                            aria-disabled="'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(14,i,0),data:i}))?a:"")+'">\n                        <i class="s-list-icon" aria-label="quick links to lists of references, citations and more"></i>\n                    </button>\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?a:"")+'                </div>\n                <div class="letter-icon s-letter-icon">\n\n                    <button class="btn-link  '+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?a:"")+'"\n                            aria-disabled="'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(19,i,0),data:i}))?a:"")+'">\n                        <i class="s-data-icon" aria-label="quick links to data associated with this article"></i>\n                    </button>\n\n'+(null!=(a=t.if.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.noop,data:i}))?a:"")+"                </div>\n"},4:function(e,t,n,i){return" active-link s-active-link "},6:function(e,t,n,i){return" false "},8:function(e,t,n,i){return" true "},10:function(e,t,n,i){var a;return'                    <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.text:a,{name:"each",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+"                    </ul>\n"},11:function(e,t,n,i){var a;return"                        <li><a "+(null!=(a=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?a:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'"\n                            target="_blank" rel="noopener">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},12:function(e,t,n,i){return'class="s-open-access"'},14:function(e,t,n,i){return" true"},16:function(e,t,n,i){var a;return'                    <ul class="hidden list-unstyled list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.list:a,{name:"each",hash:{},fn:this.program(17,i,0),inverse:this.noop,data:i}))?a:"")+"                    </ul>\n"},17:function(e,t,n,i){return'                        <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},19:function(e,t,n,i){return" true  "},21:function(e,t,n,i){var a;return'                    <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(a=t.each.call(e,null!=(a=null!=e?e.links:e)?a.data:a,{name:"each",hash:{},fn:this.program(22,i,0),inverse:this.noop,data:i}))?a:"")+"                    </ul>\n"},22:function(e,t,n,i){var a;return"                        <li><a "+(null!=(a=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?a:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.url:e,e))+'" target="_blank" rel="noopener"\n                            >'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},24:function(e,t,n,i){return'            <button class="btn btn-sm btn-danger btn-inverse remove-record pull-right" title="delete record permanently from this library"><i class="fa fa-times"></i></button>\n'},26:function(e,t,n,i){var a,r;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'/abstract">\n                <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n            </a>\n"},28:function(e,t,n,i){var a,r;return'            <h3 class="s-results-title">'+(null!=(a="function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)?a:"")+"</h3>\n"},30:function(e,t,n,i){return'                <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},32:function(e,t,n,i){var a;return"                <li><em>and "+this.escapeExpression("function"==typeof(a=null!=(a=t.extraAuthors||(null!=e?e.extraAuthors:e))?a:t.helperMissing)?a.call(e,{name:"extraAuthors",hash:{},data:i}):a)+" more</em></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,r;return'\n<div class="col-sm-12">\n\n    <div class="row s-top-row">\n        <div class="col-sm-1 col-xs-2 s-checkbox-col s-top-row-col">\n            '+this.escapeExpression("function"==typeof(r=null!=(r=t.indexToShow||(null!=e?e.indexToShow:e))?r:t.helperMissing)?r.call(e,{name:"indexToShow",hash:{},data:i}):r)+'.\n        </div>\n        <div class="col-sm-3 col-xs-4 s-top-row-col identifier s-identifier">\n            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'/abstract" aria-label="bibcode">\n                '+this.escapeExpression("function"==typeof(r=null!=(r=t.identifier||(null!=e?e.identifier:e))?r:t.helperMissing)?r.call(e,{name:"identifier",hash:{},data:i}):r)+'\n            </a>\n        </div>\n        <div class="col-sm-2 s-top-row-col" aria-label="date published">\n            '+this.escapeExpression("function"==typeof(r=null!=(r=t.formattedDate||(null!=e?e.formattedDate:e))?r:t.helperMissing)?r.call(e,{name:"formattedDate",hash:{},data:i}):r)+'\n        </div>\n        <div class="col-sm-2 col-xs-6 s-top-row-col" title="citation count">\n'+(null!=(a=t.if.call(e,null!=e?e.num_citations:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'        </div>\n        <div class="col-sm-4">\n            <span class="s-results-links">\n'+(null!=(a=t.if.call(e,null!=e?e.links:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?a:"")+"            </span>\n\n"+(null!=(a=t.if.call(e,null!=e?e.permission:e,{name:"if",hash:{},fn:this.program(24,i,0),inverse:this.noop,data:i}))?a:"")+'        </div>\n\n    </div>\n    <div class="row">\n\n        <div class="col-xs-10 col-xs-offset-1">\n'+(null!=(a=t.if.call(e,null!=e?e.identifier:e,{name:"if",hash:{},fn:this.program(26,i,0),inverse:this.program(28,i,0),data:i}))?a:"")+'        </div>\n    </div>\n\n    <div class="row">\n        <div class="col-xs-10 col-xs-offset-1">\n            <ul class="list-inline just-authors s-results-authors" aria-label="authors">\n'+(null!=(a=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(30,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(32,i,0),inverse:this.noop,data:i}))?a:"")+"            </ul>\n\n        </div>\n\n    </div>\n\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/library_list/templates/library-item-edit",n),n}),define("hbs!js/widgets/library_list/templates/empty-collection",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div style="padding: 40px 5%">\n    <p>You haven\'t added any bibcodes yet!</p>\n    <p>\n        If you have edit privileges for this library, you can  <a href="#">make a search in ADS </a>\n        and add papers using the blue "libraries" widget on the right.\n    </p>\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/library_list/templates/empty-collection",n),n}),define("js/widgets/library_list/widget",["marionette","js/widgets/list_of_things/item_view","js/widgets/list_of_things/widget","js/widgets/list_of_things/paginated_view","js/widgets/list_of_things/model","hbs!js/widgets/library_list/templates/library-container","hbs!js/widgets/library_list/templates/library-item-edit","hbs!js/widgets/library_list/templates/empty-collection","js/mixins/link_generator_mixin","js/mixins/papers_utils","js/mixins/formatter","js/components/api_query","js/components/api_request","js/components/api_response","js/components/api_targets","js/mixins/add_stable_index_to_collection","js/mixins/add_secondary_sort","bootstrap","hbs!js/wraps/widget/loading/template","es6!js/widgets/sort/widget.jsx","es6!js/widgets/sort/redux/modules/sort-app"],function(e,t,n,i,a,r,s,o,l,c,u,d,h,p,f,g,m,b,v,y,w){var S=t.extend({template:s,triggers:{"click .remove-record":"removeRecord"},className:"library-item s-library-item write-permission",render:e.ItemView.prototype.render,serializeData:function(){var t=this.model.toJSON();return _.extend(t,{permission:e.getOption(this,"permission")})}}),E=e.ItemView.extend({template:function(e){return e.query||""===e.query?o(e):v(_.extend(e,{widgetLoadingSize:"big",hideCloseButton:!0}))}}),x=i.extend({initialize:function(){this.sortWidget=new y,i.prototype.initialize.apply(this,arguments),this.sortWidget.onSortChange=_.bind(this.onSortChange,this)},childView:S,template:r,className:"library-detail-view",childViewContainer:".library-list-container",emptyView:E,events:{"click a.page-control":"changePageWithButton","keyup input.page-control":"tabOrEnterChangePageWithInput","click .per-page":"changePerPage"},modelEvents:{change:"render"},onSortChange:function(){var e=this.sortWidget.store.getState().get("SortApp"),t=e.get("sort").get("id")+" "+e.get("direction");this.model.set("sort",t),this.trigger("changeSort")},childViewOptions:function(){if(this.model.get("editRecords"))return{permission:!0}},childEvents:{removeRecord:"removeRecord"},removeRecord:function(e){e.$(".remove-record").html('<i class="fa fa-spinner fa-pulse"></i>');var t=e.model.get("bibcode");this.trigger("removeRecord",t)},render:function(){return i.prototype.render.apply(this,arguments),this.$("#sort-container").html(this.sortWidget.render().el),this}}),A=n.extend({setData:function(e){this.model.set({public:e.publicView,libraryID:e.id,editRecords:e.editRecords})},initialize:function(e){(e=e||{}).collection=new a,e.view=new x({collection:e.collection,model:this.model}),n.prototype.initialize.apply(this,[e]),this.view.model=this.model,this.listenTo(this.model,"change:libraryID",function(){this.reset()}),this.listenTo(this.view,"all",this.handleViewEvents)},changeSort:function(){var e=this.model.get("sort");this.reset(),this.dispatchRequest({sort:e})},defaultQueryArguments:{fl:"title,bibcode,author,keyword,pub,aff,volume,year,links_data,[citations],property,esources,data,pubdate,abstract",rows:25,start:0,sort:"date desc"},activate:function(e){n.prototype.activate.apply(this,[].slice.apply(arguments)),this.view.sortWidget.activate(e),this.updateSortWidget()},updateSortWidget:function(e){var t=this.view.sortWidget;e=(e=e||this.getCurrentQuery()).toJSON();var n=t.extractSort(e&&e.sort&&e.sort[0]||"");t.store.dispatch(w.setQuery(e)),t.store.dispatch(w.setSort(n.sort,!0)),t.store.dispatch(w.setDirection(n.direction,!0)),t.store.dispatch(w.setLocked(!1))},onShow:function(){this.dispatchRequest()},composeRequest:function(e){var t=f.LIBRARIES+"/"+this.model.get("libraryID");return new h({target:t,query:e,options:{context:this,contentType:"application/x-www-form-urlencoded",done:this.createApiResponse.bind(this,e),fail:this.handleError}})},handleError:function(e){console.error("data for library list view not received",e)},createApiResponse:function(e,t){if(this.model.set("itemDeleted",!1),_.isString(t.solr))throw new Error(t.solr+": list of things widget can't render");t.solr.response.docs.length>1&&this.model.set("hasRecords",!0);var n=t.solr.responseHeader.params.sort;this.model.set({sort:n.split(",")[0]}),(t=new p(t.solr)).setApiQuery(e),this.processResponse(t),this.updateSortWidget(e)},executeRequest:function(e){this.getBeeHive().getService("Api").request(e)},dispatchRequest:function(e){var t=this.customizeQuery(new d);e&&t.set(e),m.addSecondarySort(t);var n=this.composeRequest(t);this.getBeeHive().getService("Api").request(n)},processDocs:function(e,t,n){if(!e.has("response"))return[];var i=e.get("response").start||n.start||0;t=g.addPaginationToDocs(t,i),_.each(t,function(e,t){e.identifier=e.bibcode,e.noCheckbox=!0;if(e.author&&e.author.length>3){e.extraAuthors=e.author.length-3;var n=e.author.slice(0,3)}else e.author&&(n=e.author);if(e.author){var i=n.length-1;e.authorFormatted=_.map(n,function(e,t){return t==i||0==i?e:e+";"})}return e["[citations]"]&&e["[citations]"].num_citations>0?e.num_citations=this.formatNum(e["[citations]"].num_citations):e.num_citations=0,e.formattedDate=e.pubdate?this.formatDate(e.pubdate,{format:"yy/mm",missing:{day:"yy/mm",month:"yy"}}):void 0,e.shortAbstract=e.abstract?this.shortenAbstract(e.abstract):void 0,e},this);try{t=this.parseLinksData(t)}catch(e){}return t},reset:function(){this.model.set({hasRecords:!1}),n.prototype.reset.apply(this,arguments)},handleViewEvents:function(e,t,n){var i=this;switch(e){case"changeSort":this.changeSort(t);break;case"removeRecord":var a={bibcode:[t],action:"remove"},r=this.model.get("libraryID");this.getBeeHive().getObject("LibraryController").updateLibraryContents(r,a).done(function(){i.reset(),i.model.set("itemDeleted",!0);var e=i.model.get("sort")?{sort:i.model.get("sort")}:{};i.dispatchRequest(e)})}}});return _.extend(A.prototype,l),_.extend(A.prototype,c),_.extend(A.prototype,u),A})}();